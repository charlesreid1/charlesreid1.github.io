<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Project Euler Problem 172
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2018-02-16T18:30:00-08:00" pubdate>Friday 02/16/2018</time>
                in 
                <a href="https://charlesreid1.github.io/category/mathematics.html">Mathematics</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/project-euler-problem-172.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li><a href="#pe172-problem">Overview: Problem 172</a></li>
<li><a href="#pe172-background">Background</a><ul>
<li><a href="#pe172-multiset">Multiset Permutations</a></li>
<li><a href="#pe172-problemsoln">A Simple Problem (And Solution)</a></li>
<li><a href="#pe172-complicated">A Slightly More Complicated Problem</a></li>
</ul>
</li>
<li><a href="#pe172-algorithm">Algorithm</a><ul>
<li><a href="#pe172-zero">Ignoring Numbers Starting with 0</a></li>
</ul>
</li>
<li><a href="#pe172-code">Code</a><ul>
<li><a href="#pe172-test">Test Cases</a></li>
<li><a href="#pe172-recursion">Recursion</a></li>
<li><a href="#pe172-pseudocode">Pseudocode</a></li>
<li><a href="#pe172-python-code">Python Code</a></li>
</ul>
</li>
<li><a href="#pe172-final">Final Answer</a></li>
</ul>
<p><br />
<br /></p>
<p><a name="pe172-problem"></a></p>
<h1>Overview: Problem 172</h1>
<p>How many 18-digit numbers <span class="math">\(n\)</span> (without leading zeros) are there 
such that no digit occurs more than three times in <span class="math">\(n\)</span>?</p>
<p><a href="https://projecteuler.net/problem=172">Link to Project Euler Problem 172</a></p>
<p><a name="pe172-background"></a></p>
<h1>Background</h1>
<p>Project Euler Problem 172 is your classic Project Euler problem: short, simple, and overwhelmingly complicated.</p>
<p>To nail this one, it's important to start simple - very simple. What I'll do is walk through the process 
of breaking this problem down to find and generalize the patterns needed to count permutations of digits.</p>
<p>First, in combinatorics problems it is important to think about what is changing, and how to count
possible outcomes one piece at a time. Then the overall pieces can be combined to get the total count. 
In this case, we can think about a case for each digit: the case of 3 occurrences, the case of 2 
occurrences, the case of 1 occurrence, and the case of 0 occurrences. Depending on the case, we limit 
our choices for later digits.</p>
<p>Let's start with a similar, but much simpler, problem: how do we construct a binary number with N 
digits and no more than m 0s and no more than m 1s?</p>
<p>In fact, let's make it even easier: how do we construct a 10 digit binary number with no more than 
5 0's and no more than 5 1's?</p>
<p>The answer is, there is only ONE way to choose no more than 5 0's and no more than 5 1's to form a 
10 digit number, and that's by having exactly 5 0's and 5 1's. Now that we know exactly how many of 
each digit we have, we can count the number of permutations of the number 0000011111 (the number of 
permutations).</p>
<p><a name="pe172-multiset"></a></p>
<h2>Multiset Permutations</h2>
<p>Note that multiset permutations are also discussed on the following wiki pages and blog posts:</p>
<ul>
<li><a href="https://charlesreid1.com/wiki/Project Euler/172">Wiki: Project Euler/172</a></li>
<li><a href="https://charlesreid1.com/wiki/Project Euler/15">Wiki: Project Euler/15</a></li>
<li><a href="https://charlesreid1.com/wiki/ Project Euler/502">Wiki: Project Euler/502</a></li>
<li><a href="https://charlesreid1.com/wiki/ AOCP/Multisets">Wiki: AOCP/Multisets</a></li>
<li><a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Blog: Shortest Lattice Paths and Multiset Permutations</a></li>
</ul>
<p>If we are selecting from a group of <span class="math">\(N_1\)</span> things of type A, <span class="math">\(N_2\)</span> things of type B, and <span class="math">\(N_3\)</span> things of type C 
to form a total of <span class="math">\(N\)</span> things, this type of combinatorics problem is called a multiset permutation, and the 
total number of ways of arranging this set of 3 things is given by:</p>
<div class="math">$$
\binom{N}{N_1, N_2, N_3} = \dfrac{N!}{N_1! N_2! N_3!}
$$</div>
<p>In fact, this generalizes, for <span class="math">\(k\)</span> classes of things we have a <span class="math">\(k\)</span>-set permutation:</p>
<div class="math">$$
\binom{N}{N_1, \dots, N_k} = \dfrac{N!}{N_1! \dots N_k!}
$$</div>
<p><a name="pe172-problemsoln"></a></p>
<h2>A Simple Problem (And Solution)</h2>
<p>Back to the problem at hand: to count the number of ways of placing 5 0s and 5 1s to form a 10 digit number.</p>
<p>Once we place 5 digits into any of the 10 available slots, that fixes the locations of the remaining 5 digits. 
However, we still have to include two 5! values, to account for all possible duplicates if we exchanged all 5 
of the 1s with one another, or all 5 of the 0s with one another. We use the expression:</p>
<div class="math">$$
\binom{10}{5} = \dfrac{10!}{5! 5!} = 10 \times 9 \times 8 \times 7 \times 6
$$</div>
<p><a name="pe172-complicated"></a></p>
<h2>A slightly More Complicated Problem</h2>
<p>To solve a slightly more complicated problem: suppose we have to assemble a 10-digit binary number from no more than 6 0s and no more than 6 1s?</p>
<p>Now we have 3 possible cases of numbers of 0s:</p>
<div class="highlight"><pre><span></span><span class="mi">4</span> <span class="mi">0</span><span class="n">s</span><span class="p">:</span> <span class="mi">0000111111</span> <span class="o">-</span> <span class="k">and</span> <span class="n">its</span> <span class="n">permutations</span>

<span class="mi">5</span> <span class="mi">0</span><span class="n">s</span><span class="p">:</span> <span class="mi">0000011111</span> <span class="o">-</span> <span class="k">and</span> <span class="n">its</span> <span class="n">permutations</span>

<span class="mi">6</span> <span class="mi">0</span><span class="n">s</span><span class="p">:</span> <span class="mi">0000001111</span> <span class="o">-</span> <span class="k">and</span> <span class="n">its</span> <span class="n">permutations</span>
</pre></div>


<p>For each of these cases, we can think of it as the "bucket" of 0s containing 4 0s (5 and 6 0s, respectively) 
and the "bucket" of 1s containing 6 1s (5 and 4 1s, respectively). We still have a number of permutations 
that we can form using this given number of 0s and 1s, given by a multiset permutation expression.</p>
<p>For each case, we have a multiset permutation expression that tells us how many permutations we can form 
from the given number of 0s and 1s:</p>
<div class="math">$$
\binom{ N }{ N_0, N_1 }
$$</div>
<p>So we have three possible outcomes, and the total number of arrangements is the sum of these three cases:</p>
<div class="math">$$
N_{perms} = \binom{ 10 }{ 6, 4} + \binom{ 10 }{ 5, 5 } + \binom{ 10 }{ 6 , 4 }
$$</div>
<p><a name="pe172-algorithm"></a></p>
<h1>Algorithm</h1>
<p>We can generalize the process. Suppose we are forming a number of length N from a number of digits/classes <span class="math">\(k\)</span> 
labeled from <span class="math">\(0 \dots k-1\)</span>, and each digit/class can only appear a maximum of <span class="math">\(m\)</span> times.</p>
<p>The number of combinations that can be formed for a given <span class="math">\(N, k, m\)</span> is given by the multiset permutation 
expression above. So the total number of permutations that can be formed is a sum of these multiset permutation 
expressions, over each possible combination of digits/classes into a number of length <span class="math">\(N\)</span>.</p>
<p>In computer science terms, we can think of this as a nested for loop or dynamic program; in mathematical terms, 
we can think of a sequence of summations whose limits depend on the variables in the other summations.</p>
<div class="math">$$
\sum_{N_1} \sum_{N_2} \dots \sum_{N_k} \binom{N}{N_0, N_1, N_2, \dots, N_{k-1}}
$$</div>
<p>where the limits of the summations are given by:</p>
<div class="math">$$
N_1 = \min \left(N - (k-1) m, 0 \right) \dots m
$$</div>
<div class="math">$$
N_2 = \min \left( N - N_1 - (k-2) m, 0 \right) \dots m
$$</div>
<p>etc...</p>
<div class="math">$$
N_{k-1} = \min \left( N - N_1 - N_2 - \dots - N_{k-2}, 0 \right) \dots m
$$</div>
<p>these all fix the number of zeros N_0:</p>
<div class="math">$$
N_0 = N - N_1 - N_2 - N_3 - \dots - N_k
$$</div>
<p>Notice that we ignore N_0 in the list of summations, because fixing the number of the first k-1 digits/classes 
(1s, 2s, 3s, ..., (k-1)s) will fix the number of 0s. Alternatively, we could count 0s and include a summation over <span class="math">\(N_0\)</span>, 
and eliminate the last summation over <span class="math">\(k-1\)</span>.</p>
<p>However, the multiset permutation expression includes ALL of the N's, from <span class="math">\(N_0\)</span> to <span class="math">\(N_{k-1}\)</span>, since the choice 
of each variable leads to additional permutations.</p>
<p>Also note that any algorithm implementing this procedure can save time by checking if, for the preceding combinations 
of <span class="math">\(N\)</span>, we have already reached the maximum possible digits that can be selected. (Alternatively, we could write the 
upper limit of the summations as expressions depending on the prior values of <span class="math">\(N_i\)</span>, but we'll keep it simple.) </p>
<p><a name="pe172-zero"></a></p>
<h2>Ignoring Numbers Starting with Zero</h2>
<p>We have one last hurdle remaining, and that is how to ignore numbers that start with 0.</p>
<p>If we think about the problem as selecting the number of times each digit is repeated, then assembling that 
selection into all possible permutations, fixing the first digit as 0 is equivalent to removing one from the 
total length of the number that must be assembled, and removing one from the possible 0s that will go in the 
final number. Thus, if we are assembling an N digit number from <span class="math">\(N_0\)</span> 0s, <span class="math">\(N_1\)</span> 1s, <span class="math">\(N_2\)</span> 2s, <span class="math">\(N_3\)</span> 3s, on up to <span class="math">\(N_9\)</span> 9s, 
then the total number of permutations is given by:</p>
<div class="math">$$
\binom{ N }{N_0, N_1, \dots, N_9}
$$</div>
<p>If we fix the first digit as 0, the remaining number of permutations is given by:</p>
<div class="math">$$
\binom{N-1}{ N_0-1, N_1, \dots, N_9 }
$$</div>
<p>Therefore, the number of permutations, excluding those beginning with 0, is written:</p>
<div class="math">$$
\binom{ N }{N_0, N_1, \dots, N_9} - \binom{N-1}{ N_0-1, N_1, \dots, N_9 }
$$</div>
<p>Also, it is important to note that if N_0 = 0 to begin with, there are no possible ways of assembling numbers that begin with 0 because there are no 0s in the number, so the second term becomes 0:</p>
<div class="math">$$
\binom{ N }{0, N_1, \dots, N_9} - 0
$$</div>
<p><a name="pe172-code"></a></p>
<h1>Code</h1>
<p><a name="pe172-test-cases"></a></p>
<h2>Test Cases</h2>
<h3>Test Case 1</h3>
<p>Assemble two digits <span class="math">\(\{0,1\}\)</span> into a 10-digit number, if each digit <span class="math">\(\{0,1\}\)</span> can occur up to 5 times.</p>
<p>In this case, we know that 0 and 1 must occur exactly 5 times each. Now we are asking how we can assemble 
two sets of 5 things into 10 slots. This is a multiset permutation problem:</p>
<div class="math">$$
\binom{10}{5,5} = \dfrac{10!}{5! \cdot 5!} = \dfrac{10 \cdot 9 \cdot 8 \cdot 7 \cdot 6}{5 \cdot 4 \cdot 3 \cdot 2 \cdot 1} = 252
$$</div>
<p>But wait! We also want to exclude numbers starting with 0, so we actually have:</p>
<div class="math">$$
\binom{10}{5, 5} - \binom{9}{4, 5} = 126
$$</div>
<p>which is half of 252 - exactly what we would expect.</p>
<h3>Test Case 2</h3>
<p>Assemble three digits <span class="math">\(\{[0, 1, 2\}\)</span> into a 6-digit number, if each digit <span class="math">\(\{0, 1, 2\}\)</span> can occur up to 3 times. No number should start with 0.</p>
<p>In the prior case, we had one outcome of number of 0s and 1s, but in this case, we have a larger number of outcomes that we might see.</p>
<p>Evaluating the expressions for the limits of <span class="math">\(N_i\)</span>, we get:</p>
<div class="math">$$
\sum_{N_0 = 0}^{3} \sum_{N_1 = \max(0, 3 - N_0) }^{3} \binom{6}{N_0, N_1, (N-N_0-N_1)}
$$</div>
<p>where <span class="math">\(N_2 = N - N_0 - N_1\)</span>. Written out, this becomes the total number of possible 6-digit numbers,</p>
<div class="math">$$
a = \binom{6}{0,3,3} + \binom{6}{1,2,3} + \binom{6}{1,3,2} + \binom{6}{2,1,3} + \binom{6}{2,2,2} + \\
\binom{6}{2,3,1} + \binom{6}{3,0,3} + \binom{6}{3,1,2} + \binom{6}{3,2,1} + \binom{6}{3,3,0}
$$</div>
<p>minus the number of 6-digit numbers starting with 0:</p>
<div class="math">$$
b = 0 + \binom{5}{0,2,3} + \binom{5}{0,3,2} + \binom{5}{1,1,3} + \binom{5}{1,2,2} + \\
\binom{5}{1,3,1} + \binom{5}{2,0,3} + \binom{5}{2,1,2} + \binom{5}{2,2,1} + \binom{5}{2,3,0}
$$</div>
<p>Let <span class="math">\(a\)</span> be the first expression and <span class="math">\(b\)</span> be the second expression; then the total is:</p>
<div class="highlight"><pre><span></span><span class="k">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">np</span><span class="p">.</span><span class="k">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="mi">510</span><span class="p">.</span><span class="mi">0</span>

<span class="k">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">np</span><span class="p">.</span><span class="k">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="mi">170</span><span class="p">.</span><span class="mi">0</span>

<span class="k">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">np</span><span class="p">.</span><span class="k">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="k">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="mi">340</span><span class="p">.</span><span class="mi">0</span>
</pre></div>


<div class="math">$$
a - b = 340
$$</div>
<p><a name="pe172-recursion"></a></p>
<h2>Recursion</h2>
<p>The essence of this problem is a nested for loop - but because we have 9 digits to deal with, a 9-level 
nested for loop would be a big headache and would not generalize well.</p>
<p>Instead, we can write a recursive method that is called for each of the <span class="math">\(k\)</span> (9) digits being selected 
to compose the final <span class="math">\(N\)</span>- (18-) digit number.</p>
<p>The recursive method looks something like this:</p>
<div class="highlight"><pre><span></span><span class="k">global</span> <span class="n">variable</span> <span class="n">solution_count</span>
<span class="k">global</span> <span class="n">variable</span> <span class="n">m</span>
<span class="k">global</span> <span class="n">variable</span> <span class="n">N</span>

<span class="k">def</span> <span class="nf">recursive_method</span><span class="p">(</span> <span class="n">n_tuple</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">compute</span> <span class="n">multiset</span> <span class="n">permutation</span> <span class="n">combinations</span>
        <span class="n">increment</span> <span class="k">global</span> <span class="n">solutions</span> <span class="n">total</span>
        <span class="n">need</span> <span class="n">N</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">assemble</span> <span class="n">choices</span> <span class="k">for</span> <span class="n">N_i</span>
        <span class="k">for</span><span class="p">(</span><span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">set</span> <span class="n">N_i</span> <span class="n">to</span> <span class="n">choice</span>
            <span class="n">call</span> <span class="n">recursive_method</span><span class="p">()</span>
            <span class="n">unset</span> <span class="n">N_i</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><a name="pe172-pseudocode"></a></p>
<h2>Pseudocode</h2>
<p>Computing the number of possible integers n that meet the specified criteria thus boils down to a long sequence of nested summations (nested loops).</p>
<p>The problem is posed for <span class="math">\(N = 18, k = 10, m = 3\)</span>. For this case, the final expression for the total number of permutations is:</p>
<div class="math">$$
\sum_{N_1} \sum_{N_2} \sum_{N_3} \sum_{N_4} \sum_{N_5} \sum_{N_6} \sum_{N_7} \sum_{N_8} \sum_{N_9} \binom{N}{N_0, N_1, N_2, \dots, N_9} - \binom{N-1}{N_0-1, N_1, N_2, \dots, N_9}
$$</div>
<p>where the limits of summation are given by:</p>
<div class="math">$$
N_1 = \max \left( N - (10-1) m, 0 \right) \dots m
$$</div>
<div class="math">$$
N_2 = \max \left( N - N_1 - (10-2) m, 0 \right) \dots m
$$</div>
<div class="math">$$
N_3 = \max \left( N - N_1 - N_2 - (10-3) m, 0 \right) \dots m
$$</div>
<div class="math">$$
N_4 = \max \left( N - N_1 - N_2 - N_3 - (10-4) m, 0 \right) \dots m
$$</div>
<p>etc...</p>
<div class="math">$$
N_9 = \max \left( N - N_1 - N_2 - \dots - N_7 - N_8, 0 \right) \dots m
$$</div>
<p>and from these, <span class="math">\(N_0\)</span> is determined by:</p>
<div class="math">$$
N_0 = N - N_1 - N_2 - \dots - N_8 - N_9
$$</div>
<p><a name="pe172-python-code"></a></p>
<h2>Python Code</h2>
<p><a href="https://git.charlesreid1.com/cs/euler/raw/master/scratch/Round7_170-180/Problem172.py">Link to Problem 172 Python Code at git.charlesreid1.com</a></p>
<p>To implement the solution to Problem 172 in Python, we used recursion, as mentioned above.
THe only tricky part of implementing this recursive method was the usual challenge with 
recursive methods: keeping track of the total number of solutions found via a global variable.</p>
<p>To do this in Python, we declare a variable outside the scope of a given function, and we use
that variable as a global variable by declaring it with the global keyword.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># Real problem:</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">18</span>


<span class="n">solution_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">factorials</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>


<p>Now we have a <code>main()</code> driver method to call the recursive method:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">solution_count</span>
    <span class="n">n_tuple</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,]</span><span class="o">*</span><span class="n">k</span>
    <span class="n">recursive_method</span><span class="p">(</span><span class="n">n_tuple</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total number of permutations:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">solution_count</span><span class="p">))</span>
</pre></div>


<p>We have the recursive backtracking method that constructs
all combinations of <span class="math">\(k\)</span> digits into <span class="math">\(N\)</span>-digit numbers:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recursive_method</span><span class="p">(</span> <span class="n">n_tuple</span><span class="p">,</span> <span class="n">ni</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use recursive backtracking to form all possible </span>
<span class="sd">    combinations of k digits into N-digit numbers </span>
<span class="sd">    such that the number of digits is m or less.</span>

<span class="sd">    (n_tuple is actually a list.)</span>

<span class="sd">    ni = current class step 1..(k-1)</span>
<span class="sd">    n_tuple = list of number of digits for each class 0 through k</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">solution_count</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">N</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ni</span><span class="o">==</span><span class="n">k</span><span class="p">):</span>

        <span class="c1"># N_1 through N_(k-1) have been set,</span>
        <span class="c1"># now it is time to set N_0:</span>
        <span class="c1"># N_0 = N - N_1 - N_2 - N_3 - .. - N_{k-1}</span>
        <span class="n">sum_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">n_tuple</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)])</span>
        <span class="n">n_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">sum_N</span><span class="p">)</span>

        <span class="c1"># Compute multiset permutation</span>
        <span class="n">solution_count</span> <span class="o">+=</span> <span class="n">multiset</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">n_tuple</span><span class="p">)</span> <span class="o">-</span> <span class="n">multiset_0</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">n_tuple</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># Problem: we are not stopping </span>
        <span class="c1"># when the sum of digits chosen</span>
        <span class="c1"># is greater than N</span>

        <span class="c1"># Assemble the minimum and maximum limits for N_i:</span>
        <span class="c1"># (Everything up to ni-1 should be defined, no TypeErrors due to None)</span>
        <span class="n">sum_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">n_tuple</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ni</span><span class="p">)])</span>
        <span class="n">ktm</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">ni</span><span class="p">)</span><span class="o">*</span><span class="n">m</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">sum_N</span> <span class="o">-</span> <span class="n">ktm</span>
        <span class="n">minn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">expr</span> <span class="p">))</span>

        <span class="c1"># Note: previously this was just maxx=m.</span>
        <span class="c1"># This required a check around each call to</span>
        <span class="c1"># recursive_method to see if the sum of n_tuple</span>
        <span class="c1"># was already maxed out. Now we just do it here.</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">sum_N</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">N_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minn</span><span class="p">,</span><span class="n">maxx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="c1"># Set</span>
                <span class="n">n_tuple</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_i</span>

                <span class="c1"># Explore</span>
                <span class="n">recursive_method</span><span class="p">(</span><span class="n">n_tuple</span><span class="p">,</span> <span class="n">ni</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Unset</span>
                <span class="n">n_tuple</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span>
</pre></div>


<p>We have a <code>multiset()</code> method that evaluates the multiset permutation count formula:</p>
<div class="math">$$
\binom{N}{N_1, \dots, N_k} = \dfrac{N!}{N_1! \dots N_k!}
$$</div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiset</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">n_tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of multiset permutations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="n">factorial</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">n_tuple</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">multiset_0</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">n_tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of multiset permutations that start with 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="n">factorial</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">factorial</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_tuple</span><span class="p">)]))</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>


<p>And finally, we have a <code>factorial()</code> method:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factorial utility</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: negative factorials not possible&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>At the bottom of the file, we ensure that the driver is run when the 
funtion is run directly through Python:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p><a name="pe172-final"></a></p>
<h1>Final Answer</h1>
<p>Setting the correct parameters should result in the following result:</p>
<div class="math">$$
P = 227,485,267,000,992,000
$$</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mathematics.html">mathematics</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/factors.html">factors</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/sequences.html">sequences</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/euler.html">euler</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/project-euler.html">project euler</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>

</div>


<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>