<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Building Snakemake Command Line Wrappers for Kubernetes Workflows
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-28T20:00:00-08:00" pubdate>Monday 01/28/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/snakemake.html">Snakemake</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><strong>NOTE:</strong> These ideas are implemented in the repository
<a href="https://github.com/charlesreid/2019-snakemake-byok8s">charlesreid1/2019-snakemake-byok8s</a>.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#recap-workflows-as-executables">Recap: Workflows as Executables</a><ul>
<li><a href="#2018-snakemake-cli">2018-snakemake-cli</a></li>
<li><a href="#2019-snakemake-cli">2019-snakemake-cli</a></li>
<li><a href="#2019-snakemake-byok8s">2019-snakemake-byok8s</a></li>
</ul>
</li>
<li><a href="#overview-of-2019-snakemake-byok8s">Overview of 2019-snakemake-byok8s</a><ul>
<li><a href="#cloud-scale-kubernetes-k8s">Cloud + Scale = Kubernetes (k8s)</a></li>
<li><a href="#snakemake-k8s-support">Snakemake k8s Support</a></li>
</ul>
</li>
<li><a href="#modifying-the-cli">Modifying the CLI</a><ul>
<li><a href="#namespaces">Namespaces</a></li>
<li><a href="#adding-flags">Adding flags</a></li>
</ul>
</li>
<li><a href="#local-kubernetes-clusters-with-minikube">Local Kubernetes Clusters with Minikube</a><ul>
<li><a href="#what-is-minikube">What is minikube?</a></li>
<li><a href="#aws">AWS</a><ul>
<li><a href="#installing-python-prerequisites">Installing Python Prerequisites</a></li>
<li><a href="#installing-byok8s">Installing byok8s</a></li>
<li><a href="#starting-a-k8s-cluster-with-minikube">Starting a k8s cluster with minikube</a></li>
</ul>
</li>
<li><a href="#fixing-dns-issues-with-aws">Fixing DNS issues with AWS</a><ul>
<li><a href="#the-problem">The Problem</a></li>
<li><a href="#the-fix">The Fix</a></li>
</ul>
</li>
<li><a href="#aws-byok8s-workflow">AWS + byok8s Workflow</a></li>
<li><a href="#travis">Travis</a></li>
<li><a href="#travisyml">.travis.yml</a></li>
</ul>
</li>
<li><a href="#end-product-byok8s">End Product: byok8s</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</div>
<h1 id="recap-workflows-as-executables">Recap: Workflows as Executables</h1>
<p>In our previous blog post, <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers</a>
we covered some approaches to making Snakemake
workflows into executables that can be run as
command line utilities.</p>
<p>In this post, we extend those ideas to Snakemake workflows
that run on Kubernetes clusters.</p>
<h2 id="2018-snakemake-cli">2018-snakemake-cli</h2>
<p>To recap, back in March 2018 Titus Brown wrote a blog post titled
<a href="http://ivory.idyll.org/blog/2018-workflows-applications.html">Pydoit, snakemake, and workflows-as-applications</a>
in which he implemented a proof-of-concept command
line utility wrapping the Snakemake API to create
an executable Snakemake workflow.</p>
<p>The end result was a command line utility that could
be run like so:</p>
<div class="highlight"><pre><span></span><code>./run &lt;workflow-config&gt; &lt;workflow-params&gt;
</code></pre></div>

<p>Relevant code is in <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>.</p>
<p><a name="2019"></a></p>
<h2 id="2019-snakemake-cli">2019-snakemake-cli</h2>
<p>In our previous blog post, <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers.html">Building Snakemake Command Line Wrappers</a>,
we extended this idea to create a bundled executable
command line utility that could be installed with
<code>setup.py</code> and run from a working directory. We also
demonstrated a method of writing tests for the 
Snakemake workflow and running those tests with
Travis CI.</p>
<p>We packaged the Snakefile with the command line utility,
but the approach is flexible and can be modified to
use a user-provided Snakemake workflow or Snakefile.</p>
<p>The end result was a command line utility called
<code>bananas</code> that could be installed and run like
the <code>run</code> wrapper above:</p>
<div class="highlight"><pre><span></span><code>bananas &lt;workflow-config&gt; &lt;workflow-params&gt;
</code></pre></div>

<p>Relevant code is in <a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<p><a name="byok8s"></a></p>
<h2 id="2019-snakemake-byok8s">2019-snakemake-byok8s</h2>
<p>The next logical step in bundling workflows was to take
advantage of Snakemake's ability to run workflows across
distributed systems.</p>
<p>Specifically, we wanted to modify the command line utility
above to run the workflow on a user-provided Kubernetes
cluster, instead of running the workflow locally.</p>
<p>The result is <a href="https://github.com/charlesreid1/2019-snakemake-byok8s">2019-snakemake-byok8s</a>,
a command line utility that can be installed with
a <code>setup.py</code> and that launches a Snakemake workflow 
on a user-provided Kubernetes cluster. Furthermore,
we demonstrate how to use minikube to run a local
Kubernetes cluster to test Snakemake workflows on
Kubernetes clusters.</p>
<p>Here's what it looks like in practice:</p>
<div class="highlight"><pre><span></span><code># Get byok8s
git clone https://github.com/charlesreid1/2019-snakemake-byok8s.git
cd ~/2019-snakemake-byok8s

# Create a virtual environment
virtualenv vp
vp/bin/actiavte

# Install byok8s
pip install -r requirements.txt
python setup.py build install

# Create virtual k8s cluster
minikube start

# Run the workflow on the k8s cluster
cd /path/to/workflow/
byok8s my-workflowfile my-paramsfile --s3-bucket=my-bucket

# Clean up the virtual k8s cluster
minikube stop
</code></pre></div>

<p>We cover the details below.</p>
<h1 id="overview-of-2019-snakemake-byok8s">Overview of 2019-snakemake-byok8s</h1>
<h2 id="cloud-scale-kubernetes-k8s">Cloud + Scale = Kubernetes (k8s)</h2>
<p>First, why kubernetes (k8s)?</p>
<p>To scale Snakemake workflows to multiple compute nodes,
it is not enough to just give Snakemake a pile of
compute nodes and a way to remotely connect to each.
Snakemake requires the compute nodes to have a 
controller and a job submission system.</p>
<p>When using cloud computing platforms like GCP (Google 
Cloud Platform) or AWS (Amazon Web Services),
k8s is a simple and popular way to orchestrate
multiple compute nodes (support for Docker images
is also baked directly into k8s).</p>
<h2 id="snakemake-k8s-support">Snakemake k8s Support</h2>
<p>Snakemake has built-in support for k8s, making
the combination a logical choice for running 
Snakemake workflows at scale in the cloud. </p>
<p>The <code>minikube</code> tool, which we will cover later
in this blog post, makes it easy to run a local
virtual k8s cluster for testing purposes, and
even makes it possible to run k8s tests using
Travis CI.</p>
<p>Snakemake only requires the <code>--kubernetes</code> flag,
and an optional namespace, to connect to
the k8s cluster. (Under the hood, Snakemake
uses the Kubernetes Python API to connect
to the cluster and launch jobs.)</p>
<p>If you can run <code>kubectl</code> from a computer
to control the Kubernetes cluster, you can
run a Snakemake workflow on that cluster.</p>
<p>Let's get into the changes required in the Python code.</p>
<h1 id="modifying-the-cli">Modifying the CLI</h1>
<p>In our <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers.html">prior post</a>
covering <a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>,
we showed how to create a command line utility
using the <code>cli/</code> directory for the command line
interface package, and specifying it is a cli
entrypoint in <code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><code>cli/
├── Snakefile
├── __init__.py
└── command.py
</code></pre></div>

<p>and the relevant bit from <code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[console_scripts]</span>
<span class="si">{program}</span><span class="s2"> = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
</code></pre></div>

<p>We want our new command line utility, <code>byok8s</code>, to work
the same way, so we can do a <code>s/byok8s/bananas/g</code>
across the package.</p>
<p>The only change required happens in the file
<code>command.py</code>, where the Snakemake API call 
happens.</p>
<h2 id="namespaces">Namespaces</h2>
<p>Checking the <a href="https://snakemake.readthedocs.io/en/stable/api_reference/snakemake.html">Snakemake API documentation</a>,
we can see that the API has a <code>kubernetes</code> option:</p>
<blockquote>
<p><strong>kubernetes</strong> <em>(str)</em> – submit jobs to kubernetes,
using the given namespace.</p>
</blockquote>
<p>so <code>command.py</code> should modify the Snakmake API call
accordingly, adding a kubernetes namespace.
This is a parameter the user usually won't need
to provide (<code>default</code> is the typical namespace
we want to use) but we added a <code>-k</code> argument
to the ArgParser to allow the user to specify
the Kubernetes namespace name. By default
the Kubernetes namespace used is <code>default</code>.</p>
<h2 id="adding-flags">Adding flags</h2>
<p>We add and modify some flags to make the workflow
more flexible:</p>
<ul>
<li>
<p>The user now provides the Snakefile, which is
  called <code>Snakefile</code> in the current working directory
  by default but can be specified with the <code>--snakefile</code>
  or <code>-s</code> flag</p>
</li>
<li>
<p>The user provides the k8s namespace using the
  <code>--k8s-namespace</code> or <code>-k</code> flag</p>
</li>
<li>
<p>The user provides the name of an S3 bucket for
  Snakemake worker nodes to use for I/O using the
  <code>--s3-bucket</code> flag</p>
</li>
</ul>
<p>Finally, the user is also required to provide their
AWS credentials to access the S3 bucket, via two
environment variables that Snakemake passes through
to the Kubernetes worker nodes:</p>
<div class="highlight"><pre><span></span><code>AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
</code></pre></div>

<p>For Travis CI testing, these environment variables
can be set in the repository settings on the Travis
website once Travis CI has been enabled.</p>
<p>See <a href="https://charlesreid1.github.io/2019-snakemake-byok8s/travis_tests/">https://charlesreid1.github.io/2019-snakemake-byok8s/travis_tests/</a>
for details.</p>
<h1 id="local-kubernetes-clusters-with-minikube">Local Kubernetes Clusters with Minikube</h1>
<h2 id="what-is-minikube">What is minikube?</h2>
<p>Minikube is a Go program that allows users to simulate
a single-node kubernetes cluster using a virtual machine.
This is useful for local testing of Kubernetes workflows,
as it does not require setting up or tearing down cloud
infrastructure, or long waits for remote resources to
become ready.</p>
<p>We cover two ways to use it:</p>
<ol>
<li>
<p>Installing and running a minikube virtual kubernetes cluster on
   AWS (for development and testing of Snakemake + kubernetes
   workflows)</p>
</li>
<li>
<p>Running a minikube cluster on a Travis CI worker node
   to enable us to <em>test</em> Snakemake + kubernetes workflows.</p>
</li>
</ol>
<h2 id="aws">AWS</h2>
<p>Using Minikube from an AWS EC2 compute node comes 
with two hangups.</p>
<p>The first is that AWS nodes are virtual machines,
and you can't run virtual machines within virtual
machines, so it is not possible to use minikube's
normal VirtualBox mode, which creates a kubernetes
cluster using a virutal machine.</p>
<p>Instead, we must use minikube's native driver, meaning
minikube uses docker directly. This is tricky for several
reasons:</p>
<ul>
<li>we can't bind-mount a local directory into the
  kubernetes cluster</li>
<li>the minikube cluster must be run with sudo
  privileges, which means permissions can be
  a problem</li>
</ul>
<p>The second hangup with minikube on AWS nodes is that the
DNS settings of AWS nodes are copied into the Kubernetes
containers, including the kubernetes system's DNS service
container. Unfortunately, the AWS node's DNS settings are
not valid in the kubernetes cluster, so the DNS container
crashes, and no container in the kubernetes cluster can
reach the outside world.  This must be fixed with a
custom config file (provided with byok8s; details below).</p>
<h3 id="installing-python-prerequisites">Installing Python Prerequisites</h3>
<p>To use byok8s from a fresh Ubuntu AWS node
(tested with Ubuntu 16.04 (xenial) and 18.04
(bionic)), you will want to install a version
of conda; we recommend using pyenv and miniconda:</p>
<div class="highlight"><pre><span></span><code>curl https://pyenv.run | bash
</code></pre></div>

<p>Restart your shell and install miniconda:</p>
<div class="highlight"><pre><span></span><code>pyenv update
pyenv install miniconda3-4.3.30
pyenv global miniconda3-4.3.30
</code></pre></div>

<p>You will also need the virtualenv package to
set up a virtual environment:</p>
<div class="highlight"><pre><span></span><code>pip install virtualenv
</code></pre></div>

<h3 id="installing-byok8s">Installing byok8s</h3>
<p>Start by cloning the repo and installing byok8s:</p>
<div class="highlight"><pre><span></span><code>cd 
git clone https://github.com/charlesreid1/2019-snakemake-byok8s.git
cd ~/2019-snakemake-byok8s
</code></pre></div>

<p>Next, you'll create a virtual environment:</p>
<div class="highlight"><pre><span></span><code>virtualenv vp
source vp/bin/activate

pip install -r requirements.txt
python setup.py build install
</code></pre></div>

<p>Now you should be ready to rock:</p>
<div class="highlight"><pre><span></span><code>which byok8s
</code></pre></div>

<h3 id="starting-a-k8s-cluster-with-minikube">Starting a k8s cluster with minikube</h3>
<p>Install minikube:</p>
<div class="highlight"><pre><span></span><code>curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  &amp;&amp; sudo install minikube-linux-amd64 /usr/local/bin/minikube
</code></pre></div>

<p>Now you're ready to start a minikube k8s
cluster on your AWS node! Start a k8s cluster
as root with:</p>
<div class="highlight"><pre><span></span><code>sudo minikube start
</code></pre></div>

<p><strong>NOTE:</strong> The <code>minikube start</code> command will print
some commands for you to run to fix permissions -
it is importat you run them!</p>
<p>Tear down the cluster with:</p>
<div class="highlight"><pre><span></span><code>sudo minikube stop
</code></pre></div>

<p>While the k8s cluster is running, you can control
it and interact with it like a normal k8s cluster
using <code>kubectl</code>.</p>
<p>However, as-is, the cluster's DNS settings are broken!
We need to fix them before running.</p>
<h2 id="fixing-dns-issues-with-aws">Fixing DNS issues with AWS</h2>
<p>We mentioned a second hangup with AWS was with the
DNS settings. </p>
<p>The problem is with <code>/etc/resolv.conf</code> on the
AWS host node. It is set up for AWS's internal 
cloud network routing, but this is copied
into the CoreDNS container, which is the
kube-system container that manages DNS requests
from all k8s containers. The settings from the
AWS host confuse the DNS container, and it cannot
route any DNS requests.</p>
<h3 id="the-problem">The Problem</h3>
<p>If you're having the problem, you will see
something like this with <code>kubectl</code>, where the
coredns containers are in a <code>CrashLoopBackOff</code>:</p>
<div class="highlight"><pre><span></span><code>$ kubectl get pods --namespace=kube-system

NAME                               READY   STATUS             RESTARTS   AGE
coredns-86c58d9df4-lvq8b           0/1     CrashLoopBackOff   5          5m17s
coredns-86c58d9df4-pr52t           0/1     CrashLoopBackOff   5          5m17s
etcd-minikube                      1/1     Running            15         4h43m
kube-addon-manager-minikube        1/1     Running            16         4h43m
kube-apiserver-minikube            1/1     Running            15         4h43m
kube-controller-manager-minikube   1/1     Running            15         4h43m
kube-proxy-sq77h                   1/1     Running            3          4h44m
kube-scheduler-minikube            1/1     Running            15         4h43m
storage-provisioner                1/1     Running            6          4h44m
</code></pre></div>

<p>This will cause all Snakemake jobs to fail with a name
resolution failure when it tries to write its output
files to the AWS S3 bucket:</p>
<div class="highlight"><pre><span></span><code>$ kubectl logs snakejob-c71fba38-f64b-5803-915d-933ae273d7a4

Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 4
Rules claiming more threads will be scaled down.
Job counts:
    count   jobs
    1   target1
    1

[Thu Jan 24 00:06:03 2019]
rule target1:
    output: cmr-smk-0123/alpha.txt
    jobid: 0

echo alpha blue &gt; cmr-smk-0123/alpha.txt
Traceback (most recent call last):
  File &quot;/opt/conda/lib/python3.7/site-packages/urllib3/connection.py&quot;, line 171, in _new_conn
    (self._dns_host, self.port), self.timeout, **extra_kw)
  File &quot;/opt/conda/lib/python3.7/site-packages/urllib3/util/connection.py&quot;, line 56, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
  File &quot;/opt/conda/lib/python3.7/socket.py&quot;, line 748, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
socket.gaierror: [Errno -3] Temporary failure in name resolution
</code></pre></div>

<p>and the kubernetes log for the CoreDNS container</p>
<div class="highlight"><pre><span></span><code>$ kubectl logs --namespace=kube-system coredns-86c58d9df4-lvq8b

.:53
2019/01/25 14:54:48 [INFO] CoreDNS-1.2.2
2019/01/25 14:54:48 [INFO] linux/amd64, go1.11, fc62f9c
CoreDNS-1.2.2
linux/amd64, go1.11, eb51e8b
2019/01/25 14:54:48 [INFO] plugin/reload: Running configuration MD5 = 486384b491cef6cb69c1f57a02087373
2019/01/25 14:54:48 [FATAL] plugin/loop: Seen &quot;HINFO IN 9273194449250285441.798654804648663468.&quot; more than twice, loop detected
</code></pre></div>

<p>Basically, the AWS node's DNS name server settings cause 
an infinite DNS loop to be set up.</p>
<h3 id="the-fix">The Fix</h3>
<p>Fixing this problem requires manually setting the DNS 
name servers inside the CoreDNS container to Google's
public DNS servers, <code>8.8.8.8</code> and <code>8.8.4.4</code>.</p>
<p>To apply this fix, we use a YAML configuration file to patch the
CoreDNS container image.</p>
<p>Hat tip to <a href="https://github.com/kubernetes/minikube/issues/2027">this long Github issue</a>
in the minikube Github repo, and specifically 
<a href="https://github.com/kubernetes/minikube/issues/2027#issuecomment-381574807">this comment</a>
by Github user <a href="https://github.com/jgoclawski">jgoclawski</a>.
and also <a href="https://github.com/kubernetes/minikube/issues/2027#issuecomment-419733791">this comment</a>
by Github user <a href="https://github.com/bw2">bw2</a>.
(Note that neither of these quite solve the problem -
jgoclawski's solution is for kube-dns, not CoreDNS,
and bw2's YAML is not valid, but both got me most
of the way to a solution.)</p>
<p>Here is the YAML file (also in the 2019-snakemake-byok8s
repo here: <a href="https://github.com/charlesreid1/2019-snakemake-byok8s/blob/master/test/fixcoredns.yml">https://github.com/charlesreid1/2019-snakemake-byok8s/blob/master/test/fixcoredns.yml</a>):</p>
<p><strong><code>fixcoredns.yml</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">Corefile</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">.:53 {</span>
        <span class="no">errors</span>
        <span class="no">health</span>
        <span class="no">kubernetes cluster.local in-addr.arpa ip6.arpa {</span>
           <span class="no">upstream 8.8.8.8 8.8.4.4</span>
           <span class="no">pods insecure</span>
           <span class="no">fallthrough in-addr.arpa ip6.arpa</span>
        <span class="no">}</span>
        <span class="no">proxy .  8.8.8.8 8.8.4.4</span>
        <span class="no">cache 30</span>
        <span class="no">reload</span>
    <span class="no">}</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2019-01-25T22:55:15Z</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">coredns</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div>

<p>(<strong>NOTE:</strong> There is also a <code>fixkubedns.yml</code> if you are using
an older Kubernetes version that uses kube-dns instead of
CoreDNS.)</p>
<p>To tell the k8s cluster to use this image
when it creates a CoreDNS container, run
this kubectl command <em>while the cluster is
running</em>:</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f fixcoredns.yml
</code></pre></div>

<p>Last but not least, delete all <code>kube-system</code> containers
and let Kubernetes regenerate them:</p>
<div class="highlight"><pre><span></span><code>kubectl delete --all pods --namespace kube-system
</code></pre></div>

<p>The pods will regenerate quickly, and you can
check to confirm that the CoreDNS container
is no longer in the <code>CrashLoopBackOff</code> state
and is <code>Running</code> nicely:</p>
<div class="highlight"><pre><span></span><code>kubectl get pods --namespace=kube-system
</code></pre></div>

<p>This is all documented in <a href="https://github.com/kubernetes/minikube/issues/2027#issuecomment-457808462">this comment</a>
in the same Github issue in the minikube repo
that was linked to above, <a href="https://github.com/kubernetes/minikube/issues/2027">kubernetes/minikube
issue #2027: dnsmasq pod CrashLoopBackOff</a>.</p>
<h2 id="aws-byok8s-workflow">AWS + byok8s Workflow</h2>
<p>Now that the k8s cluster is running successfully,
run the example byok8s workflow in the <code>test/</code> 
directory of the byok8s repository (assuming
you cloned the repo to <code>~/byok8s</code>, and are in
the same virtual environment as before):</p>
<div class="highlight"><pre><span></span><code># Return to our virtual environment
cd ~/2019-snakemake-byok8s/test/
source vp/bin/activate

# Verify k8s is running
minikube status

# Export AWS keys for Snakemake
export AWS_ACCESS_KEY_ID=&quot;XXXXX&quot;
export AWS_SECRET_ACCESS_KEY=&quot;XXXXX&quot;

# Run byok8s
byok8s workflow-alpha params-blue --s3-bucket=mah-bukkit 
</code></pre></div>

<p>The bucket you specify must be created in advance
and be writable by the account whose credentials
you are passing in via environment variables.</p>
<p>When you do all of this, you should see the job
running, then exiting successfully:</p>
<div class="highlight"><pre><span></span><code>$ byok8s --s3-bucket=cmr-0123 -f workflow-alpha params-blue
--------
details!
    snakefile: /home/ubuntu/2019-snakemake-byok8s/test/Snakefile
    config: /home/ubuntu/2019-snakemake-byok8s/test/workflow-alpha.json
    params: /home/ubuntu/2019-snakemake-byok8s/test/params-blue.json
    target: target1
    k8s namespace: default
--------
Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 1
Rules claiming more threads will be scaled down.
Job counts:
    count   jobs
    1   target1
    1
Resources before job selection: {&#39;_cores&#39;: 1, &#39;_nodes&#39;: 9223372036854775807}
Ready jobs (1):
    target1
Selected jobs (1):
    target1
Resources after job selection: {&#39;_cores&#39;: 0, &#39;_nodes&#39;: 9223372036854775806}

[Mon Jan 28 18:06:08 2019]
rule target1:
    output: cmr-0123/alpha.txt
    jobid: 0

echo alpha blue &gt; cmr-0123/alpha.txt
Get status with:
kubectl describe pod snakejob-e585b53f-f9d5-5142-ac50-af5a0d532e85
kubectl logs snakejob-e585b53f-f9d5-5142-ac50-af5a0d532e85
Checking status for pod snakejob-e585b53f-f9d5-5142-ac50-af5a0d532e85
[Mon Jan 28 18:06:18 2019]
Finished job 0.
1 of 1 steps (100%) done
Complete log: /home/ubuntu/2019-snakemake-byok8s/test/.snakemake/log/2019-01-28T180607.988313.snakemake.log
unlocking
removing lock
removing lock
removed all locks
</code></pre></div>

<p>Woo hoo! You've successfully run a Snakemake workflow 
on a virtual Kubernetes cluster!</p>
<h2 id="travis">Travis</h2>
<p>Like running minikube on an AWS node, running minikube on Travis workers
also suffers from DNS issues. Fortunately, Github user 
<a href="https://github.com/LiliC">LiliC</a> worked out how to run
minikube on Travis, and importantly, <em>did so for multiple versions</em>
of minikube and kubernetes.</p>
<p>The relevant <code>.travis.yml</code> file is available in the 
<a href="https://github.com/LiliC/travis-minikube">LiliC/travis-minikube</a>
repo on Github.</p>
<p>We ended up using the <a href="https://github.com/LiliC/travis-minikube/tree/minikube-30-kube-1.12"><code>minikube-30-kube-1.12</code></a>
branch of LiliC/travis-minikube, which used the most up-to-date
version of minikube and kubernetes available in that repo. The <code>.travis.yml</code> file
provided by LiliC on that branch is 
<a href="https://github.com/LiliC/travis-minikube/blob/minikube-30-kube-1.12/.travis.yml">here</a>.</p>
<p>The example script by LiliC provided 90% of the legwork (thanks!!!),
and we only needed to modify a few lines of LiliC's Travis file
(which launches a redis container using kubectl)
to use Snakemake (launched via byok8s) instead.</p>
<h2 id="travisyml"><code>.travis.yml</code></h2>
<p>Here is the final <code>.travis.yml</code> file, which has explanatory comments.</p>
<p><strong><code>.travis.yml</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Modified from original:</span>
<span class="c1"># https://raw.githubusercontent.com/LiliC/travis-minikube/minikube-30-kube-1.12/.travis.yml</span>

<span class="c1"># byok8s and Snakemake both require Python,</span>
<span class="c1"># so we make this Travis CI test Python-based.</span>
<span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="nt">python</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;3.6&quot;</span>

<span class="c1"># Running minikube via travis requires sudo</span>
<span class="nt">sudo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">required</span>

<span class="c1"># We need the systemd for the kubeadm and it&#39;s default from 16.04+</span>
<span class="nt">dist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">xenial</span>

<span class="c1"># This moves Kubernetes specific config files.</span>
<span class="nt">env</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CHANGE_MINIKUBE_NONE_USER=true</span>

<span class="nt">install</span><span class="p">:</span>
<span class="c1"># Install byok8s requirements (snakemake, python-kubernetes)</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
<span class="c1"># Install byok8s cli tool</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python setup.py build install</span>

<span class="nt">before_script</span><span class="p">:</span>
<span class="c1"># Do everything from test/</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cd test</span>
<span class="c1"># Make root mounted as rshared to fix kube-dns issues.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sudo mount --make-rshared /</span>
<span class="c1"># Download kubectl, which is a requirement for using minikube.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.12.0/bin/linux/amd64/kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/</span>
<span class="c1"># Download minikube.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.30.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sudo minikube start --vm-driver=none --bootstrapper=kubeadm --kubernetes-version=v1.12.0</span>
<span class="c1"># Fix the kubectl context, as it&#39;s often stale.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">minikube update-context</span>
<span class="c1"># Wait for Kubernetes to be up and ready.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">JSONPATH=&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;; until kubectl get nodes -o jsonpath=&quot;$JSONPATH&quot; 2&gt;&amp;1 | grep -q &quot;Ready=True&quot;; do sleep 1; done</span>

<span class="c1">################</span>
<span class="c1">## easy test</span>
<span class="nt">script</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubectl cluster-info</span>
<span class="c1"># Verify kube-addon-manager.</span>
<span class="c1"># kube-addon-manager is responsible for managing other kubernetes components, such as kube-dns, dashboard, storage-provisioner..</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">JSONPATH=&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;; until kubectl -n kube-system get pods -lcomponent=kube-addon-manager -o jsonpath=&quot;$JSONPATH&quot; 2&gt;&amp;1 | grep -q &quot;Ready=True&quot;; do sleep 1;echo &quot;waiting for kube-addon-manager to be available&quot;; kubectl get pods --all-namespaces; done</span>
<span class="c1"># Wait for kube-dns to be ready.</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">JSONPATH=&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;; until kubectl -n kube-system get pods -lk8s-app=kube-dns -o jsonpath=&quot;$JSONPATH&quot; 2&gt;&amp;1 | grep -q &quot;Ready=True&quot;; do sleep 1;echo &quot;waiting for kube-dns to be available&quot;; kubectl get pods --all-namespaces; done</span>

<span class="c1">################ </span>
<span class="c1">## hard test</span>
<span class="c1"># run byok8s workflow on the k8s cluster</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">byok8s --s3-bucket=cmr-0123 -f workflow-alpha params-blue</span>
</code></pre></div>

<h1 id="end-product-byok8s">End Product: byok8s</h1>
<p>The final byok8s package can be found in the
<a href="https://github.com/charlesreid1/2019-snakemake-byok8s">charlesreid1/2019-snakemake-byok8s</a>
repository on Github.</p>
<p>You can find documentation for 2019-snakemake-byok8s 
here: <a href="https://charlesreid1.github.io/2019-snakemake-byok8s/">https://charlesreid1.github.io/2019-snakemake-byok8s/</a></p>
<p>To return to our quick start, here is what running
byok8s end-to-end on a minikube kubernetes cluster 
on an AWS node looks like (slightly modified from
the intro of our post):</p>
<div class="highlight"><pre><span></span><code># Install minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  &amp;&amp; sudo install minikube-linux-amd64 /usr/local/bin/minikube

# Get byok8s
git clone https://github.com/charlesreid1/2019-snakemake-byok8s.git
cd ~/2019-snakemake-byok8s

# Create a virtual environment
virtualenv vp
vp/bin/actiavte

# Install byok8s
pip install -r requirements.txt
python setup.py build install

# Create virtual k8s cluster
sudo minikube start

# Fix CoreDNS
kubectl apply -f fixcoredns.yml
kubectl delete --all pods --namespace kube-system

# Wait for kube-system to respawn
kubectl get pods --namespace=kube-system

# Run the workflow on the k8s cluster
cd test/
byok8s workflow-alpha params-blue --s3-bucket=mah-bukkit 

# Clean up the virtual k8s cluster
sudo minikube stop
</code></pre></div>

<h1 id="documentation">Documentation</h1>
<p>You can find documentation for 2019-snakemake-byok8s 
here: <a href="https://charlesreid1.github.io/2019-snakemake-byok8s/">https://charlesreid1.github.io/2019-snakemake-byok8s/</a></p>
<p>The documentation covers a quick start on AWS nodes, 
similar to what is covered above, as well as more information
about running byok8s on other types of Kubernetes clusters
(e.g., AWS, Google Cloud, and Digital Ocean).</p>
<h1 id="next-steps">Next Steps</h1>
<p>Last year we were working on implementing metagenomic pipelines for
shotgun sequencing data as part of the <a href="https://github.com/dahak-metagenomics">dahak-metagenomics</a>
project. We implemented several Snakemake workflows
in the <a href="https://github.com/dahak-metagenomics/dahak">dahak</a>
repo, and began (but never completed) work on a command line utility
to run these workflows called <a href="https://github.com/dahak-metagenomics/dahak-taco">dahak-taco</a>.</p>
<p>Our next major goal is to reboot dahak-taco and redesign it to run metagenomic
workflows from dahak on Kubernetes clusters, similar to the way byok8s works.</p>
<p>Stay tuned for more!</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/workflows.html">workflows</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/pipelines.html">pipelines</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/snakemake.html">snakemake</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/travis.html">travis</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/kubernetes.html">kubernetes</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/minikube.html">minikube</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Building Snakemake Command Line Wrappers for Workflows
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-21T22:00:00-08:00" pubdate>Monday 01/21/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/snakemake.html">Snakemake</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><strong>NOTE:</strong> These ideas are implemented in the repository
<a href="https://github.com/charlesreid/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#basic-idea-wrapping-snakemake-api-calls">Basic Idea: Wrapping Snakemake API Calls</a><ul>
<li><a href="#2018-snakemake-cli">2018-snakemake-cli</a></li>
<li><a href="#2019-snakemake-cli">2019-snakemake-cli</a></li>
</ul>
</li>
<li><a href="#turning-executables-into-packages">Turning Executables into Packages</a></li>
<li><a href="#end-result-using-bananas">End Result: Using bananas</a><ul>
<li><a href="#quick-start-installing">Quick Start: Installing</a></li>
<li><a href="#quick-start-running-tests">Quick Start: Running Tests</a></li>
<li><a href="#quick-start-running-examples">Quick Start: Running Examples</a></li>
</ul>
</li>
<li><a href="#adding-travis-ci-tests">Adding Travis CI Tests</a></li>
<li><a href="#final-repository">Final Repository</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</div>
<h1 id="basic-idea-wrapping-snakemake-api-calls">Basic Idea: Wrapping Snakemake API Calls</h1>
<h2 id="2018-snakemake-cli">2018-snakemake-cli</h2>
<p>This blog post covers the implementation of an idea
that was originally explored in a blog post from 
Titus Brown, <a href="http://ivory.idyll.org/blog/2018-workflows-applications.html">Pydoit, snakemake, and workflows-as-applications</a>.</p>
<p>That blog post implemented a basic command line
wrapper around the Snakemake API to demonstrate
how a Snakemake workflow could be turned into
an executable.</p>
<p>Relevant code is in <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>,
but the basic idea is to implement a command line
utility that takes two orthogonal sets of inputs:
a workflow configuration file, and a parameter set.</p>
<div class="highlight"><pre><span></span><code>./run &lt;workflow-config&gt; &lt;workflow-params&gt;
</code></pre></div>

<p>The <a href="https://github.com/ctb/2018-snakemake-cli/blob/master/run">run script</a>
is a Python executable file that parses arguments
from the user.</p>
<p>Here is the main entrypoint of <code>run</code>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#! /usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Execution script for snakemake workflows.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">snakemake</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">thisdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># </span>
    <span class="c1"># ...see below...</span>
    <span class="c1">#</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;run snakemake workflows&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;run &lt;workflow&gt; &lt;parameters&gt; [&lt;target&gt;]</span>
<span class="s1">Run snakemake workflows, using the given workflow name &amp; parameters file.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;workflowfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;paramsfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--dry-run&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</code></pre></div>

<p>The <code>main()</code> method uses the <code>os</code> module to look for
the Snakefile, the config file, and the params file,
then makes a call to the Snakemake API:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># ...find the snakefile...</span>
    <span class="c1"># ...find the config file...</span>
    <span class="c1"># ...find the params file...</span>
    <span class="c1"># </span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">workflow_info</span><span class="p">[</span><span class="s1">&#39;workflow_target&#39;</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;details!&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">snakefile: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">config: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflowfile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">params: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramsfile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">target: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>

    <span class="c1"># run!!</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span> 
                                 <span class="n">configfile</span><span class="o">=</span><span class="n">paramsfile</span><span class="p">,</span>
                                 <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> 
                                 <span class="n">printshellcmds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span> 
                                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span> <span class="c1"># translate &quot;success&quot; into shell exit code of 0</span>
       <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre></div>

<p>This call uses the provided parameters file to set
the Snakemake configuration dictionary, but this can
be overridden with the <code>config</code> dictionary.
Additional argparser flags can be added, and the
<code>config</code> dictionary contents modified based on
the flags.</p>
<h2 id="2019-snakemake-cli">2019-snakemake-cli</h2>
<p>We wanted to take this demo a step further, and add
a few things to it:</p>
<ul>
<li>
<p>Bundle the Snakefile and command line utility as an
  installable Python package with a <code>setup.py</code></p>
</li>
<li>
<p>Implement Travis CI tests of the Snakemake workflow.</p>
</li>
</ul>
<p>We implemented a bundled Snakemake workflow as a 
command line tool called <code>bananas</code>.</p>
<h1 id="turning-executables-into-packages">Turning Executables into Packages</h1>
<p>We began with an executable script <code>run</code> and wished
to turn it into an installable command line utility
called <code>bananas</code>.</p>
<p>To do this, we moved the contents of <code>run</code> into 
a new file <code>command.py</code> in a new Python module 
called <code>cli</code>:</p>
<div class="highlight"><pre><span></span><code>cli/
├── Snakefile
├── __init__.py
└── command.py
</code></pre></div>

<p>The <code>Snakefile</code> will contain the workflow. Here is the
very simple workflow from <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>.
The named rules are specified by the workflow configuration
file, while the parameters in <code>{}</code> are provided through
the parameters file (or via command line flags).</p>
<p><code>cli/Snakefile</code>:</p>
<div class="highlight"><pre><span></span><code>name = config[&#39;name&#39;]

rule rulename1:
     input:
        &quot;hello.txt&quot;

rule target1:
     output:
        &quot;hello.txt&quot;
     shell:
        &quot;echo hello {name} &gt; {output}&quot;

rule target2:
     output:
        &quot;goodbye.txt&quot;
     shell:
        &quot;echo goodbye {name} &gt; {output}&quot;
</code></pre></div>

<p><strong>NOTE:</strong> In this case we are bundling the Snakefile
with the command line wrapper, and writing the command
line wrapper to expect the Snakefile to be in the package.
But we can modify the command line wrapper function
(below) to look for the Snakefile in a local directory,
allowing the user to provide Snakefiles and workflows
to the command line wrapper.</p>
<p>The <code>__init__.py</code> file sets two important parameters:
the name of the command line utility, and the version
number:</p>
<p><code>cli/__init__.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">_program</span> <span class="o">=</span> <span class="s2">&quot;bananas&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
</code></pre></div>

<p>The contents of <code>command.py</code> are similar to <code>run</code> and
basically control how the command line utility runs:</p>
<p><code>cli/command.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Command line interface driver for snakemake workflows</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">snakemake</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_program</span>


<span class="n">thisdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">parentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisdir</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">sysargs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span> <span class="o">=</span> <span class="n">_program</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;bananas: run snakemake workflows&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;bananas &lt;workflow&gt; &lt;parameters&gt; [&lt;target&gt;]</span>

<span class="s1">bananas: run snakemake workflows, using the given workflow name &amp; parameters file.</span>

<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;workflowfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;paramsfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--dry-run&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--force&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sysargs</span><span class="p">)</span>

    <span class="c1"># ...find the Snakefile...</span>
    <span class="c1"># ...find the config file...</span>
    <span class="c1"># ...find the params file...</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">workflow_info</span><span class="p">[</span><span class="s1">&#39;workflow_target&#39;</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;details!&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">snakefile: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">config: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflowfile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">params: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramsfile</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">target: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>

    <span class="c1"># run bananas!!</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="n">paramsfile</span><span class="p">,</span>
                                 <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">printshellcmds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">forceall</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span> <span class="c1"># translate &quot;success&quot; into shell exit code of 0</span>
       <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>The last component here is to make the function
in <code>cli/command.py</code> the entrypoint of a command line
utility called <code>bananas</code>, which can be done via
<code>setup.py</code>. This will put the executable <code>bananas</code>
in the Python binaries folder when the package is
installed.</p>
<p><code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;requirements.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)]</span>

<span class="c1"># Note: the _program variable is set in __init__.py.</span>
<span class="c1"># it determines the name of the package/final command line tool.</span>
<span class="kn">from</span> <span class="nn">cli</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">_program</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">],</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s1">&#39;pytest.collector&#39;</span><span class="p">,</span>
      <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">],</span>
      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;bananas command line interface&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://charlesreid1.github.io/2019-snakemake-cli&#39;</span><span class="p">,</span>
      <span class="n">author</span><span class="o">=</span><span class="s1">&#39;@charlesreid1&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;cmreid@ucdavis.edu&#39;</span><span class="p">,</span>
      <span class="n">license</span><span class="o">=</span><span class="s1">&#39;MIT&#39;</span><span class="p">,</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      [console_scripts]</span>
<span class="s2">      </span><span class="si">{program}</span><span class="s2"> = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<p>First, we grab the variables from <code>__init__.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">cli</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">_program</span>
</code></pre></div>

<p>Next we specify where our package lives, the <code>cli</code> directory:</p>
<div class="highlight"><pre><span></span><code><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">],</span>
</code></pre></div>

<p>and finally, we specify that we want to build a command line 
interface, with the entrypoint being the <code>main()</code> method of the
<code>cli/command.py</code> file using <code>entry_points</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[console_scripts]</span>
<span class="si">{program}</span><span class="s2"> = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
</code></pre></div>

<h1 id="end-result-using-bananas">End Result: Using bananas</h1>
<p>The end result is a command line utility that bundles a
Snakemake workflow. The repository contains some tests,
so let's run through the quick start installation and
run the tests.</p>
<h2 id="quick-start-installing">Quick Start: Installing</h2>
<p>Start by setting up a virtual environment:</p>
<div class="highlight"><pre><span></span><code>virtualenv vp
<span class="nb">source</span> vp/bin/activate
</code></pre></div>

<p>Install required components, then install the package:</p>
<div class="highlight"><pre><span></span><code>pip install -r requirements.txt
python setup.py build install
</code></pre></div>

<p>Now you should see <code>bananas</code> on your path:</p>
<div class="highlight"><pre><span></span><code>which bananas
</code></pre></div>

<h2 id="quick-start-running-tests">Quick Start: Running Tests</h2>
<div class="highlight"><pre><span></span><code>pytest
</code></pre></div>

<h2 id="quick-start-running-examples">Quick Start: Running Examples</h2>
<p>Change to the <code>test/</code> directory and run tests with
the example config and param files.</p>
<div class="highlight"><pre><span></span><code>cd test
</code></pre></div>

<p>Run the hello workflow with Amy params:</p>
<div class="highlight"><pre><span></span><code>rm -f hello.txt
bananas workflow-hello params-amy
</code></pre></div>

<p>Run the hello workflow with Beth params:</p>
<div class="highlight"><pre><span></span><code>rm -f hello.txt
bananas workflow-hello params-beth
</code></pre></div>

<p>Run the goodbye workflow with Beth params:</p>
<div class="highlight"><pre><span></span><code>rm -f goodbye.txt
bananas workflow-goodbye params-beth
</code></pre></div>

<h1 id="adding-travis-ci-tests">Adding Travis CI Tests</h1>
<p>To test or workflow, we break down the necessary tasks:</p>
<ul>
<li>Use a Python environment</li>
<li>Install our requirements (snakemake)</li>
<li>Install bananas with setup.py</li>
<li>Run pytest</li>
</ul>
<p>This is an easy Travis file to write, following the
<a href="https://docs.travis-ci.com/user/languages/python/">Travis docs</a>.</p>
<p><code>.travis.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="nt">python</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.5&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.6&quot;</span>
  <span class="c1">#- &quot;3.7-dev&quot; # fails due to datrie build failure (snakemake dependency)</span>

<span class="c1"># command to install dependencies</span>
<span class="nt">install</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python setup.py build install</span>

<span class="c1"># command to run tests</span>
<span class="nt">script</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pytest</span>
</code></pre></div>

<h1 id="final-repository">Final Repository</h1>
<p>All of the code for this repository is in
<a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<p>See the <a href="https://github.com/charlesreid1/2019-snakemake-cli/releases/tag/v2.0">v2.0 tag</a>
in case there are changes to the code that are not reflected in
this blog post.</p>
<h1 id="next-steps">Next Steps</h1>
<p>This demo provides a starting point for creating executable Snakemake
workflows that are installable.</p>
<p>A few open question and directions:</p>
<ul>
<li>
<p>Bundling the Snakefile vs. user-provided Snakefles</p>
<ul>
<li>There is obviously more utility and flexibility in letting the user provide Snakefiles.</li>
<li>User-provided Snakefiles provide more ways for workflows to go wrong.</li>
<li>Testing is either more difficult, or shifted to the workflow author.</li>
<li>Bundled Snakefiles take the burden of writing the workflow off of the user,
  so they can focus on param/config files.</li>
</ul>
</li>
<li>
<p>Kubernetes</p>
<ul>
<li>Can we make the command line wrapper work with a Kubernetes cluster?</li>
<li>See <a href="https://github.com/charlesreid1/2019-snakemake-byok8s">charlesreid1/2019-snakemake-byok8s</a>
  for proof of concept.</li>
</ul>
</li>
<li>
<p>Applications</p>
<ul>
<li>How can we apply this concept?</li>
<li><a href="https://github.com/spacegraphcats/spacegraphcats">spacegraphcats</a></li>
<li><a href="https://github.com/dib-lab/eelpond">eelpond</a></li>
<li><a href="https://github.com/dahak-metagenomics/dahak">dahak</a> and 
  <a href="https://github.com/dahak-metagenomics/dahak-taco">dahak-taco</a> </li>
</ul>
</li>
</ul></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/workflows.html">workflows</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/pipelines.html">pipelines</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/snakemake.html">snakemake</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/travis.html">travis</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-03T10:30:00-08:00" pubdate>Thursday 01/03/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/computational-biology.html">Computational Biology</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><em>This is the third in a series of three blog posts describing our
solution to a bioinformatics problem from Rosalind.info,
<a href="http://rosalind.info/problems/ba1i/">Problem BA1(i) (Find most frequent words with mismatches
in a string)</a>.
To solve this problem and generate variations of a DNA string
as required, we implemented a recursive backtracking method
in the Go programming language.</em></p>
<ul>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1: Counting Variations</a></em></li>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Part 2: Generating Variations</a></em></li>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Part 3: Go Implementation of Recursive Backtracking</a></em></li>
</ul>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#problem-description">Problem Description</a></li>
<li><a href="#recursive-backtracking-pseudocode">Recursive Backtracking Pseudocode</a></li>
<li><a href="#recursive-backtracking-go-implementation">Recursive Backtracking: Go Implementation</a><ul>
<li><a href="#visit-hamming-neighbors-function">Visit Hamming Neighbors Function</a><ul>
<li><a href="#public-non-recursive-function">Public, Non-Recursive Function</a></li>
<li><a href="#private-recursive-function">Private, Recursive Function</a></li>
</ul>
</li>
<li><a href="#assemble-visit-variation-function">Assemble Visit Variation Function</a></li>
</ul>
</li>
<li><a href="#tests">Tests</a></li>
<li><a href="#final-code">Final Code</a></li>
<li><a href="#go-forth-and-be-fruitful">Go Forth and Be Fruitful</a></li>
</ul>
</div>
<h2 id="problem-description">Problem Description</h2>
<p>The task at hand is to take a given input strand of DNA,
and generate variations from it that have up to <span class="math">\(d\)</span> differences
(a Hamming distance of <span class="math">\(d\)</span>) in the codons (base pairs).</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">part 1 of this series</a>, we walk through the
construction of an analytical formula to count the number
of variations of a given DNA string that can be generated,
given the constraints of the problem.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">part 2 of this series</a>, we cover several techniques to
generate variations on a DNA string, and present pseudocode
for the recursive backtracking method that we use here.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">part 3 of this series</a>, we will cover our implementation
of the recursive backtracking method in the Go programming
language.</p>
<p><br />
<br /></p>
<p><a name="backtracking"></a></p>
<h2 id="recursive-backtracking-pseudocode">Recursive Backtracking Pseudocode</h2>
<p>To review from the prior post, our pseudocode
for recursive backtracking to explore variations
or combinations looks like the following:</p>
<div class="highlight"><pre><span></span><code>explore method:
    base case:
        visit this solution
    recursive case:
        for each available choice:
            make a choice
            explore outcomes
            unmake the choice
            move on to the next choice
</code></pre></div>

<p>The key elements there are the base and recursive
cases, and the mechanism of iterating over each
possible choice and making/exploring/unmaking
the choice.</p>
<p><a name="go-implementation"></a></p>
<h2 id="recursive-backtracking-go-implementation">Recursive Backtracking: Go Implementation</h2>
<p>In total, we have three different methods to
accomplish this task:</p>
<ul>
<li>
<p><code>VisitHammingNeighbors(input,d)</code>: this is the public method
  that the user calls to generate a string array of all
  strings that are a Hamming distance of up to <code>d</code> from
  the input string <code>input</code>. This public method performs
  parameter and error checking, initializes space for
  data, and collects results.</p>
</li>
<li>
<p><code>visitHammingNeighbors_recursive(base_kmer, depth, choices, results_map)</code>:
  this method is the private recursive method available
  only to the package. This method performs the actual
  recursive work. </p>
</li>
</ul>
<p><strong>NOTE:</strong> the function name starts with a lower case letter,
so it is not exported by the package - i.e., it is not available
to the user when they import this package.</p>
<p>The base case of the <code>visitHammingNeighbors_recursive()</code>
function will pass the final set of choices to the final
step:</p>
<ul>
<li><code>assemble_variations(base_kmer, choices, results_map)</code>: 
  this method (private to the package) is a recursive
  method that uses the chosen indices and </li>
</ul>
<p><a name="visit-hamming"></a></p>
<h3 id="visit-hamming-neighbors-function">Visit Hamming Neighbors Function</h3>
<p>The function call to visit all Hamming neighbors and add them to the <code>results</code> set
is split into two parts: a non-recursive public function, which provides a public wrapper
that is user-friendly and performs error-checking on the parameters provided, and a
recursive private function that is used internally but not intended to be called by
users directly.</p>
<h4 id="public-non-recursive-function">Public, Non-Recursive Function</h4>
<p>Here is the entry point function that the user calls
when they wish to generate all variations on a given
string of DNA, and have the variations returned as a
string slice.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Given an input string of DNA, generate variations</span>
<span class="c1">// of said string that are a Hamming distance of</span>
<span class="c1">// less than or equal to d.</span>
<span class="kd">func</span> <span class="nx">VisitHammingNeighbors</span><span class="p">(</span><span class="nx">input</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">d</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// a.k.a. visit_kmer_neighbors</span>

    <span class="c1">// number of codons</span>
    <span class="nx">n_codons</span> <span class="o">:=</span> <span class="mi">4</span>

    <span class="c1">// Use combinatorics to calculate the total</span>
    <span class="c1">// number of variation.</span>
    <span class="nx">buffsize</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">CountHammingNeighbors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">n_codons</span><span class="p">)</span>
</code></pre></div>

<p>The call to <code>CountHammingNeighbors()</code> uses the counting
formula from <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1</a>
to predict the number of variations. If the user has selected
an astronomical problem size, the program warns the user.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1">// This blows up quickly, so warn the user</span>
    <span class="c1">// if their problem is too big</span>
    <span class="nx">MAX</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">buffsize</span> <span class="p">&gt;</span> <span class="nx">MAX</span> <span class="p">{</span>
        <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error: you are generating over MAX = %d permutations, you probably don&#39;t want to do this.&quot;</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>

<p>Now the actual recursive backtracking algorithm begins.
The code loops over every possible value of Hamming distance
<span class="math">\(d\)</span> and calls the recursive method at each value of <span class="math">\(d\)</span>.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1">// Store the final results in a set (string-&gt;bool map)</span>
    <span class="nx">results</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span>

    <span class="c1">// Begin backtracking algorithm</span>
    <span class="k">for</span> <span class="nx">dd</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dd</span> <span class="o">&lt;=</span> <span class="nx">d</span><span class="p">;</span> <span class="nx">dd</span><span class="o">++</span> <span class="p">{</span>

        <span class="c1">// The choices array will change with each recursive call.</span>
        <span class="c1">// Go passes all arguments by copy, which is good for us.</span>
        <span class="nx">choices</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>

        <span class="c1">// Populate list of neighbors</span>
        <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">dd</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>

    <span class="p">}</span>
</code></pre></div>

<p>We don't assign any results from the call to <code>visitHammingNeighbors_recursive()</code>
because we pass in a data structure (actually a pointer to a
data structure), <code>results</code>, that is modified in-place.</p>
<p>Thus, when we complete a call to <code>visitHammingNeighbors_recursive()</code>,
results will contain all variations already.</p>
<div class="highlight"><pre><span></span><code>    <span class="c1">// Check if we have the right number of results</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">buffsize</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;WARNING: number of results (%d) did not match expected value (%d)\n&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">results</span><span class="p">),</span> <span class="nx">buffsize</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="private-recursive-function">Private, Recursive Function</h4>
<p>In the above function, the call to the recursive
function to visit all Hamming neighbors happens
here:</p>
<div class="highlight"><pre><span></span><code>        <span class="c1">// Populate list of neighbors</span>
        <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">dd</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
</code></pre></div>

<p>The user passes the original kmer <code>input</code>, along with the
Hamming distance parameter <code>dd</code>, the list of choices
of indices that have already been selected <code>choices</code>,
and the data structure storing all resulting strings
<code>results</code>.</p>
<p>As with the pseudocode, we have a base case and 
a recursive case. The recursive function is being
called repeatedly until it reaches a depth of 0,
with the depth parameter being decremented each call.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Recursive function: given an input string of DNA,</span>
<span class="c1">// generate Hamming neighbors that are a Hamming</span>
<span class="c1">// distance of exactly d. Populate the neighbors</span>
<span class="c1">// array with the resulting neighbors.</span>
<span class="kd">func</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Base case</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The base case occurs when we reach a depth of 0 and have
no further choices to make. We reach this base case for
each binary number with <span class="math">\(d\)</span> digits set to 1; once the base
case is reached, we call the <code>assemble_variations()</code> function
to substitute all possible codons at the selected indices.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">nil</span>
</code></pre></div>

<p>The recursive case is slightly more complicated, but it follows
the same backtracking pseudocode covered previously: from a set
of possible choices, try each choice, recursively call this 
function, then unmake the choice and move on to the next choice.</p>
<p>Here, the choice is which index <code>c</code> in the kmer to modify. Each
kmer can only be modified once, so we have a for loop to
check if the index <code>c</code> is in the list of choices already made.</p>
<div class="highlight"><pre><span></span><code>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>
        <span class="k">for</span> <span class="nx">c</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">c</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">);</span> <span class="nx">c</span><span class="o">++</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">indexAlreadyTaken</span> <span class="kt">bool</span>
            <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">choice</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">choices</span> <span class="p">{</span>
                <span class="k">if</span> <span class="nx">c</span> <span class="o">==</span> <span class="nx">choice</span> <span class="p">{</span>
                    <span class="nx">indexAlreadyTaken</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div>

<p>As before, the recursive call to this function will
not return any values that need to be stored, since 
<code>results</code> points to a data structure (map) that is 
modified in-place.</p>
<div class="highlight"><pre><span></span><code>            <span class="k">if</span> <span class="p">!</span><span class="nx">indexAlreadyTaken</span> <span class="p">{</span>

                <span class="c1">// This will make a new copy of choices</span>
                <span class="c1">// for each recursive function call</span>
                <span class="nx">choices2</span> <span class="o">:=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">choices</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
                <span class="nx">err</span> <span class="o">:=</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">,</span> <span class="nx">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">choices2</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">err</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<p><a name="assemble-visit"></a></p>
<h3 id="assemble-visit-variation-function">Assemble Visit Variation Function</h3>
<p>Once we've generated each list of indices to modify,
we call a second recursive function to substitute each
codon into each index.</p>
<p>In the recursive method above, each recursive function
call added a new choice to <code>choices</code>; in this recursive
function, each recursive funcction call pops a choice 
from <code>choices</code>. Thus, the base case is when <code>choices</code>
is empty.</p>
<p>Here are the base and recursive cases:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Given a base kmer and a choice of indices where</span>
<span class="c1">// the kmer should be changed, generate all possible</span>
<span class="c1">// variations on this base_kmer.</span>
<span class="kd">func</span> <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">choices</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>
        <span class="o">...</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="o">...</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The recursive case pops a choice from <code>choices</code>, 
finds which nucleotide (AGCT) is at that location,
and assembles the list of possible choices (the
other 3 nucleotide values). It then performs
the recursive backtracking algorithm, choosing 
from each of the three possible nucleotide values,
exploring the choice by making a recursive call,
then un-making the choice.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">choices</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>

        <span class="nx">all_codons</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="s">&quot;C&quot;</span><span class="p">}</span>

        <span class="c1">// Pop the next choice</span>
        <span class="c1">// https://github.com/golang/go/wiki/SliceTricks</span>
        <span class="nx">ch_ix</span><span class="p">,</span> <span class="nx">choices</span> <span class="o">:=</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1">// Get the value of the codon at that location</span>
        <span class="k">if</span> <span class="nx">ch_ix</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// slice of string is bytes,</span>
            <span class="c1">// so convert back to string</span>
            <span class="nx">this_codon</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">[</span><span class="nx">ch_ix</span><span class="p">])</span>
            <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">codon</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">all_codons</span> <span class="p">{</span>

                <span class="k">if</span> <span class="nx">codon</span> <span class="o">!=</span> <span class="nx">this_codon</span> <span class="p">{</span>
                    <span class="c1">// Swap out the old codon with the new codon</span>
                    <span class="nx">new_kmer</span> <span class="o">:=</span> <span class="nx">base_kmer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">ch_ix</span><span class="p">]</span> <span class="o">+</span> <span class="nx">codon</span> <span class="o">+</span> <span class="nx">base_kmer</span><span class="p">[</span><span class="nx">ch_ix</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">new_kmer</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="nx">results</span><span class="p">[</span><span class="nx">base_kmer</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><br />
<br /></p>
<p><a name="tests"></a></p>
<h2 id="tests">Tests</h2>
<p>The last step after some debugging was to write tests for the
function to generate all variations of a DNA string, to ensure
the recursive backtracking functions work correctly.</p>
<p>The pattern we use is to create a struct containing test parameters,
then create a test matrix by initializing instances of the
parameter struct with the parameters we want to test.</p>
<p>Here is how we set up the tests:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestMatrixVisitHammingNeighbors</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tests</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">input</span> <span class="kt">string</span>
        <span class="nx">d</span>     <span class="kt">int</span>
        <span class="nx">gold</span>  <span class="p">[]</span><span class="kt">string</span>
    <span class="p">}{</span>
        <span class="p">{</span><span class="s">&quot;AAA&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;AAC&quot;</span><span class="p">,</span> <span class="s">&quot;AAT&quot;</span><span class="p">,</span> <span class="s">&quot;AAG&quot;</span><span class="p">,</span> <span class="s">&quot;AAA&quot;</span><span class="p">,</span> <span class="s">&quot;CAA&quot;</span><span class="p">,</span> <span class="s">&quot;GAA&quot;</span><span class="p">,</span> <span class="s">&quot;TAA&quot;</span><span class="p">,</span> <span class="s">&quot;ATA&quot;</span><span class="p">,</span> <span class="s">&quot;ACA&quot;</span><span class="p">,</span> <span class="s">&quot;AGA&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">test</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>

        <span class="o">...</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Each test case should generate all Hamming neighbors, and compare to the list of
Hamming neighbors provided. This requires two tricks:</p>
<ul>
<li>sort before comparing, to ensure a proper comparison</li>
<li>use a custom <code>EqualStringSlices()</code> function that will iterate through
  two string slices element-wise to check if they are equal.</li>
</ul>
<p>The <code>EqualStringSlices()</code> function is required because Go does not have 
built-in equality checks for slices.</p>
<p>Here is what the tests look like:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">test</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>

        <span class="c1">// Money shot</span>
        <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">VisitHammingNeighbors</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">d</span><span class="p">)</span>

        <span class="c1">// Check if there was error</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error: %v&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// Sort before comparing</span>
        <span class="nx">sort</span><span class="p">.</span><span class="nx">Strings</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span>
        <span class="nx">sort</span><span class="p">.</span><span class="nx">Strings</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">!</span><span class="nx">EqualStringSlices</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error testing VisitHammingNeighbors():\ncomputed = %v\ngold     = %v&quot;</span><span class="p">,</span>
                <span class="nx">result</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<p><a name="final"></a></p>
<h2 id="final-code">Final Code</h2>
<p>The final version of the recursive function to visit all Hamming neighbors
and return them in a string array can be found in the <code>go-rosalind</code> library
on Github.</p>
<p>Specifically, in the file <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go"><code>rosalind_ba1.go</code></a>,
there is a <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L711"><code>VisitHammingNeighbors()</code></a>
function that is the public function that calls the private recursive
function <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L778"><code>visitHammingNeighbors_recursive()</code></a>,
and the recursive function to swap out codons is
in the <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L819"><code>visit()</code></a>
funciont.</p>
<p><a name="fruitful"></a></p>
<h2 id="go-forth-and-be-fruitful">Go Forth and Be Fruitful</h2>
<p>Now that you have the basic tools to imlement a recursive
backtracking algorithm in Go to generate string variations,
you have one of the key ingredients to solve Rosalind.info
problem <a href="http://rosalind.info/problems/ba1i/">BA1i, "Find Most Frequent Words with Mismatches by
String"</a>.</p>
<p>This problem is tricky principally because it requires generating
every DNA string variation, so now you should have the key
ingredient to solve BA1i (and several problems that follow).</p>
<p>You can use the final version of the methods we covered by importing
the <code>go-rosalind</code> library in your Go code
(<a href="https://godoc.org/github.com/charlesreid1/go-rosalind/rosalind">link to go-rosalind documentation on godoc.org</a>)
or you can implement your own version of these algorithms. 
The Go code we covered in this post is also on Github in the
<a href="https://github.com/charlesreid1/go-rosalind">charlesreid1/go-rosalind</a> repository.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/go.html">go</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/golang.html">golang</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/rosalind.html">rosalind</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computational-biology.html">computational biology</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/recursion.html">recursion</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/backtracking.html">backtracking</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/strings.html">strings</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/combinatorics.html">combinatorics</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">

            <a class="next" href="https://charlesreid1.github.io/index13.html">&larr; Newer</a>

            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;

            <a class="prev" href="https://charlesreid1.github.io/index15.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>March 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/episode-23740000-of-so-thats-in-the-internet-archive-now.html">Episode 23,740,000 of So That's In The Internet Archive Now</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/how-to-read-ulysses.html">How to Read Ulysses</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-todo-lists.html">MediaWiki Patterns for a Zettelkasten: Todo Lists</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-organizing-pages.html">MediaWiki Patterns for a Zettelkasten: Organizing Pages</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-monthly-template-pattern.html">MediaWiki Patterns for a Zettelkasten: Monthly Template Pattern</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-daily-page-pattern.html">MediaWiki Patterns for a Zettelkasten: Daily Page Pattern</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mediawiki-as-a-zettelkasten-or-external-brain.html">Using MediaWiki as a Zettelkasten or External Brain</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2021</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/september-2021-tils.html">September 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/august-2021-tils.html">August 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/july-2021-tils.html">July 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/june-2021-tils.html">June 2021 TILs</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/copying-letsencrypt-certs-between-machines.html">Copying LetsEncrypt Certs Between Machines</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/applied-gitflow.html">Applied Gitflow</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/a-singleton-configuration-class-in-python.html">A Singleton Configuration Class in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mock-api-servers.html">Using Mock API Servers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/creating-mock-api-servers.html">Creating Mock API Servers</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-from-args-to-kwargs.html">Python: From Args to Kwargs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/confuse-a-constructor-when-class-as-constructor-returns-objects-of-type-b.html">Confuse-A-Constructor: When Class A's Constructor Returns Objects of Type B</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-patterns-the-registry.html">Python Patterns: The Registry</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/incorporating-terraform-commands-into-makefiles.html">Incorporating Terraform Commands into Makefiles</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/automatically-generating-up-to-date-requirementstxt-for-python-projects.html">Automatically Generating Up-To-Date requirements.txt for Python Projects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-3-refactoring-large-branches-and-pull-requests.html">Git Workflows, Part 3: Refactoring Large Branches and Pull Requests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>November 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-2-crafting-commits.html">Git Workflows, Part 2: Crafting Commits</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">Git Workflows, Part 1: Supercharging your Git Config</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Mocking AWS in Unit Tests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">Deconvoluting Convolutional Neural Networks</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-2-finding-eulerian-paths.html">Graphs for Bioinformatics, Part 2: Finding Eulerian Paths</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-1-de-bruijn-graphs-hamiltonian-paths-and-eulerian-paths.html">Graphs for Bioinformatics, Part 1: de Bruijn Graphs, Hamiltonian Paths, and Eulerian Paths</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-git-commit-ectomy.html">The Git-Commit-Ectomy</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-3-solving-the-double-step-case.html">The Josephus Problem: Part 3: Solving the Double Step Case</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-2-two-examples.html">The Josephus Problem: Part 2: Two Examples</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-1-the-problem.html">The Josephus Problem: Part 1: The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/approximating-pi-happy-pi-day.html">Approximating Pi (Happy Pi Day)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-5-the-try-trie-tree.html">Five Letter Words: Part 5: The Try Trie Tree</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-4-revisiting-diff-by-one.html">Five Letter Words: Part 4: Revisiting Diff by One</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion: a document search engine</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/any-color-you-like-as-long-as-its-00add8.html">Any Color You Like, As Long As It's 00ADD8</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/a-few-of-my-favorite-peps.html">A Few of My Favorite PEPs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/context-managers-in-python.html">Context Managers in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">Building Snakemake Command Line Wrappers for Kubernetes Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers for Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>