<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Git Workflows, Part 1: Supercharging your Git Config
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-10-07T20:00:00-07:00" pubdate>Monday 10/07/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/git.html">Git</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Source</h1>
<p>Most of the good stuff is from
<a href="https://github.com/mathiasbynens/dotfiles">https://github.com/mathiasbynens/dotfiles</a>!</p>
<h1><code>[user]</code> section</h1>
<p>Start off easy - here's how you set your email and name for commits:</p>
<div class="highlight"><pre><span></span><span class="k">[user]</span>
    <span class="na">email</span> <span class="o">=</span> <span class="s">foo@bar.com</span>
<span class="s">    name = Foo Bar</span>
</pre></div>


<h1>Bash Aliases</h1>
<h2>The Best One Letter Alias Ever</h2>
<p>Start supercharging how you use git by creating a one-letter alias.</p>
<p>Add this to your <code>~/.bashrc</code> file:</p>
<div class="highlight"><pre><span></span>alias g=&quot;git&quot;
</pre></div>


<p>You're already saving yourself a bunch of keystrokes, and we're just getting started!</p>
<h2>Ending Bad Habits</h2>
<p>This is a nice trick for getting yourself out of bad habits.
My first time using a "sophisticated" branch worklow in git
(i.e., not just committing and pushing to master all the time),
I got in trouble for committing directly to master with a
<code>git push origin master</code> (instead of making a feature branch
and opening a pull request).</p>
<p>To get myself out of the habit of typing <code>git push origin master</code>,
I wanted to map it to an alias that told me no. I did that by
defining <code>git</code> to be a bash function (this works because functions
take precedence over a binary named <code>git</code> on your path).</p>
<p>The git function checks the arguments that are passed to it.
If the arguments are <code>push origin master</code>, it means I'm typing
<code>git push origin master</code>, and I get a slap on the wrist.</p>
<p>Otherwise, it passes the arguments through to the <code>git</code> binary.</p>
<p>You can also put this in <code>~/.bashrc</code>.</p>
<div class="highlight"><pre><span></span>git<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$@</span> <span class="o">==</span> <span class="s2">&quot;push origin master&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;nope&quot;</span>
    <span class="k">else</span>
        <span class="nb">command</span> git <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>
</pre></div>


<h1><code>[alias]</code> section</h1>
<p>In the ~/.gitconfig<code>file, aliases specific to git can be 
defined in a section beginning with</code>[alias]`.</p>
<h2>Log Utils</h2>
<p>Let's start with some utilities for viewing git logs.</p>
<p>(You can never have too many ways to look at a git log.)</p>
<p>Note that we'll assume the <code>[alias]</code> bit in the following git config excerpts.</p>
<div class="highlight"><pre><span></span><span class="k">[alias]</span>
    <span class="c1"># courtesy of https://stackoverflow.com/a/34467298</span>
    <span class="na">lg</span> <span class="o">=</span> <span class="s">!&quot;git lg1&quot;</span>
<span class="s">    lg1 = !&quot;git lg1-specific --all&quot;</span>
<span class="s">    lg2 = !&quot;git lg2-specific --all&quot;</span>
<span class="s">    lg3 = !&quot;git lg3-specific --all&quot;</span>

    <span class="na">lg1-specific</span> <span class="o">=</span> <span class="s">log --graph --abbrev-commit --decorate --format=format:&#39;%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)&#39;</span>
<span class="s">    lg2-specific = log --graph --abbrev-commit --decorate --format=format:&#39;%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(auto)%d%C(reset)%n&#39;&#39;          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)&#39;</span>
<span class="s">    lg3-specific = log --graph --abbrev-commit --decorate --format=format:&#39;%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset) %C(bold cyan)(committed: %cD)%C(reset) %C(auto)%d%C(reset)%n&#39;&#39;          %C(white)%s%C(reset)%n&#39;&#39;          %C(dim white)- %an &lt;%ae&gt; %C(reset) %C(dim white)(committer: %cn &lt;%ce&gt;)%C(reset)&#39;</span>
</pre></div>


<p>The <code>git lgX</code> shortcuts give similar views of the log, but with increasing vertical spacing.
<code>git lg1</code> is the most compact, while <code>git lg3</code> is the most comfortable to read, as far as vertical whitespace.
Same with the <code>-specific</code> commands.</p>
<p>This is one more nice short log command:</p>
<div class="highlight"><pre><span></span>    # View abbreviated SHA, description, and history graph of the latest 20 commits
    l = log --pretty=oneline -n 20 --graph --abbrev-commit
</pre></div>


<p>Remember to use this with the <code>g</code> alias for super short log:</p>
<div class="highlight"><pre><span></span>$ g l
* 4357b28 <span class="o">(</span>HEAD -&gt; <span class="nb">source</span><span class="o">)</span> update mocking aws post
* 063ad78 <span class="o">(</span>gh/source, gh/HEAD<span class="o">)</span> add mocking post
* a5f1adc add init keras cnn post
* fb911ec add keras cnn draft
* 3549d35 add rosalind <span class="o">(</span>euler paths<span class="o">)</span> part <span class="m">7</span> draft

$ g lg1
* 4357b28 - <span class="o">(</span><span class="m">67</span> minutes ago<span class="o">)</span> update mocking aws post - Charles Reid <span class="o">(</span>HEAD -&gt; <span class="nb">source</span><span class="o">)</span>
* 063ad78 - <span class="o">(</span><span class="m">2</span> weeks ago<span class="o">)</span> add mocking post - Charles Reid <span class="o">(</span>gh/source, gh/HEAD<span class="o">)</span>
* a5f1adc - <span class="o">(</span><span class="m">4</span> months ago<span class="o">)</span> add init keras cnn post - C Reid
* fb911ec - <span class="o">(</span><span class="m">5</span> months ago<span class="o">)</span> add keras cnn draft - C Reid
* 3549d35 - <span class="o">(</span><span class="m">5</span> months ago<span class="o">)</span> add rosalind <span class="o">(</span>euler paths<span class="o">)</span> part <span class="m">7</span> draft - C Reid
...
</pre></div>


<h2>Status Utils</h2>
<p>The git status command is one of my most frequently used commands, so I made a few shortcuts:</p>
<div class="highlight"><pre><span></span>    # View the current working tree status using the short format
    s = status -s
    ss = status
</pre></div>


<p>This makes checking the short or long status of a git repo easy:</p>
<div class="highlight"><pre><span></span>$ g s
AM pelican/content/git-workflows-1-config.md
AM pelican/content/git-workflows-2-teams.md

$ g ss
On branch <span class="nb">source</span>
Your branch is ahead of <span class="s1">&#39;gh/source&#39;</span> by <span class="m">1</span> commit.
  <span class="o">(</span>use <span class="s2">&quot;git push&quot;</span> to publish your <span class="nb">local</span> commits<span class="o">)</span>

Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git restore --staged &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>
    new file:   pelican/content/git-workflows-1-config.md
    new file:   pelican/content/git-workflows-2-teams.md

Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
    modified:   pelican/content/git-workflows-1-config.md
    modified:   pelican/content/git-workflows-2-teams.md
</pre></div>


<h2>Fetching</h2>
<p>Fetching is handy to do, since it just fetches changes from a remote and doesn't actually
change anything or try to merge anything (unlike a <code>git pull</code> command).</p>
<p>The most useful fetch command (<code>git fetch --all</code>) is aliased to <code>g f</code> with the following
bit in the <code>[aliases]</code> section of the <code>~/.gitconfig</code> file:</p>
<div class="highlight"><pre><span></span>    f = fetch --all
</pre></div>


<h2>Branch Utils</h2>
<p>The only command I might use more than the status command are branch commands,
so here are several branch aliases:</p>
<div class="highlight"><pre><span></span>    b = branch -v
    bv = branch -v
    bb = branch -v

    ba = branch -a
    bb = branch -v -a
</pre></div>


<p>In a similar way, you can get a summary view using <code>g b</code>:</p>
<div class="highlight"><pre><span></span>$ g b
  master 4c828cd <span class="o">[</span>behind <span class="m">84</span><span class="o">]</span> update with awsome day notes
* <span class="nb">source</span> b18adfd add two git workflow posts

$ g b
  master 940ee98 update mocking post
* <span class="nb">source</span> b18adfd add two git workflow posts
</pre></div>


<p>and a little bit more information with <code>g bb</code>:</p>
<div class="highlight"><pre><span></span>$ g bb
  master            940ee98 update mocking post
* <span class="nb">source</span>            b18adfd add two git workflow posts
  remotes/gh/HEAD   -&gt; gh/source
  remotes/gh/master 940ee98 update mocking post
  remotes/gh/source b18adfd add two git workflow posts
</pre></div>


<h3>Branch and Checkout</h3>
<p>Sometimes if you are creaing a branch with a long branch name, it can be
inconvenient to have to first create the branch with <code>git branch &lt;branch-name&gt;</code>
and then check it out with <code>git checkout &lt;branch-name&gt;</code>.</p>
<p>To resolve this you can define a <code>git go</code> alias that creates the branch and
then switches to that branch:</p>
<div class="highlight"><pre><span></span>    # Switch to a branch, creating it 
    # from the current branch if necessary
    go = &quot;!f() { git checkout -b \&quot;$1\&quot; 2&gt; /dev/null || git checkout \&quot;$1\&quot;; }; f&quot;
</pre></div>


<p>Careful you don't mistype the branch name.</p>
<h2>Remote Utils</h2>
<p>Another useful git command is the remote command, so here are a few
remote aliases:</p>
<div class="highlight"><pre><span></span>    r = remote -v
    rv = remote -v
    ra = remote -v
</pre></div>


<h2>Commit Utils</h2>
<p>Sometimes you have changes that you've staged using <code>git add</code>, but you
want to see the changes that you've staged, before you commit them.</p>
<p>Normally you'd have to use the inconvenient <code>git diff --cached &lt;files&gt;</code>,
but this can be aliased to <code>cdiff</code>, so that you can use <code>git diff</code> to see
unstaged changes and <code>git cdiff</code> to see staged changes.</p>
<p>Even better, you can define the alias <code>g cd</code> to run <code>git cdiff</code>...!</p>
<p>Here's the relevant bit in the <code>[aliases]</code> section:</p>
<div class="highlight"><pre><span></span>    cdiff = diff --cached
    cd = diff --cached
</pre></div>


<h3>Committing All Changes</h3>
<div class="highlight"><pre><span></span>    # Commit all changes
    ca = !git add -A &amp;&amp; git commit -av
</pre></div>


<h3>Fixing Commits</h3>
<p>Some common operations for repairing commit history before pushing:</p>
<div class="highlight"><pre><span></span>    # Amend the currently staged files to the latest commit
    amend = commit --amend --reuse-message=HEAD

    # Oops
    fix = commit --amend --reuse-message=HEAD --edit
</pre></div>


<h2>Miscellaneous Utils</h2>
<p>There are a few other actions that are useful to add to the <code>[aliases]</code> section
of the <code>~/.gitconfig</code>:</p>
<h3>Rebasing shortcuts</h3>
<div class="highlight"><pre><span></span>    # Interactive rebase with the given number of latest commits
    reb = &quot;!r() { git rebase -i HEAD~$1; }; r&quot;
</pre></div>


<h3>Diff shortcuts</h3>
<div class="highlight"><pre><span></span>    # Show the diff between the latest commit and the current state
    d = !&quot;git diff-index --quiet HEAD -- || clear; git --no-pager diff --patch-with-stat&quot;

    # `git di $number` shows the diff between the state `$number` revisions ago and the current state
    di = !&quot;d() { git diff --patch-with-stat HEAD~$1; }; git diff-index --quiet HEAD -- || clear; d&quot;
</pre></div>


<h3>Pull shortcuts</h3>
<div class="highlight"><pre><span></span>    p = &quot;!f() { git pull $1 $2; }; f&quot;
</pre></div>


<h3>Clone shortcuts</h3>
<div class="highlight"><pre><span></span>    # Clone a repository including all submodules
    c = clone --recursive
</pre></div>


<h3>Contributor shortcuts</h3>
<p>This last one is convenient for getting a summary of contributors:</p>
<div class="highlight"><pre><span></span>    # List contributors with number of commits
    contributors = shortlog --summary --numbered
</pre></div>


<p>An example for <a href="https://github.com/aws/chalice">https://github.com/aws/chalice</a>:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> chalice/
$ g contributors
  <span class="m">1053</span>  James Saryerwinnie
   <span class="m">120</span>  John Carlyle
    <span class="m">94</span>  stealthycoin
    <span class="m">42</span>  kyleknap
    <span class="m">35</span>  jcarlyl
    <span class="m">19</span>  Kyle Knapp
    <span class="m">12</span>  Atharva Chauthaiwale
</pre></div>


<h1><code>[core]</code> section</h1>
<p>Because it's the best text editor:</p>
<div class="highlight"><pre><span></span><span class="k">[core]</span>
    <span class="na">editor</span> <span class="o">=</span> <span class="s">vim</span>
</pre></div>


<p>I have some other stuff I've collected, many of them from
<a href="https://github.com/mathiasbynens/dotfiles">https://github.com/mathiasbynens/dotfiles</a>:</p>
<div class="highlight"><pre><span></span>    # Use custom `.gitignore` and `.gitattributes`
    excludesfile = ~/.gitignore
    attributesfile = ~/.gitattributes

    # Treat spaces before tabs and all kinds of trailing whitespace as an error
    # [default] trailing-space: looks for spaces at the end of a line
    # [default] space-before-tab: looks for spaces before tabs at the beginning of a line
    whitespace = space-before-tab,-indent-with-non-tab,trailing-space

    # Make `git rebase` safer on macOS
    # More info: &lt;http://www.git-tower.com/blog/make-git-rebase-safe-on-osx/&gt;
    ###trustctime = false

    # Prevent showing files whose names contain non-ASCII symbols as unversioned.
    # http://michael-kuehnel.de/git/2014/11/21/git-mac-osx-and-german-umlaute.html
    precomposeunicode = false

    # Speed up commands involving untracked files such as `git status`.
    # https://git-scm.com/docs/git-update-index#_untracked_cache
    untrackedCache = true
</pre></div>


<h1><code>[color]</code> section</h1>
<p>Make some nice beautiful colors that are easy to understand:</p>
<div class="highlight"><pre><span></span><span class="k">[color]</span>

    <span class="c1"># Use colors in Git commands that are capable of colored output when</span>
    <span class="c1"># outputting to the terminal. (This is the default setting in Git ≥ 1.8.4.)</span>
    <span class="na">ui</span> <span class="o">=</span> <span class="s">auto</span>

<span class="k">[color &quot;branch&quot;]</span>

    <span class="na">current</span> <span class="o">=</span> <span class="s">yellow reverse</span>
<span class="s">    local = yellow</span>
<span class="s">    remote = green</span>

<span class="k">[color &quot;diff&quot;]</span>

    <span class="na">meta</span> <span class="o">=</span> <span class="s">yellow bold</span>
<span class="s">    frag = magenta bold # line info</span>
<span class="s">    old = red # deletions</span>
<span class="s">    new = green # additions</span>

<span class="k">[color &quot;status&quot;]</span>

    <span class="na">added</span> <span class="o">=</span> <span class="s">yellow</span>
<span class="s">    changed = green</span>
<span class="s">    untracked = cyan</span>
</pre></div>


<h1><code>[url]</code> section</h1>
<p>This makes some Github-related URLs easier and shorter to type:</p>
<div class="highlight"><pre><span></span><span class="k">[url &quot;git@github.com:&quot;]</span>

    <span class="na">insteadOf</span> <span class="o">=</span> <span class="s">&quot;gh:&quot;</span>
<span class="s">    pushInsteadOf = &quot;github:&quot;</span>
<span class="s">    pushInsteadOf = &quot;git://github.com/&quot;</span>

<span class="k">[url &quot;git@gist.github.com:&quot;]</span>

    <span class="na">insteadOf</span> <span class="o">=</span> <span class="s">&quot;gst:&quot;</span>
<span class="s">    pushInsteadOf = &quot;gist:&quot;</span>
<span class="s">    pushInsteadOf = &quot;git://gist.github.com/&quot;</span>

<span class="k">[url &quot;git://gist.github.com/&quot;]</span>

    <span class="na">insteadOf</span> <span class="o">=</span> <span class="s">&quot;gist:&quot;</span>
</pre></div>


<p>Now, instead of</p>
<div class="highlight"><pre><span></span>$ git clone git@github.com:org-name/repo-name
</pre></div>


<p>you can do the much simpler</p>
<div class="highlight"><pre><span></span>$ g c gh://org-name/repo-name
</pre></div>


<p>Voila! Start integrating these alises into your daily workflow,
and you'll find yourself using a lot fewer keystrokes!</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/git.html">git</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/rebase.html">rebase</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/cherry-pick.html">cherry-pick</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/branching.html">branching</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/version-control.html">version control</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Mocking AWS in Unit Tests
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-09-23T09:00:00-07:00" pubdate>Monday 09/23/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>Table of Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#a-simple-example-mocking-api-responses">A Simple Example: Mocking API Responses</a><ul>
<li><a href="#the-genuine-aws-call">The Genuine AWS Call</a></li>
<li><a href="#the-mocked-aws-call">The Mocked AWS Call</a></li>
</ul>
</li>
</ul>
<h2>Overview</h2>
<p>This post covers a technique for mocking AWS in unit tests so that you can test functionality that normally
requires API calls and handling responses, by mocking those responses instead of making actual API calls.</p>
<h2>A Simple Example: Mocking API Responses</h2>
<h3>The Genuine AWS Call</h3>
<p>Let's start with an example of an AWS API call. Here's how our program will be structured:
start with a driver <code>lister.py</code> that creates an AWS secrets manager client and defines a 
function to list secrets using the secrets manager client, then a test for it in <code>test_lister.py</code>
that mocks the AWS call.</p>
<p>This example is simple and uses just one function, <code>list_secrets()</code>,
which returns a JSON response that looks something like this:</p>
<div class="highlight"><pre><span></span>{
  &quot;SecretList&quot;: [
    {
      &quot;ARN&quot;: &quot;arn:aws:secretsmanager:us-east-1:000000000000:secret:prefix/secret1-abc123&quot;,
      &quot;Name&quot;: &quot;prefix/es_source_ip&quot;,
      &quot;LastChangedDate&quot;: &quot;2019-09-23 17:29:16.267000-07:00&quot;,
      &quot;LastAccessedDate&quot;: &quot;2019-09-23 17:00:00-07:00&quot;,
      &quot;SecretVersionsToStages&quot;: {
        &quot;658c3b41-0806-48b9-b05d-ea7dc2dbf237&quot;: [
          &quot;AWSCURRENT&quot;
        ],
        &quot;f37ccfe2-16e0-4305-a250-ef89d2c47ece&quot;: [
          &quot;AWSPREVIOUS&quot;
        ]
      }
    },
    {
      &quot;ARN&quot;: &quot;arn:aws:secretsmanager:us-east-1:000000000000:secret:prefix/secret2-def789&quot;,
      &quot;Name&quot;: &quot;prefix/secret2&quot;,
      &quot;LastChangedDate&quot;: &quot;2019-09-22 17:05:01.431000-07:00&quot;,
      &quot;LastAccessedDate&quot;: &quot;2019-09-22 17:00:00-07:00&quot;,
      &quot;SecretVersionsToStages&quot;: {
        &quot;95AE5F8B-34E7-4EDF-A672-9E3AF1A4732E&quot;: [
          &quot;AWSCURRENT&quot;
        ],
        &quot;F29E224A-BC03-4780-B64E-EA666B99D952&quot;: [
          &quot;AWSPREVIOUS&quot;
        ]
      }
    }
  ]
}
</pre></div>


<p>Using the secrets manager API:</p>
<p><strong><code>lister.py</code></strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">sm_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;secretsmanager&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_secret_names</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sm_client</span><span class="o">.</span><span class="n">list_secrets</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">secret</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;SecretList&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;Name&#39;</span> <span class="ow">in</span> <span class="n">secret</span> <span class="ow">and</span> <span class="s1">&#39;LastAccessedDate&#39;</span> <span class="ow">in</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Secret Name: {secret[&#39;Name&#39;]} (last accessed: {secret[&#39;LastAccessedDate&#39;]})&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">print_secret_names</span><span class="p">()</span>
</pre></div>


<p>If we run this file, we'll see a list of secrets in the real secrets manager -
that is, the secrets manager that is linked to the boto credentials in <code>~/.aws</code>,
so the secrets we see are the actual secrets in the secret manager:</p>
<div class="highlight"><pre><span></span>$ python lister.py
Secret Name: prefix/secret1 <span class="o">(</span>last accessed: <span class="m">2019</span>-09-23 <span class="m">17</span>:00:00-07:00<span class="o">)</span>
Secret Name: prefix/secret2 <span class="o">(</span>last accessed: <span class="m">2019</span>-09-23 <span class="m">17</span>:00:00-07:00<span class="o">)</span>
Secret Name: prefix/secret3 <span class="o">(</span>last accessed: <span class="m">2019</span>-09-23 <span class="m">17</span>:00:00-07:00<span class="o">)</span>
</pre></div>


<h3>The Mocked AWS Call</h3>
<p>It is important to only mock the functionality we need.
We should mock the returned JSON, but only the <code>Name</code>
and <code>LastAccessedDate</code> fields.</p>
<p>To mock the call to <code>list_secrets()</code>, we start by importing
<code>mock</code> from <code>unittest</code>. Then we import the file that has the
function we want to test. We also import any other modules
we need.</p>
<p>Next, we are mocking a call to a method of an object,
which we can do by creating a context via <code>with mock.patch()</code>
(and passing it a string with the name of the object we want
to mock, or patch).</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="kn">import</span> <span class="nn">lister</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">TestMo</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;mo.sm_client&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sm</span><span class="p">:</span>
            <span class="o">...</span>
            <span class="n">sm_client</span><span class="o">.</span><span class="n">list_secrets</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
            <span class="o">...</span>
</pre></div>


<p>Any calls made to <code>sm_client</code> in the <code>mo</code> module will be mocked
using the <code>mock.MagicMock</code> object that we define in the context,
so we craft the response we want before we call the method we 
want to test (which in turn will call <code>sm_client.list_secrets()</code>).</p>
<p>The full version of the test looks like this:</p>
<p><strong><code>test_lister.py</code></strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="kn">import</span> <span class="nn">lister</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">TestLister</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;lister.sm_client&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sm</span><span class="p">:</span>
            <span class="n">return_json</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;SecretList&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;fakesecret1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;LastAccessedDate&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;fakesecret2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;LastAccessedDate&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">list_secrets</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">return_json</span><span class="p">)</span>
            <span class="n">lister</span><span class="o">.</span><span class="n">print_secret_names</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>When the test file is run via Python, we see the fake secrets:</p>
<div class="highlight"><pre><span></span>$ python test_lister.py
Secret Name: fakesecret1 <span class="o">(</span>last accessed: <span class="m">2019</span>-09-23 <span class="m">20</span>:31:49.186874<span class="o">)</span>
Secret Name: fakesecret2 <span class="o">(</span>last accessed: <span class="m">2019</span>-09-23 <span class="m">20</span>:31:49.186880<span class="o">)</span>
.
----------------------------------------------------------------------
Ran <span class="m">1</span> <span class="nb">test</span> in <span class="m">0</span>.000s

OK
</pre></div></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/pytest.html">pytest</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/tests.html">tests</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/aws.html">aws</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mock.html">mock</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mocking.html">mocking</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Deconvoluting Convolutional Neural Networks
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-05-29T14:00:00-07:00" pubdate>Wednesday 05/29/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/machine-learning.html">Machine Learning</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#introduction-a-simple-cnn-example">Introduction: A Simple CNN Example</a></li>
<li><a href="#exploring-data">Exploring Data</a></li>
<li><a href="#create-cnn">Create CNN</a></li>
<li>
<p><a href="#analyzing-network-architecture-and-tensor-shapes">Analyzing Network Architecture and Tensor Shapes</a></p>
<ul>
<li>
<p><a href="#input-image-layer">Input Image Layer</a></p>
</li>
<li>
<p><a href="#first-convolution-layer">First Convolution Layer</a></p>
</li>
<li><a href="#first-convolution-layer">First Activation Layer</a></li>
<li>
<p><a href="#first-convolution-layer">First Pooling Layer</a></p>
</li>
<li>
<p><a href="#second-convolution-layer">Second Convolution Layer</a></p>
</li>
<li><a href="#second-convolution-layer">Second Activation Layer</a></li>
<li>
<p><a href="#second-convolution-layer">Second Pooling Layer</a></p>
</li>
<li>
<p><a href="#third-convolution-layer">Third Convolution Layer</a></p>
</li>
<li><a href="#third-convolution-layer">Third Activation Layer</a></li>
<li>
<p><a href="#third-convolution-layer">Third Pooling Layer</a></p>
</li>
<li>
<p><a href="#flatten-and-dense-layers">Flatten and Dense Layers</a></p>
</li>
<li><a href="#categorical-output">Categorical Output</a></li>
</ul>
</li>
<li>
<p><a href="#image-transformer">Image Transformer</a></p>
</li>
<li>
<p><a href="#next-steps">Next Steps</a></p>
</li>
</ul>
<h1>Introduction: A Simple CNN Example</h1>
<p>As part of our weekly Deep Learning for Genomics reading group
here in the <a href="http://ivory.idyll.org/lab/">Lab for Data Intensive Biology (DIB Lab)</a>,
we are applying convolutional neural networks (deep learning) 
to various problems in genomics and biology.</p>
<p>For the most recent meeting, we prepared some notes on how convolutional
neural networks work. The notes are in the form of a Jupyter notebook.
This blog post summarizes some of the important conclusions from the
notebook and links to relevant sections in the notebook.</p>
<p>In the notebook covered in this blog post, we set up a 
simple convolutional neural network from an example on the
<a href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html">keras blog</a>.
This example is used to classify input images as being either
a cat or a dog.</p>
<p>All materials covered in this blog post are in the 
<a href="https://github.com/charlesreid1/deconvoluting-convolutions">charlesreid1/deconvoluting-convolutions</a>
repository on Github.</p>
<h1>Exploring the Data</h1>
<p><strong>TL;DR:</strong> When developing a deep learning model for a problem,
it is important to start by exploring the data and understanding
it thoroughly. </p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Image-Data">Link to "Image Data" section of notebook</a></p>
<h1>Create CNN</h1>
<p><strong>TL;DR:</strong> Our convolutional neural network consists of the following architecture:</p>
<ul>
<li>Convolutional Stage #1<ul>
<li>Convolution (3 x 3 kernel, 32 filters)</li>
<li>Activation (ReLU)</li>
<li>Max Pooling (2x2)</li>
</ul>
</li>
<li>Convolutional Stage #2<ul>
<li>Convolution (3 x 3 kernel, 32 filters)</li>
<li>Activation (ReLU)</li>
<li>Max Pooling (2x2)</li>
</ul>
</li>
<li>Convolutional Stage #3<ul>
<li>Convolution (3 x 3 kernel, 64 filters)</li>
<li>Activation (ReLU)</li>
<li>Max Pooling (2x2)</li>
</ul>
</li>
<li>Flatten</li>
<li>Dense (64 nodes)</li>
<li>Activation (ReLU)</li>
<li>Dropout (0.5)</li>
<li>Dense (1 node)</li>
<li>Activation (ReLU)</li>
</ul>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Create-Convolutional-Neural-Network">Link to "Create Convolutional Neural Network" section of notebook</a></p>
<h1>Analyzing Network Architecture and Tensor Shapes</h1>
<p><strong>TL;DR:</strong> Each step of the neural network transforms
an input tensor of a given shape into an output tensor
of a (potentially different) shape.</p>
<p>In this section of the notebook, we step through each
of the neural network's layers to explain how the size
of each layer's inputs and outputs are determined.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Network-Architecture/Shapes">Link to "Network Architecture/Shapes" section of notebook</a></p>
<h2>Input Image Layer</h2>
<p><strong>TL;DR:</strong> The size of the cat and dog images is 150 x 150 pixels.
Each image is a color image, so it consists of 3 channels. Therefore,
the input to the very first layer has a shape of</p>
<div class="math">$$
(\mbox{None}, w_0, h_0, c_0) = (\mbox{None}, 150, 150, 3)
$$</div>
<p>(where "None" indicates a variable-size dimension that is equal to
the number of total input images, or alternatively, the number of 
images per batch, if we are using batch learning).</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Input-Image-Layer">Link to "Input Image Layer" section of notebook</a></p>
<h2>First Convolution Layer</h2>
<p><strong>TL;DR:</strong> A convolutional layer with a kernel size of <span class="math">\(k_1 \times k_1\)</span>
and a number of filters <span class="math">\(c_1\)</span> will transform the shape of the input image to:</p>
<div class="math">$$
(\mbox{None}, w_1, h_1, c_1) = 
(\mbox{None}, 148, 148, 32)
$$</div>
<p>where</p>
<div class="math">$$
w_1 = w_0 - k_1 + 1 \\
h_1 = h_0 - k_1 + 1
$$</div>
<p>Importantly, each of the three input channels are added together to determine
their contribution to the final convolution filters - the number of input channels
does not affect the number of output channels. </p>
<p>The total number of output channels is equal to the number of filters
in the convolution layer. </p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#First-Convolution-Layer">Link to "First Convolutional Layer" section of notebook</a></p>
<h2>First Activation Layer</h2>
<p><strong>TL;DR:</strong> The activation layer is a straightforward one-to-one mapping -
each individual value from the output of the convolution layer is fed through
the rectified linear unit (ReLU) function and the resulting output value becomes
the input to the next layer. The ReLU function is given by:</p>
<div class="math">$$
\mbox{ReLU}(x) = \max(0,x)
$$</div>
<p>The activation layer does not change the shape of the input tensor.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#First-Activation-Layer">Link to "First Activation Layer" section of notebook</a></p>
<h2>First MaxPooling Layer</h2>
<p><strong>TL;DR:</strong> The max pooling layer is a way of making the final convolutional
filters (the "feature-detectors" of the convolutional neural network) less 
sensitive to the exact placement of features. The pooling layer only affects
the size of the filter, not the number of channels.</p>
<p>If we use a max pooling window of <span class="math">\(p_1 \times p_1\)</span>, we will reduce the image
size by <span class="math">\(\mbox{ceil}(w_1/p_1)\)</span> and <span class="math">\(\mbox{ceil}(h_1/p_1)\)</span>. This reduces the input tensor shape
to:</p>
<div class="math">$$
(\mbox{None}, \mbox{ceil}(w_1/p_1), \mbox{ceil}(h_1/p_1), c_1) = 
(\mbox{None}, 74, 74, 32)
$$</div>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#First-Max-Pooling-Layer">Link to "First Max Pooling Layer" section of notebook</a></p>
<h2>Second Convolution Layer</h2>
<p><strong>TL;DR:</strong> The second convolutional layer has a kernel size 
of <span class="math">\(k_2 \times k_2\)</span> and a number of filters <span class="math">\(c_2\)</span>, which will
transform the shape of the input image in the same way as 
described for the first convolutional layer.</p>
<p>Note that just as the number of channels (3) in each 
input to the first convolutional layer did not affect
the final number of channels in the output of the convolutional
layer (number of channels was fixed by specifying number of
output filters for the convolutional layer), so the number of
input channels to the second convolutional layer does not affect 
the number of output channels from the second convolutional
layer.</p>
<p>The final shape coming out of the second convolutional layer is:</p>
<div class="math">$$
(\mbox{None}, w_2, h_2, c_2) = 
(\mbox{None}, 72, 72, 32)
$$</div>
<p>where</p>
<div class="math">$$
w_2 = w_1 - k_2 + 1 \\
h_2 = h_1 - k_2 + 1 \\
$$</div>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Second-Convolution-Layer">Link to "Second Convolutional Layer" section of notebook</a></p>
<h2>Second Activation Layer</h2>
<p><strong>TL;DR:</strong> The activation layer again uses a function to
map input values to output values in a one-to-one mapping,
so the activation layer does not change the shape of the 
input tensor.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Second-Activation-Layer">Link to "Second Activation Layer" section of notebook</a></p>
<h2>Second MaxPooling Layer</h2>
<p><strong>TL;DR:</strong> The second max pooling layer uses a pooling
window of size <span class="math">\(p_2 \times p_2\)</span>. This will reduce the input
size to <span class="math">\(\mbox{ceil}(w_2/p_2) \times \mbox{ceil}(h_2/p_2)\)</span>. This reduces 
the input tensor shape to:</p>
<div class="math">$$
(\mbox{None}, \mbox{ceil}(w_2/p), \mbox{ceil}(h_2/p), c_2) = 
(\mbox{None}, 36, 36, 32)
$$</div>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Second-Max-Pooling-Layer">Link to "Second Max Pooling Layer" section of notebook</a></p>
<h2>Third Convolution Layer</h2>
<p><strong>TL;DR:</strong> The third convolution layer with a kernel size 
of <span class="math">\(k_3 \times k_3\)</span> and <span class="math">\(c_3\)</span> output filters will transform
the input tensor shape in the following way (note that the
third convolutional layer has 64 filters, not 32):</p>
<div class="math">$$
(\mbox{None}, w_3, h_3, c_3) =
(\mbox{None}, 34, 34, 64)
$$</div>
<p>where</p>
<div class="math">$$
w_3 = w_2 - k_3 + 1 \\
h_3 = h_2 - k_3 + 1
$$</div>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Third-Convolution-Layer">Link to "Third Convolutional Layer" section of notebook</a></p>
<h2>Third Activation Layer</h2>
<p><strong>TL;DR:</strong> The activation layer again uses a function to
map input values to output values in a one-to-one mapping,
so the activation layer does not change the shape of the 
input tensor.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Third-Activation-Layer">Link to "Third Activation Layer" section of notebook</a></p>
<h2>Third MaxPooling Layer</h2>
<p><strong>TL;DR:</strong> The thid max pooling layer uses a pooling
window of size <span class="math">\(p_3 \times p_3\)</span>. This will reduce the input
size to <span class="math">\(\mbox{ceil}(w_3/p_3) \times \mbox{ceil}(h_3/p_3)\)</span>. This reduces 
the input tensor shape to:</p>
<div class="math">$$
(\mbox{None}, \mbox{ceil}(w_3/p_3), \mbox{ceil}(h_3/p_3), c_2) = 
(\mbox{None}, 17, 17, 64)
$$</div>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Third-Max-Pooling-Layer">Link to "Third Max Pooling Layer" section of notebook</a></p>
<h2>Flatten and Dense Layers</h2>
<p><strong>TL;DR:</strong> The flatten layer converts a tensor of dimension <span class="math">\((\mbox{None}, 17, 17, 64)\)</span>
into a 1D vector of <span class="math">\(17 \times 17 \times 64 = 18,496\)</span> neural network nodes. This does not
change any of the values, it simply reshapes the input tensor.</p>
<p>The first dense layer reduces the flattened <span class="math">\(18,496\)</span> nodes to <span class="math">\(64\)</span> nodes, using a fully connected
layer of nodes. These values are then passed through an activation function (as with the above
activation layers, this is a one-to-one mapping and does not change the shape of the input tensor).
The dense layer is followed by a dropout layer to help prevent overfitting; this pattern is common
in convolutional neural networks.</p>
<p>The second dense layer further reduces the <span class="math">\(64\)</span> nodes to a single node, whose output will determine
whether the input image is a cat or a dog.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Flatten-Layer">Link to "Flatten Layer" section of notebook</a></p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Dense-(64)">Link to "Dense (64) Layers" section of notebook</a></p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Dense-(1)">Link to "Dense (1) Layers" section of notebook</a></p>
<h2>Categorical Output</h2>
<p><strong>TL;DR:</strong> Normally when classifying cats and dogs, we would have two output neurons, one to
output a binary yes/no to answer "is this a cat?" and another output a binary yes/no to answer 
"is this a dog?". However, in this example, we assume that <em>all</em> inputs contain either only cats
or only dogs, so the single-output binary classifier is determining whether an image is a dog (0)
or a cat (1).</p>
<h1>Image Transformer</h1>
<p><strong>TL;DR:</strong> The <code>ImageDataGenerator</code> class is a class provided by keras
for loading image data from a directory and (optionally) applying various
transformations to the images in order to generate additional training data
from a set of images. For example, the following code block from the 
notebook creates an <code>ImageDataGenerator</code> class that will load images from a
folder on disk, and applies various transformations (shearing, zooming, 
and horizontally flipping) to each image during the training process.</p>
<div class="highlight"><pre><span></span><span class="n">train_datagen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span>
    <span class="n">rescale</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span>
    <span class="n">shear_range</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">zoom_range</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">horizontal_flip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>This can then be used to generate test image data:</p>
<div class="highlight"><pre><span></span>train_generator = train_datagen.flow_from_directory(
    &#39;train&#39;,
    target_size=(img_width, img_height),
    batch_size=batch_size,
    class_mode=&#39;binary&#39;)
</pre></div>


<p>This will look for images in the relative path <code>train/data/</code>
(note the implicit <code>data/</code> directory tacked on the end).
Note that this image data generator allows us to use images
that do not have size <span class="math">\(150 \times 150\)</span>, as they will be re-sized
to <code>target_size</code>.</p>
<p><a href="https://tinyurl.com/deconvoluting-convolutions#Image-Transformer">Link to "Image Transformer" section of notebook</a></p>
<h2>Next Steps</h2>
<p>Now that we have walked through a sample convolutional neural network
and covered how each layer transforms the size of the input tensor, 
we are ready to start applying convolutional neural networks to real
problems.</p>
<p>Our next blog post will cover the materials in the
<a href="https://github.com/charlesreid1/deep-learning-genomics">charlesreid1/deep-learning-genomics</a>
repository on Github, which applies the convolutional neural 
network concept in a 1D context (applying convolutions to 1D sequences, 
instead of 2D images) to learn about (and predict) DNA transcription factor 
binding sites.  </p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/deep-learning.html">deep learning</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/machine-learning.html">machine learning</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/neural-networks.html">neural networks</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/keras.html">keras</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/convolutional-neural-networks.html">convolutional neural networks</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/cnn.html">cnn</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">



            <a class="prev" href="https://charlesreid1.github.io/index2.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>October 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">Git Workflows, Part 1: Supercharging your Git Config</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Mocking AWS in Unit Tests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">Deconvoluting Convolutional Neural Networks</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-1-de-bruijn-graphs-hamiltonian-paths-and-eulerian-paths.html">Graphs for Bioinformatics, Part 1: de Bruijn Graphs, Hamiltonian Paths, and Eulerian Paths</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-git-commit-ectomy.html">The Git-Commit-Ectomy</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-3-solving-the-double-step-case.html">The Josephus Problem: Part 3: Solving the Double Step Case</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-2-two-examples.html">The Josephus Problem: Part 2: Two Examples</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-1-the-problem.html">The Josephus Problem: Part 1: The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/approximating-pi-happy-pi-day.html">Approximating Pi (Happy Pi Day)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-5-the-try-trie-tree.html">Five Letter Words: Part 5: The Try Trie Tree</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-4-revisiting-diff-by-one.html">Five Letter Words: Part 4: Revisiting Diff by One</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion: a document search engine</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/any-color-you-like-as-long-as-its-00add8.html">Any Color You Like, As Long As It's 00ADD8</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/a-few-of-my-favorite-peps.html">A Few of My Favorite PEPs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/context-managers-in-python.html">Context Managers in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">Building Snakemake Command Line Wrappers for Kubernetes Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers for Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>