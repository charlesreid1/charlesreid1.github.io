<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <!--
        <link href="/theme/css/cyborg.css"          rel="stylesheet" type="text/css">
        <link href="/theme/css/cosmo.css"           rel="stylesheet" type="text/css">
        <link href="/theme/css/sandstone.css"       rel="stylesheet" type="text/css">
        -->
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>


        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <!--
            http://www.w3schools.com/bootstrap/bootstrap_case_navigation.asp
            -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="/" class="navbar-brand">charlesreid1.com</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/projects">Projects</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Research Blog</a>
                    </li>
                    <li>
                        <a href="http://git.charlesreid1.com/explore">git.charlesreid1.com</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/contact">Contact Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>


<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com research<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Setting Up a Self-Hosted Github Clone with Gitea
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-01T22:00:00-07:00" pubdate>Saturday 04/01/2017</time>
                in 
                <a href="/category/git.html">Git</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/setting-up-a-self-hosted-github-clone-with-gitea.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#gitea-intro">Intro</a></li>
<li><a href="#gitea-running">Running with Gitea</a><ul>
<li><a href="#gitea-bin">Binary or Source</a></li>
<li><a href="#gitea-config-dir">Configuring Gitea Directories</a></li>
<li><a href="#gitea-fw">Opening the Firewall</a></li>
<li><a href="#gitea-config-server">Setting Up and Configuring Gitea Server</a></li>
</ul>
</li>
<li><a href="#gitea-use">How To Use Gitea</a><ul>
<li><a href="#gitea-pushing-local">Pushing a Local Repo Into Gitea</a></li>
<li><a href="#gitea-copying">Copying Repos from Github to Gitea</a></li>
<li><a href="#gitea-moving">"Moving" Repos from Github to Gitea</a></li>
<li><a href="#gitea-pushing-commits">Pushing Commits to Github or Gitea</a></li>
<li><a href="#gitea-backing-up">Backing Up Gitea</a></li>
</ul>
</li>
<li><a href="#gitea-patterns">How Gitea Fits Into Git Patterns</a></li>
<li><a href="#gitea-wrapup">Wrapup</a></li>
</ul>
<p><a name="gitea-intro"></a></p>
<h2>Intro</h2>
<p>In this post we'll cover how to set up a web-hosted git server that uses Gitea,
a Github clone that is written in Go. 
While this post is not, strictly speaking, research, 
having your own hosted git server certainly makes it easier to
manage research codes and set up organizations to own different bits of code.</p>
<p>Here's an image of a git repository in the finished product:</p>
<p><img alt="Image of finished product" src="/images/gitea1.png"></p>
<p>We will start by covering the server configuration for Gitea, 
and then we'll cover how to use Gitea's git repository.</p>
<p><a name="gitea-running"></a></p>
<h2>Running with Gitea</h2>
<p>Gitea is a web app for running a self-hosted Github clone. 
It is implemented entirely in the Go language,
so all of the pages that are served up are assembled by the Go binary.
The Go binary also has a local instance of git running, 
and any actions taken through the Gitea web interface
are translated, by the Go binary, into actions in the git reopsitory.</p>
<p>Out of the box, Gitea provides all of this functionality, and takes care of all the details,
so you don't have to worry about any of this. But if you build it yourself,
you can modify the content the binary serves up and the actions it takes. </p>
<p>In this guide, we'll stick to the binary.</p>
<p><img alt="DIagram of how the gitea binary runs as an http server on port 3000." src="/images/gitea-diagram.png"></p>
<p><a name="gitea-bin"></a></p>
<h3>Binary or Source</h3>
<p>There are some problems with the source code that may make compilation from source impossible.
(See <a href="https://charlesreid1.com/wiki/Gitea#Using_Binary">charlesreid1.com wiki notes</a>.)
The binary version of Gitea is recommended. </p>
<p><a name="gitea-config-dir"></a></p>
<h3>Configuring Gitea Directories</h3>
<p>Gitea expects a certain directory organization, specifically, a folder for binaries, 
certificates, a database, git repositories, and the log.</p>
<p>The recommended arrangment is:</p>
<div class="highlight"><pre><span></span>/path/to/www/gitea/
   \
    \---------- bin/
     \--------- certs/
      \-------- data/
       \------- repositories/
        \------ log/
</pre></div>


<p>Once the files are organized in this way, navigate to the bin directory
and (preferrably using tmux or screen to send to background) 
execute the command:</p>
<div class="highlight"><pre><span></span>./gitea web
</pre></div>


<p>This runs a setup page on port 3000.</p>
<p>Note that you may or may not need to set your <code>$GOPATH</code> variable:</p>
<div class="highlight"><pre><span></span>export GOPATH=&quot;<span class="cp">${</span><span class="n">HOME</span><span class="cp">}</span>/gocode&quot;
</pre></div>


<p>Go ahead and follow the instructions on the page to get Gitea set up.
The <a href="https://gitea.io">gitea.io</a> page has good documentation.</p>
<p><a name="gitea-fw"></a></p>
<h3>Opening the Firewall</h3>
<p>Assuming your port 3000 was closed on the firewall,
and assuming you plan to run the gitea service as a public service listening on an external port, 
you will want to open your firewall to accept incoming traffic on port 3000:</p>
<div class="highlight"><pre><span></span># allow traffic on port 3000
iptables -A INPUT -p tcp --dport 3000 -j ACCEPT
#  to allow forwarding for 3000 to internal LAN 
iptables -A FORWARD -p tcp -j ACCEPT --dport 3000 -m state --state NEW
</pre></div>


<p><a name="gitea-config-server"></a></p>
<h3>Setting Up and Configuring Gitea Server</h3>
<p>To configure gitea, you will use a <code>.ini</code> configuration file contained in:</p>
<div class="highlight"><pre><span></span>/path/to/www/gitea/custom/conf/app.ini
</pre></div>


<p>Here is an example gitea configuration file. It starts with a header, then has sections
for different aspects like databases, the git repository, and the server:</p>
<div class="highlight"><pre><span></span>;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Example Gitea Config File
;;
;; https://github.com/go-gitea/gitea/blob/master/conf/app.ini
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

APP_NAME = big ugly git repo (BUGR)
RUN_USER = git
RUN_MODE = prod

[database]
DB_TYPE  = sqlite3
SSL_MODE = disable
PATH     = /www/gitea/data/gitea.db

[repository]
ROOT = /www/gitea/repositories
PREFERRED_LICENSES = MIT License

[server]
PROTOCOL     = https
DOMAIN       = yourdomain.com
CERT_FILE    = /www/gitea/certs/cert.pem
KEY_FILE     = /www/gitea/certs/key.pem
SSH_DOMAIN   = git.yourdomain.com
HTTP_PORT    = 3000
ROOT_URL     = https://yourdomain.com:3000
DISABLE_SSH  = false
SSH_PORT     = 22
OFFLINE_MODE = false

[log]
ROOT_PATH = /www/gitea/log
</pre></div>


<p>Ultimately, there are many configuration examples available for Gitea,
so we won't go into any more detail on that.</p>
<p>For details on how to configure Gitea with HTTPS, see <a href="https://charlesreid1.com/wiki/Gitea">charlesreid1.com/wiki/Gitea</a>.</p>
<p>Let's move on to how we actually utilize Gitea,
and focus especially on how to make gitea work in tandem with github
and other git servers, instead of being yet another complication in the toolchain.</p>
<p><a name="gitea-use"></a></p>
<h2>How To Use Gitea</h2>
<p>As we mentioned before, the gitea binary is actually wrapping a git repo, 
and interactions with the binary (via the web) are translated into actions in that repo.
This is important to understand, since it will prevent us from thinking about 
gitea as a "centralized" server, and get us thinking about gitea as just another 
computer with a copy of the repository on it.</p>
<p>Understanding how to use gitea also requires correct thinking about how 
distributed version control works - the way that each collaborator 
with a copy of the repo can also act as a decentralized git server. 
In this way, the gitea server becomes just another git client,
with some extra frosting on top in the form of a web interface.</p>
<p><a name="gitea-pushing-local"></a></p>
<h3>Pushing a Local Repo Into Gitea</h3>
<p>If you want to move existing local repositories into gitea, it's easy.
Remember that with git, everything is local, so all you need to do 
is push a copy to gitea, and gitea will have the whole repository locally too,
including its entire history and any branches and tags that were on your local machine.
If you have remotes, you'll need to get local copies of any branches or tags you want
from that remote server (covered in more detail below).</p>
<p>The basic steps:
<em> Get everything you want locally (including branches and tags)
</em> Fetch from remotes, if you have any.
<em> Add new remote (gitea)
</em> Push to new remote</p>
<p>The end result will be a gitea repo fully-populated with the project's commit history.</p>
<p>Here are the steps in a bit more detail:</p>
<p>Start by creating a git repository, or cloning an existing one:</p>
<div class="highlight"><pre><span></span>mkdir my_git_repo/
cd my_git_repo
git init .
</pre></div>


<p>or</p>
<div class="highlight"><pre><span></span>git clone http://github.com/mot_pesli/coune_car
</pre></div>


<p>Next, create an empty git repo on the gitea server.
Sign in using a gitea username and password. 
There will be a plus sign in the upper right,
just like on Github. Click the plus sign, and choose create new repo.
Enter the repo name, and a description.
Make sure the repo will NOT automatically create
a readme or a LICENSE file, as we will be importing all files
from another repo anyway.</p>
<p>Once you've got a local copy of the repo with everything you want to push,
and you have an empty repository on the gitea server ready for commits,
add the gitea repository as a new remote to your local repository.</p>
<p>Example: suppose you have a gitea user named <code>zappa</code> who has created a new empty repo 
named <code>linol-aquabus</code> on the gitea server. 
Zappa would then cd to the local copy of the git repo,
and add the gitea repository's url as a new remote called <code>gitea</code>:</p>
<div class="highlight"><pre><span></span>git remote add gitea https://git.mydomain.com/zappa/linol-aquabus.git

# alternatively,

git remote add gitea https://mydomain.com:3000/zappa/linol-aquabus.git
</pre></div>


<p>Now Zappa can push the entire commit history of the current repo
to the gitea remote git server:</p>
<div class="highlight"><pre><span></span>git push origin gitea

# alternatively,

git push --all origin gitea
</pre></div>


<p>If Zappa now visits <code>mydomain.com:3000/zappa/linol-aquabus</code> the entire
contents of the repository and its commit history in gitea's web interface
will be available for browsing.</p>
<p><a name="gitea-copying"></a></p>
<h3>Copying Repos from Gitub to Gitea</h3>
<p>The process for copying Github repositories to Gitea follows the above procedure closely:</p>
<div class="highlight"><pre><span></span>git clone https://github.com/user/repo.git
</pre></div>


<p>Check out any branches or tags you may want to push to gitea.</p>
<p>Then add the gitea remote to the repo:</p>
<div class="highlight"><pre><span></span>git remote add gitea https://git.mydomain.com/zappa/linol-aquabus.git
</pre></div>


<p>Now push the contents of the local repository to the remote gitea repository:</p>
<div class="highlight"><pre><span></span>git push origin gitea
</pre></div>


<p>Once this command is executed, the gitea remote will have the entire commit history of the repo,
which it will render and display through its web interface. Thus, the entire commit history
will be immediately available to browse through gitea.</p>
<p>(Note that information about Github issues or Github user profiles is not stored in the git repo,
just as Gitea comments and Gitea user profiles are not stored in the git repo.)</p>
<p><img alt="Gitea and Github - same repo, side by side." src="/images/gitea-n-github.png"></p>
<p><a name="gitea-moving"></a></p>
<h3>"Moving" Repos from Gitub to Gitea</h3>
<p>First, it should be stated up front that you do not have to choose 
between gitea and github - you can have a copy of a repo on both,
frequently push to one or the other, and occasionally update the other
as a kind of "mirror."</p>
<p>If you do want to <em>move</em> a repo from github to gitea,
remember that github does not "own" the repo,
so what you're actually doing is deleting the copy of your repo 
that lives on github's server.</p>
<p>To move the repo, all you have to do is copy it from github to somewhere else
(whether it be your local computer, or to the gitea server), then delete it from github.
You will not lose any information about the git repository history.
Github does not keep/store that information - git does.</p>
<p><a name="gitea-pushing-commits"></a></p>
<h3>Where to Push Commits: Github or Gitea?</h3>
<p>It may seem confusing to use multiple repositories side-by-side,
but this is precisely how the designers of git intended it to be used - 
for decentralized version control.</p>
<p>That means Github or Gitea are not "centralized" servers that "own" the repository,
they are merely another instance of git, running on a server, with a local copy of the repo.</p>
<p>Accordingly, if your project exists as a repo on gitea and as a repo on github, 
it is like the project existing as a repo on your hard drive and as a repo on your collaborator's hard drive -
there is no contradiction. If you make changes to your local copy of the repo, you can commit those changes,
then push the commits to someone else. In the same way, you can make changes to your local copy of the repo 
and commit those changes, then push the commits to either gitea, or github, or both - wherever you want.</p>
<p><a name="gitea-backing-up"></a></p>
<h3>Backing Up Gitea</h3>
<p>It's important to say a few words about backups.</p>
<p>Because Gitea is configured (with the above config file) to use sqlite,
it stores its entire database (the extra "frosting" of stars, wiki pages,
issues, user pictures, etc.) in a single file on disk, in the <code>data/</code> directory
of the gitea installation.</p>
<p>The git repository is, similarly, a single file on disk, with the entire database 
of commits, blogs, commit histories, etc., all contained in the <code>.git</code> directory,
which is contained in the <code>repositories</code> directory of the gitea installation.</p>
<p>That means backing up your git server is as easy as copying the gitea folder.
No need to back up a MySQL database or do a funny pants dance to export your database
to a proprietary format. </p>
<p>This is another central tenent of git's design philosophy - 
be fast, pack light, and travel easily.</p>
<p><a name="gitea-patterns"></a></p>
<h2>How Gitea Fits Into Git Patterns</h2>
<p>There are <a href="https://charlesreid1.com/wiki/Git_Resources">many resources on git</a>,
and some cover the concept of "git patterns," 
or templates for how to use git.</p>
<p>Because git is designed to be decentralized, 
gitea provides a "centralized" node for collaboration
within a decentralized system.
So you could use gitea to collaborate with 
your local Team A, and push and pull branches 
and work on various features together.
Then, once Team A has put together a branch they've found useful,
they can push it to a different remote server that is more widely accessed.</p>
<p>(Note that this is the logic behind why you need to 
check out all the branches and tags, <em>locally</em>, that you want to push 
to the gitea remote server - this allows you the flexibility to 
only share select branches, so that you might have 
some branches shared in common wth gitea and github,
and other branches only existing on gitea.)</p>
<p>Team B and Team C may use github, and not gitea, to access the project code.
The gitea server may for example be a private server on a local network,
whereas github is better suited for collaboration.
By pushing select branches from the Team A git server, gitea,
to the github server, Team B and Team C will then be able to 
access them from github.</p>
<p>You could also have multiple gitea/gitlab/github enterprise servers 
for multiple organizations running on git, and they could share a code base 
by sharing git repositories, commit histories, branches, and so on.</p>
<p><a name="gitea-wrapup"></a></p>
<h2>Wrapup</h2>
<p>Have a look at the <a href="http://gitea.io">Gitea project</a>, <a href="https://golang.org">the Go language</a>,
<a href="https://git-scm.com">git</a>, <a href="https://github.com">Github</a> for all the nice software
that made this possible. </p>
<p>Then have a look at the finished product at <a href="https://git.charlesreid1.com">git.charlesreid1.com</a>.</p>
<p>Gitea allows you to create organizations, useful for organizing repos related to 
particular functionality or platforms. For example, <a href="https://charlesreid1.com:3000/rpi">rpi</a> 
is an organization that owns repositories with scripts and software for raspberry pis,
<a href="https://charlesreid1.com:3000/docker">docker</a> is an organization that owns repositories
with Dockerfiles, and <a href="https://charlesreid1.com:3000/mac">mac</a> holds Mac-related things.</p>
<p>This organization allows better organization of project code - a dotfiles repository
that works for a Mac laptop or a Unix server is not necessarily good for a Raspberry Pi
or a Docker container, so code is organized accordingly.</p>
<p>Organizations can also be used to organize project-level code. 
This git repo is in its beginning phases, but has great potential
as a great tool that makes git even more functional and provides 
one more reason to switch to git.</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/git.html">git</a>
                    &nbsp;&nbsp;
                    <a href="/tag/go.html">go</a>
                    &nbsp;&nbsp;
                    <a href="/tag/gitea.html">gitea</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-01T09:00:00-07:00" pubdate>Saturday 04/01/2017</time>
                in 
                <a href="/category/java.html">Java</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#better-timing-thecode">Before We Begin: The Code</a></li>
<li><a href="#better-timing-timing">Timing Scripts</a></li>
<li><a href="#better-timing-before-u-time">Before You Time: Developing Your Algorithm</a></li>
<li><a href="#better-timing-timing-journey">Beginning Your Timing Journey</a></li>
<li><a href="#better-timing-mouse-cookie">Statistical Timing, a.k.a., If You Give A Mouse A Cookie</a></li>
<li><a href="#better-timing-hierarchical">Hierarchical Timing Strategy</a></li>
<li><a href="#better-timing-single">Single Problem/Program/Binary</a></li>
<li><a href="#better-timing-multiple">Multiple Problem/Program/Binary</a></li>
<li><a href="#better-timing-statistical">Statistical Averaging</a></li>
<li><a href="#better-timing-results">Results</a></li>
<li><a href="#better-timing-summary">Summary</a></li>
</ul>
<p><a name="better-timing-thecode"></a></p>
<h2>Before We Begin: The Code</h2>
<p>Note that all of the code discussed/shown in this post is available from the 
traveling salesperson problem repository on <a href="https://charlesreid1.com:3000/charlesreid1/tsp">git.charlesreid1.com</a>.
The <code>guava/</code> directory contains the guava solution to the traveling salesperson problem,
along with the timing scripts discussed below, and several example output files.</p>
<p><a name="better-timing-intro"></a></p>
<h2>Introduction</h2>
<p>Timing a piece of code can be tricky. </p>
<p>Choosing a random problem of a given size can be problematic,
if you happen to randomly chose a particularly easy or difficult case.
This can lead to an inaccurate picture of scale-up behavior.
Timing results should be statistically averaged - the figure below
shows scale-up behavior for the traveling salesperson problem
when solving a single random problem, versus a hundred random problems.</p>
<p><img alt="Average versus one-time solutions, walltime versus problem size." src="/images/avg-vs-onetime-walltime.png"></p>
<p>This post will cover some conceptual and code tools 
for measuring the timing and performance of code.</p>
<p><a name="better-timing-timing"></a></p>
<h2>Timing Scripts</h2>
<p>Timing a piece of code is a task that sounds simple, on its face.
However, the task of profiling code quickly balloons 
from a single timing of a single bit of code 
to running hundreds of cases, juggling output from each run,
and stitching together script upon script.
Soon you find yourself swimming in a pool of output files,
looking for your scripts...</p>
<p>In this post we'll cover a workflow for timing a piece of Java code
that will help give you a method for thinking about timing.
This also balances the need for practicality
(i.e., just get it done in as simple a manner as possible)
with good design 
(i.e., flexible inputs and the use of scripts).</p>
<h2>Before You Time: Developing Your Algorithm</h2>
<p>As you develop your algorithm, you may have variable values hard-coded 
and random number generators seeding from the same value each time.
The intention, as you are developing, is to work out the bugs
without the additional difficulty of solving a different problem
each time you run the program.</p>
<h2>Beginning Your Timing Journey</h2>
<p>Once you've implemented your algorithm and verified that it works,
the timing portion begins. You can time the code using mechanisms
built into the language, which is the most accurate way of 
timing code. This is called <em>instrumenting</em> your code.
To begin with, you might try timing a single problem size, 
but this information is hard to interpret without more data,
so you start to time the code on problems of other sizes.</p>
<p>Here there be dragons.</p>
<h2>Statistical Timing, a.k.a., If You Give A Mouse A Cookie</h2>
<p>See <a href="https://en.wikipedia.org/wiki/If_You_Give_a_Mouse_a_Cookie"><em>If You Give A Mouse A Cookie</em></a>.</p>
<p>Once you time the code solving a single problem,
you will want to time the code solving multiple problems.</p>
<p>Once you time the code solving multiple problems,
you will want to time the code solving each problem multiple times 
to get an accurate statistical picture of the solution time on a variety of problems.</p>
<p>Once you get statistics about multiple problem times,
you will want to gather statics about variations in problem types and algorithm variations.</p>
<p>It simply does not end. A strategy for managing this deluge of new timing needs 
prevents spaghetti code.</p>
<h2>Hierarchical Timing Strategy</h2>
<p>The strategy here is to design code and scripts that are <em>hierarchical</em>.
The levels of the hierarchy consist of the different scopes involved in timing:
<em> Single problem/program/binary
</em> Multiple problem/program/binary
<em> Statistical averages using case matrix
</em> Design of Computer Experiments: Testing Variations 
* Strong and weak scaling (if we decide to continue with parallelization of algorithm)</p>
<p>At each stage, we utilize scripts to bundle the task into a single command or script.</p>
<h2>Single Problem/Program/Binary: Makefile</h2>
<p>At the scale of solving a single problem, we need a tool that will 
compile and run Java code - even if it only happens once.
Makefiles are an excellent tool for stringing together commands with flags 
(in the case of the traveling salesperson problem,
we need to link to the Guava Jars when we compile and run).</p>
<p>By defining some variables at the top of the Makefile, 
and a few rules, we have a functional and easy way to build code 
with scalable complexity:</p>
<div class="highlight"><pre><span></span><span class="c"># Set path to guava</span>
<span class="nv">HOME</span><span class="o">=</span>/Users/charles
<span class="nv">GUAVA</span><span class="o">=</span><span class="k">$(</span>HOME<span class="k">)</span>/codes/guava/jars/guava-21.0.jar

<span class="c"># Set compile target</span>
<span class="nv">BIN</span><span class="o">=</span>TSP
<span class="nv">TARGET</span><span class="o">=</span><span class="k">$(</span>BIN<span class="k">)</span>.java

<span class="c"># Set java class path</span>
<span class="c"># Hard to believe this actually works, but ok:</span>
<span class="nv">CP</span><span class="o">=</span>-cp <span class="s1">&#39;.:$(GUAVA)&#39;</span>


<span class="nf">build</span><span class="o">:</span>
    javac <span class="k">$(</span>CP<span class="k">)</span> <span class="k">$(</span>TARGET<span class="k">)</span> 

<span class="nf">run</span><span class="o">:</span>
<span class="c">    # If no size, use default</span>
    java <span class="k">$(</span>CP<span class="k">)</span> <span class="k">$(</span>BIN<span class="k">)</span> 

<span class="nf">time</span><span class="o">:</span>
<span class="c">    # Java times itself, we just have to pass it the size</span>
    java <span class="k">$(</span>CP<span class="k">)</span> <span class="k">$(</span>BIN<span class="k">)</span> <span class="k">$(</span>SIZE<span class="k">)</span> 

<span class="nf">clean</span><span class="o">:</span>
    rm -rf *.class
</pre></div>


<p><a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/guava/Makefile">Link to code on git.charlesreid1.com</a></p>
<p>This enables us to run </p>
<div class="highlight"><pre><span></span>$ make build 
/Users/charles/codes/guava/jars/guava-21.0.jar
</pre></div>


<p>and have a new version of the code compile. 
We can also run a problem with a default size of 5 nodes with a simple make run command:</p>
<div class="highlight"><pre><span></span>$ make run
java -cp <span class="s1">&#39;.:/Users/charles/codes/guava/jars/guava-21.0.jar&#39;</span> TSP
------------------- TSP Version <span class="m">2</span>: The Pessimistic Algorithm ----------------------
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">2</span>, <span class="m">3</span>, <span class="m">4</span>, <span class="m">1</span><span class="o">]</span>  Distance: <span class="m">258</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">2</span>, <span class="m">3</span>, <span class="m">1</span>, <span class="m">4</span><span class="o">]</span>  Distance: <span class="m">257</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">2</span>, <span class="m">4</span>, <span class="m">1</span>, <span class="m">3</span><span class="o">]</span>  Distance: <span class="m">189</span>
Found solution...?
Elapsed <span class="nb">time</span> <span class="m">0</span>.005529 s
</pre></div>


<p>and have the compiled code run. We can also feed arguments to make commands,
and have them passed to the command that is executed:</p>
<div class="highlight"><pre><span></span>$ make <span class="nb">time</span> <span class="nv">SIZE</span><span class="o">=</span><span class="m">10</span>
<span class="c1"># Java times itself, we just have to pass it the size</span>
java -cp <span class="s1">&#39;.:/Users/charles/codes/guava/jars/guava-21.0.jar&#39;</span> TSP <span class="m">10</span>
------------------- TSP Version <span class="m">2</span>: The Pessimistic Algorithm ----------------------
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">9</span>, <span class="m">7</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">1</span>, <span class="m">4</span><span class="o">]</span>   Distance: <span class="m">446</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">9</span>, <span class="m">7</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">4</span>, <span class="m">1</span><span class="o">]</span>   Distance: <span class="m">395</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">9</span>, <span class="m">7</span>, <span class="m">4</span>, <span class="m">1</span>, <span class="m">8</span>, <span class="m">2</span><span class="o">]</span>   Distance: <span class="m">382</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">9</span>, <span class="m">1</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">2</span>, <span class="m">8</span><span class="o">]</span>   Distance: <span class="m">365</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">9</span>, <span class="m">1</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">8</span>, <span class="m">2</span><span class="o">]</span>   Distance: <span class="m">326</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">7</span>, <span class="m">4</span>, <span class="m">1</span>, <span class="m">9</span><span class="o">]</span>   Distance: <span class="m">303</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">3</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">9</span>, <span class="m">1</span><span class="o">]</span>   Distance: <span class="m">298</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">3</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">9</span>, <span class="m">1</span><span class="o">]</span>   Distance: <span class="m">286</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">8</span>, <span class="m">2</span>, <span class="m">3</span>, <span class="m">7</span>, <span class="m">4</span>, <span class="m">1</span>, <span class="m">9</span><span class="o">]</span>   Distance: <span class="m">283</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">9</span>, <span class="m">1</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">3</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">8</span>, <span class="m">2</span><span class="o">]</span>   Distance: <span class="m">275</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">3</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">5</span>, <span class="m">6</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">9</span>, <span class="m">1</span><span class="o">]</span>   Distance: <span class="m">274</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">7</span>, <span class="m">4</span>, <span class="m">1</span>, <span class="m">9</span>, <span class="m">5</span>, <span class="m">6</span>, <span class="m">3</span><span class="o">]</span>   Distance: <span class="m">262</span>
!!!!!YAY!!!!!!  NEW SOLUTION    Route: <span class="o">[</span><span class="m">0</span>, <span class="m">2</span>, <span class="m">8</span>, <span class="m">4</span>, <span class="m">7</span>, <span class="m">3</span>, <span class="m">6</span>, <span class="m">5</span>, <span class="m">9</span>, <span class="m">1</span><span class="o">]</span>   Distance: <span class="m">256</span>
Found solution...?
Elapsed <span class="nb">time</span> <span class="m">0</span>.050795 s
</pre></div>


<p>For running single cases and gathering small amounts of (initial) timing data,
Makefiles greatly simplify the workflow.</p>
<h2>Multiple Program/Problem/Binary: Bash</h2>
<p>Bash is a faithful scripting language that makes it easy to do 
simple mechanical tasks like run commands in for loops,
necessary for the next level of complexity in our timing hierarchy.</p>
<p>While the task at hand is simple enough, and we could easily use Makefiles, 
we'll use a separate Bash script for separate functionality 
and keep things from getting overly complicated in the Makefile.</p>
<p>The essence of the timing script is combining the <code>make time</code> command,
which takes a size parameter, with bash for loops.</p>
<p>Here is a stripped down version of the timing script:</p>
<div class="highlight"><pre><span></span>make build 

for N in 4 5 6 7 8
do
    make time SIZE=<span class="cp">${</span><span class="n">N</span><span class="cp">}</span> 
done
</pre></div>


<p>That's it... The rest is just printing!</p>
<p>The <code>make time</code> command passes the size argument on the command line.
The Java Traveling Salesperson Problem code checks if there is an input argument on the command line,
and if there is it uses that as the problem size.</p>
<p>Here's a more embellished script:</p>
<div class="highlight"><pre><span></span>export RIGHTNOW=&quot;`date +&quot;%Y%m%d_%H%M%S&quot;`&quot;
export OUT=&quot;timeout_tsp_java_<span class="cp">${</span><span class="n">RIGHTNOW</span><span class="cp">}</span>.out&quot;
touch <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>
cat /dev/null &gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

# Compile
make build 

for N in {4..8..1}
do
    echo &quot;**************************************&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>
    echo &quot;Running TSP with <span class="nv">$N</span> nodes with Java...&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

    make time SIZE=<span class="cp">${</span><span class="n">N</span><span class="cp">}</span> &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span> 2&gt;<span class="err">&amp;</span>1

    make dot
    mv graphviz.png graphviz_tsp_<span class="cp">${</span><span class="n">N</span><span class="cp">}</span>.png

    echo &quot;Done.&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

    echo &quot;&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

done

echo &quot;&quot;
echo <span class="cp">${</span><span class="n">OUTFILE</span><span class="cp">}</span>
echo &quot;&quot;
</pre></div>


<p><a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/guava/time_java.sh">Link to code on git.charlesreid1.com</a></p>
<p>This creates a time-and-date-stamped output file in which 
all of the output of this script goes - and which can be 
parsed for plotting the results of timing studies.</p>
<p>Before it times the solution to the TSP, it dumps out a graphviz dot file 
containing a schematic of the graph that can be diagrammed:</p>
<p><img alt="Example graphviz dot output showing a 14-node TSP." src="/images/graphviz_tsp_14.png"></p>
<div class="highlight"><pre><span></span>**************************************
Running TSP with 4 nodes with Java...
Found solution.
Elapsed time 0.004679 s
 Done.

**************************************
Running TSP with 5 nodes with Java...
Found solution.
Elapsed time 0.004543 s
 Done.

**************************************
Running TSP with 6 nodes with Java...
Found solution.
Elapsed time 0.006911 s
 Done.

**************************************
Running TSP with 7 nodes with Java...
Found solution.
Elapsed time 0.008286 s
 Done.

**************************************
Running TSP with 8 nodes with Java...
Found solution.
Elapsed time 0.014499 s
 Done.
</pre></div>


<p>In this way we can run a quick test matrix of different problem sizes,
and see how the code scales.</p>
<h2>Statistical Averaging</h2>
<p>Of course, any good computational physicist will tell you that scaling behavior
extrapolated from running a single case of a single problem size is folly - 
your random choice of graph could have been an unusually easy or difficult graph,
throwing off the results of the timing. </p>
<p>A proper scaling study really needs to take into account the statistical trends 
in solution time on a random assortment of problems, 
so we need a way of scripting solutions to dozens or hundreds of random problems 
and computing statistically representative measures of code performance.</p>
<p>Our code implements a function to generate random graphs, 
but for testing and debugging purposes the random number generator 
was seeded with the same value each time. By making the random number generators
truly random, each problem we solve will be a different random graph
with the specified number ofn odes.</p>
<p>We can accomplish all of this using bash again: within the for loop over different problem sizes,
we will add a for loop for repetitions.
Here is the basic framework:</p>
<div class="highlight"><pre><span></span>make build 

for N in {4..10..1}
do
    for repetition in {0..100..1}
    do
        make time SIZE=<span class="cp">${</span><span class="n">N</span><span class="cp">}</span> 
    done
done
</pre></div>


<p>And the embellished version that prints the resulting timing information to a file:</p>
<div class="highlight"><pre><span></span># Compile
make build 

export RIGHTNOW=&quot;`date +&quot;%Y%m%d_%H%M%S&quot;`&quot;

for N in {4..10..1}
do

    export OUT=&quot;avgtimeout_tsp_<span class="cp">${</span><span class="n">RIGHTNOW</span><span class="cp">}</span>_<span class="cp">${</span><span class="n">N</span><span class="cp">}</span>.out&quot;
    touch <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

    echo &quot;**************************************&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>
    echo &quot;Running TSP with <span class="nv">$N</span> nodes with Java...&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

    for repetition in {0..100..1}
    do
        make time SIZE=<span class="cp">${</span><span class="n">N</span><span class="cp">}</span> &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span> 2&gt;<span class="err">&amp;</span>1
    done
    echo &quot;Done.&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>
    echo &quot;&quot; &gt;&gt; <span class="cp">${</span><span class="n">OUT</span><span class="cp">}</span>

done

echo &quot;&quot;
echo <span class="cp">${</span><span class="n">OUTFILE</span><span class="cp">}</span>
echo &quot;&quot;
</pre></div>


<p><a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/guava/avg_time_java.sh">Link to code on git.charlesreid1.com</a></p>
<p>This results in a file with a large amount of information, but it can be trimmed down 
to the quantities of interest using a little command line fu.
Here are filtered results from an 11-node traveling salesperson problem
run approximately 102 times:</p>
<div class="highlight"><pre><span></span>$ cat avgtimeout_tsp_20170330_235134_11.out <span class="p">|</span> grep Elapsed <span class="p">|</span> wc -l
     <span class="m">102</span>

$ cat avgtimeout_tsp_20170330_235134_11.out <span class="p">|</span> grep Elapsed
Elapsed <span class="nb">time</span> <span class="m">0</span>.082839 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.130378 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.173737 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.100067 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.166046 s

&lt;clipped&gt;

Elapsed <span class="nb">time</span> <span class="m">0</span>.147801 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.285777 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.078655 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.081246 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.174288 s
</pre></div>


<p>Now we have a Makefile that allows us to build and run with a single command,
and a bash script that loops over each problem size and runs a set of computations
for each problem size. But how to compute an average?</p>
<p>We have an assortment of choices - Python being the most obvious - but in the spirit of
old-school Unix tools like make, cat, grep, and wc, let's use <code>awk</code> to compute the average 
walltime for each case size.</p>
<h2>Awk to Compute Average Walltime</h2>
<p>Given the following output of elapsed walltime for different problem sizes,</p>
<div class="highlight"><pre><span></span>$ cat avgtimeout_tsp_20170330_235134_11.out <span class="p">|</span> grep Elapsed
Elapsed <span class="nb">time</span> <span class="m">0</span>.082839 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.130378 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.173737 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.100067 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.166046 s

&lt;clipped&gt;

Elapsed <span class="nb">time</span> <span class="m">0</span>.147801 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.285777 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.078655 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.081246 s
Elapsed <span class="nb">time</span> <span class="m">0</span>.174288 s
</pre></div>


<p>we want to extract two things: 
the first is the problem size (contained in the filename),
and the second is the column of numbers.</p>
<p>We can extract the problem size from the filename using sed,
by searching for the pattern <code>_8.out</code> or <code>_10.out</code>. 
Here is a Bash one-liner that does this for a variable <code>$f</code> 
containing the filename:</p>
<div class="highlight"><pre><span></span>    N=$(echo $f | sed &#39;s/^.*_\([0-9]\{1,\}\).out/\1/&#39;)
</pre></div>


<p>The next thing we wnat to do is extract the column of timing data.
This is a good task for the <code>cut</code> utility. We can pass it two flags,
<code>-d</code> to tell it what to use as a field delimiter, and <code>-f</code> to tell it which field
(column) to return. To extract the third column,</p>
<div class="highlight"><pre><span></span>    cat $f | grep &quot;Elapsed&quot; | cut -d&quot; &quot; -f3 
</pre></div>


<p>This command results in a series of floating point numbers. If we can pipe it to a program
that can do simple math, like <code>awk</code>, we can compute an average (which is pretty simple math).</p>
<p>Since <code>awk</code> is a text-proecssing program that happens to be able to interpret numbers as numbers,
we have to think like a text processing program. To compute an average, we accumulate the sum
of each line in the file, using an accumulator variable. When we have gone through each line in the file,
we divide this cumulative sum by the number of lines in the file.</p>
<div class="highlight"><pre><span></span>    cat $f | grep &quot;Elapsed&quot; | cut -d&quot; &quot; -f3 | awk &#39;{a+=$1} END{print a/NR}&#39;
</pre></div>


<p>This one-liner uses two important concepts in <code>awk</code>, the first is the bracketed blocks <code>{}</code> 
some denoted with <code>BEGIN</code> and <code>END</code>, and the second is the set of built-in variables available in <code>awk</code>.</p>
<p>By surrounding statements by brackets, we denote a block of statements to be run together as the main body of the program.
If the bracket is prefixed by <code>BEFORE</code>, this block of statements is run once at the beginning of the program.
If the bracket is prefixed by <code>END</code>, this block of statements is run once at the end of the program.
To compute an average, the main body of the program is to accumulate a cumulative sum variable. 
The <code>END</code> block, run once at the end, is to divide this cumulative sum by the total number of lines.</p>
<p>Finally, these values can be assigned to Bash variables using <code>$(cmd)</code> syntax:</p>
<div class="highlight"><pre><span></span>    export N=$(echo <span class="nv">$f</span> | sed &#39;s/^.*_\([0-9]\{1,\}\).out/\1/&#39;)
    export AVG=$(cat <span class="nv">$f</span> | grep &quot;Elapsed&quot; | cut -d&quot; &quot; -f3 | awk &#39;{a+=$1} END{print a/NR}&#39;) 
    echo &quot;Average time : <span class="cp">${</span><span class="n">N</span><span class="cp">}</span>-node TSP problem : <span class="cp">${</span><span class="n">AVG</span><span class="cp">}</span> s&quot;
</pre></div>


<p>Here is the final script, which loops over all of the output files
generated by the statistical average timing script,
which runs 10-100 cases per problem size:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">for</span> f in <span class="sb">`</span>/bin/ls -1 avgtimeout_tsp*<span class="sb">`</span>
<span class="k">do</span>
    touch tmpfile 
    cat /dev/null &gt; tmpfile

    <span class="nb">export</span> <span class="nv">N</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$f</span> <span class="p">|</span> sed <span class="s1">&#39;s/^.*_\([0-9]\{1,\}\).out/\1/&#39;</span><span class="k">)</span>
    <span class="nb">export</span> <span class="nv">AVG</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$f</span> <span class="p">|</span> grep <span class="s2">&quot;Elapsed&quot;</span> <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f3 <span class="p">|</span> awk <span class="s1">&#39;{a+=$1} END{print a/NR}&#39;</span><span class="k">)</span> 
    <span class="nb">echo</span> <span class="s2">&quot;Average time : </span><span class="si">${</span><span class="nv">N</span><span class="si">}</span><span class="s2">-node TSP problem : </span><span class="si">${</span><span class="nv">AVG</span><span class="si">}</span><span class="s2"> s&quot;</span>

    rm tmpfile
<span class="k">done</span>
</pre></div>


<p><a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/guava/avg_calcs.sh">Link to code on git.charlesreid1.com</a></p>
<p>Example output:</p>
<div class="highlight"><pre><span></span>$ ./avg_calcs.sh  <span class="p">|</span> sort
Average <span class="nb">time</span> : <span class="m">10</span>-node TSP problem : <span class="m">0</span>.0492826 s
Average <span class="nb">time</span> : <span class="m">11</span>-node TSP problem : <span class="m">0</span>.125827 s
Average <span class="nb">time</span> : <span class="m">12</span>-node TSP problem : <span class="m">0</span>.272998 s
Average <span class="nb">time</span> : <span class="m">13</span>-node TSP problem : <span class="m">0</span>.56743 s
Average <span class="nb">time</span> : <span class="m">14</span>-node TSP problem : <span class="m">1</span>.24297 s
Average <span class="nb">time</span> : <span class="m">14</span>-node TSP problem : <span class="m">1</span>.66563 s
Average <span class="nb">time</span> : <span class="m">15</span>-node TSP problem : <span class="m">8</span>.08373 s
Average <span class="nb">time</span> : <span class="m">16</span>-node TSP problem : <span class="m">16</span>.4353 s
Average <span class="nb">time</span> : <span class="m">17</span>-node TSP problem : <span class="m">94</span>.7363 s
Average <span class="nb">time</span> : <span class="m">18</span>-node TSP problem : <span class="m">749</span>.798 s
Average <span class="nb">time</span> : <span class="m">4</span>-node TSP problem : <span class="m">0</span>.00473154 s
Average <span class="nb">time</span> : <span class="m">4</span>-node TSP problem : <span class="m">0</span>.00475648 s
Average <span class="nb">time</span> : <span class="m">5</span>-node TSP problem : <span class="m">0</span>.005247 s
Average <span class="nb">time</span> : <span class="m">5</span>-node TSP problem : <span class="m">0</span>.005765 s
Average <span class="nb">time</span> : <span class="m">6</span>-node TSP problem : <span class="m">0</span>.00694926 s
Average <span class="nb">time</span> : <span class="m">7</span>-node TSP problem : <span class="m">0</span>.0100795 s
Average <span class="nb">time</span> : <span class="m">8</span>-node TSP problem : <span class="m">0</span>.0167346 s
Average <span class="nb">time</span> : <span class="m">9</span>-node TSP problem : <span class="m">0</span>.028239 s
</pre></div>


<p>Inspecting the output from particular solutions of particular random graphs 
shows a wide variation in the number of shortest paths found. For example, 
for random graphs consisting of 11 nodes, here are some sample solutions.
Note the difference in solution times:</p>
<div class="highlight"><pre><span></span>------------------- TSP Version 2: The Pessimistic Algorithm ----------------------
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 7, 6, 10, 3]   Distance: 597
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 7, 6, 3, 10]   Distance: 582
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 7, 10, 3, 6]   Distance: 560
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 7, 3, 6, 10]   Distance: 553
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 10, 3, 7, 6]   Distance: 540
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 10, 7, 6, 3]   Distance: 532
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 10, 7, 3, 6]   Distance: 503
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 5, 6, 3, 7, 10]   Distance: 498
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 10, 3, 7, 5, 6]   Distance: 450
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 10, 5, 7, 3, 6]   Distance: 440
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 10, 5, 6, 7, 3]   Distance: 422
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 6, 5, 10, 3, 7]   Distance: 421
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 4, 6, 5, 10, 7, 3]   Distance: 380
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 7, 10, 5, 6, 4, 3]   Distance: 364
NEW SOLUTION    Route: [0, 9, 2, 1, 8, 7, 3, 4, 6, 5, 10]   Distance: 357
NEW SOLUTION    Route: [0, 9, 2, 1, 5, 10, 7, 3, 8, 4, 6]   Distance: 352
NEW SOLUTION    Route: [0, 9, 2, 1, 5, 10, 7, 8, 3, 4, 6]   Distance: 336
NEW SOLUTION    Route: [0, 9, 2, 1, 5, 6, 4, 10, 7, 8, 3]   Distance: 330
NEW SOLUTION    Route: [0, 9, 2, 1, 4, 8, 7, 3, 6, 5, 10]   Distance: 326
NEW SOLUTION    Route: [0, 9, 2, 1, 4, 8, 3, 7, 6, 5, 10]   Distance: 320
NEW SOLUTION    Route: [0, 9, 2, 1, 4, 8, 3, 7, 10, 5, 6]   Distance: 298
NEW SOLUTION    Route: [0, 9, 2, 1, 4, 6, 5, 10, 7, 8, 3]   Distance: 261
NEW SOLUTION    Route: [0, 9, 2, 7, 8, 3, 1, 4, 6, 5, 10]   Distance: 250
NEW SOLUTION    Route: [0, 9, 8, 7, 2, 3, 1, 4, 6, 5, 10]   Distance: 245
Found solution.
Elapsed time 0.057047 s

------------------- TSP Version 2: The Pessimistic Algorithm ----------------------
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 5, 2, 7, 3]   Distance: 650
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 5, 2, 3, 7]   Distance: 641
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 5, 7, 2, 3]   Distance: 638
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 5, 7, 3, 2]   Distance: 630
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 7, 5, 2, 3]   Distance: 589
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 2, 3, 7, 5]   Distance: 580
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 10, 2, 5, 7, 3]   Distance: 548
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 2, 5, 7, 3, 10]   Distance: 533
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 7, 5, 2, 3, 10]   Distance: 522
NEW SOLUTION    Route: [0, 8, 1, 6, 4, 9, 7, 5, 2, 10, 3]   Distance: 495
NEW SOLUTION    Route: [0, 8, 1, 6, 7, 9, 4, 5, 2, 10, 3]   Distance: 494
NEW SOLUTION    Route: [0, 8, 1, 6, 7, 5, 4, 9, 2, 10, 3]   Distance: 493
NEW SOLUTION    Route: [0, 8, 1, 6, 3, 10, 2, 5, 7, 9, 4]   Distance: 490
NEW SOLUTION    Route: [0, 8, 1, 6, 3, 10, 2, 5, 7, 4, 9]   Distance: 486
NEW SOLUTION    Route: [0, 8, 1, 6, 9, 4, 7, 5, 2, 10, 3]   Distance: 467
NEW SOLUTION    Route: [0, 8, 1, 10, 2, 5, 7, 4, 9, 6, 3]   Distance: 453
NEW SOLUTION    Route: [0, 8, 1, 2, 5, 7, 4, 9, 6, 3, 10]   Distance: 442
NEW SOLUTION    Route: [0, 8, 1, 2, 5, 7, 4, 9, 6, 10, 3]   Distance: 437
NEW SOLUTION    Route: [0, 8, 1, 5, 7, 4, 9, 2, 10, 6, 3]   Distance: 433
NEW SOLUTION    Route: [0, 8, 10, 2, 1, 5, 4, 9, 7, 6, 3]   Distance: 427
NEW SOLUTION    Route: [0, 8, 10, 2, 1, 5, 7, 4, 9, 6, 3]   Distance: 400
NEW SOLUTION    Route: [0, 8, 2, 1, 5, 7, 4, 9, 6, 10, 3]   Distance: 399
NEW SOLUTION    Route: [0, 3, 7, 4, 9, 6, 10, 2, 1, 5, 8]   Distance: 394
NEW SOLUTION    Route: [0, 3, 7, 4, 9, 6, 10, 2, 8, 5, 1]   Distance: 389
NEW SOLUTION    Route: [0, 3, 6, 9, 4, 7, 5, 8, 1, 2, 10]   Distance: 384
NEW SOLUTION    Route: [0, 3, 6, 9, 4, 7, 5, 8, 10, 2, 1]   Distance: 382
NEW SOLUTION    Route: [0, 3, 6, 9, 4, 7, 5, 1, 2, 8, 10]   Distance: 374
NEW SOLUTION    Route: [0, 9, 4, 5, 1, 2, 8, 10, 3, 6, 7]   Distance: 373
NEW SOLUTION    Route: [0, 9, 4, 7, 3, 6, 10, 8, 5, 1, 2]   Distance: 365
NEW SOLUTION    Route: [0, 9, 4, 7, 3, 6, 10, 2, 1, 5, 8]   Distance: 360
NEW SOLUTION    Route: [0, 9, 4, 7, 3, 6, 10, 2, 8, 5, 1]   Distance: 355
NEW SOLUTION    Route: [0, 9, 4, 7, 5, 8, 1, 2, 10, 6, 3]   Distance: 345
NEW SOLUTION    Route: [0, 9, 4, 7, 5, 1, 2, 8, 10, 6, 3]   Distance: 335
Found solution.
Elapsed time 0.159882 s

------------------- TSP Version 2: The Pessimistic Algorithm ----------------------
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 1, 9, 6]   Distance: 500
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 1, 6, 9]   Distance: 498
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 6, 1, 9]   Distance: 493
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 6, 9, 1]   Distance: 481
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 9, 1, 6]   Distance: 443
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 4, 7, 8, 9, 6, 1]   Distance: 429
NEW SOLUTION    Route: [0, 3, 10, 2, 5, 6, 1, 9, 8, 7, 4]   Distance: 417
NEW SOLUTION    Route: [0, 3, 10, 2, 6, 5, 4, 7, 8, 9, 1]   Distance: 360
NEW SOLUTION    Route: [0, 3, 10, 2, 1, 9, 6, 5, 4, 7, 8]   Distance: 359
NEW SOLUTION    Route: [0, 3, 10, 4, 5, 6, 2, 1, 9, 7, 8]   Distance: 358
NEW SOLUTION    Route: [0, 3, 10, 4, 5, 6, 2, 1, 9, 8, 7]   Distance: 342
NEW SOLUTION    Route: [0, 3, 10, 4, 5, 6, 9, 8, 7, 2, 1]   Distance: 340
NEW SOLUTION    Route: [0, 3, 10, 4, 7, 8, 9, 1, 2, 6, 5]   Distance: 310
NEW SOLUTION    Route: [0, 3, 7, 8, 9, 10, 4, 5, 6, 2, 1]   Distance: 305
NEW SOLUTION    Route: [0, 3, 9, 8, 7, 4, 10, 1, 2, 6, 5]   Distance: 303
NEW SOLUTION    Route: [0, 5, 4, 7, 3, 10, 8, 9, 6, 2, 1]   Distance: 301
NEW SOLUTION    Route: [0, 5, 4, 7, 3, 10, 1, 2, 6, 9, 8]   Distance: 293
NEW SOLUTION    Route: [0, 5, 4, 7, 3, 1, 6, 2, 10, 9, 8]   Distance: 286
NEW SOLUTION    Route: [0, 5, 4, 7, 3, 1, 2, 6, 9, 10, 8]   Distance: 281
NEW SOLUTION    Route: [0, 5, 4, 7, 3, 1, 2, 6, 10, 9, 8]   Distance: 275
NEW SOLUTION    Route: [0, 5, 4, 7, 8, 9, 6, 2, 1, 3, 10]   Distance: 270
NEW SOLUTION    Route: [0, 5, 4, 7, 8, 9, 10, 3, 1, 2, 6]   Distance: 269
NEW SOLUTION    Route: [0, 5, 4, 10, 3, 7, 8, 9, 6, 2, 1]   Distance: 268
NEW SOLUTION    Route: [0, 5, 4, 10, 9, 8, 7, 3, 1, 2, 6]   Distance: 252
NEW SOLUTION    Route: [0, 5, 4, 10, 9, 6, 2, 1, 3, 7, 8]   Distance: 248
NEW SOLUTION    Route: [0, 5, 6, 2, 10, 4, 7, 8, 9, 3, 1]   Distance: 235
NEW SOLUTION    Route: [0, 5, 6, 2, 1, 3, 10, 4, 7, 8, 9]   Distance: 231
NEW SOLUTION    Route: [0, 5, 6, 2, 1, 3, 7, 4, 10, 9, 8]   Distance: 212
NEW SOLUTION    Route: [0, 5, 6, 2, 1, 3, 9, 10, 4, 7, 8]   Distance: 207
Found solution.
Elapsed time 0.175282 s

------------------- TSP Version 2: The Pessimistic Algorithm ----------------------
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 9, 3, 8, 1]   Distance: 515
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 9, 3, 1, 8]   Distance: 495
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 9, 8, 1, 3]   Distance: 423
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 8, 9, 1, 3]   Distance: 368
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 3, 8, 9, 1]   Distance: 361
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 10, 4, 3, 1, 9, 8]   Distance: 341
NEW SOLUTION    Route: [0, 6, 7, 2, 5, 1, 9, 8, 3, 4, 10]   Distance: 330
NEW SOLUTION    Route: [0, 6, 7, 2, 10, 5, 1, 9, 8, 4, 3]   Distance: 309
NEW SOLUTION    Route: [0, 6, 7, 10, 2, 5, 1, 9, 8, 4, 3]   Distance: 284
NEW SOLUTION    Route: [0, 6, 7, 8, 9, 1, 5, 2, 10, 4, 3]   Distance: 266
NEW SOLUTION    Route: [0, 6, 7, 8, 9, 1, 5, 10, 2, 4, 3]   Distance: 258
NEW SOLUTION    Route: [0, 6, 5, 2, 10, 4, 3, 1, 9, 8, 7]   Distance: 250
NEW SOLUTION    Route: [0, 6, 5, 2, 10, 7, 8, 9, 1, 3, 4]   Distance: 243
NEW SOLUTION    Route: [0, 6, 5, 2, 4, 3, 1, 9, 8, 7, 10]   Distance: 225
NEW SOLUTION    Route: [0, 6, 5, 1, 9, 8, 7, 10, 2, 4, 3]   Distance: 197
Found solution.
Elapsed time 0.051783 s

------------------- TSP Version 2: The Pessimistic Algorithm ----------------------
NEW SOLUTION    Route: [0, 8, 9, 6, 1, 7, 3, 4, 5, 2, 10]   Distance: 607
NEW SOLUTION    Route: [0, 8, 9, 6, 1, 7, 3, 4, 2, 5, 10]   Distance: 573
NEW SOLUTION    Route: [0, 8, 9, 6, 1, 7, 3, 4, 10, 5, 2]   Distance: 562
NEW SOLUTION    Route: [0, 8, 9, 6, 1, 7, 3, 5, 2, 4, 10]   Distance: 513
NEW SOLUTION    Route: [0, 8, 9, 6, 1, 3, 5, 2, 7, 4, 10]   Distance: 496
NEW SOLUTION    Route: [0, 8, 9, 6, 7, 3, 1, 5, 2, 4, 10]   Distance: 493
NEW SOLUTION    Route: [0, 8, 9, 6, 7, 3, 1, 10, 4, 2, 5]   Distance: 489
NEW SOLUTION    Route: [0, 8, 9, 6, 7, 2, 4, 10, 1, 3, 5]   Distance: 487
NEW SOLUTION    Route: [0, 8, 9, 6, 7, 2, 5, 3, 1, 10, 4]   Distance: 480
NEW SOLUTION    Route: [0, 8, 9, 6, 4, 3, 5, 2, 7, 1, 10]   Distance: 454
NEW SOLUTION    Route: [0, 8, 9, 6, 4, 5, 2, 7, 3, 1, 10]   Distance: 453
NEW SOLUTION    Route: [0, 8, 9, 6, 4, 10, 5, 2, 7, 3, 1]   Distance: 452
NEW SOLUTION    Route: [0, 8, 9, 6, 4, 10, 1, 7, 3, 5, 2]   Distance: 443
NEW SOLUTION    Route: [0, 8, 9, 6, 4, 10, 1, 3, 5, 2, 7]   Distance: 411
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 1, 3, 5, 2, 7]   Distance: 407
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 7, 2, 5, 3, 1]   Distance: 402
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 5, 2, 7, 3, 1]   Distance: 390
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 2, 7, 3, 1, 5]   Distance: 388
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 2, 7, 1, 3, 5]   Distance: 387
NEW SOLUTION    Route: [0, 8, 9, 10, 4, 6, 2, 5, 3, 1, 7]   Distance: 384
NEW SOLUTION    Route: [0, 8, 9, 10, 1, 3, 5, 2, 7, 4, 6]   Distance: 376
NEW SOLUTION    Route: [0, 8, 9, 10, 6, 4, 3, 1, 7, 2, 5]   Distance: 371
NEW SOLUTION    Route: [0, 8, 9, 10, 6, 4, 3, 1, 5, 2, 7]   Distance: 367
NEW SOLUTION    Route: [0, 8, 9, 10, 6, 4, 2, 5, 3, 1, 7]   Distance: 366
NEW SOLUTION    Route: [0, 8, 9, 10, 6, 4, 7, 2, 5, 3, 1]   Distance: 365
NEW SOLUTION    Route: [0, 8, 9, 5, 3, 1, 10, 6, 4, 2, 7]   Distance: 358
NEW SOLUTION    Route: [0, 8, 9, 5, 2, 7, 3, 1, 10, 4, 6]   Distance: 352
NEW SOLUTION    Route: [0, 8, 2, 4, 6, 10, 9, 5, 3, 7, 1]   Distance: 344
NEW SOLUTION    Route: [0, 8, 2, 4, 6, 10, 9, 5, 3, 1, 7]   Distance: 328
NEW SOLUTION    Route: [0, 8, 2, 7, 3, 1, 5, 9, 10, 4, 6]   Distance: 321
NEW SOLUTION    Route: [0, 8, 2, 7, 1, 3, 5, 9, 10, 4, 6]   Distance: 320
NEW SOLUTION    Route: [0, 8, 5, 3, 1, 9, 10, 6, 4, 2, 7]   Distance: 319
NEW SOLUTION    Route: [0, 8, 5, 9, 10, 6, 4, 2, 7, 3, 1]   Distance: 314
NEW SOLUTION    Route: [0, 8, 5, 2, 7, 3, 1, 9, 10, 4, 6]   Distance: 313
NEW SOLUTION    Route: [0, 8, 4, 3, 5, 2, 7, 1, 9, 10, 6]   Distance: 299
NEW SOLUTION    Route: [0, 8, 4, 3, 7, 2, 5, 9, 1, 10, 6]   Distance: 293
NEW SOLUTION    Route: [0, 8, 4, 3, 1, 7, 2, 5, 9, 10, 6]   Distance: 278
NEW SOLUTION    Route: [0, 8, 4, 2, 7, 3, 1, 5, 9, 10, 6]   Distance: 277
NEW SOLUTION    Route: [0, 8, 4, 2, 7, 1, 3, 5, 9, 10, 6]   Distance: 276
NEW SOLUTION    Route: [0, 8, 4, 6, 10, 9, 5, 3, 1, 7, 2]   Distance: 263
NEW SOLUTION    Route: [0, 8, 4, 6, 10, 9, 5, 3, 1, 2, 7]   Distance: 262
NEW SOLUTION    Route: [0, 8, 4, 6, 10, 9, 5, 2, 7, 3, 1]   Distance: 249
NEW SOLUTION    Route: [0, 3, 5, 9, 10, 6, 4, 8, 1, 7, 2]   Distance: 245
NEW SOLUTION    Route: [0, 3, 5, 9, 10, 6, 4, 8, 1, 2, 7]   Distance: 244
NEW SOLUTION    Route: [0, 3, 7, 2, 5, 9, 10, 1, 8, 4, 6]   Distance: 242
NEW SOLUTION    Route: [0, 3, 7, 2, 5, 9, 10, 6, 4, 8, 1]   Distance: 231
NEW SOLUTION    Route: [0, 3, 1, 8, 4, 6, 10, 9, 5, 2, 7]   Distance: 215
Found solution.
Elapsed time 0.087109 s
</pre></div>


<h2>Results</h2>
<p>The figure below shows the results of the timing study when using the average of 100 different random problems, 
compared to the timing study performed using a single problem size.</p>
<p><img alt="Average versus one-time solutions, walltime versus problem size." src="/images/avg-vs-onetime-walltime.png"></p>
<p>The results show dramatically different behavior, highlighting the importance
of computing the statistical average of solution walltime for many different problems.
This was not an issue that arose in discussing timing or profiling of codes to solve the 
8 queens problem, because in that case the problem (and resulting decision tree)
were determined by the choice of algorithm.</p>
<p>This information is also important ot keep in mind when comparing the timing performance 
of two algorithms - using many cases to compare two algorithms is preferrable,
since it reduces the likelihood of randomly selecting a problem that highights 
a weakness of one algorithm or a strength of the other.</p>
<h2>Summary</h2>
<p>In this post we covered some scripting tools that make timing a lot easier to do,
and some ways of thinking about and building up scripts 
to allow for more complex timing studies without an increase 
in the associated post-processing work involved.</p>
<p>We showed how to use <code>make</code> and a Makefile to create compact, expressive commands to build and run Java programs.
We showed how to use Bash scripting to implement loops and run a case matrix of problems of various sizes,
measuring timing data for hundreds of problems in total.
All of these scripts made heavy use of Unix command line tools, 
demonstrating how to chain commands and functionality together on the command line to accomplish complex tasks.
Finally, we showed how to use the <code>awk</code> programming language to compute the average of a set of numbers,
exploring yet another application of this unusually handy language.</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="/tag/command-line.html">command line</a>
                    &nbsp;&nbsp;
                    <a href="/tag/guava.html">guava</a>
                    &nbsp;&nbsp;
                    <a href="/tag/graph.html">graph</a>
                    &nbsp;&nbsp;
                    <a href="/tag/tsp.html">TSP</a>
                    &nbsp;&nbsp;
                    <a href="/tag/make.html">make</a>
                    &nbsp;&nbsp;
                    <a href="/tag/awk.html">awk</a>
                    &nbsp;&nbsp;
                    <a href="/tag/performance.html">performance</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-29T14:00:00-07:00" pubdate>Wednesday 03/29/2017</time>
                in 
                <a href="/category/java.html">Java</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#tsp2-intro">Intro</a></li>
<li><a href="#tsp2-graphs">The Graphs We Are Solving</a><ul>
<li><a href="#tsp2-viz-graphs">Visualizations of Graphs</a></li>
</ul>
</li>
<li><a href="#tsp2-guava-tsp-soln">Guava TSP Solution</a><ul>
<li><a href="#tsp2-timing-guava-tsp">Timing the TSP Solution</a></li>
</ul>
</li>
<li><a href="#tsp2-improving">Improving the Guava TSP Solution</a><ul>
<li><a href="#tsp2-flaw">The Flaw</a></li>
<li><a href="#tsp2-fixing">Fixing the Flaw</a></li>
<li><a href="#tsp2-pessimist">The Pessimist Algorithm</a></li>
</ul>
</li>
<li><a href="#tsp2-timing">Timing Results</a></li>
<li><a href="#tsp2-future">Future Work</a></li>
</ul>
<p><a name="tsp2-intro"></a></p>
<h2>Intro</h2>
<p>In a prior blog post we introduced you to the traveling salesperson problem (TSP),
which involves finding the shortest path through every city in a group of cities
connected by a network of roads. Using Google Guava, we have implemented a solution 
to the TSP in Java.</p>
<p>Our philosophy toward timing, profiling, and optimization is that it is always best 
to work from data - and timing is the first place to begin collecting data.
As we will show in this blog post, simply timing your function for different problem sizes
can reveal scaling behavior that indicates bottlenecks, bugs, or inefficiencies in the algorithm.</p>
<p>In this post, we use simple timing tools and a spreadsheet 
to plot scaling behavior and identify bottlenecks in the 
traveling salesperson problem code. Fixing the bottleneck
led to a reduction in cost of <strong>two orders of magnitude</strong>.</p>
<p>Here's a preview:</p>
<p><img alt="TSP Guava Solution scaling results - initial and pessimist algorithms" src="/images/tsp-guava-initial-pessimist.png"></p>
<p>In this post we'll cover what we did to time the problem,
the initial results, and the algorithm improvement that led to 
the massive performance improvement.</p>
<p>But first, let's look at some of the graphs that are being solved.</p>
<p><a name="tsp2-graphs"></a></p>
<h2>The Graphs We Are Solving</h2>
<p>Let's start by having a look at some of the graphs we will be solving,
and the representation of the problem.</p>
<p><a name="tsp2-viz-graphs"></a></p>
<h3>Visualizations of Graphs</h3>
<p>The first few graphs start out simple: here is a randomly generated 4-node traveling salesman problem
(we wil cover the code that generates the graph pictured here in a moment):</p>
<p><img alt="TSP graph with 4 nodes" src="/images/graphviz_tsp_4.png"></p>
<p><strong>Shortest Route: [0, 2, 3, 1] Distance: 112.0</strong></p>
<p>Here is another randomly generated graph with 5 nodes:</p>
<p><img alt="TSP graph with 5 nodes" src="/images/graphviz_tsp_5.png"></p>
<p><strong>Shortest Route: [0, 4, 2, 1, 3]   Distance: 130.0</strong></p>
<p>With 6 nodes:</p>
<p><img alt="TSP graph with 6 nodes" src="/images/graphviz_tsp_6.png"></p>
<p><strong>Shortest Route: [0, 2, 4, 1, 5, 3]    Distance: 163.0</strong></p>
<p>But problem of this sise are still trivially easy for a processor to handle.
Our inefficient, first-pass algorithm started to show signs of eating up CPU cycles 
at around 9 nodes (albeit less than 1 second). Here is the graph with 9 nodes:</p>
<p><img alt="TSP graph with 9 nodes" src="/images/graphviz_tsp_9.png"></p>
<p><strong>Shortest Route: [0, 6, 1, 7, 3, 2, 5, 8, 4]   Distance: 166.0</strong></p>
<p>With 12 nodes:</p>
<p><img alt="TSP graph with 12 nodes" src="/images/graphviz_tsp_12.png"></p>
<p><strong>Shortest Route: [0, 7, 5, 4, 1, 8, 6, 10, 11, 9, 3, 2]    Distance: 236.0</strong></p>
<p>At 14 nodes, even the efficient algorithm crosses the 1 second threshold.</p>
<p><img alt="TSP graph with 14 nodes" src="/images/graphviz_tsp_14.png"></p>
<p><strong>Shortest Route: [0, 2, 6, 10, 13, 12, 7, 4, 1, 11, 5, 3, 9, 8]    Distance: 277.0</strong></p>
<p>We tested randomly-generated, fully-connected graphs of up to 18 nodes, 
and the algorithm was able to compute solutions within a few minutes.
Here is an 18-node graph:</p>
<p><img alt="TSP graph with 18 nodes" src="/images/graphviz_tsp_18.png"></p>
<p><strong>Shortest Route: [0, 3, 10, 6, 12, 5, 11, 2, 14, 8, 13, 4, 7, 1, 9]    Distance: 267.0</strong></p>
<p><a name="tsp2-guava-tsp-soln"></a></p>
<h2>The Guava TSP Solution</h2>
<p>In a prior post we covered the implementation of a solution to the TSP 
using Guava's Network objects. This implementation utilized a recursive
depth-first search algorithm to search for the shortest path among all nodes.</p>
<p>To recap, here was our pseudocode for the TSP solution:</p>
<div class="highlight"><pre><span></span>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        for neighbor in unvisited neighbors:
            visit neighbor
            explore(new_neighbors)
            unvisit neighbor
</pre></div>


<p>And here is what the recursive backtracking <code>explore()</code> method looked like
when implemented in Java:</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** Recursive backtracking method: explore possible solutions starting at this node, having made nchoices */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">explore</span><span class="o">(</span><span class="n">Node</span> <span class="n">node</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nchoices</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">nchoices</span> <span class="o">==</span> <span class="n">graphSize</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// </span>
            <span class="c1">// BASE CASE</span>
            <span class="c1">//</span>
            <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Solution base case</span>
                <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span><span class="o">;</span>
                <span class="n">printSolution</span><span class="o">();</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//</span>
            <span class="c1">// RECURSIVE CASE</span>
            <span class="c1">//  </span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">neighbors</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">adjacentNodes</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Node</span> <span class="n">neighbor</span> <span class="o">:</span> <span class="n">neighbors</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">neighbor</span><span class="o">.</span><span class="na">visited</span> <span class="o">==</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>

                    <span class="kt">int</span> <span class="n">distance_btwn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000</span><span class="o">;</span>

                    <span class="k">for</span><span class="o">(</span> <span class="n">Edge</span> <span class="n">edge</span> <span class="o">:</span> <span class="n">graph</span><span class="o">.</span><span class="na">edgesConnecting</span><span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">neighbor</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                        <span class="n">distance_btwn</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="c1">// Make a choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">visit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">+=</span> <span class="n">distance_btwn</span><span class="o">;</span>

                    <span class="c1">// Explore the consequences</span>
                    <span class="n">explore</span><span class="o">(</span><span class="n">neighbor</span><span class="o">,</span><span class="n">nchoices</span><span class="o">+</span><span class="mi">1</span><span class="o">);</span>

                    <span class="c1">// Unmake the choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">unvisit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">-=</span> <span class="n">distance_btwn</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">// Move on to the next choice (continue loop)</span>
            <span class="o">}</span>               
        <span class="o">}</span> <span class="c1">// End base/recursive case</span>
    <span class="o">}</span>
</pre></div>


<p>Note: full TSP code available at <a href="http://git.charlesreid1.com/charlesreid1/tsp">http://git.charlesreid1.com/charlesreid1/tsp</a>.</p>
<p><a name="tsp2-timing-guava-tsp"></a></p>
<h3>Timing the TSP Solution</h3>
<p>To time the Guava solution to the TSP, we utilized Java's system time
to measure the amount of time it took to compute solutions, 
excluding the time spent on graph construction.</p>
<p>Here is the code that performs the timing of the call to the explore method:</p>
<div class="highlight"><pre><span></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IllegalArgumentException</span> <span class="o">{</span> 

        <span class="o">...</span>

        <span class="kt">double</span> <span class="n">conn</span> <span class="o">=</span> <span class="mf">1.00</span><span class="o">;</span>
        <span class="n">TSP</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TSP</span><span class="o">(</span><span class="n">N</span><span class="o">,</span><span class="n">conn</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
        <span class="n">t</span><span class="o">.</span><span class="na">solve</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Elapsed time %03f s\n &quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">duration</span><span class="o">/</span><span class="mf">1E9</span><span class="o">)</span> <span class="o">);</span>
    <span class="o">}</span>
</pre></div>


<p>The elapsed time is computed using <code>System.nanoTime()</code>.</p>
<p>Writing a script to feed variable size graphs and time the resulting code 
showed some pretty awful scaling behavior: </p>
<p><img alt="Java Guava TSP Solution Scaling" src="/images/tsp-java-scaling.png"></p>
<p>This scaling behavior reveals a bottleneck in the algorithm:
the algorithm scales the same way the problem size scales.
A more efficient algorithm would be capable of ruling out 
more of the solution space as the graph size grows,
allowing the algorithm to scale better at large problem sizes.</p>
<p>This led to some reconsideration of the algorithm.</p>
<p><a name="tsp2-improving"></a></p>
<h2>Improving the Guava TSP Solution</h2>
<p>The original TSP algorithm implemented a subtle flaw - 
not by implementing a mistake in the calculation, 
but by ignoring an important piece of information.</p>
<p><a name="tsp2-theflaw"></a></p>
<h3>The Flaw</h3>
<p>As the recursive depth-first search traverses the graph, the algorithm is checking if all nodes have been traversed.
When all nodes have been traversed, it then compares the distance of that journey to the current shortest journey.
If the new journey is shorter, it is saved as the new shortest journey, otherwise it is ignored and we move on.</p>
<p>What this ignores is the fact that any path, at any point, can be checked to see if it is 
longer than the current minimum, and if it is, any possibilities that follow from it can be skipped.</p>
<p>For example, consider the TSP on a graph of six cities, A B C D E F.</p>
<p>Suppose that the algorithm is in the midst of the recursive backtracking solution,
and has a current minimum distance and minimum path of the route <code>A-B-E-D-C-F</code>, which is 24 miles.</p>
<p>Now suppose that the algorithm is searching for solutions that begin with the choice <code>A-E-C</code>,
and the distance <code>A-E-C</code> is 28 miles.</p>
<p>The naive algorithm ignores this information, and continues choosing from among the 
3 remaining cities, computing the total length for <span class="math">\(3! = 6\)</span> additional routes, and finding 
that all six of them do not work.</p>
<p>The smart algorithm checks <em>each time it chooses a new node</em> whether the length of the current route
exceeds the current minimum route distance (if one has been found/set).
If not, the algorithm keeps going, but if so, it skips choosing neighbors 
and returns directly to the parent caller.</p>
<p><a name="tsp2-fixing"></a></p>
<h3>Fixing the Flaw</h3>
<p>Fixing the flaw is surpsingly easy: we just add an if statement.</p>
<p>Illustrating first with the pseudocode:</p>
<div class="highlight"><pre><span></span>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        if current distance is greater than current minimum:
            skip
        else:
            for neighbor in unvisited neighbors:
                visit neighbor
                explore(new_neighbors)
                unvisit neighbor
</pre></div>


<p>In our Java implementation, the algorithm simply prints out solutions as it goes,
then returns to the calling function whether a solution was found or not.
Thus, we can "skip" a set of solutions by just returning to the calling function,
using a <code>return</code> statement.</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span><span class="o">(</span><span class="n">nchoices</span> <span class="o">==</span> <span class="n">graphSize</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// </span>
            <span class="c1">// BASE CASE</span>
            <span class="c1">//</span>
            <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Solution base case:</span>
                <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span><span class="o">;</span>
                <span class="n">printSolution</span><span class="o">();</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//</span>
            <span class="c1">// RECURSIVE CASE</span>
            <span class="c1">//  </span>

            <span class="cm">/* </span>
<span class="cm">             * The following lines result in a huge computational cost savings.</span>
<span class="cm">            */</span>
            <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">min_distance</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span><span class="o">&gt;</span><span class="k">this</span><span class="o">.</span><span class="na">min_distance</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Just give up already. It&#39;s meaningless. There&#39;s no point.</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// Everything else stays exactly the same</span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">neighbors</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">adjacentNodes</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Node</span> <span class="n">neighbor</span> <span class="o">:</span> <span class="n">neighbors</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">neighbor</span><span class="o">.</span><span class="na">visited</span> <span class="o">==</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>

                    <span class="kt">int</span> <span class="n">distance_btwn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000</span><span class="o">;</span>

                    <span class="k">for</span><span class="o">(</span> <span class="n">Edge</span> <span class="n">edge</span> <span class="o">:</span> <span class="n">graph</span><span class="o">.</span><span class="na">edgesConnecting</span><span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">neighbor</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                        <span class="n">distance_btwn</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="c1">// Make a choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">visit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">+=</span> <span class="n">distance_btwn</span><span class="o">;</span>

                    <span class="c1">// Explore the consequences</span>
                    <span class="n">explore</span><span class="o">(</span><span class="n">neighbor</span><span class="o">,</span><span class="n">nchoices</span><span class="o">+</span><span class="mi">1</span><span class="o">);</span>

                    <span class="c1">// Unmake the choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">unvisit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">-=</span> <span class="n">distance_btwn</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">// Move on to the next choice (continue loop)</span>
            <span class="o">}</span>               
        <span class="o">}</span> <span class="c1">// End base/recursive case</span>
    <span class="o">}</span>
</pre></div>


<p><a name="tsp2-pessimist"></a></p>
<h3>The Pessimist Algorithm</h3>
<p>This algorithm is dubbed The Pessimist Algorithm. Let's see how it works.
Here is that new if statement:</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">min_distance</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span><span class="o">&gt;</span><span class="k">this</span><span class="o">.</span><span class="na">min_distance</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Just give up already. It&#39;s meaningless. There&#39;s no point.</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<p>This if statement tests two conditions - first, we check if a first minimum distance has actually been found,
and second, we check if the distance of the current path is greater than the minimum distance.
If it is, we give up continuing our search down this path, and just return back to the calling function.</p>
<p>This introduces a small computational cost - 
we now have an if statement to check every time the <code>explore()</code> method is called -
but it results in such significant cost savings that it does not matter.</p>
<p><a name="tsp-timing"></a></p>
<h2>Timing Results</h2>
<p>Shown below is a graph of the walltime for various problem sizes,
showing both the original algorithm and the pessimist algorithm
and their scaling behavior. </p>
<p>The pessimist algorithm led to a <em>drastic</em> improvement in scale-up -
the results are striking.</p>
<p><img alt="TSP Guava Solution scaling results - initial and pessimist algorithms" src="/images/tsp-guava-initial-pessimist.png"></p>
<p>And here are the results in a table form:</p>
<div class="highlight"><pre><span></span>-----------------------------------------------------------------------------------------
| Number of Nodes N | Initial Algorithm Walltime [s] | Pessimist Algorithm Walltime [s] |
|-------------------|--------------------------------|----------------------------------|
| 4                 | 0.005                          | 0.006                            |
| 5                 | 0.006                          | 0.006                            |
| 6                 | 0.009                          | 0.008                            |
| 7                 | 0.017                          | 0.011                            |
| 8                 | 0.029                          | 0.020                            |
| 9                 | 0.083                          | 0.023                            |
| 10                | 0.305                          | 0.053                            |
| 11                | 1.443                          | 0.118                            |
| 12                | 15.808                         | 0.149                            |
| 13                | 180.078                        | 0.524                            |
| 14                |                                | 1.276                            |
| 15                |                                | 3.905                            |
| 16                |                                | 216.827                          |
| 17                |                                | 106.992                          |
| 18                |                                | 337.930                          |
-----------------------------------------------------------------------------------------
</pre></div>


<p>For a problem with 13 nodes, the initial algorithm took 3 minutes; 
the pessimist algorithm didn't even break the one second mark!</p>
<h2>Future Work</h2>
<p>Now that we've got the algorithm running faster and more efficiently,
we can tackle larger problems and explore the impact of problem topology
on solutions, and we can rest assured we have an efficient algorithm
that can scale to larger and more interesting problems.</p>
<p>There are further improvements we could make to the algorithm to improve it, though.
By examining the solutions that are found, we can see that the solutions
usually, but not always, connects from each neighbor to its next-closest neighbor.
If, when iterating over neighbors, we start by searching the nearest neighbors first,
we can potentially get to the minimum solution faster, which would allow us
to more quickly rule out larger portions of the solution space that are infeasible.</p>
<p>This would induce an additional overhead cost of sorting, since the Guava library
returns the edges that connect to a node as an unordered Set. These edges would 
have to be added to a container and sorted to implement the nearest-neighbor search.</p>
<p>However, we saw with the pessimist solution that a small increase in complexity
can rule out large enough portions of the solution space to make it worthwhile,
so it may be that the cost of sorting each edge pays off in the computational savings that result.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="/tag/guava.html">guava</a>
                    &nbsp;&nbsp;
                    <a href="/tag/graph.html">graph</a>
                    &nbsp;&nbsp;
                    <a href="/tag/tsp.html">TSP</a>
                    &nbsp;&nbsp;
                    <a href="/tag/performance.html">performance</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">
            <a class="prev" href="/index2.html">&larr; Older</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>








<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>
<!--
<script type="text/javascript" src="/theme/js/leaflet-0.7.3.js"></script>
<script type="text/javascript" src="/theme/js/leaflet.ajax.min.js"></script>
--><footer id="contentinfo" class="body">
<hr />
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="http://d3js.org">D3.js</a>, <a href="http://angularjs.org">Angular.js</a>, and <a href="http://getpelican.com">Pelican</a>.
</p>

<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/jquery_load_template-1.4.5.min.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

</footer><!-- /#contentinfo -->
</body>
</html>