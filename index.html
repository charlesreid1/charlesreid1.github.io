<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Building Snakemake Command Line Wrappers
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-21T22:00:00-08:00" pubdate>Monday 01/21/2019</time>
                in 
                <a href="/category/snakemake.html">Snakemake</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/building-snakemake-command-line-wrappers.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><strong>NOTE:</strong> These ideas are implemented in the repository
<a href="https://github.com/charlesreid/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<p><br />
<br /></p>
<h2>Table of Contents:</h2>
<ul>
<li><a href="#basic">Basic Idea: Wrapping Snakemake API Calls</a><ul>
<li><a href="#2018">2018-snakemake-cli</a></li>
<li><a href="#2019">2019-snakemake-cli</a></li>
</ul>
</li>
<li><a href="#exe">Turning Executables into Packages</a></li>
<li><a href="#using">End Result: Using bananas</a></li>
<li><a href="#travis">Adding Travis CI Tests</a></li>
<li><a href="#next">Next Steps</a></li>
</ul>
<p><br />
<br /></p>
<p><a name="basic"></a></p>
<h1>Basic Idea: Wrapping Snakemake API Calls</h1>
<p><a name="2018"></a></p>
<h2>2018-snakemake-cli</h2>
<p>This blog post covers the implementation of an idea
that was originally explored in a blog post from 
Titus Brown, <a href="http://ivory.idyll.org/blog/2018-workflows-applications.html">Pydoit, snakemake, and workflows-as-applications</a>.</p>
<p>That blog post implemented a basic command line
wrapper around the Snakemake API to demonstrate
how a Snakemake workflow could be turned into
an executable.</p>
<p>Relevant code is in <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>,
but the basic idea is to implement a command line
utility that takes two orthogonal sets of inputs:
a workflow configuration file, and a parameter set.</p>
<div class="highlight"><pre><span></span>./run &lt;workflow-config&gt; &lt;workflow-params&gt;
</pre></div>


<p>The <a href="https://github.com/ctb/2018-snakemake-cli/blob/master/run">run script</a>
is a Python executable file that parses arguments
from the user.</p>
<p>Here is the main entrypoint of <code>run</code>:</p>
<div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Execution script for snakemake workflows.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">snakemake</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">thisdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># </span>
    <span class="c1"># ...see below...</span>
    <span class="c1">#</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;run snakemake workflows&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;run &lt;workflow&gt; &lt;parameters&gt; [&lt;target&gt;]</span>
<span class="s1">Run snakemake workflows, using the given workflow name &amp; parameters file.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;workflowfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;paramsfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--dry-run&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</pre></div>


<p>The <code>main()</code> method uses the <code>os</code> module to look for
the Snakefile, the config file, and the params file,
then makes a call to the Snakemake API:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># ...find the snakefile...</span>
    <span class="c1"># ...find the config file...</span>
    <span class="c1"># ...find the params file...</span>
    <span class="c1"># </span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">workflow_info</span><span class="p">[</span><span class="s1">&#39;workflow_target&#39;</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;details!&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">snakefile: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">config: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflowfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">params: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramsfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">target: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>

    <span class="c1"># run!!</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span> 
                                 <span class="n">configfile</span><span class="o">=</span><span class="n">paramsfile</span><span class="p">,</span>
                                 <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> 
                                 <span class="n">printshellcmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                 <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span> 
                                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span> <span class="c1"># translate &quot;success&quot; into shell exit code of 0</span>
       <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>


<p>This call uses the provided parameters file to set
the Snakemake configuration dictionary, but this can
be overridden with the <code>config</code> dictionary.
Additional argparser flags can be added, and the
<code>config</code> dictionary contents modified based on
the flags.</p>
<p><a name="2019"></a></p>
<h2>2019-snakemake-cli</h2>
<p>We wanted to take this demo a step further, and add
a few things to it:</p>
<ul>
<li>
<p>Bundle the Snakefile and command line utility as an
  installable Python package with a <code>setup.py</code></p>
</li>
<li>
<p>Implement Travis CI tests of the Snakemake workflow.</p>
</li>
</ul>
<p>We implemented a bundled Snakemake workflow as a 
command line tool called <code>bananas</code>.</p>
<p><a name="exe"></a></p>
<h1>Turning Executables into Packages</h1>
<p>We began with an executable script <code>run</code> and wished
to turn it into an installable command line utility
called <code>bananas</code>.</p>
<p>To do this, we moved the contents of <code>run</code> into 
a new file <code>command.py</code> in a new Python module 
called <code>cli</code>:</p>
<div class="highlight"><pre><span></span><span class="n">cli</span><span class="o">/</span>
<span class="err">├──</span> <span class="n">Snakefile</span>
<span class="err">├──</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="err">└──</span> <span class="n">command</span><span class="o">.</span><span class="n">py</span>
</pre></div>


<p>The <code>Snakefile</code> will contain the workflow. Here is the
very simple workflow from <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>.
The named rules are specified by the workflow configuration
file, while the parameters in <code>{}</code> are provided through
the parameters file (or via command line flags).</p>
<p><code>cli/Snakefile</code>:</p>
<div class="highlight"><pre><span></span>name = config[&#39;name&#39;]

rule rulename1:
     input:
        &quot;hello.txt&quot;

rule target1:
     output:
        &quot;hello.txt&quot;
     shell:
        &quot;echo hello {name} &gt; {output}&quot;

rule target2:
     output:
        &quot;goodbye.txt&quot;
     shell:
        &quot;echo goodbye {name} &gt; {output}&quot;
</pre></div>


<p><strong>NOTE:</strong> In this case we are bundling the Snakefile
with the command line wrapper, and writing the command
line wrapper to expect the Snakefile to be in the package.
But we can modify the command line wrapper function
(below) to look for the Snakefile in a local directory,
allowing the user to provide Snakefiles and workflows
to the command line wrapper.</p>
<p>The <code>__init__.py</code> file sets two important parameters:
the name of the command line utility, and the version
number:</p>
<p><code>cli/__init__.py</code>:</p>
<div class="highlight"><pre><span></span>_program = &quot;bananas&quot;
__version__ = &quot;0.1.0&quot;
</pre></div>


<p>The contents of <code>command.py</code> are similar to <code>run</code> and
basically control how the command line utility runs:</p>
<p><code>cli/command.py</code>:</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Command line interface driver for snakemake workflows</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">snakemake</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_program</span>


<span class="n">thisdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">parentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisdir</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">sysargs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span> <span class="o">=</span> <span class="n">_program</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;bananas: run snakemake workflows&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;bananas &lt;workflow&gt; &lt;parameters&gt; [&lt;target&gt;]</span>

<span class="s1">bananas: run snakemake workflows, using the given workflow name &amp; parameters file.</span>

<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;workflowfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;paramsfile&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--dry-run&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--force&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sysargs</span><span class="p">)</span>

    <span class="c1"># ...find the Snakefile...</span>
    <span class="c1"># ...find the config file...</span>
    <span class="c1"># ...find the params file...</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">workflow_info</span><span class="p">[</span><span class="s1">&#39;workflow_target&#39;</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;details!&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">snakefile: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">config: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflowfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">params: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramsfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">target: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>

    <span class="c1"># run bananas!!</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="n">paramsfile</span><span class="p">,</span>
                                 <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">printshellcmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                 <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">forceall</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span> <span class="c1"># translate &quot;success&quot; into shell exit code of 0</span>
       <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>The last component here is to make the function
in <code>cli/command.py</code> the entrypoint of a command line
utility called <code>bananas</code>, which can be done via
<code>setup.py</code>. This will put the executable <code>bananas</code>
in the Python binaries folder when the package is
installed.</p>
<p><code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;requirements.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)]</span>

<span class="c1"># Note: the _program variable is set in __init__.py.</span>
<span class="c1"># it determines the name of the package/final command line tool.</span>
<span class="kn">from</span> <span class="nn">cli</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">_program</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">],</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s1">&#39;pytest.collector&#39;</span><span class="p">,</span>
      <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">],</span>
      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;bananas command line interface&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://charlesreid1.github.io/2019-snakemake-cli&#39;</span><span class="p">,</span>
      <span class="n">author</span><span class="o">=</span><span class="s1">&#39;@charlesreid1&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;cmreid@ucdavis.edu&#39;</span><span class="p">,</span>
      <span class="n">license</span><span class="o">=</span><span class="s1">&#39;MIT&#39;</span><span class="p">,</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      [console_scripts]</span>
<span class="s2">      {program} = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p><a name="using"></a></p>
<h1>End Result: Using bananas</h1>
<p>The end result is a command line utility that bundles a
Snakemake workflow. The repository contains some tests,
so let's run through the quick start installation and
run the tests.</p>
<h2>Quick Start: Installing</h2>
<p>Start by setting up a virtual environment:</p>
<div class="highlight"><pre><span></span>virtualenv vp
<span class="nb">source</span> vp/bin/activate
</pre></div>


<p>Install required components, then install the package:</p>
<div class="highlight"><pre><span></span>pip install -r requirements.txt
python setup.py build install
</pre></div>


<p>Now you should see <code>bananas</code> on your path:</p>
<div class="highlight"><pre><span></span>which bananas
</pre></div>


<h2>Quick Start: Running Tests</h2>
<div class="highlight"><pre><span></span>pytest
</pre></div>


<h2>Quick Start: Running Examples</h2>
<p>Change to the <code>test/</code> directory and run tests with
the example config and param files.</p>
<div class="highlight"><pre><span></span>cd test
</pre></div>


<p>Run the hello workflow with Amy params:</p>
<div class="highlight"><pre><span></span>rm -f hello.txt
bananas workflow-hello params-amy
</pre></div>


<p>Run the hello workflow with Beth params:</p>
<div class="highlight"><pre><span></span>rm -f hello.txt
bananas workflow-hello params-beth
</pre></div>


<p>Run the goodbye workflow with Beth params:</p>
<div class="highlight"><pre><span></span>rm -f goodbye.txt
bananas workflow-goodbye params-beth
</pre></div>


<p><a name="travis"></a></p>
<h1>Adding Travis CI Tests</h1>
<p>To test or workflow, we break down the necessary tasks:</p>
<ul>
<li>Use a Python environment</li>
<li>Install our requirements (snakemake)</li>
<li>Install bananas with setup.py</li>
<li>Run pytest</li>
</ul>
<p>This is an easy Travis file to write, following the
<a href="https://docs.travis-ci.com/user/languages/python/">Travis docs</a>.</p>
<p><code>.travis.yml</code>:</p>
<div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="nt">python</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.5&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.6&quot;</span>
  <span class="c1">#- &quot;3.7-dev&quot; # fails due to datrie build failure (snakemake dependency)</span>

<span class="c1"># command to install dependencies</span>
<span class="nt">install</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python setup.py build install</span>

<span class="c1"># command to run tests</span>
<span class="nt">script</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pytest</span>
</pre></div>


<p><a name="next"></a></p>
<h1>Next Steps</h1></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="/tag/workflows.html">workflows</a>
                    &nbsp;&nbsp;
                    <a href="/tag/pipelines.html">pipelines</a>
                    &nbsp;&nbsp;
                    <a href="/tag/snakemake.html">snakemake</a>
                    &nbsp;&nbsp;
                    <a href="/tag/travis.html">travis</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-03T10:30:00-08:00" pubdate>Thursday 01/03/2019</time>
                in 
                <a href="/category/rosalind.html">Rosalind</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><em>This is the third in a series of three blog posts describing our
solution to a bioinformatics problem from Rosalind.info,
<a href="http://rosalind.info/problems/ba1i/">Problem BA1(i) (Find most frequent words with mismatches
in a string)</a>.
To solve this problem and generate variations of a DNA string
as required, we implemented a recursive backtracking method
in the Go programming language.</em></p>
<ul>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1: Counting Variations</a></em></li>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Part 2: Generating Variations</a></em></li>
<li><em>Part 3: Go Implementation of Recursive Backtracking (you are here)</em></li>
</ul>
<p><br />
<br /></p>
<p><a name="toc"></a></p>
<h2>Table of Contents</h2>
<ul>
<li>
<p><a href="#problem-descr">Problem Description</a></p>
</li>
<li>
<p><a href="#backtracking">Recursive Backtracking Pseudocode</a></p>
</li>
<li>
<p><a href="#go-implementation">Recursive Backtracking: Go Implementation</a></p>
<ul>
<li><a href="#visit-hamming">Visit Hamming Neighbors Function</a></li>
<li><a href="#assemble-visit">Assemble Visit Variations Function</a></li>
</ul>
</li>
<li>
<p><a href="#tests">Tests</a></p>
</li>
<li>
<p><a href="#final">Final Code</a></p>
</li>
<li>
<p><a href="#fruitful">Go forth and be fruitful</a></p>
</li>
</ul>
<p><br />
<br /></p>
<p><a name="problem-descr"></a></p>
<h2>Problem Description</h2>
<p>The task at hand is to take a given input strand of DNA,
and generate variations from it that have up to <span class="math">\(d\)</span> differences
(a Hamming distance of <span class="math">\(d\)</span>) in the codons (base pairs).</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">part 1 of this series</a>, we walk through the
construction of an analytical formula to count the number
of variations of a given DNA string that can be generated,
given the constraints of the problem.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">part 2 of this series</a>, we cover several techniques to
generate variations on a DNA string, and present pseudocode
for the recursive backtracking method that we use here.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">part 3 of this series</a>, we will cover our implementation
of the recursive backtracking method in the Go programming
language.</p>
<p><br />
<br /></p>
<p><a name="backtracking"></a></p>
<h2>Recursive Backtracking Pseudocode</h2>
<p>To review from the prior post, our pseudocode
for recursive backtracking to explore variations
or combinations looks like the following:</p>
<div class="highlight"><pre><span></span>explore method:
    base case:
        visit this solution
    recursive case:
        for each available choice:
            make a choice
            explore outcomes
            unmake the choice
            move on to the next choice
</pre></div>


<p>The key elements there are the base and recursive
cases, and the mechanism of iterating over each
possible choice and making/exploring/unmaking
the choice.</p>
<p><a name="go-implementation"></a></p>
<h2>Recursive Backtracking: Go Implementation</h2>
<p>In total, we have three different methods to
accomplish this task:</p>
<ul>
<li>
<p><code>VisitHammingNeighbors(input,d)</code>: this is the public method
  that the user calls to generate a string array of all
  strings that are a Hamming distance of up to <code>d</code> from
  the input string <code>input</code>. This public method performs
  parameter and error checking, initializes space for
  data, and collects results.</p>
</li>
<li>
<p><code>visitHammingNeighbors_recursive(base_kmer, depth, choices, results_map)</code>:
  this method is the private recursive method available
  only to the package. This method performs the actual
  recursive work. </p>
</li>
</ul>
<p><strong>NOTE:</strong> the function name starts with a lower case letter,
so it is not exported by the package - i.e., it is not available
to the user when they import this package.</p>
<p>The base case of the <code>visitHammingNeighbors_recursive()</code>
function will pass the final set of choices to the final
step:</p>
<ul>
<li><code>assemble_variations(base_kmer, choices, results_map)</code>: 
  this method (private to the package) is a recursive
  method that uses the chosen indices and </li>
</ul>
<p><a name="visit-hamming"></a></p>
<h3>Visit Hamming Neighbors Function</h3>
<p>The function call to visit all Hamming neighbors and add them to the <code>results</code> set
is split into two parts: a non-recursive public function, which provides a public wrapper
that is user-friendly and performs error-checking on the parameters provided, and a
recursive private function that is used internally but not intended to be called by
users directly.</p>
<h4>Public, Non-Recursive Function</h4>
<p>Here is the entry point function that the user calls
when they wish to generate all variations on a given
string of DNA, and have the variations returned as a
string slice.</p>
<div class="highlight"><pre><span></span><span class="c1">// Given an input string of DNA, generate variations</span>
<span class="c1">// of said string that are a Hamming distance of</span>
<span class="c1">// less than or equal to d.</span>
<span class="kd">func</span> <span class="nx">VisitHammingNeighbors</span><span class="p">(</span><span class="nx">input</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">d</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// a.k.a. visit_kmer_neighbors</span>

    <span class="c1">// number of codons</span>
    <span class="nx">n_codons</span> <span class="o">:=</span> <span class="mi">4</span>

    <span class="c1">// Use combinatorics to calculate the total</span>
    <span class="c1">// number of variation.</span>
    <span class="nx">buffsize</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">CountHammingNeighbors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">n_codons</span><span class="p">)</span>
</pre></div>


<p>The call to <code>CountHammingNeighbors()</code> uses the counting
formula from <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1</a>
to predict the number of variations. If the user has selected
an astronomical problem size, the program warns the user.</p>
<div class="highlight"><pre><span></span>    <span class="c1">// This blows up quickly, so warn the user</span>
    <span class="c1">// if their problem is too big</span>
    <span class="nx">MAX</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">buffsize</span> <span class="p">&gt;</span> <span class="nx">MAX</span> <span class="p">{</span>
        <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error: you are generating over MAX = %d permutations, you probably don&#39;t want to do this.&quot;</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>


<p>Now the actual recursive backtracking algorithm begins.
The code loops over every possible value of Hamming distance
<span class="math">\(d\)</span> and calls the recursive method at each value of <span class="math">\(d\)</span>.</p>
<div class="highlight"><pre><span></span>    <span class="c1">// Store the final results in a set (string-&gt;bool map)</span>
    <span class="nx">results</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span>

    <span class="c1">// Begin backtracking algorithm</span>
    <span class="k">for</span> <span class="nx">dd</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dd</span> <span class="o">&lt;=</span> <span class="nx">d</span><span class="p">;</span> <span class="nx">dd</span><span class="o">++</span> <span class="p">{</span>

        <span class="c1">// The choices array will change with each recursive call.</span>
        <span class="c1">// Go passes all arguments by copy, which is good for us.</span>
        <span class="nx">choices</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>

        <span class="c1">// Populate list of neighbors</span>
        <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">dd</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>

    <span class="p">}</span>
</pre></div>


<p>We don't assign any results from the call to <code>visitHammingNeighbors_recursive()</code>
because we pass in a data structure (actually a pointer to a
data structure), <code>results</code>, that is modified in-place.</p>
<p>Thus, when we complete a call to <code>visitHammingNeighbors_recursive()</code>,
results will contain all variations already.</p>
<div class="highlight"><pre><span></span>    <span class="c1">// Check if we have the right number of results</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">buffsize</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;WARNING: number of results (%d) did not match expected value (%d)\n&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">results</span><span class="p">),</span> <span class="nx">buffsize</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">results</span>
<span class="p">}</span>
</pre></div>


<h4>Private, Recursive Function</h4>
<p>In the above function, the call to the recursive
function to visit all Hamming neighbors happens
here:</p>
<div class="highlight"><pre><span></span>        <span class="c1">// Populate list of neighbors</span>
        <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">dd</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
</pre></div>


<p>The user passes the original kmer <code>input</code>, along with the
Hamming distance parameter <code>dd</code>, the list of choices
of indices that have already been selected <code>choices</code>,
and the data structure storing all resulting strings
<code>results</code>.</p>
<p>As with the pseudocode, we have a base case and 
a recursive case. The recursive function is being
called repeatedly until it reaches a depth of 0,
with the depth parameter being decremented each call.</p>
<div class="highlight"><pre><span></span><span class="c1">// Recursive function: given an input string of DNA,</span>
<span class="c1">// generate Hamming neighbors that are a Hamming</span>
<span class="c1">// distance of exactly d. Populate the neighbors</span>
<span class="c1">// array with the resulting neighbors.</span>
<span class="kd">func</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Base case</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The base case occurs when we reach a depth of 0 and have
no further choices to make. We reach this base case for
each binary number with <span class="math">\(d\)</span> digits set to 1; once the base
case is reached, we call the <code>assemble_variations()</code> function
to substitute all possible codons at the selected indices.</p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">nil</span>
</pre></div>


<p>The recursive case is slightly more complicated, but it follows
the same backtracking pseudocode covered previously: from a set
of possible choices, try each choice, recursively call this 
function, then unmake the choice and move on to the next choice.</p>
<p>Here, the choice is which index <code>c</code> in the kmer to modify. Each
kmer can only be modified once, so we have a for loop to
check if the index <code>c</code> is in the list of choices already made.</p>
<div class="highlight"><pre><span></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>
        <span class="k">for</span> <span class="nx">c</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">c</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">);</span> <span class="nx">c</span><span class="o">++</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">indexAlreadyTaken</span> <span class="kt">bool</span>
            <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">choice</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">choices</span> <span class="p">{</span>
                <span class="k">if</span> <span class="nx">c</span> <span class="o">==</span> <span class="nx">choice</span> <span class="p">{</span>
                    <span class="nx">indexAlreadyTaken</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">}</span>
</pre></div>


<p>As before, the recursive call to this function will
not return any values that need to be stored, since 
<code>results</code> points to a data structure (map) that is 
modified in-place.</p>
<div class="highlight"><pre><span></span>            <span class="k">if</span> <span class="p">!</span><span class="nx">indexAlreadyTaken</span> <span class="p">{</span>

                <span class="c1">// This will make a new copy of choices</span>
                <span class="c1">// for each recursive function call</span>
                <span class="nx">choices2</span> <span class="o">:=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">choices</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
                <span class="nx">err</span> <span class="o">:=</span> <span class="nx">visitHammingNeighbors_recursive</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">,</span> <span class="nx">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">choices2</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">err</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>


<p><a name="assemble-visit"></a></p>
<h3>Assemble Visit Variation Function</h3>
<p>Once we've generated each list of indices to modify,
we call a second recursive function to substitute each
codon into each index.</p>
<p>In the recursive method above, each recursive function
call added a new choice to <code>choices</code>; in this recursive
function, each recursive funcction call pops a choice 
from <code>choices</code>. Thus, the base case is when <code>choices</code>
is empty.</p>
<p>Here are the base and recursive cases:</p>
<div class="highlight"><pre><span></span><span class="c1">// Given a base kmer and a choice of indices where</span>
<span class="c1">// the kmer should be changed, generate all possible</span>
<span class="c1">// variations on this base_kmer.</span>
<span class="kd">func</span> <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">choices</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>
        <span class="o">...</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="o">...</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The recursive case pops a choice from <code>choices</code>, 
finds which nucleotide (AGCT) is at that location,
and assembles the list of possible choices (the
other 3 nucleotide values). It then performs
the recursive backtracking algorithm, choosing 
from each of the three possible nucleotide values,
exploring the choice by making a recursive call,
then un-making the choice.</p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">base_kmer</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">choices</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">results</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">choices</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>

        <span class="c1">// Recursive case</span>

        <span class="nx">all_codons</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="s">&quot;C&quot;</span><span class="p">}</span>

        <span class="c1">// Pop the next choice</span>
        <span class="c1">// https://github.com/golang/go/wiki/SliceTricks</span>
        <span class="nx">ch_ix</span><span class="p">,</span> <span class="nx">choices</span> <span class="o">:=</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1">// Get the value of the codon at that location</span>
        <span class="k">if</span> <span class="nx">ch_ix</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// slice of string is bytes,</span>
            <span class="c1">// so convert back to string</span>
            <span class="nx">this_codon</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">base_kmer</span><span class="p">[</span><span class="nx">ch_ix</span><span class="p">])</span>
            <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">codon</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">all_codons</span> <span class="p">{</span>

                <span class="k">if</span> <span class="nx">codon</span> <span class="o">!=</span> <span class="nx">this_codon</span> <span class="p">{</span>
                    <span class="c1">// Swap out the old codon with the new codon</span>
                    <span class="nx">new_kmer</span> <span class="o">:=</span> <span class="nx">base_kmer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">ch_ix</span><span class="p">]</span> <span class="o">+</span> <span class="nx">codon</span> <span class="o">+</span> <span class="nx">base_kmer</span><span class="p">[</span><span class="nx">ch_ix</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="nx">assemble_variations</span><span class="p">(</span><span class="nx">new_kmer</span><span class="p">,</span> <span class="nx">choices</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Base case</span>
        <span class="nx">results</span><span class="p">[</span><span class="nx">base_kmer</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><br />
<br /></p>
<p><a name="tests"></a></p>
<h2>Tests</h2>
<p>The last step after some debugging was to write tests for the
function to generate all variations of a DNA string, to ensure
the recursive backtracking functions work correctly.</p>
<p>The pattern we use is to create a struct containing test parameters,
then create a test matrix by initializing instances of the
parameter struct with the parameters we want to test.</p>
<p>Here is how we set up the tests:</p>
<div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">TestMatrixVisitHammingNeighbors</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tests</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">input</span> <span class="kt">string</span>
        <span class="nx">d</span>     <span class="kt">int</span>
        <span class="nx">gold</span>  <span class="p">[]</span><span class="kt">string</span>
    <span class="p">}{</span>
        <span class="p">{</span><span class="s">&quot;AAA&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;AAC&quot;</span><span class="p">,</span> <span class="s">&quot;AAT&quot;</span><span class="p">,</span> <span class="s">&quot;AAG&quot;</span><span class="p">,</span> <span class="s">&quot;AAA&quot;</span><span class="p">,</span> <span class="s">&quot;CAA&quot;</span><span class="p">,</span> <span class="s">&quot;GAA&quot;</span><span class="p">,</span> <span class="s">&quot;TAA&quot;</span><span class="p">,</span> <span class="s">&quot;ATA&quot;</span><span class="p">,</span> <span class="s">&quot;ACA&quot;</span><span class="p">,</span> <span class="s">&quot;AGA&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">test</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>

        <span class="o">...</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Each test case should generate all Hamming neighbors, and compare to the list of
Hamming neighbors provided. This requires two tricks:</p>
<ul>
<li>sort before comparing, to ensure a proper comparison</li>
<li>use a custom <code>EqualStringSlices()</code> function that will iterate through
  two string slices element-wise to check if they are equal.</li>
</ul>
<p>The <code>EqualStringSlices()</code> function is required because Go does not have 
built-in equality checks for slices.</p>
<p>Here is what the tests look like:</p>
<div class="highlight"><pre><span></span>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">test</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tests</span> <span class="p">{</span>

        <span class="c1">// Money shot</span>
        <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">VisitHammingNeighbors</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">d</span><span class="p">)</span>

        <span class="c1">// Check if there was error</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error: %v&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// Sort before comparing</span>
        <span class="nx">sort</span><span class="p">.</span><span class="nx">Strings</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span>
        <span class="nx">sort</span><span class="p">.</span><span class="nx">Strings</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">!</span><span class="nx">EqualStringSlices</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Error testing VisitHammingNeighbors():\ncomputed = %v\ngold     = %v&quot;</span><span class="p">,</span>
                <span class="nx">result</span><span class="p">,</span> <span class="nx">test</span><span class="p">.</span><span class="nx">gold</span><span class="p">)</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p><a name="final"></a></p>
<h2>Final Code</h2>
<p>The final version of the recursive function to visit all Hamming neighbors
and return them in a string array can be found in the <code>go-rosalind</code> library
on Github.</p>
<p>Specifically, in the file <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go"><code>rosalind_ba1.go</code></a>,
there is a <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L711"><code>VisitHammingNeighbors()</code></a>
function that is the public function that calls the private recursive
function <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L778"><code>visitHammingNeighbors_recursive()</code></a>,
and the recursive function to swap out codons is
in the <a href="https://github.com/charlesreid1/go-rosalind/blob/master/rosalind/rosalind_ba1.go#L819"><code>visit()</code></a>
funciont.</p>
<p><a name="fruitful"></a></p>
<h2>Go Forth and Be Fruitful</h2>
<p>Now that you have the basic tools to imlement a recursive
backtracking algorithm in Go to generate string variations,
you have one of the key ingredients to solve Rosalind.info
problem <a href="http://rosalind.info/problems/ba1i/">BA1i, "Find Most Frequent Words with Mismatches by
String"</a>.</p>
<p>This problem is tricky principally because it requires generating
every DNA string variation, so now you should have the key
ingredient to solve BA1i (and several problems that follow).</p>
<p>You can use the final version of the methods we covered by importing
the <code>go-rosalind</code> library in your Go code
(<a href="https://godoc.org/github.com/charlesreid1/go-rosalind/rosalind">link to go-rosalind documentation on godoc.org</a>)
or you can implement your own version of these algorithms. 
The Go code we covered in this post is also on Github in the
<a href="https://github.com/charlesreid1/go-rosalind">charlesreid1/go-rosalind</a> repository.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/go.html">go</a>
                    &nbsp;&nbsp;
                    <a href="/tag/golang.html">golang</a>
                    &nbsp;&nbsp;
                    <a href="/tag/rosalind.html">rosalind</a>
                    &nbsp;&nbsp;
                    <a href="/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="/tag/recursion.html">recursion</a>
                    &nbsp;&nbsp;
                    <a href="/tag/backtracking.html">backtracking</a>
                    &nbsp;&nbsp;
                    <a href="/tag/strings.html">strings</a>
                    &nbsp;&nbsp;
                    <a href="/tag/combinatorics.html">combinatorics</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2018-12-28T14:00:00-08:00" pubdate>Friday 12/28/2018</time>
                in 
                <a href="/category/rosalind.html">Rosalind</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><em>This is the second in a series of three blog posts describing our
solution to a bioinformatics problem from Rosalind.info,
<a href="http://rosalind.info/problems/ba1i/">Problem BA1(i) (Find most frequent words with mismatches
in a string)</a>.
To solve this problem and generate variations of a DNA string
as required, we implemented a recursive backtracking method
in the Go programming language.</em></p>
<ul>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1: Counting Variations</a></em></li>
<li><em>Part 2: Generating Variations (you are here)</em></li>
<li><em><a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Part 3: Go Implementation of Recursive Backtracking</a></em></li>
</ul>
<p><br />
<br /></p>
<p><a name="toc"></a></p>
<h2>Table of Contents</h2>
<ul>
<li><a href="#problem-descr">Problem Description</a></li>
<li><a href="#perms-combs-vars">Permutations vs Combinations vs Variations</a></li>
<li><a href="#recursion">Recursion</a><ul>
<li><a href="#backtracking">Recursive Backtracking Pseudocode</a></li>
</ul>
</li>
<li><a href="#dna">Appying to DNA Variations</a><ul>
<li><a href="#generating-visits">Generating Visits with Binary Numbers</a></li>
<li><a href="#assembling">Assembling the Variation</a></li>
</ul>
</li>
</ul>
<p><br />
<br /></p>
<p><a name="problem-descr"></a></p>
<h2>Problem Description</h2>
<p>The task at hand is to take a given input strand of DNA,
and generate variations from it that have up to <span class="math">\(d\)</span> differences
(a Hamming distance of <span class="math">\(d\)</span>) in the codons (base pairs).</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">part 1 of this series</a>, we walk through the
construction of an analytical formula to count the number
of variations of a given DNA string that can be generated,
given the constraints of the problem.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">part 2 of this series</a>, we cover several techniques to
generate variations on a DNA string, and present pseudocode
for the recursive backtracking method that we use here.</p>
<p>In <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">part 3 of this series</a>, we will cover our implementation
of the recursive backtracking method in the Go programming
language.</p>
<p><a name="perms-combs-vars"></a></p>
<h2>Permutations vs Combinations vs Variations</h2>
<p>Before covering generation of variations of a DNA string,
we should cover some terminology for clarification.</p>
<p>If we were to use the term <em>permutations</em>, as in, we are
counting (or generating) <em>permutations</em> of the input DNA string, 
that would imply that we were doing some kind of
rearrangement of the elements of the input DNA string
(for example, swapping two codons). This is not the
problem that we are solving, and requires different
formulas. (See <a href="http://mathworld.wolfram.com/Permutation.html">Permutations</a>
entry on Wolfram MathWorld.)</p>
<p>The variations that we are referring to are not
exactly <em>combinations</em>, either, though. If we were
to use the term <em>combinations</em>, it would imply that
we were choosing a set of <span class="math">\(k\)</span> integers from a set
of <span class="math">\(d\)</span> integers <span class="math">\({1, 2, \dots, d}\)</span>.</p>
<p>The variations that we are counting are similar to
combinations, but with the additional act of swapping
out each codon at the position (integer) selected
with three other possible codons, so there are
more variations than combinations (and many
more permutations than variations).</p>
<p><a name="transform"></a></p>
<h2>Transforming the Problem Space</h2>
<p>A surprisingly large variety of problems in combinatorics 
can be transformed into an equivalent problem involving 
binary numbers, which are usually easier to think about.</p>
<p>To generate variations, we can break up the process of
producing a variation into two steps, or choices, and
then convert these choices (and the process of making them)
into an equivalent problem in terms of binary numbers.</p>
<p>We can decompose the cration of a DNA string variation into
the first step of choosing which codons (indices) to edit, 
and the second step of cycling through every possible codon 
(ATGC) at the selected indices.</p>
<p>To translate this into an equivalent binary number problem,
consider the input string of DNA "AAAAA" and let the Hamming
distance that we are considering be <span class="math">\(d = 1\)</span>. Then we can code
each index with a 0 (not chosen) or a 1 (chosen) and turn the
problem into cycling throgh all binary numbers with 1 bit:</p>
<div class="highlight"><pre><span></span>00001
00010
00100
01000
10000
</pre></div>


<p>The second step is to cycle through each alternate codon at
the given position, so that <code>00001</code> would generate the 
variations:</p>
<div class="highlight"><pre><span></span>AAAAC
AAAAG
AAAAT
</pre></div>


<p>and so on.</p>
<p>We saw this two-part technique already when counting the total number of
variations that could be created in <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Part 1: Counting Variations</a>.
It resulted in a counting formula with two terms, a binomial term
for step 1 and an exponential term for step 2.</p>
<p>We can think of the problem as forming a tree with several
decision nodes that need to be explored; this type of problem
structure is ideal for a recursive backtracking algorithm.</p>
<p>We will cover the use of recursive backtracking to actually
explore the entire tree of possible outcomes (not just count
it), starting with some review and background on recursive 
backtracking and how it works.</p>
<p><a name="recursion"></a></p>
<h2>Recursion</h2>
<p>Recursion is a common pattern to use for problems that require
exploring a large problem space that requires us to make
several selections.</p>
<p>A recursive backtracking algorithm is analogous to exploring a
maze but laying out a rope as you go, so tht you can revisit
each possible route. In this case, we are using backtracking
to make the choice of which indices of the input DNA string
to modify. We want to explore all possible choices to generate
all possible variations of the input DNA string, and backtracking
gives us the framework to do that.</p>
<p>For example, if we wanted to recursively generate codon choices
for the case of an input DNA string like "AAAAA" and <span class="math">\(d = 2\)</span>,
we would call a recursive method twice; the first time through,
we would choose one of the five indices, and mark it as picked;
then we would call the method again, and choose a second index
(different from the first) and mark it as picked.</p>
<p>When unrolled, this is equivalent to a nested for loop,</p>
<div class="highlight"><pre><span></span>for i in range( 0 .. len(dna_string) ):
    for j in range( 0 .. len(dna_string) ):
        if (i != j):
            Start with the binary number 00000
            Set the digit at index i to 1
            Set the digit at index j to 1
</pre></div>


<p><a name="backtracking"></a></p>
<h3>Recursive Backtracking Pseudocode</h3>
<p>Basic pseudocode for a backtracking method:</p>
<div class="highlight"><pre><span></span>explore method:
    base case:
        visit this solution
    recursive case:
        for each available choice:
            make a choice
            explore outcomes
            unmake the choice
            move on to the next choice
</pre></div>


<p><a name="dna"></a></p>
<h2>Applying to DNA Variations</h2>
<p>There are actually two places where we need to apply
backtracking to our problem.</p>
<p><a name="generating-visits"></a></p>
<h3>Generating Visits with Binary Numbers</h3>
<p>The first application of recursive backtracking is to
carry out step 1, choosing indices in the original
DNA string to modify or cycle through altnerate 
codons. We showed above how generating variations
on a kmer of length <span class="math">\(k\)</span> at a distance <span class="math">\(d\)</span> from the
original kmer was equivalent to generating binary 
numbers with <span class="math">\(d\)</span> bits set to 1.</p>
<p>We can use recursive backtracking to generate these
numbers. By creating a method that recursively selects
an index to switch to 1, and passing that (and all prior
choices) on to further recursive calls, the function
can recurse to a given depth <span class="math">\(d\)</span> and visit all possible
binary numbers with <span class="math">\(d\)</span> bits set to 1.</p>
<p>The base case of this recursive method would be reached
when all <span class="math">\(d\)</span> choices had been made and <span class="math">\(d\)</span> bits were 
set to 1. Then the choice of indices to swap out with
alternate codons would be passed on to a recursive method
that would carry out Step 2 (see below).</p>
<p>For example, to generate variations of the 5-mer <code>AAAAA</code>,
we would start by selecting a Hamming distance <span class="math">\(d\)</span>, then
generate a binary number with <span class="math">\(d\)</span> bits set to 1 to select
indices to modify. Suppose <span class="math">\(d = 2\)</span>; then the first few
binary numbers are:</p>
<div class="highlight"><pre><span></span>AAAAA
11000
10100
10010
10001
...
</pre></div>


<p>To expand on the pseudocode a bit more, to generate a
binary number with <span class="math">\(d\)</span> bits flipped to 1 we will want
to call a recursive method with a depth of <span class="math">\(d\)</span>, making
a choice at each recursive call of which index to set
to 1 next.</p>
<p>The <span class="math">\(n^{th}\)</span> recursive call picks the <span class="math">\(n^{th}\)</span> index for
1. Each index can only be chosen once in the stack of 
recursive calls, and the indices that have been chosen
by prior recursive function calls are passed along.</p>
<p>Thus we need a minimum of two parameters: an integer
indicating the depth level of this recursive function
call, and an integer array of index choices.</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">generate_binary_numbers</span><span class="p">(</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">choices</span><span class="p">[],</span> <span class="p">...</span> <span class="p">)</span><span class="o">:</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="nx">is</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">base</span> <span class="k">case</span>
        <span class="nx">no</span> <span class="nx">more</span> <span class="nx">choices</span> <span class="nx">left</span> <span class="nx">to</span> <span class="nx">make</span>
        <span class="nx">choices</span><span class="p">[]</span> <span class="nx">is</span> <span class="nx">full</span>
        <span class="nx">pass</span> <span class="nx">along</span> <span class="nx">choices</span><span class="p">[]</span> <span class="nx">to</span> <span class="nx">assemble</span> <span class="nx">the</span> <span class="nx">variations</span>

    <span class="k">else</span><span class="p">,</span>
        <span class="nx">recursive</span> <span class="k">case</span>
        <span class="k">for</span> <span class="nx">each</span> <span class="nx">possible</span> <span class="nx">index</span><span class="p">,</span>
            <span class="k">if</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">already</span> <span class="k">in</span> <span class="nx">choices</span><span class="p">,</span>
                <span class="nx">add</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">to</span> <span class="nx">choices</span>
                <span class="nx">generate_binary_numbers</span><span class="p">(</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">choices</span><span class="p">[]</span> <span class="p">)</span>
                <span class="nx">remove</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">from</span> <span class="nx">choices</span>
</pre></div>


<p><a name="assembling"></a></p>
<h3>Assembling the Variation</h3>
<p>Each binary number is then turned into variations by substituting
every combination of 3 codons in every position with a 1
possible, so the first binary number for <span class="math">\(d=2\)</span> would generate
the variations:</p>
<div class="highlight"><pre><span></span>AAAAA
11000
-----
CCAAA
GCAAA
TCAAA
CGAAA
GGAAA
TGAAA
CTAAA
GTAAA
TTAAA
</pre></div>


<p>This would be repeated for all Hamming distances up to the
maximum specified Hamming distance.</p>
<p>Like the generation of binary numbers, the substitution of all
possible combinations of codons at these positions is a
task conducive to a recursive backtracking algorithm.</p>
<p>Like the prior task's recursive method, this task's recursive 
method will have one parameter for depth (number of choices
left to make) and a range of choices to try (codons).</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">assemble_variations</span><span class="p">(</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">choices</span><span class="p">[],</span> <span class="p">...</span> <span class="p">)</span><span class="o">:</span>

    <span class="k">if</span> <span class="nx">depth</span> <span class="nx">is</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">base</span> <span class="k">case</span>
        <span class="nx">no</span> <span class="nx">more</span> <span class="nx">choices</span> <span class="nx">left</span> <span class="nx">to</span> <span class="nx">make</span>
        <span class="nx">choices</span><span class="p">[]</span> <span class="nx">is</span> <span class="nx">full</span>
        <span class="nx">pass</span> <span class="nx">along</span> <span class="nx">choices</span><span class="p">[]</span> <span class="nx">to</span> <span class="nx">assemble</span> <span class="nx">the</span> <span class="nx">variations</span>

    <span class="k">else</span><span class="p">,</span>
        <span class="nx">recursive</span> <span class="k">case</span>
        <span class="k">for</span> <span class="nx">each</span> <span class="nx">possible</span> <span class="nx">index</span><span class="p">,</span>
            <span class="k">if</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">already</span> <span class="k">in</span> <span class="nx">choices</span><span class="p">,</span>
                <span class="nx">add</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">to</span> <span class="nx">choices</span>
                <span class="nx">generate_binary_numbers</span><span class="p">(</span> <span class="nx">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">choices</span><span class="p">[]</span> <span class="p">)</span>
                <span class="nx">remove</span> <span class="k">this</span> <span class="nx">index</span> <span class="nx">from</span> <span class="nx">choices</span>
</pre></div>


<p>In the final part, Part 3, of this blog post, we will cover the actual 
Go implementation of these functions.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/go.html">go</a>
                    &nbsp;&nbsp;
                    <a href="/tag/golang.html">golang</a>
                    &nbsp;&nbsp;
                    <a href="/tag/rosalind.html">rosalind</a>
                    &nbsp;&nbsp;
                    <a href="/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="/tag/recursion.html">recursion</a>
                    &nbsp;&nbsp;
                    <a href="/tag/backtracking.html">backtracking</a>
                    &nbsp;&nbsp;
                    <a href="/tag/strings.html">strings</a>
                    &nbsp;&nbsp;
                    <a href="/tag/combinatorics.html">combinatorics</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">



            <a class="prev" href="/index2.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="/building-snakemake-command-line-wrappers.html">Building Snakemake Command Line Wrappers</a>
            </p>
            <p class="archive">
            <a href="/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>