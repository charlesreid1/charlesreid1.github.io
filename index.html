<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <!--
        <link href="/theme/css/cyborg.css"          rel="stylesheet" type="text/css">
        <link href="/theme/css/cosmo.css"           rel="stylesheet" type="text/css">
        <link href="/theme/css/sandstone.css"       rel="stylesheet" type="text/css">
        -->
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>


        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <!--
            http://www.w3schools.com/bootstrap/bootstrap_case_navigation.asp
            -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="/" class="navbar-brand">charlesreid1.com</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/projects">Projects</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Research Blog</a>
                    </li>
                    <li>
                        <a href="http://git.charlesreid1.com/explore">git.charlesreid1.com</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/contact">Contact Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>


<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com research<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Internet Service Providers and the FBI in Seattle
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-05-06T07:00:00-07:00" pubdate>Saturday 05/06/2017</time>
                in 
                <a href="/category/privacy.html">Privacy</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/internet-service-providers-and-the-fbi-in-seattle.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>Third and Spring</h2>
<p>On Third Avenue and Spring Street in downtown Seattle, across the street from Potbelly Sandwiches,
at a relatively unassuming intersection where buses shuttle past, second by second,
there is a line. It is a black line, less than a foot wide. And it is a line between privacy and security. </p>
<p>Here is what it looks like:</p>
<p><img src="/images/isp_fbi_0001.jpg" style="height: 500px;" /></p>
<h2>The Buildings</h2>
<p>On the left side of this line is a drab gray building that looks like a drain 
at the bottom of a concrete pit, turned on its side. 
This is 1122 Third Avenue - home to two of the biggest internet service providers in Seattle,
AT&amp;T and CenturyLink.</p>
<p><img src="/images/isp_fbi_0002.jpg" style="height: 500px;" /> </p>
<p>Many of the windows are blacked out, but through the second floor windows 
you can catch a glimpse of what's inside - server racks. </p>
<p><img src="/images/isp_fbi_0003.jpg" style="width: 500px;" />  </p>
<p>Out in front are corporate logos, electronic badge readers, surveillance cameras, 
and a sign notifying visitors that cellphone use is not allowed inside the building:
all hints that the server racks are handling sensitive customer data.</p>
<p><img src="/images/isp_fbi_0004.jpg" style="width: 500px;" />  </p>
<p><img src="/images/isp_fbi_0005.jpg" style="width: 500px;" /></p>
<p>Nests of surveillance cameras protrude from the concrete wall. 
Like black lamps with bulbs that suck up light instead of spreading it,
staring out at the world like the pupil of a passive, all-seeing eye.</p>
<p><img src="/images/isp_fbi_0006.jpg" style="width: 500px;" /></p>
<h2>The Abraham Lincoln Building</h2>
<p>On the right side of the line is a building that looks like a shower mat in a roadside motel. 
But this is no multi-story cubicle farm, as evidenced by the metal detector in the lobby
and the receptionists sitting behind bulletproof glass.</p>
<p><img src="/images/isp_fbi_0007.jpg" width="500px" /></p>
<p>This is the Abraham Lincoln Building: home to the Seattle 
branch office of the Federal Bureau of Investigation. 
No doubt Abraham Lincoln would be delighted that his namesake 
has been slapped onto the building housing the Domestic Surveillance
Home Team, headed by one James Comey, an incompetent and overtly partisan 
chowderhead and one of the few people capable of making Congress look 
not-so-bad by comparison:</p>
<p><img src="/images/isp_fbi_0008.jpg" width="500px" /></p>
<p>That tiny black gap, less than a foot wide, is all that separates the FBI and the private data 
of thousands of Seattle residents.</p>
<p><img src="/images/isp_fbi_0009.jpg" width="500px" /></p>
<p>And because of the recent legislation that killed the rule that would have re-designated ISPs as 
"common carriers," ISPs are free to sell your private data to third parties. But surely you can 
trust them not to share data with their next door neighbors. And there are <strong>definitely</strong> no wires
running across that half-inch gap. </p>
<p>Still think you've got nothing to worry about?</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/privacy.html">privacy</a>
                    &nbsp;&nbsp;
                    <a href="/tag/security.html">security</a>
                    &nbsp;&nbsp;
                    <a href="/tag/fbi.html">FBI</a>
                    &nbsp;&nbsp;
                    <a href="/tag/isp.html">ISP</a>
                    &nbsp;&nbsp;
                    <a href="/tag/att.html">ATT</a>
                    &nbsp;&nbsp;
                    <a href="/tag/centurylink.html">CenturyLink</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Stunnel
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-30T20:00:00-07:00" pubdate>Sunday 04/30/2017</time>
                in 
                <a href="/category/security.html">Security</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/stunnel.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li>
<p><a href="#stunnel-intro">Introduction</a></p>
<ul>
<li><a href="#stunnel-what">What Does Stunnel Do?</a></li>
<li><a href="#stunnel-work">How Does Stunnel Work?</a> </li>
</ul>
</li>
<li>
<p><a href="#stunnel-server">Setting Up an Stunnel Server</a></p>
<ul>
<li><a href="#stunnel-server-resoures">Charlesreid1.com Resources for Stunnel Servers</a></li>
</ul>
</li>
<li>
<p><a href="#stunnel-client">Setting Up an Stunnel Client</a></p>
</li>
<li>
<p><a href="#stunnel-protocols">Example Protocols</a></p>
</li>
<li>
<p><a href="#stunnel-docker">Stunnel with Docker</a></p>
</li>
<li>
<p><a href="#stunnel-troubleshooting">Troubleshooting Stunnel Connections</a></p>
</li>
<li>
<p><a href="#stunnel-refs">References</a></p>
</li>
</ul>
<p><a name="stunnel-intro"></a></p>
<h2>Introduction</h2>
<p><a name="stunnel-what"></a></p>
<h3>What Does Stunnel Do?</h3>
<p>Stunnel is a tool for creating SSL tunnels between a client and a server.</p>
<p>Creating SSL connections is a general task that is very useful.
In particular, any packet of any protocol can always be wrapped in an
additional SSL layer, with packets embedded within packets, so this means 
you can wrap arbitrary traffic protocols in SSL using Stunnel.</p>
<p>Stunnel requires a client and a server on either end of the tunnel.</p>
<p>This writeup assumes access to both the server and the client.
If you don't have access to the client, the server certificate
needs to be signed by a certificate authority that the client trusts.
You can either:</p>
<ul>
<li>
<p>Shell out big bucks for a certificate signed by a certificate authority company, thereby contributing to the ongoing racketeering of said companies;</p>
</li>
<li>
<p>Use a LetsEncrypt certificate, signed by a certificate authority for free; or</p>
</li>
<li>
<p>Use a self-signed certificate and install the certificate authority onto the client computer.</p>
</li>
</ul>
<p>(These are all difficult and confusing processes, 
compounded by OpenSSL's lack of documentation
and a proliferation of incorrect terminology.
Good luck.)</p>
<p><a name="stunnel-work"></a></p>
<h3>How Does Stunnel Work?</h3>
<p>The client stunnel instance will encrypt traffic, 
and the server stunnel instance will decrypt traffic.</p>
<p>When encrypting traffic, stunnel accepts incoming traffic by listening on
a port (almost always a local port). It will wrap the traffic in an encrypted
SSL layer (TCP wrapping) using the SSL certificate/key that is shared between
the client and the server. The client then sends out the encrypted traffic 
over an external connection, and on to the stunnel server.</p>
<p>When decrypting traffic, stunnel will listen on an external connection for 
incoming, encrypted SSL traffic. It will use its SSL certificate/key to 
decrypt the traffic and unwrap the SSL layer. It will then forward this traffic
on to another (usually local) port.</p>
<p><img alt="Stunnel flowchart schematic" src="/images/stunnel1.png"></p>
<p><a name="stunnel-server"></a></p>
<h2>Setting Up an Stunnel Server</h2>
<p>Stunnel servers can listen on any port, and the port you choose depends on the application. 
The configuration we're showing here is intended to bypass a network that is tightly controlled
and locked down except for HTTP and HTTPS traffic (ports 80 and 443).</p>
<p>Consider an example of connecting a local service on local port 8443 (not open to the outside world)
to an stunnel server listening on port 443 (open to the outside world).</p>
<p>stunnel will listen on port 443, open to external traffic, for SSL-encrypted stunnel traffic. 
This means that only stunnel can listen on 443 (so this cannot be a server for an HTTPS web 
site - if a user points their browser to https://yourstunnelserver.com stunnel will not understand
the HTTPS request and will discard it). 
We can use stunnel on any port that we want, but communicating between stunnel clients 
and servers on port 443 allows us to disguise arbitrary traffic (HTTP, HTTPS, SSH, database, 
etc.) as legitimate HTTPS. </p>
<p>This is very useful if we have a firewall that is actively inspecting
the type of traffic inside of packets, and dropping packets with particular protocols like 
SSH or OpenVPN. By wrapping that traffic in an SSL layer, there is no way for the 
firewall to inspect the contents of the packet, so it just looks like ordinary HTTPS traffic.
The firewall can't decrypt the packet contents, so it doesn't know if you are visiting 
your bank, checking your email, or sneaking SSH/OpenVPN traffic through the firewall. </p>
<p>(Note that other services like Iodine allow you to do similar things with other protocols,
like disguising network connections using encrypted DNS on port 53.)</p>
<p>Typically, stunnel is forwarding that traffic on to a local port, something like 8443. 
(The common scenario is if you have a service only exposed to LOCAL traffic from localhost or 127.0.0.1 
and not bound to an EXTERNAL ip address like 0.0.0.0). </p>
<p><a name="stunnel-server-resources"></a></p>
<h3>Charlesreid1.com Resources for Stunnel Servers</h3>
<p>The charlesreid1.com wiki has an extensive guide to setting up an Stunnel server: </p>
<ul>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/Server">charlesreid1.com/wiki/Stunnel/Server</a></p>
</li>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/Docker">charlesreid1.com/wiki/Stunnel/Docker</a> - wiki page detailing the use of Docker and Docker containers to run an stunnel server.</p>
</li>
</ul>
<p>The charlesreid1.com git server has several repositories with configuration files for setting up an stunnel server: </p>
<ul>
<li><a href="https://charlesreid1.com:3000/docker/d-stunnel">d-stunnel repository</a> - repo containing Docker configuration files, for creating a Docker container that runs an stunnel server.
    This repository contains example stunnel configuration files for running a number of different protocols over stunnel (ssh, http, and rsync).</li>
</ul>
<p><a name="stunnel-client"></a></p>
<h2>Setting Up an Stunnel Client</h2>
<p>Running an stunnel client requires installing stunnel and 
setting up a configuration file just like if you were setting up an Stunnel/Server, 
except swapping the accept and connect ports, since we want the client to accept local 
traffic (e.g., on port 8443) and send it on to the server that it connects to with SSL 
(e.g., on port 443).</p>
<p><a name="stunnel-client-resources"></a></p>
<h2>Charlesreid1.com Resources for Stunnel Clients</h2>
<p>The charlesreid1.com wiki has an extensive guide to setting up an Stunnel client: </p>
<ul>
<li><a href="https://charlesreid1.com/wiki/Stunnel/Client">charlesreid1.com/wiki/Stunnel/Client</a> - wiki page detailing the stunnel configuration process for stunnel servers.</li>
</ul>
<p>The charlesreid1.com git server has several repositories with configuration files for setting up an stunnel client: </p>
<ul>
<li>
<p><a href="https://charlesreid1.com:3000/mac/m-stunnel">m-stunnel repository</a> - stunnel configuration files for running an stunnel client on Mac OS X</p>
</li>
<li>
<p><a href="https://charlesreid1.com:3000/rpi/pi-stunnel">pi-stunnel repository</a> - stunnel configuration files for running an stunnel client on Raspberry Pi</p>
</li>
</ul>
<p><a name="stunnel-protocols"></a></p>
<h2>Example Protocols</h2>
<p>One of the most beautiful aspects of networking is that packets can be wrapped within other packets - 
so theoretically it can be packets all the way down. This allows us to use stunnel's SSL TCP wrappers to wrap
just about any traffic we want. This means we can run various services (encrypted or not) through stunnel,
including but not limited to:</p>
<ul>
<li>
<p>SSH (secure shell)</p>
</li>
<li>
<p>SCP (secure copy)</p>
</li>
<li>
<p>OpenVPN (virtual network)</p>
</li>
<li>
<p>Rsync (file transfer)</p>
</li>
<li>
<p>MongoDB (NoSQL database)</p>
</li>
<li>
<p>Redis (local-only NoSQL database)</p>
</li>
</ul>
<p>While stunnel has a few pre-configured services that it can deal with, 
users can also define their own custom protocols, over whatever port they please.</p>
<p>The charlesreid1.com wiki details stunnel configuration for all of the above protocols,
excepting MongoDB and redis. Here are links to pages specifying how to configure stunnel
for each protocol:</p>
<ul>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/SSH">SSH over stunnel</a></p>
</li>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/Scp">SCP over stunnel</a></p>
</li>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/HTTP">HTTP over stunnel</a></p>
</li>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/OpenVPN">OpenVPN over stunnel</a></p>
</li>
<li>
<p><a href="https://charlesreid1.com/wiki/Stunnel/Rsync">Rsync over stunnel</a></p>
</li>
</ul>
<p>The <a href="https://charlesreid1.com/wiki/Stunnel/Rsync">Rsync over stunnel</a> page, in particular,
details the steps needed to define your own custom protocol and have stunnel wrap it 
in an SSL layer <em>correctly</em>.</p>
<p><a name="stunnel-docker"></a></p>
<h2>Stunnel with Docker</h2>
<p>Docker is a useful way of managing services in a self-contained and reproducible manner.
Running stunnel through a Docker container is surprisingly easy: 
once you've installed stunnel into the docker container, you just need to map 
the incoming port (containing incoming encrypted traffic from the client, linked to the external network interface)
to the outgoing port (containing decrypted traffic from stunnel, linked to a local-only service on a closed port).</p>
<p>The charlesreid1.com wiki details how to create set up SSH over stunnel at the following page:
* <a href="https://charlesreid1.com/wiki/Stunnel/Docker">charlesreid1.com/wiki/Stunnel/Docker</a></p>
<p>The charlesreid1.com git server has an stunnel docker repository with configuration files
for running a Docker stunnel server, along with several example stunnel server configuration files
for handling protocols like rsync, ssh, and http:
* <a href="https://charlesreid1.com:3000/docker/d-stunnel">d-stunnel repository</a></p>
<p><a name="stunnel-troubleshooting"></a></p>
<h2>Troubleshooting Stunnel Connections</h2>
<p>In the <a href="https://charlesreid1.com:3000/docker/d-stunnel">d-stunnel repository</a> is a document called <code>DEBUGGING.md</code> 
that contains a number of techniques for debugging an stunnel connection. </p>
<p><a href="https://charlesreid1.com:3000/docker/d-stunnel/src/master/DEBUGGING.md">Here is the direct link to DEBUGGING.md</a>.</p>
<p>The techniques covered include:</p>
<ul>
<li>
<p>Configuring stunnel to run in the foreground (print log messages to console instead of to log file)</p>
</li>
<li>
<p>Configuring stunnel to output debugging information </p>
</li>
<li>
<p>Poking the stunnel server with telnet</p>
</li>
<li>
<p>Inspecting open ports with nmap</p>
</li>
<li>
<p>Watching <code>/var/log/syslog</code> for activity</p>
</li>
</ul>
<p>See <a href="https://charlesreid1.com:3000/docker/d-stunnel/src/master/DEBUGGING.md">DEBUGGING.md</a> for details.</p>
<p><a name="stunnel-refs"></a></p>
<h2>References</h2>
<ol>
<li>
<p>"Stunnel". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel">https://charlesreid1.com/wiki/Stunnel</a>&gt;</p>
</li>
<li>
<p>"Category: Stunnel". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Category:Stunnel">https://charlesreid1.com/wiki/Category:Stunnel</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Server". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Server">https://charlesreid1.com/wiki/Stunnel/Server</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Client". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Client">https://charlesreid1.com/wiki/Stunnel/Client</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Docker". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Docker">https://charlesreid1.com/wiki/Stunnel/Docker</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Certificates". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Certificates">https://charlesreid1.com/wiki/Stunnel/Certificates</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Rsync". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Rsync">https://charlesreid1.com/wiki/Stunnel/Rsync</a>&gt;</p>
</li>
<li>
<p>"Stunnel/SSH". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/SSH">https://charlesreid1.com/wiki/Stunnel/SSH</a>&gt;</p>
</li>
<li>
<p>"Stunnel/Scp". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/Scp">https://charlesreid1.com/wiki/Stunnel/Scp</a>&gt;</p>
</li>
<li>
<p>"Stunnel/OpenVPN". Charlesreid1.com wiki. 30 April 2017. 
&lt;<a href="https://charlesreid1.com/wiki/Stunnel/OpenVPN">https://charlesreid1.com/wiki/Stunnel/OpenVPN</a>&gt;</p>
</li>
</ol></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/stunnel.html">stunnel</a>
                    &nbsp;&nbsp;
                    <a href="/tag/ssl.html">SSL</a>
                    &nbsp;&nbsp;
                    <a href="/tag/encryption.html">encryption</a>
                    &nbsp;&nbsp;
                    <a href="/tag/ssh.html">SSH</a>
                    &nbsp;&nbsp;
                    <a href="/tag/networking.html">networking</a>
                    &nbsp;&nbsp;
                    <a href="/tag/openvpn.html">OpenVPN</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Traveling Schoolteacher Problem
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-30T13:00:00-07:00" pubdate>Sunday 04/30/2017</time>
                in 
                <a href="/category/java.html">Java</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/traveling-schoolteacher-problem.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#tstp-intro">The Traveling Schoolteacher Problem</a></li>
<li><a href="#tstp-math">The Mathematical Model</a></li>
<li><a href="#tstp-pseudocode">The Pseudocode</a> </li>
<li><a href="#tstp-java">The Java Code</a> <ul>
<li><a href="#tstp-classes">TSTP Class Fields and Methods</a> </li>
<li><a href="#tstp-base">Explore: Base Case</a> </li>
<li><a href="#tstp-recursive">Explore: Recursive Case</a> </li>
</ul>
</li>
<li><a href="#tstp-graphs">Example Graphs</a> </li>
<li><a href="#tstp-results">Results</a><ul>
<li><a href="#tstp-walltime-nodes">Walltime vs Number of Nodes</a></li>
</ul>
</li>
<li><a href="#tstp-conclusion">Conclusion</a></li>
<li><a href="#tstp-references">References</a></li>
</ul>
<p><a name="tstp-intro"></a></p>
<h2>The Traveling Schoolteacher Problem</h2>
<p>The Traveling Schoolteacher Problem (TSTP) is a variation on the Traveling Salesperson Problem (TSP).</p>
<p>The Traveling Schoolteacher Problem supposes a schoolteacher that is traveling from school to school
in order to give lessons at different schools. Being a poor schoolteacher, they are only able to afford an older car that gets bad mileage and has a small gas tank.</p>
<p>After visiting each school, the schoolteacher receives payment from the school, in the currency of <span class="math">\(P\)</span> gallons of gasoline. 
Different schools pay the teacher different amounts of gasoline, further complicating matters. The schoolteacher's car has a 
small gas tank that can only hold a maximum of <span class="math">\(M\)</span> gallons of gas, and the schoolteacher cannot travel with cans of gasoline. 
Any gasoline the schoolteacher receives above <span class="math">\(M\)</span> gallons of gas must be left behind. </p>
<p>Traveling from a source node to a target node incurs a cost of <span class="math">\(C\)</span> gallons of gas, deducted from the gas tank's total at the source node.</p>
<p>In an attempt to minimize losses and avoid running out of gas, the traveling schoolteacher must plan out a route 
that both avoids running out of gas and minimizes the total distance traveled.</p>
<p><a name="tstp-math"></a></p>
<h2>The Mathematical Model</h2>
<p>To represent this problem in the computer, we can use a graph - just like the Traveling Salesperson Problem solution - but modified a bit. Like the TSP, we can also solve the Traveling Schoolteacher Problem with recursive backtracking.</p>
<p>Each edge will represent a cost in gas, and each school arrived at will result in a payment in gas. Thus, the "real cost" of an edge will change depending on the state of the gas tank and the path taken to arrive there. </p>
<p>We can add a number to each node to represent the amount of gas that that school pays the schoolteacher.
We can use a number in each edge to represent the amount of gas that it costs to travel from one school to another.
The backtracking solution will explore various paths through teh graph, keeping track of the gas tank's running total and rejecting any paths that lead to an empty gas tank.</p>
<p><a name="tstp-pseudocode"></a></p>
<h2>The Pseudocode</h2>
<p>Revisiting the original Traveling Salesperson Problem, the recursive backtracking method we implemented was described with the following pseudocode:</p>
<div class="highlight"><pre><span></span>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        if current distance is greater than current minimum:
            skip
        else:
            for neighbor in unvisited neighbors:
                visit neighbor
                explore(new_neighbors)
                unvisit neighbor
</pre></div>


<p>To modify this to solve the Traveling Schoolteacher Problem, we want to make a few additions:</p>
<ul>
<li>Check if the gas tank is empty, and if so, don't explore this path</li>
<li>Check if the current distance is greater than our current minimum-distance path through the graph</li>
<li>Add gas from each school to the gas tank (up to the tank's maximum), subtract gas from each path from the gas tank</li>
</ul>
<p>This results in the following pseudocode:</p>
<div class="highlight"><pre><span></span>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        if gas tank is below empty:
            skip
        if current distance is greater than current minimum:
            skip
        else:
            add gas from this school to gas tank
            for neighbor in unvisited neighbors:
                visit neighbor
                deduct gas to get to neighbor from gas tank

                explore(new_neighbors)

                unvisit neighbor
                add gas back into gas tank
</pre></div>


<p>Once you have a backtracking algorithm for the original Traveling Salesperson Problem TSP, it's quite easy to make the few modifications required to solve the Traveling Schoolteacher Problem TSTP.</p>
<p><a name="tstp-java"></a></p>
<h2>The Java Code</h2>
<p>The Java code to solve the TSTP is organized into several classes:</p>
<ul>
<li>TSTP class - implements the recursive backtracking solution method, and owns temporary variables used by backtracking.</li>
<li>Node class - the Node is a lightweight class that stores an integer, representing the amount of gas this school pays the teacher. (Note, Node stores no links. Graph links handled by Guava.)</li>
<li>Edge class - the Edge class is a lightweight class that stores an integer for each edge, representing the amount of gas this path costs to travel.</li>
<li>RandomNodeGraph - a static class that builds random graphs with nodes and edges pre-populated with values. Parameters like connectivity and maximum gas tank capacity can be passed to introduce variation and ensure the graph is solvable (or not).</li>
</ul>
<p><a name="tstp-classes"></a></p>
<h3>TSTP Class Fields and Methods</h3>
<p>The TSTP class implements several fields to store the graph, and to store temporary information about the current solution during recursive backtracking (such that it is accessible by each instance of the recursive method). </p>
<p>The class stores the current route in an integer array, along with the current path distance, the current minimum distance, and the current state of the gas tank.</p>
<p>The TSTP class has a public <code>solve()</code> method, which calls a private recursive backtracking <code>explore()</code> method to solve the problem. </p>
<p>The recursive method will have a base case and a recursive case.</p>
<ul>
<li>
<p>The <strong>base case</strong> is that we have visited all cities on the graph. Check if this is a new solution, and if so, save it.</p>
</li>
<li>
<p>In the <strong>recursive case</strong>, we explore all solutions possible starting at the current node (passed in as a parameter), having already made N choices (passed in as a parameter). We do this by making a choice (and marking the node as visited), then exploring the consequences (through a recursive call), then unmaking the choice (rmarking the node as unvisited).</p>
</li>
</ul>
<p>Here is the explore method header:</p>
<div class="highlight"><pre><span></span>    /** Recursive backtracking method: 
        explore possible solutions starting 
        at this node, having made nchoices */
    public void explore(Node node, int nchoices) {
</pre></div>


<p><a name="tstp-base"></a></p>
<h3>Explore: Base Case</h3>
<p>The base case begins by checking if the minimum distance has been set, and if so, whether the current distance is larger than the minimum distance. If so, this route is abandoned; otherwise, we have a new solution.</p>
<div class="highlight"><pre><span></span>        if(nchoices == graphSize) {
            // 
            // BASE CASE
            //
            if(this.this_distance &lt; this.min_distance || this.min_distance &lt; 0) {
                this.min_distance = this.this_distance;
                printSolution();
            } else {
                printFailure();
            }

        } else {
</pre></div>


<p><a name="tstp-recursive"></a></p>
<h3>Explore: Recursive Case</h3>
<p>Next, the recursive case will explore each of the possible choices open to it by iterating over each choice available at a node, and for each node, choosing it, exploring the results, and unchoosing it. </p>
<div class="highlight"><pre><span></span>        } else {
            //
            // RECURSIVE CASE
            //  
            if(this.gas_tank &lt;= 0) {
                // Bummer, man.
                return;
            }
            if(this.min_distance &gt; 0 &amp;&amp; this.this_distance &gt; this.min_distance) {
                // Give up, there&#39;s no hope.
                return;
            }

            // Now the teacher teaches,
            // Now the teacher gets some gas. 
            // If the tank is full...  bummer, man.
            this.gas_tank += Math.min(this.tankSize, this.gas_tank + node.pay);

            // For each neighbor:
            Set&lt;Node&gt; neighbors = graph.adjacentNodes(node);
            for(Node neighbor : neighbors) {
                if(neighbor.visited == false) {

                    int distance_btwn = -10000;

                    // Using a for loop, 
                    // but there should only be one edge.
                    for( Edge edge : graph.edgesConnecting(node, neighbor) ) {
                        distance_btwn = edge.cost;
                    }

                    // Make a choice
                    this.route[nchoices] = neighbor.id;
                    neighbor.visit();
                    this.this_distance += distance_btwn;

                    // Explore the consequences
                    explore(neighbor,nchoices+1);

                    // Unmake the choice
                    this.route[nchoices] = -1;
                    neighbor.unvisit();
                    this.this_distance -= distance_btwn;
                }
                // Move on to the next choice (continue loop)
            }               
        } // End base/recursive case
    }
</pre></div>


<p><a name="tstp-graphs"></a></p>
<h2>Example Graphs</h2>
<p>Just so you can see what they look like, here are a couple of graphs 
generated for the traveling schoolteacher problem:</p>
<p><img src="/images/graphviz_tstp_6.png" width="400px" /></p>
<p><img src="/images/graphviz_tstp_8.png" width="400px" /></p>
<p><img src="/images/graphviz_tstp_12.png" width="400px" /></p>
<p><a name="tstp-results"></a></p>
<h2>Results</h2>
<p><a name="tstp-walltime-nodes"></a></p>
<h3>Walltime vs. Number of Nodes</h3>
<p>The following is a plot of walltime versus number of nodes:</p>
<p><img src="/images/tstp-java-scaling.png" width="500px" /></p>
<p>This plot shows that the traveling schoolteacher problem 
is solved faster than the traveling salesperson problem.
This makes sense - for a given city, many of the possible routes can be
eliminated from the list of routes to explore, due to the additional constraint
of the gas tank needing to remain full. If there are only 2 gallons of gas 
in the tank, this constrains the choices of nodes to explore to those 
requiring 2 gallons of gas or less.</p>
<p>This is particularly true for the scenario used when generating the above graph - 
the constraint of the gas tank size is used to construct an "interesting" graph
tand ensure that we don't end up with a graph where the traveling schoolteacher 
gets "stuck" somewhere without enough gas to continue. Here is the relevant section
of the <code>RandomNodeGraph.java</code> class. </p>
<p>The <code>getNextCost()</code> method generates a random edge
between two cities, with a <span class="math">\(\frac{T}{T+1}\)</span> percent chance of it being impossible for the 
teacher to travel that route due to a gas tank that's too small:</p>
<div class="highlight"><pre><span></span>    private static int getNextCost(int T) {
        Random r = new Random();
        return 1+r.nextInt(T);
    }
</pre></div>


<p>Likewise, here is the <code>getNextPay()</code> method, which generates a random 
amount of pay (in gas) that the </p>
<div class="highlight"><pre><span></span>    private static int getNextPay(int T) {
        Random r = new Random();
        return (int)(0.5*T + 0.5*(r.nextInt(T)+1));
    }
</pre></div>


<p>Here is a link to the full <code>RandomNodeGraph.java</code> file on the charlesreid1.com git server, 
contained in the <code>tsp</code> repository (which has several codes related to the traveling salesperson problem):
<a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/schoolteacher-guava/RandomNodeGraph.java">https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava/RandomNodeGraph.java</a></p>
<p>And here is a link to the <code>tsp</code> repository on the same charlesreid1.com git server:
<a href="https://charlesreid1.com:3000/charlesreid1/tsp/src/master/schoolteacher-guava">https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava</a></p>
<p>In a city with 10 routes connecting to other cities, having edges that the schoolteacher
cannot travel, or nodes that limit the amount of gas the schoolteacher receives, 
can constrain the number of possible routes and reduce the number of routes that need to be 
explored. The methods above ensure that this will not happen very often, but that it will happen
some of the time. These routes that can be eliminated can lead to a significant reduction
in computational time.</p>
<p><a name="tstp-conclusion"></a></p>
<h2>Conclusion</h2>
<p>This project shows how easy it is to utilize the Guava library to solve computational problems
in Java and create computing benchmarks and graphs of scaling behavior. The original code to 
solve the traveling salesperson problem using recursive backtracking was fairly straightforward to 
implement on a graph, and extending this code to implement additional constraints and solve the 
traveling schoolteacher problem was surprisingly easy to do. </p>
<p>Fitting the scaling behavior to a line and computing the slope would make the scaling study
more quantitative, and needs to be done, but unfortunately the Google Sheets tool does not have 
this capability, so this information will be done with Python (scipy linear algebra package)
and comparisons between the TSP and TSTP slopes will be added later.</p>
<p><a name="tstp-references"></a></p>
<h2>References</h2>
<ol>
<li>
<p>"tsp (git repository)." Charles Reid. Modified 7 April 2017. Accesssed 30 April 2017.
&lt;<a href="https://charlesreid1.com:3000/charlesreid1/tsp">https://git.charlesreid1.com/charlesreid1/tsp</a>&gt;</p>
</li>
<li>
<p>"Solving the Traveling Salesperson Problem with Java and Guava." Charles Reid. 23 March 2017. Accessed 30 April 2017.
&lt;<a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html</a>&gt;</p>
</li>
<li>
<p>"Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts." Charles Reid. 1 April 2017. Accessed 30 April 2017.
&lt;<a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="/tag/guava.html">guava</a>
                    &nbsp;&nbsp;
                    <a href="/tag/graph.html">graph</a>
                    &nbsp;&nbsp;
                    <a href="/tag/tsp.html">TSP</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">
            <a class="prev" href="/index2.html">&larr; Older</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="/internet-service-providers-and-the-fbi-in-seattle.html">Internet Service Providers and the FBI in Seattle</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>








<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>
<!--
<script type="text/javascript" src="/theme/js/leaflet-0.7.3.js"></script>
<script type="text/javascript" src="/theme/js/leaflet.ajax.min.js"></script>
--><footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="http://d3js.org">D3.js</a>, <a href="http://angular.io">Angular.js</a>, and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

</footer><!-- /#contentinfo -->

<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/jquery_load_template-1.4.5.min.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

</footer><!-- /#contentinfo -->
</body>
</html>