<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <!--
        <link href="/theme/css/cyborg.css"          rel="stylesheet" type="text/css">
        <link href="/theme/css/cosmo.css"           rel="stylesheet" type="text/css">
        <link href="/theme/css/sandstone.css"       rel="stylesheet" type="text/css">
        -->
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>


        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <!--
            http://www.w3schools.com/bootstrap/bootstrap_case_navigation.asp
            -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="/" class="navbar-brand">charlesreid1.com</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/projects">Projects</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Research Blog</a>
                    </li>
                    <li>
                        <a href="http://git.charlesreid1.com/explore">git.charlesreid1.com</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/contact">Contact Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>


<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com research<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Python vs. Perl: N Queens Problem
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-25T20:00:00-07:00" pubdate>Saturday 03/25/2017</time>
                in 
                <a href="/category/computer-science.html">Computer Science</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/python-vs-perl-n-queens-problem.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>TOC</h2>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#nqueens">N Queens Revisited</a></li>
<li><a href="#perlsoln">Perl Solution</a></li>
<li><a href="#pythonsoln">Python Solution</a></li>
<li><a href="#h2hnqueens">Python vs. Perl: Walltime vs. Number of Queens</a></li>
<li><a href="#perlprof">Perl Profiling and Results</a></li>
<li><a href="#pythonprof">Python Profiling</a></li>
<li><a href="#pythonprofresults">Python Profiling Results</a></li>
<li><a href="#pythonperl">Comparing Python to Perl</a></li>
<li><a href="#h2hops">Python vs. Perl: Walltime vs. Number of Solutions Tested</a></li>
<li><a href="#winner">The Winner: Perl for Small Problems, Python for Big Ones</a></li>
<li><a href="#sources">Sources</a></li>
</ul>
<h2>Summary</h2>
<p><a name="background"></a></p>
<h2>Background</h2>
<p>Revisiting the N queens problem, this time implementing the solution in Python.</p>
<p>Verb-oriented solution, functional, and based on Perl solution</p>
<p>More fair comparison - both are interpreted languages, not compiled languages</p>
<p>Compare Python and Perl, ease of implementation, speed, flexibility</p>
<p><a name="nqueensproblem"></a></p>
<h2>N Queens Problem</h2>
<p>As a recap from the last post about the N queens problem, we're solving a chess puzzle that asks:
how many different configurations are there for placing <span class="math">\(N\)</span> queens on an <span class="math">\(N \times N\)</span> chessboard
such that no queen attacks any other queen?</p>
<p>This is a popular problem in computer science because solutions often implement recursive backtracking.</p>
<p>See <a href="https://en.wikipedia.org/wiki/N_Queens_Problem">the Wikipedia article</a> for details.</p>
<p><a name="nqueenssoln"></a></p>
<h2>N Queens Solution</h2>
<p>Here is the pseudocode of the N queens solution being implemented here:</p>
<div class="highlight"><pre><span></span>explore(column):
    if last column:
        # base case
        add to solutions
    else:
        # recursive case
        for each row:
            if this is a safe row:
                place queen on this row
                explore(column+1)
                remove queen from this row
</pre></div>


<p>This solution implements recursive backtracking to explore choices of where to place each queen.
It keeps solutions simple, and can be implemented using only primitive built-in data types.
Solutions are stringified version of these arrays, consisting of 8 digits, so they are likewise very simple.</p>
<p><a name="perlsoln"></a></p>
<h3>Perl Solution</h3>
<p>As a reminder, the Perl solution was originally from <a href="http://rosettacode.org/wiki/N-queens_problem#Perl">Rosetta Code</a>.
Here's another link to the Perl solution on Github.</p>
<p><a href="https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535">Github gist: nqueens.pl</a></p>
<p><a name="pythonsoln"></a></p>
<h3>Python Solution</h3>
<p>The solution requires the use of one array of data that is fixed in size,
which for a given column stores a list of rows already occupied by queens, 
and one array of data that is variable in size, which stores where each queen has been placed.</p>
<p>The Python solution makes use of lists by using a fixed-size list for the occupied rows
and a variable size list for storing queen locations. 
It utilizes buit-in methods for the list data type to append and pop, or add and remove items from the end of the list.</p>
<p><a href="https://gist.github.com/charlesreid1/1a2ecb3a83284290d4a9daf747d0d7e4">Github gist: nqueens.py</a></p>
<p><a name="h2hnqueens"></a></p>
<h2>Head to Head: Walltime vs. Number of Queens</h2>
<p><img alt="Graph of walltime versus number of queens" src="/images/python-vs-perl-nqueens.png"></p>
<div class="highlight"><pre><span></span>----------------------------------------------------------
| NQueens | Nsolutions | Java      | Perl     | Python   |
|---------|------------|-----------|----------|----------|
| 8       | 92         | 0.003628  | 0.016    | 0.018    |
| 9       | 352        | 0.006709  | 0.067    | 0.077    |
| 10      | 724        | 0.017473  | 0.259    | 0.359    |
| 11      | 2680       | 0.061291  | 1.542    | 1.684    |
| 12      | 14200      | 0.240463  | 8.431    | 8.618    |
| 13      | 73712      | 1.113491  | 48.542   | 50.401   |
| 14      | 365596     | 6.557336  | 303.278  | 322.576  |
| 15      | 2279184    | 42.619426 | 2057.052 | 1979.343 |
----------------------------------------------------------
</pre></div>


<p>The results of this test show that Python and Perl
are fairly closely matched.</p>
<p><a name="perlprof"></a></p>
<h2>Perl Profiling</h2>
<p>Results of profiling the Perl code with <code>Devel::NYTProf</code> were detailed in a prior post.</p>
<p>Here are those results once again,
for the 11 queens problem:</p>
<div class="highlight"><pre><span></span><span class="c1"># Profile data generated by Devel::NYTProf::Reader</span>
<span class="c1"># Version: v6.04</span>
<span class="c1"># More information at http://metacpan.org/release/Devel-NYTProf/</span>
<span class="c1"># Format: time,calls,time/call,code</span>
<span class="mf">0.000238</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000119</span><span class="p">,</span><span class="k">use</span> <span class="nn">Time::HiRes</span> <span class="sx">qw(time)</span><span class="p">;</span>
<span class="mf">0.000039</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000019</span><span class="p">,</span><span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="mf">0.000491</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000246</span><span class="p">,</span><span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
<span class="mf">0.000021</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000021</span><span class="p">,</span><span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="nb">time</span><span class="p">;</span>
<span class="mf">0.010338</span><span class="p">,</span><span class="mi">2680</span><span class="p">,</span><span class="mf">0.000004</span><span class="p">,</span><span class="nb">push</span> <span class="nv">@solutions</span><span class="p">,</span> <span class="s">&quot;@queens\n&quot;</span><span class="p">;</span>
<span class="mf">0.009993</span><span class="p">,</span><span class="mi">2680</span><span class="p">,</span><span class="mf">0.000004</span><span class="p">,</span><span class="k">return</span><span class="p">;</span>
<span class="mf">0.186298</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$#attacked</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$board_size</span><span class="p">;</span>
<span class="mf">0.150338</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="k">for</span><span class="p">(</span> <span class="mi">0</span> <span class="o">..</span> <span class="nv">$#queens</span><span class="p">)</span> <span class="p">{</span> 
<span class="mf">0.675523</span><span class="p">,</span><span class="mf">1.26035e+06</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$attacked</span><span class="p">[</span> <span class="nv">$ix2</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="mf">1.242624</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000008</span><span class="p">,</span><span class="k">for</span> <span class="k">my</span> <span class="nv">$row</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$board_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="mf">0.267469</span><span class="p">,</span><span class="mi">166925</span><span class="p">,</span><span class="mf">0.000002</span><span class="p">,</span><span class="n">explore</span><span class="p">(</span><span class="nv">$depth</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">0.125272</span><span class="p">,</span><span class="mi">166925</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$occupied</span><span class="p">[</span><span class="nv">$row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">0.000002</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000002</span><span class="p">,</span><span class="n">explore</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="mf">0.000011</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000011</span><span class="p">,</span><span class="k">my</span> <span class="nv">$duration</span> <span class="o">=</span> <span class="nb">time</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">;</span>
<span class="mf">0.000075</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000075</span><span class="p">,</span><span class="k">print</span> <span class="s">&quot;Found &quot;</span><span class="p">,</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@solutions</span><span class="p">),</span> <span class="s">&quot; solutions\n&quot;</span><span class="p">;</span>
<span class="mf">0.000050</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000050</span><span class="p">,</span><span class="nb">printf</span> <span class="s">&quot;Execution time: %0.3f s \n&quot;</span><span class="p">,</span><span class="nv">$duration</span><span class="p">;</span>
</pre></div>


<p><a name="pythonprof"></a></p>
<h2>Python Profiling</h2>
<p>The Python N queens solution was profiled with two tools: <code>cProfile</code> and <code>line_profiler</code>. </p>
<p>The built-in profiling tool <code>cProfile</code> gives a summary of how much time was spent in each method,
but nothing lower level than that. It is similar to Java profiling tools. <a href="https://docs.python.org/2/library/profile.html">(cProfile documentation)</a></p>
<p>The <code>line_profiler</code> tool is designed to profile Python code line-by-line, which gives a much more useful
breakdown of where the code spent all of its time. It is also helpful because this can be compared one-to-one
with the results from Perl, and we can get an equal basis for comparing the two languages.</p>
<p><a name="pythonprofresults"></a></p>
<h2>Python Profiling Results</h2>
<h3><code>cProfile</code> Results</h3>
<p>Here are the results from running the N queens problem for N = 11 through cProfile:</p>
<div class="highlight"><pre><span></span>**************************************
Profiling 11 queens problem with Python...
*******************************
cProfile:
*******************************
Found 2680 solutions
         996197 function calls (829272 primitive calls) in 2.237 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
 166926/1    1.845    0.000    2.237    2.237 /Volumes/noospace/Users/charles/codes/hello-world/python/nqueens/nqueens.py:12(explore)
   328492    0.275    0.000    0.275    0.000 {range}
   166925    0.062    0.000    0.062    0.000 {method &#39;pop&#39; of &#39;list&#39; objects}
   169605    0.029    0.000    0.029    0.000 {method &#39;append&#39; of &#39;list&#39; objects}
   164247    0.026    0.000    0.026    0.000 {len}
        1    0.000    0.000    2.237    2.237 /Volumes/noospace/Users/charles/codes/hello-world/python/nqueens/nqueens.py:4(&lt;module&gt;)
        1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
</pre></div>


<h3><code>line_profiler</code> Results</h3>
<p>The <code>line_profiler</code> tool gives a more detailed picture of the code and where it spends its time,
breaking down profiling information line-by-line. This tool can be installed with pip: <code>pip install line_profiler</code>.
The (INSERT LINK)(nqueens repository on github) has a file that demonstrates how to use this tool.
See <a href="https://charlesreid1.com/wiki/Python/Profiling">Python/Profiling</a></p>
<p>Here are the results from the <code>line_profiler</code> tool run on the same (11 queens) problem:</p>
<div class="highlight"><pre><span></span>**************************************
Profiling 11 queens problem with Python...
Found 2680 solutions
Wrote profile results to nqueens.py.lprof
Timer unit: 1e-06 s

Total time: 14.2258 s
File: nqueens.py
Function: explore at line 11

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
    11                                           @profile
    12                                           def explore(depth):
    13                                               # base case
    14    166926       187573      1.1      1.3      if(depth==board_size):
    15                                                   # stringify/serialize the solution
    16      2680        31497     11.8      0.2          solutions.append(&quot;%s&quot;%(queens))
    17      2680         3117      1.2      0.0          return
    18                                           
    19                                               else:
    20    164246       384688      2.3      2.7          attacked = 2*board_size*[0,]
    21   1424595      1690693      1.2     11.9          for i in range(0,len(queens)):
    22   1260349      1471304      1.2     10.3              ix1 = queens[i] + depth - i
    23   1260349      1405141      1.1      9.9              attacked[ix1] = 1
    24                                           
    25   1260349      1494095      1.2     10.5              ix2 = queens[i] - depth + i
    26   1260349      1392563      1.1      9.8              attacked[ix2] = 1
    27                                           
    28   1970952      2229922      1.1     15.7          for row in range(0,board_size):
    29   1806706      2031139      1.1     14.3              if(occupied[row] or attacked[row]):
    30    379432       374466      1.0      2.6                  continue
    31                                           
    32                                                       # make a choice
    33    166925       241114      1.4      1.7              queens.append(row)
    34    166925       186833      1.1      1.3              occupied[row] = 1
    35                                           
    36                                                       # explore the consequences
    37    166925       610396      3.7      4.3              explore(depth+1)
    38                                           
    39                                                       # unmake the choice
    40    166925       288667      1.7      2.0              queens.pop()
    41    166925       202555      1.2      1.4              occupied[row] = 0
</pre></div>


<p><a name="h2hopts"></a></p>
<h2>Python vs Perl: Walltime vs. Number of Solutions Tested</h2>
<p>As with the prior post, I verified that both codes were testing the same number of solutions.
Here is that table of the number of solutions for each value of N, together with the number of solutions tested:</p>
<div class="highlight"><pre><span></span>-----------------------------------------------------------------------------
| NQueens | Nsolutions | NsolutionsTested | Java      | Perl     | Python   |
|---------|------------|------------------|-----------|----------|----------|
| 8       | 92         | 1965             | 0.003628  | 0.016    | 0.018    |
| 9       | 352        | 8042             | 0.006709  | 0.067    | 0.077    |
| 10      | 724        | 34815            | 0.017473  | 0.259    | 0.359    |
| 11      | 2680       | 164246           | 0.061291  | 1.542    | 1.684    |
| 12      | 14200      | 841989           | 0.240463  | 8.431    | 8.618    |
| 13      | 73712      | 4601178          | 1.113491  | 48.542   | 50.401   |
| 14      | 365596     | 26992957         | 6.557336  | 303.278  | 322.576  |
| 15      | 2279184    | 168849888        | 42.619426 | 2057.052 | 1979.343 |
-----------------------------------------------------------------------------
</pre></div>


<p><img alt="Graph of walltime versus number of solutions tested" src="/images/python-vs-perl-ntested.png"></p>
<p><a name="winner"></a></p>
<h2>The Winner: Perl for Small Problems, Python for Big Ones</h2>
<p>It was not a big surprise to see that Perl and Python were nearly identical in their performance,
and it testament to the fact that interpreted scripting languages like Perl and Python operate at one speed,
and compiled code in C++ or Java operates at a completely different speed that is an order of magnitude faster 
(see the comparison of Perl and Java in a prior blog post).</p>
<p>Perl and Python were close enough in performance that, although Perl came out ahead on smaller problems
and Python came out ahead on the biggest, a different CPU or platform, micro-optimizations, and various butterfly effects 
could easily turn the tables. </p>
<h2>Sources</h2>
<ol>
<li>
<p>"N-Queens Problem". Rosetta Code, GNU Free Documentation License. Edited 6 March 2017. Accessed 21 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081421/http://rosettacode.org/wiki/N-queens_problem">https://web.archive.org/web/20170320081421/http://rosettacode.org/wiki/N-queens_problem</a>&gt;</p>
</li>
<li>
<p>"nqueens.py". Charles Reid. Github Gist, Github Inc. Edited 25 March 2017. Accessed 25 March 2017.
&lt;<a href="https://gist.github.com/charlesreid1/1a2ecb3a83284290d4a9daf747d0d7e4">https://gist.github.com/charlesreid1/1a2ecb3a83284290d4a9daf747d0d7e4</a>&gt;</p>
</li>
<li>
<p>"nqueens.pl". Charles Reid. Github Gist, Github Inc. Edited 20 March 2017. Accessed 23 March 2017.
&lt;<a href="https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535">https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535</a>&gt;</p>
</li>
<li>
<p>"The Python Profilers". Python 2.7.13 Documentation, Python Software Foundation. Updated 20 February 2017. Accessed 23 March 2017. 
&lt;<a href="https://docs.python.org/2/library/profile.html">https://docs.python.org/2/library/profile.html</a>&gt;</p>
</li>
<li>
<p>"line_profiler". Python Package Index, Python Software Foundation. Updated 20 October 2016. Accessed 23 March 2017.
&lt;<a href="https://pypi.python.org/pypi/line_profiler/">https://pypi.python.org/pypi/line_profiler/</a>&gt;</p>
</li>
<li>
<p>"Github - rkern/line_profiler". rkern, Github Repository, Github Inc. Updated 20 October 2016. Accessed 23 March 2017.
&lt;<a href="https://github.com/rkern/line_profiler">https://github.com/rkern/line_profiler</a>&gt;</p>
</li>
<li>
<p>"Python/Profiling". Charlesreid1.com wiki, Charles Reid. Edited 23 March 2017. Accessed 23 March 2017.
&lt;<a href="https://web.archive.org/web/20170326031708/http://charlesreid1.com/wiki/Python/Profiling">https://web.archive.org/web/20170326031708/http://charlesreid1.com/wiki/Python/Profiling</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="/tag/perl.html">perl</a>
                    &nbsp;&nbsp;
                    <a href="/tag/java.html">java</a>
                    &nbsp;&nbsp;
                    <a href="/tag/algorithms.html">algorithms</a>
                    &nbsp;&nbsp;
                    <a href="/tag/recursion.html">recursion</a>
                    &nbsp;&nbsp;
                    <a href="/tag/n-queens.html">n-queens</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Solving the Traveling Salesperson Problem with Java and Guava
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-23T11:00:00-07:00" pubdate>Thursday 03/23/2017</time>
                in 
                <a href="/category/java.html">Java</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/solving-the-traveling-salesperson-problem-with-java-and-guava.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#bkg">Background: Traveling Salesperson Problem (TSP)</a></li>
<li><a href="#graphs">Graphs</a><ul>
<li><a href="#nedges">Number of Edges</a></li>
</ul>
</li>
<li><a href="#bktk">Solution: Recursive Backtracking</a> </li>
<li><a href="#guava">Solving the TSP with Java and Guava</a> <ul>
<li><a href="#basic-guava">Basics of Guava</a></li>
<li><a href="#guava-graphs">Guava Graphs</a></li>
<li><a href="#guava-mutable-immutable">Guava Mutable vs Immutable</a></li>
<li><a href="#importing-guava">Importing Guava</a></li>
<li><a href="#tsp-class">TSP Class</a></li>
<li><a href="#node-class">Node Class</a></li>
<li><a href="#edge-class">Edge Class</a></li>
</ul>
</li>
<li><a href="#building-graph">TSP Constructor and Building the Graph</a><ul>
<li><a href="#constructor">Constructor</a></li>
<li><a href="#build-graph-method">Build Graph Method</a></li>
</ul>
</li>
<li><a href="#solving-exploring">Solving and Exploring with Recursive Backtracking</a><ul>
<li><a href="#solve">Solve Method</a></li>
<li><a href="#explore">Explore (Backtrack) Method</a></li>
</ul>
</li>
</ul>
<p><a name="bkg"></a></p>
<h2>Background: Traveling Salesperson Problem (TSP)</h2>
<p>The traveling salesperson problem, or TSP, is a classic programming problem and an important one in computer science,
and applications in operations research and optimization.</p>
<p>The idea is that you have a set of <span class="math">\(N\)</span> cities, connected by various roads, each with their own distances.
That is, we have a set of <span class="math">\(E\)</span> roads, each with their own distance <span class="math">\(d_j, j=1 \dots E\)</span>. </p>
<p>The question is, what is the shortest path that a salesperson can take to visit all <span class="math">\(N\)</span> cities, traveling the shortest possible total distance
and visiting each city once and only once?</p>
<p>Like the N queens problem, the traveling salesperson problem is a good candidate for recursive backtracking.
Also like the N queens problem, there are certain shortcuts we can take to trim down the possibilities we explore.</p>
<p><a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem">Wikipedia article for traveling salesman problem</a></p>
<p><a name="graphs"></a></p>
<h2>Graphs</h2>
<p>Graphs are mathematical objects first utilized by Leonhard Euler to solve the
<a href="https://en.wikipedia.org/wiki/Seven_Bridges_of_K%C3%B6nigsberg">Seven Bridges of Köningsberg</a> problem.
The concept is simple: you have a bunch of dots connected with lines.</p>
<p>The dots are called nodes, and the lines are called edges.</p>
<p>Graphs can be directed, meaning the edges are like arrows with particular directions, or undirected, 
meaning the edges simply represent a connection between the two nodes.</p>
<p>Here is an example of a graph with five nodes, with each edge labeled with its distance:</p>
<p><img style="background:#fff;" alt="A basic graph with five nodes" src="/images/basic-graph.png" /></p>
<p><a name="nedges"></a></p>
<h3>Number of Edges</h3>
<p>The maximum number of roads or edges <span class="math">\(E\)</span> depends on the number of nodes as <span class="math">\(E = \dfrac{N(N-1)}{2}\)</span>, which is derived from
the formula for 2 choose N (because edges connect 2 nodes). For k choose N, the formula is given by:</p>
<div class="math">$$
C_{N,k} = \dfrac{N!}{k! (N-k)!}
$$</div>
<p>and for 2 choose N, it is given by:</p>
<div class="math">$$
C_{N,2} = \dfrac{N(N-1)}{2}
$$</div>
<p>This is the maximum number of undirected edges in a graph. 
If the graph is directed, then order matters (the edgge <code>A-&gt;B</code> is no longer the same as <code>B-&gt;A</code>),
so we have to use the formula for k pick N, </p>
<div class="math">$$
P_{N,k} = \dfrac{N!}{(N-k}!}
$$</div>
<p>which results in</p>
<div class="math">$$
P_{N,2} = N (N-1)
$$</div>
<p>possible edges.</p>
<p><a name="nsolutions"></a></p>
<h3>Number of Solutions</h3>
<p>Naturally, the question of the total solution space arises.
Assuming the graph of cities is perfectly connected (representing an upper limit on problem complexity),
how does the number of solutions change as the number of nodes increases?</p>
<p>We can start with a trivial graph, and count the number of possible paths
through the entire graph, starting with a specific node.
This is equivalent to counting permutations of a string that start with a specific character.</p>
<div class="highlight"><pre><span></span>ABCDE
ABCED
ABDCE
ABDEC
ABECD
ABEDC
</pre></div>


<p>For a string of length <span class="math">\(N\)</span>, the string has <span class="math">\((N-1)!\)</span> possible permutations that start with a specific character.
Therefore, as the number of nodes <span class="math">\(N\)</span> increases, the number of possible solutions increases as <span class="math">\((N-1)!\)</span>, 
making the complexity class of the problem <span class="math">\(O(N!)\)</span>.</p>
<p><a name="bktk"></a></p>
<h2>Solution: Recursive Backtracking</h2>
<p>Here is pseudocode for a recursive backtracking method:</p>
<div class="highlight"><pre><span></span>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        for neighbor in unvisited neighbors:
            visit neighbor
            explore(new_neighbors)
            unvisit neighbor
</pre></div>


<p>Care is needed to prevent infinite loops in which the traveling salesperson goes back and forth between two cities.
As we traverse the graph, we can mark each node as visited, to ensure we don't revisit nodes and go in circles.</p>
<p>Nodes can be implemented as a <code>Node</code> object in Java, with each Node having a few characteristics:</p>
<ul>
<li>String label</li>
<li>Container of Node pointers pointing to neighbors</li>
<li>Boolean flag: have we visited this node already?</li>
</ul>
<p>Likewise, the graph edges can be represented using integers or doubles.</p>
<p><a name="guava"></a></p>
<h2>Solving the TSP with Java and Guava</h2>
<p><a href="https://github.com/google/guava">Google Guava</a> is a library of high-performance data containers in Java.
The library provides some useful graph objects that we can use to easily solve the TSP on a graph.</p>
<p><a name="basic-guava"></a></p>
<h3>Basics of Guava</h3>
<p>Install and use Guava by visiting the <a href="https://github.com/google/guava">Guava project on Github</a>, 
find the page for their latest release (<a href="https://github.com/google/guava/wiki/Release21">here is version 21.0</a>), 
and getting the latest <code>.jar</code> file.</p>
<p>To compile with the jar file, you can either utilize an IDE like <a href="http://www.eclipse.org/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ</a>,
or you can compile from the command line, specifying the class path using the <code>-cp</code> flag:</p>
<div class="highlight"><pre><span></span>$ javac -cp <span class="s1">&#39;.:/path/to/guava/jars/guava-21.0.jar&#39;</span> TSP.java
$ java -cp <span class="s1">&#39;.:/path/to/guava/jars/guava-21.0.jar&#39;</span> TSP
</pre></div>


<p>More information can be found on the charlesreid1.com wiki: <a href="https://charlesreid1.com/wiki/Guava">Guava</a></p>
<p><a name="guava-graphs"></a></p>
<h3>Guava Graphs</h3>
<p>Graph objects in Guava are implemented using a set of objects: Graphs, ValueGraphs, and Networks.</p>
<p>Graph objects treat edges as very simple and assumes they contain no information and simply link nodes. </p>
<p>ValueGraphs associate a single non-unique value with each edge on the graph. This can also be used to solve the TSP.</p>
<p>Network objects treat nodes and edges both as objects, and has the ability to deal with more complex edges: model multi-edges, repeated edges, directed edges, etc.</p>
<p>We will use a Network object and design our own graph Node and Edge objects.</p>
<p><a href="https://github.com/google/guava/wiki/GraphsExplained#building-graph-instances">Link to Guava wiki on how to build graph instances</a></p>
<p><a href="http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/graph/Network.html">Guava API Documentation: Network</a></p>
<p><a href="http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/graph/Graph.html">Guava API Documentation: Graph</a></p>
<p><a href="http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/graph/ValueGraph.html">Guava API Documentation: ValueGraph</a></p>
<p><a name="guava-mutable-immutable"></a></p>
<h3>Guava Mutable vs Immutable</h3>
<p>Guava makes a distinction between mutable graphs, which can be modified, and immutable graphs, which cannot.
Immutability provides some safety and assurances to programmers, and can make things faster.</p>
<p>When we construct the network, we need a mutable graph to modify (add nodes and edges). 
But once the network is constructed, it is finished: we don't need to modify the network while we're solving the problem.</p>
<p>Therefore, we construct a mutable network, assemble the graph for the given problem, and copy it into an immutable graph.
We then use the immutable graph to access the graph while solving.</p>
<p><a name="importing-guava"></a></p>
<h3>Importing Guava</h3>
<p>Starting with import statements, we'll use a couple of objects from the Java API, and from Google's Guava library:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.TreeMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.graph.Network</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.graph.NetworkBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.graph.ImmutableNetwork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.graph.MutableNetwork</span><span class="o">;</span>
</pre></div>


<p>For more info on why we don't just do the lazier</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.graph.*</span><span class="o">;</span>
</pre></div>


<p>see <a href="https://google.github.io/styleguide/javaguide.html">Google's Java style guide</a>.</p>
<p><a name="tsp-class"></a></p>
<h3>TSP Class</h3>
<p>Let's lay out the TSP class definition. This class is simple, and wraps a few pieces of data:
the current route, the current distance, and the minimum distance.
Note that we could also save the solution in a container, instead of printing it,
by defining a static class to hold solutions, but we'll keep it simple.</p>
<div class="highlight"><pre><span></span><span class="cm">/** This class solves the traveling salesman problem on a graph. */</span>
<span class="kd">class</span> <span class="nc">TSP</span> <span class="o">{</span>
    <span class="c1">// The actual graph of cities</span>
    <span class="n">ImmutableNetwork</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">graph</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">graphSize</span><span class="o">;</span>

    <span class="c1">// Storage variables used when searching for a solution </span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">route</span><span class="o">;</span>         <span class="c1">// store the route</span>
    <span class="kt">double</span> <span class="n">this_distance</span><span class="o">;</span>   <span class="c1">// store the total distance</span>
    <span class="kt">double</span> <span class="n">min_distance</span><span class="o">;</span>    <span class="c1">// store the shortest path found so far</span>

    <span class="cm">/** Defaut constructor generates the graph and initializes storage variables */</span>
    <span class="kd">public</span> <span class="nf">TSP</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>

    <span class="cm">/** This method actually constructs the graph. */</span>
    <span class="kd">public</span> <span class="n">ImmutableNetwork</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="nf">buildGraph</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>

    <span class="cm">/** Public solve method will call the recursive backtracking method to search for solutions on the graph */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">solve</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>

    <span class="cm">/** Recursive backtracking method: explore possible solutions starting at this node, having made nchoices */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">explore</span><span class="o">(</span><span class="n">Node</span> <span class="n">node</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nchoices</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>

    <span class="cm">/** Print out solution */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printSolution</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>

    <span class="cm">/** Print out failed path */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printFailure</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO</span>
    <span class="o">}</span>
</pre></div>


<p><a name="node-class"></a></p>
<h3>Node Class (Cities)</h3>
<p>Now we can define the Node class to represent cities on the graph.</p>
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Node</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">label</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">visited</span><span class="o">;</span> <span class="c1">// Helps us to keep track of where we&#39;ve been on the graph</span>
    <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">label</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">visited</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">visited</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unvisit</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">visited</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Like a lined list node, we want to keep graph nodes simple. 
Note that Nodes don't need to store information about their neighbors.
That's what we'll use Google Guava for!</p>
<p><a name="edge-class"></a></p>
<h3>Edge Class (Roads)</h3>
<p>Edge classes are even simpler, wrapping a single integer:</p>
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Edge</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">;</span> <span class="c1">// For convenience in construction process. Not necessary.</span>
    <span class="kd">public</span> <span class="nf">Edge</span><span class="o">(</span><span class="n">String</span> <span class="n">left</span><span class="o">,</span> <span class="n">String</span> <span class="n">right</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Note that left and right are used for convenience only during the graph construction process.
Like the nodes, the edges don't need to know who their neighbors are, 
since that's what the Google Guava graph object will take care of.</p>
<p><a name="building-graph"></a></p>
<h2>TSP Constructor and Building the Graph</h2>
<p><a name="constructor"></a></p>
<h3>Constructor</h3>
<p>The TSP class constructor should do a few things:</p>
<ul>
<li>Construct a graph, with a given set of cities and distances.</li>
<li>Initialize arrays and cumulative variables that will be used by the backtracking method.</li>
</ul>
<p>The actual graph construction process is put into another function called <code>buildGraph()</code>,
so really the constructor just calls a function and then does #2.</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** Defaut constructor generates the graph and initializes storage variables */</span>
    <span class="kd">public</span> <span class="nf">TSP</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Build the graph</span>
        <span class="k">this</span><span class="o">.</span><span class="na">graph</span> <span class="o">=</span> <span class="n">buildGraph</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">graphSize</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">graph</span><span class="o">.</span><span class="na">nodes</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>

        <span class="c1">// Initialize route variable, shared across recursive method instances</span>
        <span class="k">this</span><span class="o">.</span><span class="na">route</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="na">graphSize</span><span class="o">];</span>

        <span class="c1">// Initialize distance variable, shared across recursive method instances</span>
        <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">;</span> <span class="c1">// negative min means uninitialized</span>
    <span class="o">}</span>
</pre></div>


<p><a name="build-graph-method"></a></p>
<h3>Build Graph Method</h3>
<p>Now we actually use Guava's Immutable Network object,
which takes two templated types, T1 and T2, 
which correspond to the node types and the edge types.</p>
<p>We use a NetworkBuilder object to build the Network 
(an example of the factory template).
This returns a MutableNetwork of Node and Edge objects,
which we can then connect up using some built-in methods.</p>
<p>Here are some built-in methods available for a MutableNetwork:</p>
<div class="highlight"><pre><span></span>    addEdge(node1, node2, edge)
    addNode(node1)
    removeEdge(edge)
    removeNode(node)
</pre></div>


<p>Now here is the construction of the graph, using the Google Guava library.
There are two loops here: one for cities, and one for edges.
In the loop over each city,we create a new node and add it to the graph.
To be able to easily retrieve the Nodes we have created, 
we also store references to the nodes in a map called <code>all_nodes</code>.</p>
<p>When we construct edges, we use the map of all nodes <code>all_nodes</code> to get references to the Node objects
that correspond to a label. That way, if an edge connects "A" with "B" at a distance of 24, 
we can turn "A" and "B" into references to the Node objects A and B.</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** This method actually constructs the graph. */</span>
    <span class="kd">public</span> <span class="n">ImmutableNetwork</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="nf">buildGraph</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// MutableNetwork is an interface requiring a type for nodes and a type for edges</span>
        <span class="n">MutableNetwork</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">roads</span> <span class="o">=</span> <span class="n">NetworkBuilder</span><span class="o">.</span><span class="na">undirected</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>

        <span class="c1">// Construct Nodes for cities,</span>
        <span class="c1">// and add them to a map</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">cities</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;A&quot;</span><span class="o">,</span><span class="s">&quot;B&quot;</span><span class="o">,</span><span class="s">&quot;C&quot;</span><span class="o">,</span><span class="s">&quot;D&quot;</span><span class="o">,</span><span class="s">&quot;E&quot;</span><span class="o">};</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">all_nodes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Node</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cities</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="c1">// Add nodes to map</span>
            <span class="n">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">(</span><span class="n">cities</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
            <span class="n">all_nodes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cities</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">node</span><span class="o">);</span>

            <span class="c1">// Add nodes to network</span>
            <span class="n">roads</span><span class="o">.</span><span class="na">addNode</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// Construct Edges for roads,</span>
        <span class="c1">// and add them to a map</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">distances</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;A:B:24&quot;</span><span class="o">,</span><span class="s">&quot;A:C:5&quot;</span><span class="o">,</span><span class="s">&quot;A:D:20&quot;</span><span class="o">,</span><span class="s">&quot;A:E:18&quot;</span><span class="o">,</span><span class="s">&quot;B:C:10&quot;</span><span class="o">,</span><span class="s">&quot;B:D:20&quot;</span><span class="o">,</span><span class="s">&quot;C:D:4&quot;</span><span class="o">,</span><span class="s">&quot;C:E:28&quot;</span><span class="o">,</span><span class="s">&quot;D:E:3&quot;</span><span class="o">};</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">all_edges</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">distances</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="c1">// Parse out (city1):(city2):(distance)</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">splitresult</span> <span class="o">=</span> <span class="n">distances</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">left</span> <span class="o">=</span> <span class="n">splitresult</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
            <span class="n">String</span> <span class="n">right</span> <span class="o">=</span> <span class="n">splitresult</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
            <span class="n">String</span> <span class="n">label</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">right</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">splitresult</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>

            <span class="c1">// Add edges to map</span>
            <span class="n">Edge</span> <span class="n">edge</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Edge</span><span class="o">(</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
            <span class="n">all_edges</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">label</span><span class="o">,</span> <span class="n">edge</span><span class="o">);</span>

            <span class="c1">// Add edges to network</span>
            <span class="n">roads</span><span class="o">.</span><span class="na">addEdge</span><span class="o">(</span><span class="n">all_nodes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="na">left</span><span class="o">),</span> <span class="n">all_nodes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="na">right</span><span class="o">),</span> <span class="n">edge</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// Freeze the network</span>
        <span class="n">ImmutableNetwork</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">,</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">frozen_roads</span> <span class="o">=</span> <span class="n">ImmutableNetwork</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">roads</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">frozen_roads</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>


<p><a name="recursive-backtracking"></a></p>
<h2>Solving and Exploring with Recursive Backtracking</h2>
<h3>Solve Method</h3>
<p>The structure of some recursive backtracking problems is to create a public and a private interface,
with the public interface taking no parameters or a single parameter that the user will know, 
and the private method taking a parameter specific to the implementation. That's the pattern we use here.</p>
<p>The solve method sets up the problem by picking a starting node (in this case, an arbitrary starting node).
It then gets a reference to that node on the graph, and calls the recursive <code>explore()</code> method,
which begins the recursive backtracking method.</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** Public solve method will call the recursive backtracking method to search for solutions on the graph */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">solve</span><span class="o">()</span> <span class="o">{</span>
        <span class="cm">/** To solve the traveling salesman problem:</span>
<span class="cm">         * Set up the graph, choose a starting node, then call the recursive backtracking method and pass it the starting node.</span>
<span class="cm">         */</span>

        <span class="c1">// We need to pass a starting node to recursive backtracking method</span>
        <span class="n">Node</span> <span class="n">startNode</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// Grab a node, any node...</span>
        <span class="k">for</span><span class="o">(</span> <span class="n">Node</span> <span class="n">n</span> <span class="o">:</span> <span class="n">graph</span><span class="o">.</span><span class="na">nodes</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">startNode</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// Visit the first node</span>
        <span class="n">startNode</span><span class="o">.</span><span class="na">visit</span><span class="o">();</span>

        <span class="c1">// Add first node to the route</span>
        <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">startNode</span><span class="o">.</span><span class="na">label</span><span class="o">;</span>

        <span class="c1">// Pass the number of choices made</span>
        <span class="kt">int</span> <span class="n">nchoices</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

        <span class="c1">// Recursive backtracking</span>
        <span class="n">explore</span><span class="o">(</span><span class="n">startNode</span><span class="o">,</span> <span class="n">nchoices</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>


<h3>Explore (Backtrack) Method</h3>
<p>And now, on to the recursive backtracking method.</p>
<p>The method takes as a parameter which node we are currently on and the number of cities we have visited.
As multiple explore methods choose different paths, they pass references to different node objects in the graph,
and they pass different values of <code>nchoices</code>. </p>
<p>The methods, when they do not encounter a solution, will choose a next node and call the explore method on it.
Each instance of the explore method marks nodes as visited or unvisited on the same shared graph object.
This allows instances of the function to share information about their choices with other instances of the function.</p>
<p>All recursive methods must consist of a base case and a recursive case:</p>
<p>Base case:
- We've visited as many cities as are on the graph.
- Check if this is a new solution (distance less than the current minimum).</p>
<p>Recursive case:
- Make a choice (mark node as visited, add city to route).
- Explore the consequences (recursive call).
- Unmake the choice (mark node as unvisited, remove city from route).
- Move on to next choice.</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** Recursive backtracking method: explore possible solutions starting at this node, having made nchoices */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">explore</span><span class="o">(</span><span class="n">Node</span> <span class="n">node</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nchoices</span><span class="o">)</span> <span class="o">{</span>
        <span class="cm">/**</span>
<span class="cm">         * Solution strategy: recursive backtracking.</span>
<span class="cm">         */</span>

        <span class="k">if</span><span class="o">(</span><span class="n">nchoices</span> <span class="o">==</span> <span class="n">graphSize</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// </span>
            <span class="c1">// BASE CASE</span>
            <span class="c1">//</span>
            <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// if this_distance &lt; min_distance, this is our new minimum distance</span>
                <span class="c1">// if min_distance &lt; 0, this is our first minimium distance</span>
                <span class="k">this</span><span class="o">.</span><span class="na">min_distance</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span><span class="o">;</span>
                <span class="n">printSolution</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">printFailure</span><span class="o">();</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//</span>
            <span class="c1">// RECURSIVE CASE</span>
            <span class="c1">//  </span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">neighbors</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">adjacentNodes</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Node</span> <span class="n">neighbor</span> <span class="o">:</span> <span class="n">neighbors</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">neighbor</span><span class="o">.</span><span class="na">visited</span> <span class="o">==</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>

                    <span class="kt">int</span> <span class="n">distance_btwn</span><span class="o">;</span>

                    <span class="k">for</span><span class="o">(</span> <span class="n">Edge</span> <span class="n">edge</span> <span class="o">:</span> <span class="n">graph</span><span class="o">.</span><span class="na">edgesConnecting</span><span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">neighbor</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
                        <span class="n">distance_btwn</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="c1">// Make a choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">label</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">visit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">+=</span> <span class="n">distance_btwn</span><span class="o">;</span>

                    <span class="c1">// Explore the consequences</span>
                    <span class="n">explore</span><span class="o">(</span><span class="n">neighbor</span><span class="o">,</span><span class="n">nchoices</span><span class="o">+</span><span class="mi">1</span><span class="o">);</span>

                    <span class="c1">// Unmake the choice</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="n">neighbor</span><span class="o">.</span><span class="na">unvisit</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">this_distance</span> <span class="o">-=</span> <span class="n">distance_btwn</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">// Move on to the next choice (continue loop)</span>
            <span class="o">}</span>               
        <span class="o">}</span> <span class="c1">// End base/recursive case</span>
    <span class="o">}</span>
</pre></div>


<h2>Main and Utility Methods</h2>
<p>Last but not least, add the method that actually calls the TSP object's solve method,
and define what to do when we encounter a new solution.
This program just prints out new solutions as they are found, 
but you could also add them to a map (map routes to distances),
or quietly keep track of the shortest path and not print it until the end.</p>
<div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TSP</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span> 
        <span class="n">TSP</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TSP</span><span class="o">();</span>
        <span class="n">t</span><span class="o">.</span><span class="na">solve</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>
</pre></div>


<p>Additionally, we may want to perform a certain action when we find a new minimum distance.
Note that this method may be called multiple times during the solution procedure.</p>
<div class="highlight"><pre><span></span>    <span class="cm">/** Print out solution */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printSolution</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;@@@@@@@@@@\tNEW SOLUTION\t&quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Route: &quot;</span><span class="o">+</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">route</span><span class="o">)</span>
                          <span class="o">+</span><span class="s">&quot;\tDistance: &quot;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">min_distance</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/** Do nothing with failed path */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printFailure</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Nope</span>
    <span class="o">}</span>
</pre></div>


<h2>Program Output</h2>
<p>In the construction of the graph, we defined our graph as:</p>
<div class="highlight"><pre><span></span><span class="n">String</span><span class="o">[]</span> <span class="n">distances</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;A:B:24&quot;</span><span class="o">,</span><span class="s">&quot;A:C:5&quot;</span><span class="o">,</span><span class="s">&quot;A:D:20&quot;</span><span class="o">,</span><span class="s">&quot;A:E:18&quot;</span><span class="o">,</span><span class="s">&quot;B:C:10&quot;</span><span class="o">,</span><span class="s">&quot;B:D:20&quot;</span><span class="o">,</span><span class="s">&quot;C:D:4&quot;</span><span class="o">,</span><span class="s">&quot;C:E:28&quot;</span><span class="o">,</span><span class="s">&quot;D:E:3&quot;</span><span class="o">};</span>
</pre></div>


<p>This is the graph that we're solving the TSP problem on.
Here are the results when the program is compiled and run:</p>
<div class="highlight"><pre><span></span>$ javac -cp <span class="s1">&#39;.:/Users/charles/codes/guava/jars/guava-21.0.jar&#39;</span> TSP.java

$ java -cp <span class="s1">&#39;.:/Users/charles/codes/guava/jars/guava-21.0.jar&#39;</span> TSP

@@@@@@@@@@  NEW SOLUTION    Route: <span class="o">[</span>A, B, C, D, E<span class="o">]</span>  Distance: <span class="m">41</span>.0
@@@@@@@@@@  NEW SOLUTION    Route: <span class="o">[</span>A, C, B, D, E<span class="o">]</span>  Distance: <span class="m">38</span>.0
@@@@@@@@@@  NEW SOLUTION    Route: <span class="o">[</span>A, E, D, C, B<span class="o">]</span>  Distance: <span class="m">35</span>.0
</pre></div>


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="/tag/guava.html">guava</a>
                    &nbsp;&nbsp;
                    <a href="/tag/graph.html">graph</a>
                    &nbsp;&nbsp;
                    <a href="/tag/tsp.html">TSP</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Perl vs. Java: N Queens Problem
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-22T22:00:00-07:00" pubdate>Wednesday 03/22/2017</time>
                in 
                <a href="/category/computer-science.html">Computer Science</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/perl-vs-java-n-queens-problem.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>TOC</h2>
<ul>
<li><a href="#background">Background: Huh?</a></li>
<li><a href="#nqueensproblem">N Queens Problem</a></li>
<li><a href="#nqueenssoln">N Queens Solution</a><ul>
<li><a href="#perlsoln">Perl Solution</a></li>
<li><a href="#javasoln">Java Solution</a></li>
</ul>
</li>
<li><a href="#h2hnqueens">Head to Head: Walltime vs. Number of Queens</a></li>
<li><a href="#perlprof">Perl Profiling</a></li>
<li><a href="#perlprofresults">Perl Profiling Results</a></li>
<li><a href="#javaprof">Java Profiling</a></li>
<li><a href="#javaprofresults">Java Profiling Results</a></li>
<li><a href="#h2hntested">Head to Head: Walltime vs. Number of Solutions Tested</a></li>
<li><a href="#applesoranges">Apples and Oranges</a></li>
<li><a href="#sources">Sources</a></li>
</ul>
<h2>Summary</h2>
<p><a name="background"></a></p>
<h2>Background: Huh?</h2>
<p>Recently I read an <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">(11 year old) article</a> 
by Steve Yegge entitled "Execution in the Kingdom of Nouns." In it, Steve describes the way that in Java, 
"Classes are really the only modeling tool Java provides you. 
So whenever a new idea occurs to you, you have to sculpt it or wrap it or smash at it until it becomes a thing, 
even if it began life as an action, a process, or any other non-'thing' concept."</p>
<p>The article inspired me to try on this verb-oriented mode of thinking in a more... active way. 
Prior experiences with OCaml were confusing, and Haskell continues to evade me,
so it was easier to dust off old Perl skills than learn enough Haskell or Ocaml to solve N queens problem.
Perl was the next-closest verb-oriented "scripting" language.</p>
<p>I was also familiar with the N queens problem, since I'm a programming instructor (I'll let you guess which language),
and it seemed like a nice problem for both noun-based and verb-based approaches. 
But it also meant I had to learn enough Perl to solve the N queens problem.</p>
<p>...or, use the <a href="http://rosettacode.org/wiki/N-queens_problem#Perl">Perl solution to the N queens problem from Rosetta Code</a>.</p>
<p>Right...</p>
<p>So here's the plan: study a verb-oriented implementation of this canonical, deceptively subtle programming problem in Perl; 
translate it into a verb-oriented Java program; and run the two head-to-head, using a profiler to understand the results.</p>
<p><a name="nqueensproblem"></a></p>
<h2>N Queens Problem</h2>
<p>The N queens problem predates computers - it's a chess puzzle that asks: how many ways can you place 8 queens on a chessboard
such that no queen can attack any other queen? </p>
<p>The number of possible configurations of queens on a chessboard is 64 pick 8, or</p>
<div class="math">$$
\dfrac{64!}{(64-8)!} = 64 \times 63 \times \dots \times 57 \times 56 = 9,993,927,307,714,560
$$</div>
<p>Or, just a whisker shy of 10 quadrillion (if a whisker is defined as 7 trillion). Here's that calculation in Python:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="kp">prod</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">64</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="mi">9993927307714560</span>
</pre></div>


<p>That's bigger than the net worth of most U.S. Presidents!</p>
<p>If we implemented a dumb brute-force solution that tested each of these configurations, we'd be waiting until the heat death of the universe.</p>
<p>Fortunately, as we place queens on the board we can check if it is an invalid placement, and rule out any configurations that would follow from that choice.
As long as we are making our choices in an orderly fashion, this enables us to rule out most of the nearly 10 quadrillion possibilities. 
If we place queens column-by-column and rule out rows where there are already queens, by keeping track of where queens have already been placed, 
we can reduce the number of possible rows by 1 with each queen placed. The first queen has 8 possible rows where it can be placed,
the second queen has 7 possible rows (excluding the row that the first queen was placed on), and so on. The number of possiblities is:</p>
<div class="math">$$
8! = 8 \times 7 \times \dots \times 2 \times 1 = 40,320
$$</div>
<p>A big improvement! Here's that calculation in Python:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">return</span> <span class="mi">1</span>
<span class="o">...</span>     <span class="k">else</span><span class="p">:</span>
<span class="o">...</span>         <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fact</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="mi">40320</span>
</pre></div>


<p>This still-large number of possibilities can be further reduced by using the same procedure, but checking for invalid rows based on the diagonal squares that each already-placed queen attacks.
This covers each precondition for a solved board, and allows the base case of the recursive backtracking method to be as simple as,
"If you've reached this point, you have a valid solution. Add it to the solutions bucket."</p>
<p>Now, let's get to the solution algorithm.</p>
<p><a name="nqueenssoln"></a></p>
<h2>N Queens Solution</h2>
<p>As a recap, we dusted off our Perl skills to utilize an N queens solution in Perl from <a href="http://rosettacode.org/wiki/N-queens_problem#Perl">Rosetta Code</a>.</p>
<p>Here's the pseudocode:</p>
<div class="highlight"><pre><span></span>explore(column):
    if last column:
        # base case
        add to solutions
    else:
        # recursive case
        for each row:
            if this is a safe row:
                place queen on this row
                explore(column+1)
                remove queen from this row
</pre></div>


<p>Both codes use integer arrays to keep track of where queens are placed. 
Solutions are stringified version of these arrays, consisting of 8 digits.</p>
<p><a name="perlsoln"></a></p>
<h3>Perl Solution</h3>
<p>After looking at the Rosetta Code solution for a (long) while and marking it up with comments to understand what it was doing, 
I decided it was precisely the kind of verb-oriented solution I wanted to test out to compare Perl and Java.
It uses no objects, but instead relies on fast built-in data structures (arrays), 
for loop expansion (only <code>for my $i (1 .. $N)</code>, no <code>for($i=1; $i&lt;=$N; $i++)</code>),
and basic integer math. The cost of solving the problem comes down to basic indexing and array access.</p>
<p>This is the kind of solution I imagine a human calculator like Alan Turing or John Von Neuman looking at, nodding, and saying, "Makes sense! (And by the way the answer is 92.)"</p>
<p><a href="https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535">Github gist: nqueens.pl</a></p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="c1"># Solve the N queens problem</span>
<span class="c1"># using recursive backtracking.</span>
<span class="c1"># </span>
<span class="c1"># Author: Charles Reid</span>
<span class="c1"># Date: March 2017</span>

<span class="c1"># Create an array to store solutions</span>
<span class="k">my</span> <span class="nv">@solutions</span><span class="p">;</span>

<span class="c1"># Create an array to store where queens have been placed</span>
<span class="k">my</span> <span class="nv">@queens</span><span class="p">;</span>

<span class="c1"># Mark the rows already used (useful for lookup)</span>
<span class="k">my</span> <span class="nv">@occupied</span><span class="p">;</span>

<span class="c1"># explore() implements a recursive, depth-first backtracking method</span>
<span class="k">sub</span> <span class="nf">explore</span> <span class="p">{</span> 
    <span class="c1"># Parameters:</span>
    <span class="c1">#   depth : this is the argument passed by the user</span>

    <span class="c1"># First argument passed to the function is $depth </span>
    <span class="c1"># (how many queens we&#39;ve placed on the board),</span>
    <span class="c1"># so use shift to pop that out of the parameters </span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$depth</span><span class="p">,</span> <span class="nv">@diag</span><span class="p">)</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="c1"># Explore is a recursive method,</span>
    <span class="c1"># so we need a base case and a recursive case.</span>
    <span class="c1">#</span>
    <span class="c1"># The base case is, we&#39;ve reached a leaf node,</span>
    <span class="c1"># placed 8 queens, and had no problems, </span>
    <span class="c1"># so we found a solution.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$depth</span><span class="o">==</span><span class="nv">$board_size</span><span class="p">)</span> <span class="p">{</span> 
        <span class="c1"># Here, we store the stringified version of @queens,</span>
        <span class="c1"># which are the row numbers of prior queens. </span>
        <span class="c1"># This is a global variable that is shared across</span>
        <span class="c1"># instances of this recursive function.</span>
        <span class="nb">push</span> <span class="nv">@solutions</span><span class="p">,</span> <span class="s">&quot;@queens\n&quot;</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># Mark the squares that are attackable, </span>
    <span class="c1"># so that we can cut down on the search space.</span>
    <span class="nv">$#diag</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$board_size</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span> <span class="mi">0</span> <span class="o">..</span> <span class="nv">$#queens</span><span class="p">)</span> <span class="p">{</span> 
        <span class="nv">$ix1</span> <span class="o">=</span> <span class="nv">$queens</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$depth</span> <span class="o">-</span> <span class="nv">$_</span> <span class="p">;</span>
        <span class="nv">$diag</span><span class="p">[</span> <span class="nv">$ix1</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nv">$ix2</span> <span class="o">=</span> <span class="nv">$queens</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$depth</span> <span class="o">+</span> <span class="nv">$_</span> <span class="p">;</span>
        <span class="nv">$diag</span><span class="p">[</span> <span class="nv">$ix2</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$row</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$board_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># Cut down on the search space:</span>
        <span class="c1"># if this square is already occupied</span>
        <span class="c1"># or will lead to an invalid solution,</span>
        <span class="c1"># don&#39;t bother exploring it.</span>
        <span class="k">next</span> <span class="k">if</span> <span class="nv">$occupied</span><span class="p">[</span><span class="nv">$row</span><span class="p">]</span> <span class="o">||</span> <span class="nv">$diag</span><span class="p">[</span><span class="nv">$row</span><span class="p">];</span>

        <span class="c1"># Make a choice</span>
        <span class="nb">push</span> <span class="nv">@queens</span><span class="p">,</span> <span class="nv">$row</span><span class="p">;</span>
        <span class="c1"># Mark the square as occupied</span>
        <span class="nv">$occupied</span><span class="p">[</span><span class="nv">$row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1"># Explore the consequences</span>
        <span class="n">explore</span><span class="p">(</span><span class="nv">$depth</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

        <span class="c1"># Unmake the choice</span>
        <span class="nb">pop</span> <span class="nv">@queens</span><span class="p">;</span>

        <span class="c1"># Mark the square as unoccupied</span>
        <span class="nv">$occupied</span><span class="p">[</span><span class="nv">$row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$board_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> 

<span class="n">explore</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="k">print</span> <span class="s">&quot;total &quot;</span><span class="p">,</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@solutions</span><span class="p">),</span> <span class="s">&quot; solutions\n&quot;</span><span class="p">;</span>
</pre></div>


<p><a name="javasoln"></a></p>
<h3>Java Solution</h3>
<p>Starting with the Rosetta Code solution in Perl, I translated the algorithm into Java, sticking as closely as possible to the Way of the Verb.
I replicated the solution in Java with a minimal amount of object-oriented-ness. 
A Board class simply wraps the same set of arrays and array manipulations that the Perl solution implements directly.
These constitute the lookahead check for safe places to put the queen. </p>
<p>The Java solution implements a static class containing a Linked List to store solutions. 
This is the only use of non-array objects and has a trivial impact on the solution walltime.</p>
<p><a href="https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535">Github gist: NQueens.java</a></p>
<p>(Verbatim code not included for length.)</p>
<p><a name="h2hnqueens"></a></p>
<h2>Head to Head: Walltime vs. Number of Queens</h2>
<p><img alt="Graph of walltime versus number of queens" src="/images/perl-vs-java-nqueens.png"></p>
<div class="highlight"><pre><span></span>-----------------------------------------------
| NQueens | Nsolutions | Java [s]  | Perl [s] |
|---------|------------|-----------|----------|
| 8       | 92         | 0.003     | 0.016    |
| 9       | 352        | 0.006     | 0.067    |
| 10      | 724        | 0.017     | 0.259    |
| 11      | 2680       | 0.061     | 1.542    |
| 12      | 14200      | 0.240     | 8.431    |
| 13      | 73712      | 1.113     | 48.542   |
| 14      | 365596     | 6.557     | 303.278  |
| 15      | 2279184    | 42.619    | 2057.052 |
-----------------------------------------------
</pre></div>


<p>Java smokes Perl.</p>
<p>Initially I was using the Unix <code>time</code> utility to time these two,
and it seemed to be close for smaller problem sizes (N=9 or smaller) - 
Perl would start up and run faster than Java, measured end-to-end.
But when you time the program by using timers built into the language, 
it removes some of the overhead from the timing comparisons,
and Java becomes the clear winner.</p>
<p>We can dig deeper and understand this comparison better by using some profiling tools.</p>
<p><a name="perlprof"></a></p>
<h2>Perl Profiling</h2>
<p>I profiled Perl with <code>Devel::NYTProf</code> , 
an excellent Perl module <a href="http://search.cpan.org/~timb/Devel-NYTProf-6.04/lib/Devel/NYTProf.pm">available here on Cpanm</a>.</p>
<p>More details about the profiling tools I used for Perl are on the charlesreid1 wiki at 
<a href="https://charlesreid1.com/wiki/Perl/Profiling">Perl/Profiling</a>. </p>
<p>To run with <code>Devel::NYTProf</code>, use `cpanm:</p>
<div class="highlight"><pre><span></span>$ cpanm Devel::NYTProf
</pre></div>


<p>Now you can run Perl with <code>Devel::NYTProf</code> by doing:</p>
<div class="highlight"><pre><span></span>$ perl -d:NYTProf nqueens.pl
</pre></div>


<p>This results in a binary output file called <code>nytprof.out</code> that can be processed with several 
NYTProf post-processing tools. Use the CSV file tool to begin with:</p>
<div class="highlight"><pre><span></span>$ nytprofcsv nytprof.out
</pre></div>


<p>This puts the CSV file in a folder called <code>nytprof/</code>.</p>
<p><a name="perlprofresults"></a></p>
<h2>Perl Profiling Results</h2>
<p>The CSV output of the NYTProf module gives a breakdown of 
the amount of time spent in each method call, how many times it was called, and how much time per call was spent.
From this we can see the busiest lines are the lines accessing the arrays, and looping over the rows.
This is confirmation that this algorithm is testing the performance of the arrays,
and confirms the N queens problem is profiling Perl's core performance with its built-in data structures.</p>
<p>The profiling results of the 11 queens problem are shown below.</p>
<div class="highlight"><pre><span></span><span class="c1"># Profile data generated by Devel::NYTProf::Reader</span>
<span class="c1"># Version: v6.04</span>
<span class="c1"># More information at http://metacpan.org/release/Devel-NYTProf/</span>
<span class="c1"># Format: time,calls,time/call,code</span>
<span class="mf">0.000238</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000119</span><span class="p">,</span><span class="k">use</span> <span class="nn">Time::HiRes</span> <span class="sx">qw(time)</span><span class="p">;</span>
<span class="mf">0.000039</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000019</span><span class="p">,</span><span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="mf">0.000491</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.000246</span><span class="p">,</span><span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
<span class="mf">0.000021</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000021</span><span class="p">,</span><span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="nb">time</span><span class="p">;</span>
<span class="mf">0.010338</span><span class="p">,</span><span class="mi">2680</span><span class="p">,</span><span class="mf">0.000004</span><span class="p">,</span><span class="nb">push</span> <span class="nv">@solutions</span><span class="p">,</span> <span class="s">&quot;@queens\n&quot;</span><span class="p">;</span>
<span class="mf">0.009993</span><span class="p">,</span><span class="mi">2680</span><span class="p">,</span><span class="mf">0.000004</span><span class="p">,</span><span class="k">return</span><span class="p">;</span>
<span class="mf">0.186298</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$#attacked</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$board_size</span><span class="p">;</span>
<span class="mf">0.150338</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="k">for</span><span class="p">(</span> <span class="mi">0</span> <span class="o">..</span> <span class="nv">$#queens</span><span class="p">)</span> <span class="p">{</span> 
<span class="mf">0.675523</span><span class="p">,</span><span class="mf">1.26035e+06</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$attacked</span><span class="p">[</span> <span class="nv">$ix2</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="mf">1.242624</span><span class="p">,</span><span class="mi">164246</span><span class="p">,</span><span class="mf">0.000008</span><span class="p">,</span><span class="k">for</span> <span class="k">my</span> <span class="nv">$row</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$board_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="mf">0.267469</span><span class="p">,</span><span class="mi">166925</span><span class="p">,</span><span class="mf">0.000002</span><span class="p">,</span><span class="n">explore</span><span class="p">(</span><span class="nv">$depth</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="mf">0.125272</span><span class="p">,</span><span class="mi">166925</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">,</span><span class="nv">$occupied</span><span class="p">[</span><span class="nv">$row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">0.000002</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000002</span><span class="p">,</span><span class="n">explore</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="mf">0.000011</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000011</span><span class="p">,</span><span class="k">my</span> <span class="nv">$duration</span> <span class="o">=</span> <span class="nb">time</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">;</span>
<span class="mf">0.000075</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000075</span><span class="p">,</span><span class="k">print</span> <span class="s">&quot;Found &quot;</span><span class="p">,</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@solutions</span><span class="p">),</span> <span class="s">&quot; solutions\n&quot;</span><span class="p">;</span>
<span class="mf">0.000050</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.000050</span><span class="p">,</span><span class="nb">printf</span> <span class="s">&quot;Execution time: %0.3f s \n&quot;</span><span class="p">,</span><span class="nv">$duration</span><span class="p">;</span>
</pre></div>


<p>One of the more interesting pieces of information comes from several lines 
populating the squares that are on the diagonals with other queens (<code>$attacked</code>):</p>
<div class="highlight"><pre><span></span># Format: time,calls,time/call,code
0.186298,164246,0.000001,$#attacked = 2 * $board_size;
</pre></div>


<p>The second column gives the number of times this line is executed - 164,246.
This is actually the number of solutions that are tried,
excluding the deepest depth of the tree (the base recursive case).</p>
<p>The Java profiler will show us that Java explores the exact same number of solutions,
which is confirmation that these tests are comparing the two languages on equal footing.</p>
<p><a name="javaprof"></a></p>
<h2>Java Profiling</h2>
<p>More details about the profiling tools I used for Java are on the charlesreid1 wiki at 
<a href="https://charlesreid1.com/wiki/Java/Profiling">Java/Profiling</a></p>
<p>I profiled Java with two tools, the <a href="http://jiprof.sourceforge.net/">Java Interactive Profiler (JIP)</a>
and the <a href="https://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html">HPROF tool</a> 
that Oracle provides with Java.</p>
<p>No special compiler flags are needed, so compile as normal:</p>
<div class="highlight"><pre><span></span>$ javac NQueens.java
</pre></div>


<p>If you are profiling with JIP, you want the JIP jar, as described on the wiki: <a href="https://charlesreid1.com/wiki/Java/Profiling">Java/Profiling</a> 
Then run Java with the <code>-javaagent</code> flag:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">PATH2JIP</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/Downloads/jip&quot;</span>
$ java -javaagent:<span class="si">${</span><span class="nv">PATH2JIP</span><span class="si">}</span>/profile/profile.jar NQueens
</pre></div>


<p>This results in a <code>profile.txt</code> file with detailed profiling information
(an example is shown below).</p>
<p>The HPROF tool likewise requires no special compiler flags. 
It can be run with various options from the command line. 
Here's a basic usage of HPROF that will reduce the amount of output slightly,
making the size of the output file a little smaller:</p>
<div class="highlight"><pre><span></span>$ java -agentlib:hprof<span class="o">=</span><span class="nv">verbose</span><span class="o">=</span>n NQueens
</pre></div>


<p>This dumps out a file called <code>java.hprof.txt</code> that contains a significant amount of information.
The most useful, though, is at the end, so use tail to get a quick overview of the results:</p>
<div class="highlight"><pre><span></span>$ tail -n <span class="m">100</span> java.hprof.txt
</pre></div>


<p><a name="javaprof"></a></p>
<h2>Java Profiling Results</h2>
<p>The profiling results from JIP for the 11 queens problem are shown below.</p>
<div class="highlight"><pre><span></span>+----------------------------------------------------------------------
|  File: profile.txt
|  Date: 2017.03.19 19:34:18 PM
+----------------------------------------------------------------------

+--------------------------------------+
| Most expensive methods summarized    |
+--------------------------------------+

               Net
          ------------
 Count     Time    Pct  Location
 =====     ====    ===  ========
166926    909.5   82.2  NQueens:explore
164246     55.6    5.0  Board:getDiagAttacked
166925     41.4    3.7  Board:unchoose
166925     40.7    3.7  Board:choose
164246     31.0    2.8  Board:getOccupied
     1     18.2    1.6  NQueens:main
  2680      7.3    0.7  Board:toString
  2680      2.3    0.2  SolutionSaver:saveSolution
     1      0.2    0.0  SolutionSaver:nSolutions
     1      0.1    0.0  SolutionSaver:&lt;init&gt;
     1      0.0    0.0  Board:&lt;init&gt;
</pre></div>


<p>From this output we can see that the method getDiagAttacked, 
which is called each time we check a solution in the recursive case,
is called 164,246 times - exactly the same number of solutions that the Perl profiler showed.
One of the downsides of the JIP profiler is that it only gives high-level 
profiling information about methods and classes - it stops there.</p>
<p>Fortunately, however, the HPROF tool picks up where JIP leaves off.
The HPROF tool makes the program much slower but yields a huge amount of information.
In addition to an enormous heap dump of all objects appearing on Java's heap at any point,
it also shows where the time was spent in the low-level methods.</p>
<div class="highlight"><pre><span></span>SITES BEGIN (ordered by live bytes) Sun Mar 19 19:34:21 2017
          percent          live          alloc&#39;ed  stack class
 rank   self  accum     bytes objs     bytes  objs trace name
    1 86.01% 86.01%  10510976 164234  10510976 164234 300462 int[]
    2  1.93% 87.94%    235840 2680    235840  2680 300467 char[]
    3  1.09% 89.03%    133320 1515    133320  1515 300465 char[]
    4  1.07% 90.11%    131200    8    131200     8 300263 char[]
    5  1.05% 91.16%    128640 2680    128640  2680 300464 char[]
    6  1.04% 92.20%    127560 1313    127560  1313 300010 char[]
    7  0.76% 92.96%     92728 1009     92728  1009 300000 char[]
    8  0.54% 93.50%     65664    8     65664     8 300260 byte[]
    9  0.53% 94.02%     64320 2680     64320  2680 300468 java.util.LinkedList$Node
   10  0.53% 94.55%     64320 2680     64320  2680 300466 java.lang.String
SITES END
</pre></div>


<p>HPROF tells us that over 86% of the time spent on this program was spent accessing integer arrays.
Again, confirmation that we are getting a fair measurement of Java's performance with a core data type, the integer array.</p>
<p><a name="h2hntested"></a></p>
<h2>Head to Head: Walltime vs. Number of Solutions Tested</h2>
<p>Using the results of the profilers from each N queens problem, <code>N = 8 .. 15</code>, 
I extracted the total number of solutions tried, and confirmed that these numbers were the same 
between Java and Perl for each of the problem sizes.</p>
<p>Here is a table of the number of solutions found, and number of solutions tried, versus problem size:</p>
<div class="highlight"><pre><span></span>-------------------------------------------------------------
| NQueens | Nsolutions | Ntested     | Java [s]  | Perl [s] |
|---------|------------|-------------|-----------|----------|
| 8       | 92         | 1965        | 0.003     | 0.016    |
| 9       | 352        | 8042        | 0.006     | 0.067    |
| 10      | 724        | 34815       | 0.017     | 0.259    |
| 11      | 2680       | 164246      | 0.061     | 1.542    |
| 12      | 14200      | 841989      | 0.240     | 8.431    |
| 13      | 73712      | 4601178     | 1.113     | 48.542   |
| 14      | 365596     | 26992957    | 6.557     | 303.278  |
| 15      | 2279184    | 168849888   | 42.619    | 2057.052 |
-------------------------------------------------------------
</pre></div>


<p>When the wall time for Java and Perl are plotted against the number of solutions tested,
an interesting trend emerges: the two scale the same way, with a fixed vertical offset.</p>
<p><img alt="Graph of walltime versus number of solutions tested" src="/images/perl-vs-java-ntested.png"></p>
<p>While this is proving what we already knew, 
that a compiled language beats a scripted language every time,
it also provides proof Perl can scale as well as Java - 
it just takes significantly more overhead and time per statement.</p>
<p><a name="applesoranges"></a></p>
<h2>Why Java Beat Perl</h2>
<p>Compiled languages are turned into bytecode and pre-optimized for the processor.</p>
<p>Perl is a scripted and interpreted language, like Python, evaluated piece by piece.</p>
<p>So, we didn't learn anything surprising. But we did find an interesting result - 
Perl can scale as well as Java in its implementation of the N queens recursive backtracking algorithm.</p>
<p><a name="sources"></a></p>
<h2>Sources</h2>
<ol>
<li>
<p>"Execution in the Kingdom of Nouns". Steve Yegge. March 2006. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081755/https://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">https://web.archive.org/web/20170320081755/https://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html</a>&gt;</p>
</li>
<li>
<p>"N-Queens Problem". Rosetta Code, GNU Free Documentation License. Edited 6 March 2017. Accessed 21 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081421/http://rosettacode.org/wiki/N-queens_problem">https://web.archive.org/web/20170320081421/http://rosettacode.org/wiki/N-queens_problem</a>&gt;</p>
</li>
<li>
<p>"nqueens.pl". Charles Reid. Github Gist, Github Inc. Edited 20 March 2017. Accessed 20 March 2017.
&lt;<a href="https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535">https://gist.github.com/charlesreid1/4ce97a5f896ff1c89855a5d038d51535</a>&gt;</p>
</li>
<li>
<p>"NQueens.java". Charles Reid. Github Gist, Github Inc. Edited 20 March 2017. Accessed 20 March 2017.
&lt;<a href="https://gist.github.com/charlesreid1/7b8d7b9dffb7b3090039849d72c5fff5">https://gist.github.com/charlesreid1/7b8d7b9dffb7b3090039849d72c5fff5</a>&gt;</p>
</li>
<li>
<p>"Devel::NYTProf". Adam Kaplan, Tim Bunce. Copyright 2008-2016, Tim Bunce. Published 4 March 2008. Accessed 20 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081508/http://search.cpan.org/~timb/Devel-NYTProf-6.04/lib/Devel/NYTProf.pm">https://web.archive.org/web/20170320081508/http://search.cpan.org/~timb/Devel-NYTProf-6.04/lib/Devel/NYTProf.pm</a>&gt;</p>
</li>
<li>
<p>"Perl/Profiling". Charles Reid. Edited 20 March 2017. Accessed 20 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081532/https://charlesreid1.com/wiki/Perl/Profiling">https://web.archive.org/web/20170320081532/https://charlesreid1.com/wiki/Perl/Profiling</a>&gt;</p>
</li>
<li>
<p>"Java/Profiling". Charles Reid. Edited 20 March 2017. Accessed 20 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081535/https://charlesreid1.com/wiki/Java/Profiling">https://web.archive.org/web/20170320081535/https://charlesreid1.com/wiki/Java/Profiling</a>&gt;</p>
</li>
<li>
<p>"JIP - The Java Interactive Profiler." Andrew Wilcox. Published 30 April 2010. Accessed 20 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081538/http://jiprof.sourceforge.net/">https://web.archive.org/web/20170320081538/http://jiprof.sourceforge.net/</a>&gt;</p>
</li>
<li>
<p>"HPROF". Oracle Corporation. Copyright 1993, 2016. Published 2016. Accessed 20 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081540/https://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html">https://web.archive.org/web/20170320081540/https://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/java.html">java</a>
                    &nbsp;&nbsp;
                    <a href="/tag/perl.html">perl</a>
                    &nbsp;&nbsp;
                    <a href="/tag/algorithms.html">algorithms</a>
                    &nbsp;&nbsp;
                    <a href="/tag/recursion.html">recursion</a>
                    &nbsp;&nbsp;
                    <a href="/tag/n-queens.html">n-queens</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Enigma Cipher Implementation: Part 4: Combinatorics
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-22T19:00:00-07:00" pubdate>Wednesday 03/22/2017</time>
                in 
                <a href="/category/enigma.html">Enigma</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/enigma-cipher-implementation-part-4-combinatorics.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>In this, the fourth article in a series on implementing the Enigma cipher in Java,
we use some big number libraries to explore the combinatorics of the Enigma encryption scheme
and better understand the Enigma's strengths and weaknesses. </p>
<h2>Table of Contents</h2>
<ul>
<li><a href="#keyspace">The Key Space</a></li>
<li><a href="#switchboard">The Switchboard</a><ul>
<li><a href="#onecable">One Cable</a></li>
<li><a href="#morecables">More Cables</a></li>
<li><a href="#manycables">Many Cables</a></li>
<li><a href="#dupes">Accounting for Duplicates</a></li>
<li><a href="#finalswitchboard">Final Combination Count for Switchboard</a></li>
</ul>
</li>
<li><a href="#rotors">The Rotors</a><ul>
<li><a href="#finalrotors">Final Combination Count for Rotors</a></li>
</ul>
</li>
<li><a href="#reflector">The Reflector</a><ul>
<li><a href="#finalreflector">Final Combination Count for Reflector</a></li>
</ul>
</li>
<li><a href="#finalcount">Final Enigma Combination Count</a><ul>
<li><a href="#javabigint">Java BigInteger Combinations Program</a></li>
</ul>
</li>
<li><a href="#sources">Sources</a></li>
</ul>
<p><a name="keyspace"></a></p>
<h2>The Key Space</h2>
<p>Basically, what the Enigma did was to encrypt each character of a message one at a time, using a different, unique key for each character. 
One key corresponded to one particular scrambled version of the alphabet (one possible set of substitutions). 
The huge number of possible initial settings for the machine - the rotors, wiring, and reflector - meant that finding the very first key was extremely difficult. 
Furthermore, as the operator entered additional characters into the Enigma, the machine would rotate the rotor wheels, 
sequentially stepping through the space of possible keys in a totally random but deterministic way. 
Any operator with a matching Enigma machine and matching settings could replicate this "random walk" through the key space.</p>
<p>What we will do below is look at each component of the Enigma and determine the total number of 
unique settings for each component. A single machine setting corresponds to a single key, 
so the total number of possible settings of the machine yields the total number of possible keys for the Enigma.</p>
<p><a name="switchboard"></a></p>
<h2>The Switchboard</h2>
<p>The switchboard at the front of the Enigma consisted of a set of plugs, one for each letter, connected by wires.
The operator would connect pairs of wires to swap pairs of letters. If the letters A and K were connected, 
any A signal entering the keyboard would become a K signal leaving the keyboard, 
and any K signal entering the keyboard would become an A signal leaving the keyboard.
Letters could not be connected to themselves, and a wire could only connect two letters together.</p>
<p>From these constraints, we can get the total number of cable configurations on the front of the machine.
For a machine with <span class="math">\(S\)</span> symbols (typically 26) and <span class="math">\(N\)</span> patch cables, the total number of configurations is:</p>
<div class="math">$$
C_{sw} = \dfrac{ S! }{ N! \times (S - 2N)! \times 2^N }
$$</div>
<p>Let's break down where those terms are coming from.</p>
<p><a name="onecable"></a></p>
<h3>One Cable</h3>
<p>Let's consider a single cable connecting two letters. </p>
<p>There are S (or, 26) places to plug in the left end, and S places to plug in the right end, for a total of <span class="math">\(S^2\)</span> combinations.
But no cable can connect to itself, so there are actually <span class="math">\(S (S-1)\)</span> possible combinations. 
Furthermore, each plug is symmetric (if A connects to B, then B connects to A), so half of the plug combinations are simply mirror images of the other half.</p>
<p>For a single plug, we start from a total of <span class="math">\(26 \times 26 = 676\)</span> possible configurations.
Ruling out any combinations that connect letters to themselves eliminates 26 possibilities (A connects to A, B connects to B, etc.)
for a total of <span class="math">\(26 \times 25 = 650\)</span> possible configurations.
But half of those configurations are mirror images of the other half (if we connect A to B, by implication we connect B to A),
so our number of choices is actually half that, or <span class="math">\(\frac{26 \times 25}{2} = 350\)</span>.</p>
<p><a name="morecables"></a></p>
<h3>More Cables</h3>
<p>If we plug in a second cable, there are now 2 choices occupied by the first letter, 
so there are <span class="math">\(S-2\)</span> possible places to plug in the left end,
and <span class="math">\(S-3\)</span> possible places to plug in the right end,
but each having half duplicate solutions, since the wires are two-way,
for a total of <span class="math">\(\frac{(S-2)(S-3)}{2 \times 2}\)</span> combinations.</p>
<p><a name="manycables"></a></p>
<h3>Many Cables</h3>
<p>Once <span class="math">\(N\)</span> wires have been plugged in, there are <span class="math">\(S - 2N\)</span> spaces remaining, and <span class="math">\(2N\)</span> spaces occupied by plug ends. 
That is, we are reducing the number of choices by 2 letters with each wire placed.</p>
<p>Taking the product of these numbers explains part of the expression given above: </p>
<div class="math">$$
S \times (S-1) \times (S-2) \times \dots \times (S - 2N + 1) = \dfrac{ S! }{ (S - 2N) ! }
$$</div>
<p><a name="dupes"></a></p>
<h3>Accounting for Duplicates</h3>
<p>But where did the <span class="math">\(2^N\)</span> and <span class="math">\(N!\)</span> terms come from? They come from the fact that many choices of wiring configurations are duplicates.</p>
<p>Dividing by <span class="math">\(2^N\)</span> comes from the fact that the wires are doubled up: if A connects to B, B connects to A.
This means that when we choose our pair and connect A to B using a wire, we also connect B to A. 
Even though it looks like two choices, it is only one!</p>
<p>Meanwhile, the <span class="math">\(N!\)</span> term accounts for the fact that order is not important when we select pairs and place wires -
making the choice to connect A to B and then making the choice to connect C to D 
is entirely equivalent to connecting C to D, then connecting A to B.
This means that <span class="math">\(N!\)</span> of the <span class="math">\(S!\)</span> possible solutions are duplicate configurations 
with the same connections chosen in a different order.</p>
<p><a name="moreinteresting"></a></p>
<h3>Switchboard Combinations</h3>
<p>Here's how the number of possible combinations that result when we plug in various numbers of wires in: </p>
<div class="highlight"><pre><span></span>S = 2       N = 1       C = 1
S = 26      N = 1       C = 325
S = 26      N = 2       C = 44,850
S = 26      N = 3       C = 3,453,450
S = 26      N = 4       C = 164,038,875
S = 26      N = 5       C = 5,019,589,575
S = 26      N = 6       C = 100,391,791,500
S = 26      N = 7       C = 1,305,093,289,500
S = 26      N = 8       C = 10,767,019,638,375
S = 26      N = 9       C = 53,835,098,191,875
S = 26      N = 10      C = 150,738,274,937,250
S = 26      N = 11      C = 205,552,193,096,250
S = 26      N = 12      C = 102,776,096,548,125
S = 26      N = 13      C = 7,905,853,580,625
</pre></div>


<p>Notice the bump in the shape of the distribution, meaning the use of 11 wires is much more secure than the use of 13 wires.
Let's explore that.</p>
<h3>More Interesting Observations About the Switchboard</h3>
<p>Notice how the switchboard expression is <em>not</em> proportional to <span class="math">\(N\)</span>,
it is inversely proportional to two different terms, each changing differently
as <span class="math">\(N\)</span> changes.</p>
<p>We are looking at the denominator of this expression:</p>
<div class="math">$$
C_{sw} = \dfrac{ S! }{ N! \times (S - 2N)! \times 2^N }
$$</div>
<p>The term <span class="math">\(N!\)</span> on the bottom will increase as <span class="math">\(N\)</span> increases, thereby decreasing the total number of possible keys <span class="math">\(C_{sw}\)</span>.
However, the term <span class="math">\((S - 2N)!\)</span> will decrease as <span class="math">\(N\)</span> increases, thereby increasing the total number of possible keys <span class="math">\(C_{sw}\)</span>.
The tradeoff can be visualized just by printing it out - here are the total number of combinations that are possible
for an alphabet of <span class="math">\(S = 26\)</span> symbols, using <span class="math">\(N = 1 \dots 13\)</span> wires:</p>
<p>This pattern holds for other alphabet sizes. Here's a 52-character alphabet:</p>
<div class="highlight"><pre><span></span>S = 52      N = 1       C = 1,326
S = 52      N = 2       C = 812,175
S = 52      N = 3       C = 305,377,800
S = 52      N = 4       C = 79,016,505,750
S = 52      N = 5       C = 14,949,922,887,900
S = 52      N = 6       C = 2,145,313,934,413,650
S = 52      N = 7       C = 239,049,266,977,521,000
S = 52      N = 8       C = 21,006,454,335,649,657,875
S = 52      N = 9       C = 1,470,451,803,495,476,051,250
S = 52      N = 10      C = 82,492,346,176,096,206,475,125
S = 52      N = 11      C = 3,719,654,882,122,156,219,242,000
S = 52      N = 12      C = 134,837,489,476,928,162,947,522,500
S = 52      N = 13      C = 3,920,659,309,406,065,045,704,885,000
S = 52      N = 14      C = 91,015,305,396,926,509,989,577,687,500
S = 52      N = 15      C = 1,674,681,619,303,447,783,808,229,450,000
S = 52      N = 16      C = 24,178,215,878,693,527,378,731,312,684,375
S = 52      N = 17      C = 270,227,118,644,221,776,585,820,553,531,250
S = 52      N = 18      C = 2,296,930,508,475,885,100,979,474,705,015,625
S = 52      N = 19      C = 14,506,929,527,216,116,427,238,787,610,625,000
S = 52      N = 20      C = 66,006,529,348,833,329,743,936,483,628,343,750
S = 52      N = 21      C = 207,449,092,239,190,464,909,514,662,831,937,500
S = 52      N = 22      C = 424,327,688,671,071,405,496,734,537,610,781,250
S = 52      N = 23      C = 516,572,838,382,173,884,952,546,393,613,125,000
S = 52      N = 24      C = 322,858,023,988,858,678,095,341,496,008,203,125
S = 52      N = 25      C = 77,485,925,757,326,082,742,881,959,041,968,750
S = 52      N = 26      C = 2,980,227,913,743,310,874,726,229,193,921,875
</pre></div>


<p>For a 52-symbol alphabet the optimum number of pairs is 23 keys.</p>
<p>Okay, here we go with an alphabet of 100 characters:</p>
<div class="highlight"><pre><span></span>S = 100     N = 1       C = 4,950
S = 100     N = 2       C = 11,763,675
S = 100     N = 3       C = 17,880,786,000
S = 100     N = 4       C = 19,539,228,901,500
S = 100     N = 5       C = 16,358,242,436,335,800
S = 100     N = 6       C = 10,919,126,826,254,146,500
S = 100     N = 7       C = 5,971,202,498,700,124,686,000
S = 100     N = 8       C = 2,728,093,141,593,619,465,916,250
S = 100     N = 9       C = 1,056,681,410,177,261,939,798,227,500
S = 100     N = 10      C = 350,923,896,319,868,690,206,991,352,750
S = 100     N = 11      C = 100,810,864,760,980,460,095,826,606,790,000
S = 100     N = 12      C = 25,227,918,906,435,360,138,980,608,349,197,500
S = 100     N = 13      C = 5,530,736,067,949,290,492,007,287,215,016,375,000
S = 100     N = 14      C = 1,067,037,008,537,930,972,779,405,911,982,802,062,500
S = 100     N = 15      C = 181,823,106,254,863,437,761,610,767,401,869,471,450,000
S = 100     N = 16      C = 27,443,925,100,343,450,137,143,125,204,719,673,346,984,375
S = 100     N = 17      C = 3,677,485,963,446,022,318,377,178,777,432,436,228,495,906,250
S = 100     N = 18      C = 438,233,743,977,317,659,606,613,804,310,698,650,562,428,828,125
S = 100     N = 19      C = 46,498,906,729,382,757,987,733,338,394,229,919,975,466,132,500,000
S = 100     N = 20      C = 4,396,471,631,263,139,767,740,187,145,174,438,933,680,322,827,875,000
S = 100     N = 21      C = 370,559,751,777,893,208,995,244,345,093,274,138,695,912,924,063,750,000
S = 100     N = 22      C = 27,842,512,258,584,430,657,688,131,929,053,734,148,379,275,612,608,125,000
S = 100     N = 23      C = 1,864,237,777,313,914,052,732,161,876,988,815,242,978,438,454,061,587,500,000
S = 100     N = 24      C = 111,155,177,472,342,125,394,155,151,915,458,108,862,589,392,823,422,154,687,500
S = 100     N = 25      C = 5,895,670,613,133,026,330,905,989,257,595,898,094,071,741,395,354,311,084,625,000
S = 100     N = 26      C = 277,776,788,503,382,971,359,993,724,636,729,814,047,610,892,665,731,964,564,062,500
S = 100     N = 27      C = 11,604,896,941,919,110,803,484,182,273,712,267,786,877,966,182,479,468,741,787,500,000
S = 100     N = 28      C = 428,966,726,245,938,560,057,361,737,617,578,469,979,239,107,102,366,076,705,359,375,000
S = 100     N = 29      C = 13,993,190,449,264,064,752,216,007,027,111,352,848,288,282,597,201,320,984,940,343,750,000
S = 100     N = 30      C = 401,604,565,893,878,658,388,599,401,678,095,826,745,873,710,539,677,912,267,787,865,625,000
S = 100     N = 31      C = 10,104,889,077,329,850,114,293,791,397,061,765,963,283,274,007,127,379,728,028,210,812,500,000
S = 100     N = 32      C = 221,991,781,917,590,144,698,391,729,754,200,671,005,879,425,844,079,623,400,119,756,287,109,375
S = 100     N = 33      C = 4,238,024,927,517,630,035,151,114,840,762,012,810,112,243,584,296,065,537,638,649,892,753,906,250
S = 100     N = 34      C = 69,927,411,304,040,895,579,993,394,872,573,211,366,852,019,140,885,081,371,037,723,230,439,453,125
S = 100     N = 35      C = 990,971,314,480,122,405,933,620,681,622,751,795,370,245,756,967,971,438,858,134,592,065,656,250,000
S = 100     N = 36      C = 11,974,236,716,634,812,405,031,249,902,941,584,194,057,136,230,029,654,886,202,459,654,126,679,687,500
S = 100     N = 37      C = 122,331,391,321,296,191,597,346,282,792,214,022,306,853,986,350,032,690,459,041,344,574,591,484,375,000
S = 100     N = 38      C = 1,046,255,320,511,085,849,187,830,050,196,567,296,045,461,725,362,121,694,715,485,183,861,637,695,312,500
S = 100     N = 39      C = 7,404,268,422,078,453,701,944,643,432,160,322,402,783,267,594,870,399,685,678,818,224,251,589,843,750,000
S = 100     N = 40      C = 42,759,650,137,503,070,128,730,315,820,725,861,876,073,370,360,376,558,184,795,175,245,052,931,347,656,250
S = 100     N = 41      C = 198,154,476,246,965,446,938,018,536,730,193,018,450,096,106,548,086,489,149,050,812,111,220,901,367,187,500
S = 100     N = 42      C = 721,848,449,185,374,128,131,353,240,945,703,138,639,635,816,710,886,496,185,827,958,405,161,854,980,468,750
S = 100     N = 43      C = 2,014,460,788,424,299,892,459,590,439,848,473,875,273,402,279,193,171,617,262,775,697,874,870,292,968,750,000
S = 100     N = 44      C = 4,166,271,176,059,347,504,859,607,500,595,707,332,951,809,259,240,423,117,520,740,647,877,572,651,367,187,500
S = 100     N = 45      C = 6,110,531,058,220,376,340,460,757,667,540,370,754,995,986,913,552,620,572,363,752,950,220,439,888,671,875,000
S = 100     N = 46      C = 5,977,693,426,519,933,376,537,697,718,246,014,869,017,813,284,997,128,820,790,627,886,085,212,934,570,312,500
S = 100     N = 47      C = 3,561,179,062,607,619,883,894,798,640,657,200,347,499,973,871,913,183,127,279,522,995,965,658,769,531,250,000
S = 100     N = 48      C = 1,112,868,457,064,881,213,717,124,575,205,375,108,593,741,834,972,869,727,274,850,936,239,268,365,478,515,625
S = 100     N = 49      C = 136,269,606,987,536,475,149,035,662,270,045,931,664,539,816,527,290,170,686,716,441,172,155,310,058,593,750
S = 100     N = 50      C = 2,725,392,139,750,729,502,980,713,245,400,918,633,290,796,330,545,803,413,734,328,823,443,106,201,171,875
</pre></div>


<p>Optimum number of pairs? 45.</p>
<p><a name="finalswitchboard"></a></p>
<h3>Final Combination Count Switchboard</h3>
<p>For a switchboard with holes for each of <span class="math">\(S\)</span> symbols, with <span class="math">\(N\)</span> unique pairs of letters chosen from among the symbols to be swapped by the switchboard,
the number of possible combinations of ciphers with <span class="math">\(N\)</span> wires is:</p>
<div class="math">$$
C_{sw} = \dfrac{ S! }{ N! \times (S - 2N)! \times 2^N }
$$</div>
<p><a name="rotors"></a></p>
<h2>The Rotors</h2>
<p>Typical Enigma machines had three rotors, with each rotor implementing a different scrambled alphabet.
Assuming there are P possible rotors to choose from, the number of choices
when selecting R rotors from P possible rotors is given by:</p>
<div class="math">$$
C_{rot} = \dfrac{P!}{(P-R)!}
$$</div>
<p>If the rotors are known, <span class="math">\(P\)</span> and <span class="math">\(R\)</span> are small numbers like 8 and 3, 
yielding a modest number of possible rotor combinations (336).
If the number of rotors is unknown, however, P becomes the set of all possible rotors
(the set of all possible alphabet scrambles), which is S!. Then we take the factorial of this number,</p>
<div class="math">$$
C_{rot} = \frac{(S!)!}{(S!-R)!}
$$</div>
<p>Note that the numerator <span class="math">\((S!)!\)</span> is a double factorial. <a href="http://www.wolframalpha.com/input/?i=(26!)!">Here's how Wolfram Alpha describes 26 double-factorial (26!)!</a></p>
<div class="math">$$
10^{10^{28}}
$$</div>
<p>This can also be written as <span class="math">\(403291461126605635584000000!\)</span>.
This is a number with 10^28 digits. That's <em>probably</em> the biggest number you've ever seen in your life. 
The denominator is also pretty big, though. For small values of R, this is approximately <span class="math">\((S!)^R\)</span>.
For a 26-character alphabet with 3 rotors, that's approximately</p>
<div class="math">$$
(403,291,461,126,605,635,584,000,000)^3 = 65,592,937,459,144,468,297,405,473,968,303,761,468,794,234,820,105,359,750,856,704,000,000,000,000,000,000
$$</div>
<p>which is a key space with more keys than there are <a href="https://en.wikipedia.org/wiki/Eddington_number">protons in the universe (the Eddington number)</a>.</p>
<p>In addition, each wheel had notches at different locations. The notches change the path the Enigma takes through the key space. 
For <span class="math">\(R\)</span> rotors containing <span class="math">\(S\)</span> symbols, the total combinations increases by a factor of <span class="math">\({S}^{R-1}\)</span>.
If each wheel has <span class="math">\(M\)</span> notches, that factor is <span class="math">\({(MS)}^{R-1}\)</span>.
(The <span class="math">\(R-1\)</span> comes from the fact that the location of the notch on the last wheel has no effect.)</p>
<p><a name="finalrotors"></a></p>
<h3>Final Combination Count for Rotors</h3>
<p>The total number of combinations for <span class="math">\(R\)</span> rotors with <span class="math">\(S\)</span> symbols and <span class="math">\(M\)</span> notches (which advance the neighboring left wheel by one), 
chosen from among <span class="math">\(P\)</span> possible choices of rotors, is given by:</p>
<div class="math">$$
C_{rot} = S^{R-1} \dfrac{P!}{(P-R)!}
$$</div>
<p><strong>NOTE:</strong> For a very large set of possible rotors <span class="math">\(P\)</span>, (<span class="math">\(P &gt;&gt; R\)</span>), </p>
<div class="math">$$
\dfrac{P!}{(P-R)!} \approx P^R
$$</div>
<p>so it follows that </p>
<div class="math">$$
C_{rot} \approx S^{R-1} P^R \qquad P &gt;&gt; R
$$</div>
<p>(For example, if <span class="math">\(P = S!\)</span>, the set of all possible rotors.)</p>
<p><a name="reflector"></a></p>
<h2>Reflector</h2>
<p>Like the switchboard on the front of the Enigma, the reflector connected pairs of letters.
It could only be changed by swapping it out like a rotor, so there were a small number of mechanically produced reflectors
chosen from the set of all possible reflectors.</p>
<p>If a reflector pairs all letters with another letter, it makes <span class="math">\(N = \frac{S}{2}\)</span> possible pairs. 
Using the analysis we performed above for the switchboard, and plugging that in, and using <span class="math">\(0!=1\)</span>:</p>
<div class="math">$$
C_{rfl} = \dfrac{ S! }{ (\frac{S}{2})! \times (S - 2(\frac{S}{2}))! \times 2^S } = \dfrac{S!}{(\frac{S}{2})! 2^S}
$$</div>
<p>For the 26 characters in the English alphabet, that's:</p>
<div class="math">$$
C_{rfl} = \frac{26!}{13! * 2^26 } = 965,070,017
$$</div>
<p>This is the total number of <em>possible</em> reflectors. (Curiously enough, the number of possible keys goes down as N goes from 11 to 12 and 12 to 13, 
making the switchboard on the front, which swapped 10 pairs of letters, more secure than the rotor, which swapped 13 pairs of letters.</p>
<p>However, like the rotors, there were a finite number of reflectors in use.
Supposing there were Q reflectors in use, that would make for Q possible sets of the 13 letter pairings.
Since the reflectors did not rotate, this would lead to only 1 possible reflector position, meaning a choice from among
Q reflectors only multiplied the number of possible combinations by Q.</p>
<p><a name="finalreflector"></a></p>
<h3>Final Combination Count for Reflector</h3>
<p>Here is the final expression for the total number of combinations resulting from all possible rotors:</p>
<div class="math">$$ 
C_{rfl} = \dfrac{S!}{(\frac{S}{2})! 2^S} 
$$</div>
<p>and here is the final expression for the total number of combinations if there is 1 rotor chosen from among <span class="math">\(Q\)</span> rotors:</p>
<div class="math">$$
C_{rfl} = Q
$$</div>
<p><a name="finalcount"></a></p>
<h2>Final Enigma Combination Count</h2>
<p>Putting all of this together results in the following monstrosity of an expression for the Enigma's <em>complete</em> key space:</p>
<div class="math">$$
C_{enigma-full} = 
\left( \dfrac{S!}{N! (S-2N)! 2^N} \right) 
\left( \dfrac{(S!)!}{(S!-R)!} \right) 
\left( \dfrac{ S! }{ \left( \dfrac{S}{2} \right)! 2^S } \right)
$$</div>
<p>Note that this assumes the attacker has no idea which rotors or reflectors are actually used. If instead the attacker has knowledge that <span class="math">\(R\)</span> rotors out of <span class="math">\(P\)</span> possible rotors 
and 1 reflector out of <span class="math">\(Q\)</span> possible reflectors are being used, this key space reduces to:</p>
<div class="math">$$
C_{enigma-small} = \left( \dfrac{S!}{N! (S-2N)! 2^N} \right) \left( S^{R-1} \dfrac{P!}{(P-R)!} \right) Q
$$</div>
<p>When you evaluate the above expressions for the following values of <span class="math">\(N\)</span>, <span class="math">\(P\)</span>, <span class="math">\(Q\)</span>, <span class="math">\(R\)</span>, and <span class="math">\(S\)</span>, 
here are the actual numbers you get:</p>
<div class="highlight"><pre><span></span>N = 10; // number of switchboard wires
P = 5;  // number of possible rotors
Q = 5;  // number of possible reflectors
R = 3;  // number of rotors
S = 26; // number of symbols
</pre></div>


<p>For the case of utilizing the <span class="math">\(P\)</span> known rotors and <span class="math">\(Q\)</span> known reflectors, the key space is:</p>
<div class="math">$$
C_{enigma-small} = 537,293,436,636,253,096,800,000
$$</div>
<p>For the completely unknown case of all possible rotors and reflectors, the key space increases to an astronomical number:</p>
<div class="math">$$
C_{enigma-full} = 422,732,921,460,335,478,939,047,043,039,799,222,455,533,136,281,221,092,624,796,865,514,111,348,059,884,989,972,480,000,000,000,000,000,000,000,000
$$</div>
<p>There are plenty of additional big numbers related to the Enigma, and more math around the weaknesses in the system and how it was cracked.
There is also yet more math around how Alan Turing managed to crack the German Navy's Enigma cipher, which utilized various protective steps like bigram replacement
that made cracking via frequency analysis much more difficult.</p>
<p>But that's enough for one post!</p>
<p>Below you can find a Java program that uses the BigInteger class, part of the Java API, to perform calculations with extremely large numbers.</p>
<p><a name="javabigint"></a></p>
<h3>Java BigInteger Program</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.*</span><span class="o">;</span>

<span class="cm">/** Cryptanalysis of the Enigma Machine.</span>
<span class="cm"> *</span>
<span class="cm"> * This program uses combinatorics and big integers</span>
<span class="cm"> * to analyze the cryptographic strength of the Enigma machine.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Charles Reid</span>
<span class="cm"> * Date: March 2017</span>
<span class="cm"> */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Combos</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span> 

        <span class="c1">// This involves a double factorial. PREPARE YOUR CPU</span>
        <span class="kt">boolean</span> <span class="n">doBig</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>



        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Git Ready</span>

        <span class="n">DecimalFormat</span> <span class="n">formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DecimalFormat</span><span class="o">(</span><span class="s">&quot;#,###&quot;</span><span class="o">);</span>

        <span class="n">BigInteger</span> <span class="n">small_combos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>
        <span class="n">BigInteger</span> <span class="n">big_combos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>

        <span class="c1">/// Useful temp variable </span>
        <span class="n">BigInteger</span> <span class="n">next</span><span class="o">;</span>



        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Constants</span>

        <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="c1">// number of switchboard wires</span>
        <span class="kt">int</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>  <span class="c1">// number of possible rotors</span>
        <span class="kt">int</span> <span class="n">Q</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>  <span class="c1">// number of possible reflectors</span>
        <span class="kt">int</span> <span class="n">R</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>  <span class="c1">// number of rotors</span>
        <span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="mi">26</span><span class="o">;</span> <span class="c1">// number of symbols</span>




        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Plugboard combinations</span>

        <span class="n">BigInteger</span> <span class="n">plugboard</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>

        <span class="c1">// S!/(S-2N)!</span>
        <span class="n">BigInteger</span> <span class="n">num</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">S</span><span class="o">;</span> <span class="n">i</span><span class="o">&gt;(</span><span class="n">S</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">);</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// divided by 2^N</span>
        <span class="n">BigInteger</span> <span class="n">pdenom</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">pdenom</span> <span class="o">=</span> <span class="n">pdenom</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">N</span><span class="o">);</span>

        <span class="c1">// divided by N!</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">N</span><span class="o">;</span> <span class="n">j</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">;</span> <span class="n">j</span><span class="o">--)</span> <span class="o">{</span> 
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
            <span class="n">pdenom</span> <span class="o">=</span> <span class="n">pdenom</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">plugboard</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">pdenom</span><span class="o">);</span>



        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Rotor combinations</span>

        <span class="n">BigInteger</span> <span class="n">small_rotors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>
        <span class="n">BigInteger</span> <span class="n">big_rotors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>

        <span class="c1">// -----------------</span>
        <span class="c1">// Small case:</span>
        <span class="c1">// R rotors selected from P possible known rotors</span>

        <span class="c1">// Rotor wheel combinations</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">P</span><span class="o">;</span> <span class="n">j</span><span class="o">&gt;(</span><span class="n">P</span><span class="o">-</span><span class="n">R</span><span class="o">);</span> <span class="n">j</span><span class="o">--)</span> <span class="o">{</span> 
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
            <span class="n">small_rotors</span> <span class="o">=</span> <span class="n">small_rotors</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// Rotor wheel notch positions (assume 1 per wheel). </span>
        <span class="c1">// Ignore left-most wheel.</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">k</span><span class="o">&lt;(</span><span class="n">R</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="n">k</span><span class="o">++</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">S</span><span class="o">);</span>
            <span class="n">small_rotors</span> <span class="o">=</span> <span class="n">small_rotors</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// Rotor wheel starting positions</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">R</span><span class="o">;</span> <span class="n">k</span><span class="o">++</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">S</span><span class="o">);</span>
            <span class="n">small_rotors</span> <span class="o">=</span> <span class="n">small_rotors</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// -----------------</span>
        <span class="c1">// Big case:</span>
        <span class="c1">// R rotors selected from S! possible rotors</span>

        <span class="k">if</span><span class="o">(</span><span class="n">doBig</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">BigInteger</span> <span class="n">s_rm1</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">S</span><span class="o">).</span><span class="na">pow</span><span class="o">(</span><span class="n">R</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">BigInteger</span> <span class="n">sfact_r</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">S</span><span class="o">;</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">1</span><span class="o">;</span> <span class="n">j</span><span class="o">--)</span> <span class="o">{</span> 
                <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="n">sfact_r</span> <span class="o">=</span> <span class="n">sfact_r</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">sfact_r</span> <span class="o">=</span> <span class="n">sfact_r</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">R</span><span class="o">);</span>
            <span class="n">big_rotors</span> <span class="o">=</span> <span class="n">s_rm1</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">sfact_r</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Reflector combinations</span>

        <span class="n">BigInteger</span> <span class="n">small_reflector</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Q</span><span class="o">);</span>
        <span class="n">BigInteger</span> <span class="n">big_reflector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="s">&quot;1&quot;</span><span class="o">);</span>

        <span class="c1">// (S!)/((S/2)!)</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">S</span><span class="o">;</span> <span class="n">j</span><span class="o">&gt;(</span><span class="n">S</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span> <span class="n">j</span><span class="o">--)</span> <span class="o">{</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
            <span class="n">big_reflector</span> <span class="o">=</span> <span class="n">big_reflector</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// divided by 2^N</span>
        <span class="n">BigInteger</span> <span class="n">rfldenom</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">rfldenom</span> <span class="o">=</span> <span class="n">rfldenom</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">N</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">doBig</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">big_reflector</span> <span class="o">=</span> <span class="n">big_reflector</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">rfldenom</span><span class="o">);</span>
        <span class="o">}</span>



        <span class="c1">/////////////////////////////////</span>
        <span class="c1">// Final combinations</span>

        <span class="n">small_combos</span> <span class="o">=</span> <span class="n">small_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">plugboard</span><span class="o">);</span>
        <span class="n">small_combos</span> <span class="o">=</span> <span class="n">small_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">small_rotors</span><span class="o">);</span>
        <span class="n">small_combos</span> <span class="o">=</span> <span class="n">small_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">small_reflector</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">doBig</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">big_combos</span> <span class="o">=</span> <span class="n">big_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">plugboard</span><span class="o">);</span>
            <span class="n">big_combos</span> <span class="o">=</span> <span class="n">big_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">big_rotors</span><span class="o">);</span>
            <span class="n">big_combos</span> <span class="o">=</span> <span class="n">big_combos</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">big_reflector</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Final number of (small) Enigma combinations: &quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">small_combos</span><span class="o">));</span>

        <span class="k">if</span><span class="o">(</span><span class="n">doBig</span><span class="o">)</span> <span class="o">{</span> 
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Final number of (big) Enigma combinations: &quot;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">formatter</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">big_combos</span><span class="o">));</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Output of the program:</p>
<div class="highlight"><pre><span></span>Final number of (small) Enigma combinations:
537,293,436,636,253,096,800,000
Final number of (big) Enigma combinations:
422,732,921,460,335,478,939,047,043,039,799,222,455,533,136,281,221,092,624,796,865,514,111,348,059,884,989,972,480,000,000,000,000,000,000,000,000
</pre></div>


<p><a name="sources"></a></p>
<h2>Sources</h2>
<ol>
<li>
<p>"The Enigma Cipher". Tony Sale and Andrew Hodges. Publication date unknown. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm">https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm</a>&gt;</p>
</li>
<li>
<p>"BigInteger". Oracle Corporation. Copyright 1993-2016, Publication date unknown. Accessed 22 March 2017.
&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/math/BigInteger.html">https://docs.oracle.com/javase/8/docs/api/java/math/BigInteger.html</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/ciphers.html">ciphers</a>
                    &nbsp;&nbsp;
                    <a href="/tag/enigma.html">enigma</a>
                    &nbsp;&nbsp;
                    <a href="/tag/encryption.html">encryption</a>
                    &nbsp;&nbsp;
                    <a href="/tag/java.html">java</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-22T18:00:00-07:00" pubdate>Wednesday 03/22/2017</time>
                in 
                <a href="/category/enigma.html">Enigma</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>As the title suggests, we're continuing with the third in a series of posts 
exploring a verb-oriented approach to programming - 
in an attempt to free ourselves from the fetishization of objects,
we are attempting to learn how to use languages against their will.</p>
<p>This is all inspired by <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">Steve Yegge's 2006 blog post</a>,
"Execution in the Kingdom of Nouns," an excellent read that inspired me to 
explore the subject more deeply. </p>
<h2>Java Pseudocode</h2>
<p>In the last post, we ran through the pseudocode for an Enigma machine 
based entirely upon Strings, iterators, and integer indexes, 
leading to a vastly simpler abstraction of the Enigma machine
than would have resulted if we had implicitly chosen a noun-centric approach,
divided the entire Enigma encryption process into its component nouns like rotor wheels and reflectors,
and implemented each as an object.</p>
<p>Here was the pseudocode:</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
define list of switchboard swap pairs
define list of reflector swap pairs
for each character in plaintext message:

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    # Apply forward rotor transformation
    for each scrambled alphabet:
        get index of character in normal alphabet
        get new character at that index in scrambled alphabet
        replace character with new character 

    # Apply reflector transformation
    for each pair in reflector swap pairs:
        if character in swap pair, swap its value

    # Apply reverse rotor transformation
    for each scrambled alphabet:
        get index of input character in scrambled alphabet
        get new character at that index in normal alphabet
        replace character with new character 

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    concatenate transformed input character to ciphertext message 

    # Increment rotor wheels
    for each rotor/scrambled alphabet, left to right:
        get index of left notch in left alphabet
        get index of right notch in right alphabet
        if left index equals right index:
            cycle left alphabet forward 1 character
    cycle right-most alphabet forward 1 character
</pre></div>


<h2>Java Code</h2>
<p>The Enigma code is defined in the Java program as follows:</p>
<ul>
<li>The Enigma class defines a set of constants for historically accurate cipher settings.</li>
<li>The main method contains the encryption procedure.</li>
<li>There is one static helper method called rotateString.</li>
</ul>
<p>Everything is in a public class. Starting with the definitions of constants:</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Enigma</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ALPHA</span> <span class="o">=</span> <span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="o">;</span>

    <span class="c1">// Historically accurate rotor scrambles</span>
    <span class="c1">// See http://www.codesandciphers.org.uk/enigma/rotorspec.htm</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">WHEEL</span> <span class="o">=</span> <span class="o">{</span> <span class="n">ALPHA</span><span class="o">,</span>
                        <span class="s">&quot;EKMFLGDQVZNTOWYHXUSPAIBRCJ&quot;</span><span class="o">,</span> <span class="c1">// Rotor I    - Royal</span>
                        <span class="s">&quot;AJDKSIRUXBLHWTMCQGZNPYFVOE&quot;</span><span class="o">,</span> <span class="c1">// Rotor II   - Flags</span>
                        <span class="s">&quot;BDFHJLCPRTXVZNYEIWGAKMUSQO&quot;</span><span class="o">,</span> <span class="c1">// Rotor III  - Wave</span>
                        <span class="s">&quot;ESOVPZJAYQUIRHXLNFTGKDCMWB&quot;</span><span class="o">,</span> <span class="c1">// Rotor IV   - Kings</span>
                        <span class="s">&quot;VZBRGITYUPSDNHLXAWMJQOFECK&quot;</span><span class="o">,</span> <span class="c1">// Rotor V    - Above</span>
                        <span class="s">&quot;JPGVOUMFYQBENHZRDKASXLICTW&quot;</span><span class="o">,</span>
                        <span class="s">&quot;NZJHGRCXMYSWBOUFAIVLPEKQDT&quot;</span><span class="o">,</span>
                        <span class="s">&quot;FKQHTLXOCBJSPDZRAMEWNIUYGV&quot;</span><span class="o">};</span>

    <span class="c1">// Knocking (notch and clasp) advances the wheel to the left</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">NOTCH</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;&quot;</span><span class="o">,</span>  <span class="c1">// No notch</span>
                                          <span class="s">&quot;R&quot;</span><span class="o">,</span> <span class="c1">// Royal</span>
                                          <span class="s">&quot;F&quot;</span><span class="o">,</span> <span class="c1">// Flags</span>
                                          <span class="s">&quot;W&quot;</span><span class="o">,</span> <span class="c1">// Wave</span>
                                          <span class="s">&quot;K&quot;</span><span class="o">,</span> <span class="c1">// Kings</span>
                                          <span class="s">&quot;A&quot;</span><span class="o">,</span> <span class="c1">// Above</span>
                                          <span class="s">&quot;AN&quot;</span><span class="o">,</span>
                                          <span class="s">&quot;AN&quot;</span><span class="o">,</span>
                                          <span class="s">&quot;AN&quot;</span><span class="o">};</span>

    <span class="c1">// Reflectors</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REFLECTOR_ALPHA</span> <span class="o">=</span> <span class="s">&quot;AY:BR:CU:DH:EQ:FS:GL:IP:JX:KN:MO:TZ:VW&quot;</span><span class="o">;</span>
</pre></div>


<h2>Main Method: User Settings</h2>
<p>The next part of the code is the main method, where we begin by defining variables 
that correspond to settings that the Enigma operator would set from the daily Enigma code book.
These included:</p>
<ul>
<li>The numbering and ordering of wheels (e.g., <code>IV II I</code>)</li>
<li>The initial rotor settings for each wheel (position 0-25)</li>
<li>The pairs of letters connected on the switch board</li>
</ul>
<p>The wheels are specified using the <code>WHEEL</code> array of Strings, above.
Each element of the WHEEL array contains a different scrambled alphabet, 
corresponding to the alphabet scrambles hard-coded into the historical rotor wheels.
These go into <code>rotorAlpha</code>, which stores each rotor's alphabet in a String.</p>
<p>The locations of the notches that advance neighboring wheels are fixed by the choice of wheels, 
and are available through the <code>NOTCH</code> array.
The notch locations implemented in <code>NOTCH</code> are historically accurate for each rotor wheel. </p>
<p>The initial rotor settings were also contained in the code book as a sequence of 3 numbers,
each 0-25, indicating how many turns each wheel was rotated before starting.</p>
<p>The plugboard pairs specify the wired connections on the front of the machine.
These plugboard pairs were also daily machine settings specified in the daily Enigma code book.
The plugboard pairs are input as a single string, with pairs of letters separated by a ":", like this: <code>AB:CD:EF:GH</code>.
Pairs must be unique (no letter can connect to itself). 
Letters cannot be repeated (no letter can connect to more than 1 other letter).</p>
<div class="highlight"><pre><span></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span> 

        <span class="c1">// These two strings should encrypt/decrypt to each other when you run them through the Enigma.</span>
        <span class="c1">//String message = &quot;ABCDE FG HIJKL MNOP QRS TUVWXYZ&quot;; </span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;TVVFT KS UNVYJ FAFV NPC DZJPWEJ&quot;</span><span class="o">;</span>


        <span class="c1">//////////////////////////////////</span>
        <span class="c1">// Operator Settings</span>
        <span class="c1">// </span>
        <span class="c1">// Enigma operators have code sheets that specify: </span>
        <span class="c1">//  - The numbering/ordering of wheels </span>
        <span class="c1">//  - The initial rotor settings</span>
        <span class="c1">//  - The plugboard pairs</span>

        <span class="c1">// Rotor scrambles are applied right-to-left</span>
        <span class="c1">//              {LAST, MIDDLE, FIRST}</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">rotorAlpha</span> <span class="o">=</span> <span class="o">{</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">rotorNotch</span> <span class="o">=</span> <span class="o">{</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">rotorInit</span> <span class="o">=</span> <span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">};</span>

        <span class="n">String</span> <span class="n">plugboardPairs</span> <span class="o">=</span> <span class="s">&quot;IR:HQ:NT:WZ:VC:OY:GP:LF:BX:AK&quot;</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">coded</span> <span class="o">=</span> <span class="n">enigma</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">rotorAlpha</span><span class="o">,</span> <span class="n">rotorNotch</span><span class="o">,</span> <span class="n">rotorInit</span><span class="o">,</span> <span class="n">plugboardPairs</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">coded</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>


<h2>Cipher Procedure</h2>
<p>The next bit of code is the meat of the Enigma method.
Notice that this is purely procedural code, and makes no use of objects other than the built-in String type. 
This is the kind of verb-oriented code we are striving for
when we write noun-free Java code.</p>
<p>We also pass in any information that's required. 
Normally we would wrap all of these quantities in an object,
to keep the list of parameters short, but this implementation is entirely object-free.</p>
<div class="highlight"><pre><span></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">enigma</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">,</span>
                                <span class="n">String</span><span class="o">[]</span> <span class="n">rotorAlpha</span><span class="o">,</span>
                                <span class="n">String</span><span class="o">[]</span> <span class="n">rotorNotch</span><span class="o">,</span>
                                <span class="kt">int</span><span class="o">[]</span> <span class="n">rotorInit</span><span class="o">,</span>
                                <span class="n">String</span><span class="o">[]</span> <span class="n">plugboardPairs</span><span class="o">)</span> <span class="o">{</span> 

        <span class="n">StringBuilder</span> <span class="n">message_final</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>

        <span class="c1">//////////////////////////////////////</span>
        <span class="c1">// Enigma Cipher</span>

        <span class="c1">// Apply each transformation in sequence</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">message</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>

            <span class="c1">// Starting char</span>
            <span class="kt">char</span> <span class="n">c_orig</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">c_orig</span><span class="o">;</span>

            <span class="c1">// Perform plugboard swap</span>
            <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">plugboardPairs</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="c1">// Perform rotor letter substitutions</span>
            <span class="c1">// (forward order: right-to-left)</span>
            <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=(</span><span class="n">rotorAlpha</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="n">j</span><span class="o">--)</span> <span class="o">{</span> 
                <span class="n">ix</span> <span class="o">=</span> <span class="n">ALPHA</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">thisAlpha</span> <span class="o">=</span> <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
                <span class="k">if</span><span class="o">(</span><span class="n">ix</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="n">c</span> <span class="o">=</span> <span class="n">thisAlpha</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">ix</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">c_orig</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="c1">// Perform reflection</span>
            <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">REFLECTOR_ALPHA</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="c1">// Perform rotor letter substitutions</span>
            <span class="c1">// (backwards order: left-to-right) </span>
            <span class="n">ix</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">rotorAlpha</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span> 
                <span class="n">String</span> <span class="n">thisAlpha</span> <span class="o">=</span> <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="n">thisAlpha</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">ix</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="n">c</span> <span class="o">=</span> <span class="n">ALPHA</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">ix</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">c_orig</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>


            <span class="c1">// Perform plugboard swap</span>
            <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">plugboardPairs</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>


            <span class="c1">// Final text</span>
            <span class="k">if</span><span class="o">(</span> <span class="n">c</span><span class="o">&gt;=</span><span class="sc">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">&lt;=</span><span class="sc">&#39;Z&#39;</span><span class="o">)</span> <span class="o">{</span> 
                <span class="n">message_final</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// Could not resolve </span>
                <span class="n">message_final</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">c_orig</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="c1">// Increment rotors</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">j</span><span class="o">&lt;(</span><span class="n">rotorAlpha</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">alphaL</span> <span class="o">=</span> <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">ixL</span> <span class="o">=</span> <span class="n">alphaL</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">rotorNotch</span><span class="o">[</span><span class="n">j</span><span class="o">]);</span>
                <span class="n">String</span> <span class="n">alphaR</span> <span class="o">=</span> <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">ixR</span> <span class="o">=</span> <span class="n">alphaR</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">rotorNotch</span><span class="o">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="o">]);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">ixL</span><span class="o">!=</span><span class="n">ixR</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">rotateString</span><span class="o">(</span><span class="n">rotorAlpha</span><span class="o">[</span><span class="n">j</span><span class="o">]);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">// Always increment the right-most rotor</span>
            <span class="kt">int</span> <span class="n">lenny</span> <span class="o">=</span> <span class="n">rotorAlpha</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="n">rotorAlpha</span><span class="o">[</span><span class="n">lenny</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">rotateString</span><span class="o">(</span><span class="n">rotorAlpha</span><span class="o">[</span><span class="n">lenny</span><span class="o">-</span><span class="mi">1</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">message_final</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>


<h2>Utility Method: String Rotator</h2>
<p>One last piece that's needed to emulate the rotation of the rotor wheels 
is a method to rotate strings forward 1 character. Here's that method:</p>
<div class="highlight"><pre><span></span>    <span class="c1">/// Rotate a string forward by 1 character, so &quot;ABCDEF&quot; becomes &quot;FABCDE&quot;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">rotateString</span><span class="o">(</span><span class="n">String</span> <span class="n">original</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">lenny</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
        <span class="n">StringBuilder</span> <span class="n">rotated</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">rotated</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">lenny</span><span class="o">-</span><span class="mi">1</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">lenny</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span> 
            <span class="n">rotated</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">rotated</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span> <span class="c1">// end Enigma class</span>
</pre></div>


<h2>Complete Enigma Implementation</h2>
<p>Here is a link to the complete Enigma code on Github: <a href="">Enigma.java</a></p>
<p>Now that the Enigma machine implementation is finished, we can test it out.
One feature of the Enigma that makes it easy to test is, it is symmetric.
If we feed a plain text into the Enigma and get the corresponding ciphertext,
we can feed that ciphertext through the Enigma (with the same initial settings) 
and recover the original plain text.</p>
<p>Running the alphabet through the Enigma yields:</p>
<div class="highlight"><pre><span></span>$ java Enigma
IN:  ABCDE FG HIJKL MNOP QRS TUVWXYZ
OUT: TVVFT KS UNVYJ FAFV NPC DZJPWEJ
</pre></div>


<p>Running this back through the Enigma yields:</p>
<div class="highlight"><pre><span></span>$ java Enigma
IN:  TVVFT KS UNVYJ FAFV NPC DZJPWEJ
OUT: ABCDE FG HIJKL MNOP QRS TUVWXYZ
</pre></div>


<p><strong>NOTE:</strong> This code modifies the Enigma machine's settings in-place.
This means multiple sequential calls to the <code>enigma()</code> method will not reset the rotors.
The following code will not recover the original plain text <code>message</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">// This won&#39;t work:</span>
<span class="n">String</span> <span class="n">coded</span> <span class="o">=</span> <span class="n">enigma</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">rotorAlpha</span><span class="o">,</span> <span class="n">rotorNotch</span><span class="o">,</span> <span class="n">rotorInit</span><span class="o">,</span> <span class="n">plugboardPairs</span><span class="o">);</span>
<span class="n">String</span> <span class="n">original2</span> <span class="o">=</span> <span class="n">enigma</span><span class="o">(</span><span class="n">coded</span><span class="o">,</span> <span class="n">rotorAlpha</span><span class="o">,</span> <span class="n">rotorNotch</span><span class="o">,</span> <span class="n">rotorInit</span><span class="o">,</span> <span class="n">plugboardPairs</span><span class="o">);</span>
</pre></div>


<p>To do this correctly, we would need multiple copies of the input arrays <code>rotorAlpha</code>, <code>rotorNotch</code>, and <code>rotorInit</code>:</p>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">plugboardPairs</span> <span class="o">=</span> <span class="s">&quot;IR:HQ:NT:WZ:VC:OY:GP:LF:BX:AK&quot;</span><span class="o">;</span>

<span class="n">String</span><span class="o">[]</span> <span class="n">rotorAlpha</span> <span class="o">=</span> <span class="o">{</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">rotorNotch</span> <span class="o">=</span> <span class="o">{</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">rotorInit</span> <span class="o">=</span> <span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">};</span>
<span class="n">String</span> <span class="n">coded</span> <span class="o">=</span> <span class="n">enigma</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">rotorAlpha</span><span class="o">,</span> <span class="n">rotorNotch</span><span class="o">,</span> <span class="n">rotorInit</span><span class="o">,</span> <span class="n">plugboardPairs</span><span class="o">);</span>

<span class="n">String</span><span class="o">[]</span> <span class="n">rotorAlpha2</span> <span class="o">=</span> <span class="o">{</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">WHEEL</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">rotorNotch2</span> <span class="o">=</span> <span class="o">{</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span><span class="n">NOTCH</span><span class="o">[</span><span class="mi">3</span><span class="o">]};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">rotorInit2</span> <span class="o">=</span> <span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">};</span>
<span class="n">String</span> <span class="n">original</span> <span class="o">=</span> <span class="n">enigma</span><span class="o">(</span><span class="n">coded</span><span class="o">,</span> <span class="n">rotorAlpha2</span><span class="o">,</span> <span class="n">rotorNotch2</span><span class="o">,</span> <span class="n">rotorInit2</span><span class="o">,</span> <span class="n">plugboardPairs</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ORIGINAL:  &quot;</span><span class="o">+</span><span class="n">message</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;RECOVERED: &quot;</span><span class="o">+</span><span class="n">original</span><span class="o">);</span>
</pre></div>


<p>This works fine:</p>
<div class="highlight"><pre><span></span><span class="n">ORIGINAL</span><span class="o">:</span>  <span class="n">ABCDE</span> <span class="n">FG</span> <span class="n">HIJKL</span> <span class="n">MNOP</span> <span class="n">QRS</span> <span class="n">TUVWXYZ</span>
<span class="n">RECOVERED</span><span class="o">:</span> <span class="n">ABCDE</span> <span class="n">FG</span> <span class="n">HIJKL</span> <span class="n">MNOP</span> <span class="n">QRS</span> <span class="n">TUVWXYZ</span> 
</pre></div>


<h2>Sources</h2>
<ol>
<li>
<p>"Execution in the Kingdom of Nouns". Steve Yegge. March 2006. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081755/https://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">https://web.archive.org/web/20170320081755/https://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html</a>&gt;</p>
</li>
<li>
<p>"The Enigma Cipher". Tony Sale and Andrew Hodges. Publication date unknown. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm">https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm</a>&gt;</p>
</li>
</ol></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/ciphers.html">ciphers</a>
                    &nbsp;&nbsp;
                    <a href="/tag/enigma.html">enigma</a>
                    &nbsp;&nbsp;
                    <a href="/tag/encryption.html">encryption</a>
                    &nbsp;&nbsp;
                    <a href="/tag/java.html">java</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Enigma Cipher Implementation: Part 2: Pseudocode
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-21T21:00:00-07:00" pubdate>Tuesday 03/21/2017</time>
                in 
                <a href="/category/enigma.html">Enigma</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/enigma-cipher-implementation-part-2-pseudocode.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>This is the second of several posts walking through an implementation of the Enigma cipher in code.</p>
<p>Thanks to <a href="http://www.codesandciphers.org.uk/enigma/index.htm">the website of the late Tony Sale</a> for providing a wealth of 
detailed, accurate information entirely free of graduate level mathematics, 
and includes some very clear <a href="http://www.codesandciphers.org.uk/enigma/example1.htm">examples</a> for luddites like me who need everything spelled out really clearly.</p>
<h2>The Goal</h2>
<p>The goal of analyzing the Enigma machine is to better understand the workings of a device that played an important role in the history of computing.
It is also an excellent system to better understand some of the design decisions we make when creating a code representation of a problem. </p>
<p>The intention is to replicate some of the encryption mechanisms of the original Enigma. 
From the Part 1 post, which covered more about how Enigma works, we have built up a basic understanding of what each step does.
In this post we discuss how to implement this functionality.</p>
<p>The basic idea is to start with a plaintext input (typed by the operator) and apply a rotating cripher to encrypt it, resulting in a ciphertext output:</p>
<div class="highlight"><pre><span></span>                _________
               |         |
PLAINTEXT ---&gt; | ENIGMA  | ----&gt; CIPHERTEXT
               |_________|
</pre></div>


<h2>Function or Object?</h2>
<p>One of the first decisions typically made (sometimes implicitly) is whether to implement the Enigma as a function or an object.
Is the Enigma a noun, or a verb?</p>
<h3>The Noun Approach</h3>
<p>Programming in a language like Java or C++, the noun approach seems perfectly natural:
start with an Enigma object (the noun), and create more objects to represent more of the nouns (the switchboard, the rotor wheels, and the reflector). 
Each component is modeled as a black box function taking a character in and returning a character out. 
Each component stores and organizes information important for it to perform its particular transformation.
For example, the rotors would store the scrambled version of the alphabet that they implement, 
while the switchboard and the reflector would store the connected letter pairs.</p>
<p>This approach reflects the kind of engineering approach that was taken to the design of the Enigma: 
many simple components, working together in concert, result in a more complex integrated system.</p>
<p>But one of the reasons the Enigma machine is an interesting system for implementing in code 
is because of the simplicity of the mechanical operations performed. 
This can help identify where a person actually begins the software design process. 
If the design process starts with one foot in the world of objects already, the object approach will be adopted by default.</p>
<p>With this approach, we are reshaping our data structures to fit the problem. 
This makes the implementation more modular and the driver easier to read at a high level. 
However, reshaping the data structures to fit the problem and our abstraction of it 
can lead to more inefficient code and implementations.</p>
<h3>The Verb Approach</h3>
<p>Instead, we can start by examining the encryption process itself - the verb of encryption. 
The action of encryption consists of elementary steps - swapping out two characters. 
Each of these actions is simple enough that it can be implemented using built-in string manipulation methods,
and all of the quantities being stored are likewise simple enough that no exotic data structures are required. </p>
<p>The verb approach requires considering the problem up-front (possibly recasting it in different terms),
and thinking through the actions involved in order to best utilize simple, built-in data structures and functionality.</p>
<p>With this approach we essentially reshape the problem to fit our data structures, rather than the other way around.</p>
<h2>Applying the Verb Approach to the Rotors</h2>
<h3>Rotors</h3>
<p>To get a better sense of what the verb approach looks like, let's look at the Enigma rotors.</p>
<p>Each rotor implements a particular permutations of the 26 letters of the alphabet: </p>
<p><img alt="Enigma rotor" src="/images/enigma_rotor.jpg"></p>
<p>This is equivalent to matching up two strings. To make things slightly more concrete, let's look at Rotor I, nicknamed Royal
(due to the location of its notch at the letter R), implemented the scrambled alphabet "EKMFLGDQVZNTOWYHXUSPAIBRCJ".
With an offset of 0, this would therefore implement the following shift:</p>
<div class="highlight"><pre><span></span>ABCDEFGHIJKLMNOPQRSTUVWXYZ
||||||||||||||||||||||||||
EKMFLGDQVZNTOWYHXUSPAIBRCJ
</pre></div>


<p>This operation, when broken down, is trivial: we are matching two characters from two strings, both at a particular location.</p>
<p>Starting with a char, representing the character coming into the rotor,
we can perform a two-step operation: 
1. Get the index of the incoming character in the normal alphabet <code>ABCDEF...</code>.
2. Get the corresponding character at that index in the scrambled alphabet <code>EKMFLG...</code>.</p>
<p>We will also need to perform the reverse operation when we return the signal back through the machine from the reflector.
In that case, we're actually performing the opposite lookup, for the same wheel:</p>
<div class="highlight"><pre><span></span>EKMFLGDQVZNTOWYHXUSPAIBRCJ
||||||||||||||||||||||||||
ABCDEFGHIJKLMNOPQRSTUVWXYZ
</pre></div>


<p>When we were going through Rotor I the first time, A became E, and E became L;
when going through in reverse, E now becomes A, and L now becomes E.</p>
<p>The procedure can also be reversed:
1. Get the index of the incoming character in the scrambled alphabet <code>EKMFLG...</code>.
2. Get the corresponding character at that index in the normal alphabet <code>ABCDEF...</code>.</p>
<p>Applying this multiple times in sequence applies multiple scrambles
and replicates multiple rotors.</p>
<h3>Example of Verb Approach: Rotor Rotation</h3>
<p>One of the reasons an object-oriented approach may seem natural,
besides the chosen language suggesting it, 
is because the Enigma is an object with a <em>state</em>.
Objects provide a natural way of representing things with an internal state, 
or information specific to that entity and required for its operation.</p>
<p>For this reason, it may seem at first blush that the Engima <em>requires</em> an object-oriented implementation.
However, we can continue with our verb-centric thinking, and examine how the operations change when the wheels are rotated.</p>
<div class="highlight"><pre><span></span>After 2 rotations:

ABCDEFGHIJKLMNOPQRSTUVWXYZAB
  ||||||||||||||||||||||||||
  EKMFLGDQVZNTOWYHXUSPAIBRCJ

After 4 rotations:

ABCDEFGHIJKLMNOPQRSTUVWXYZABCD
    ||||||||||||||||||||||||||
    EKMFLGDQVZNTOWYHXUSPAIBRCJ
</pre></div>


<p>As the wheels rotate, we are still performing the same index lookup operations, 
we are just rotating each scrambled alphabet by one character. 
Again, this is a trivial operation that is probably built in for string types. </p>
<h3>Rotor Pseudocode</h3>
<p>Putting all of this together, here's pseudocode for a single forward transformation by an Engima rotor: </p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabet 
for each character in plaintext message:
    get index of input character in normal alphabet
    get new character at that index in scrambled alphabet
    concatenate transformed character to ciphertext message 
</pre></div>


<p>Because the Enigma has multiple rotors, we also want pseudocode for multiple rotors:</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
for each character in plaintext message:
    for each scrambled alphabet:
        get index of character in normal alphabet
        get new character at that index in scrambled alphabet
        replace character with new character 
    concatenate transformed character to ciphertext message 
</pre></div>


<p>Likewise, to apply multiple rotations in reverse, we just swap the alphabets out:</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
for each character in plaintext message:
    for each scrambled alphabet:
        get index of character in scrambled alphabet
        get new character at that index in normal alphabet
        replace character with new character 
    concatenate transformed character to ciphertext message 
</pre></div>


<h3>A More Complete Enigma Pseudocode</h3>
<p>To combine these operations, or add additional operations, we just add them before concatenating the final transformed character to the ciphertext message.
Thus, a more complete pseudocode would include other steps:</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
for each character in plaintext message:

    # Apply switchboard transformation

    # Apply forward rotor transformation
    for each scrambled alphabet:
        get index of character in normal alphabet
        get new character at that index in scrambled alphabet
        replace character with new character 

    # Apply reflector transformation

    # Apply reverse rotor transformation
    for each scrambled alphabet:
        get index of input character in scrambled alphabet
        get new character at that index in normal alphabet
        replace character with new character 

    # Apply switchboard transformation

    concatenate transformed character to ciphertext message 
</pre></div>


<p>Now let's cover the switchboard and reflector transformations.</p>
<h2>The Switchboard</h2>
<p>We can take the same verb-based approach to the switchboard as we took for the rotors.
When we think through the actual operation being performed by the switchboard, 
it is even simpler than the operation performed by the rotor wheels.
We have pairs of letters, and we are simply looking for one letter in a pair, and swapping it out with the other letter in the pair.
In the case of the switchboard, Enigma operators utilized 7-10 wires to connect pairs of letters; the remaining letters were unchanged.
So the switchboard step is very simple:</p>
<div class="highlight"><pre><span></span>define plaintext message
define list of switchboard swap pairs
for each character in message:
    for each pair in swap pairs:
        if character in swap pair, swap its value
    add character to ciphertext
</pre></div>


<p>That's it! No need for a reverse function, since the swap procedure is symmetric. 
(Note that if there is no wire connecting a letter to another letter, there is no swap operation, and the character is added to the ciphertext directly.)</p>
<h2>The Reflector</h2>
<p>The reflector pseudocode looks identical to the switchboard pseudocode,
except the reflector defines pairings for all 13 posible letter pairs, instead of only 7-10.</p>
<div class="highlight"><pre><span></span>define plaintext message
define list of reflector swap pairs
for each character in message:
    for each pair in swap pairs:
        if character in swap pair, swap its value
    add character to ciphertext
</pre></div>


<p>Again, no need for a reverse version, since the reflector is a symmetric transformation.</p>
<h2>Nearing a Complete Enigma Pseudocode</h2>
<p>Almost there. We have one more thing going on - those rotor wheels are moving.
Add the "increment rotor wheels" verb, and define that below.</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
define list of switchboard swap pairs
define list of reflector swap pairs
for each character in plaintext message:

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    # Apply forward rotor transformation
    for each rotor/scrambled alphabet:
        get index of character in normal alphabet
        get new character at that index in scrambled alphabet
        replace character with new character 

    # Apply reflector transformation
    for each pair in reflector swap pairs:
        if character in swap pair, swap its value

    # Apply reverse rotor transformation
    for each scrambled alphabet:
        get index of input character in scrambled alphabet
        get new character at that index in normal alphabet
        replace character with new character 

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    concatenate transformed input character to ciphertext message 

    increment rotor wheels
</pre></div>


<h2>Incrementing the Rotor Wheels</h2>
<p>Each rotor wheel has a notch located at a particular letter.
The wheels were identified by the letter on which the notch was located 
(Rotor I was "Royal" because the notch was located at "R", and so on).</p>
<p>The notches were designed to catch on the notches of other rotor wheels,
in such a way that the wheels would turn together periodically.
The right-most wheel would rotate once per keypress. 
Once per 26 letters (if S = 26), the notch would catch the notch of the next rotor over
and advance it forward by 1 letter. It was this mechanism that kept the machine
constantly skipping through the space of possible keys, mapping each character to each other character,
with one distinct key (alphabet scramble) used per letter of the message.</p>
<p>To increment the wheels in pseudocode:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">increment</span> <span class="nx">rotors</span>:
    <span class="kt">for</span> <span class="nx">each</span> <span class="nx">rotor</span><span class="o">/</span><span class="nx">scrambled</span> <span class="nx">alphabet</span><span class="p">,</span> <span class="nx">left</span> <span class="nx">to</span> <span class="nx">right</span>:
        <span class="kt">get</span> <span class="nx">index</span> <span class="nx">of</span> <span class="nx">left</span> <span class="nx">notch</span> <span class="k">in</span> <span class="nx">left</span> <span class="nx">alphabet</span>
        <span class="nx">get</span> <span class="nx">index</span> <span class="nx">of</span> <span class="nx">right</span> <span class="nx">notch</span> <span class="k">in</span> <span class="nx">right</span> <span class="nx">alphabet</span>
        <span class="k">if</span> <span class="nx">left</span> <span class="nx">index</span> <span class="nx">equals</span> <span class="nx">right</span> <span class="nx">index</span>:
            <span class="kt">cycle</span> <span class="nx">left</span> <span class="nx">alphabet</span> <span class="nx">forward</span> <span class="mi">1</span> <span class="nx">character</span>
    <span class="nx">cycle</span> <span class="nx">right</span><span class="o">-</span><span class="nx">most</span> <span class="nx">alphabet</span> <span class="nx">forward</span> <span class="mi">1</span> <span class="nx">character</span>
</pre></div>


<h2>Enigma Pseudocode</h2>
<p>Almost there. We have one more thing going on - those rotor wheels are moving.
Add the "increment rotor wheels" verb, and define that below.</p>
<div class="highlight"><pre><span></span>define plaintext message
define normal alphabet and scrambled alphabets
define list of switchboard swap pairs
define list of reflector swap pairs
for each character in plaintext message:

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    # Apply forward rotor transformation
    for each rotor/scrambled alphabet:
        get index of character in normal alphabet
        get new character at that index in scrambled alphabet
        replace character with new character 

    # Apply reflector transformation
    for each pair in reflector swap pairs:
        if character in swap pair, swap its value

    # Apply reverse rotor transformation
    for each scrambled alphabet:
        get index of input character in scrambled alphabet
        get new character at that index in normal alphabet
        replace character with new character 

    # Apply switchboard transformation
    for each pair in switchboard swap pairs:
        if character in swap pair, swap its value

    concatenate transformed input character to ciphertext message 

    # Increment rotor wheels
    for each rotor/scrambled alphabet, left to right:
        get index of left notch in left alphabet
        get index of right notch in right alphabet
        if left index equals right index:
            cycle left alphabet forward 1 character
    cycle right-most alphabet forward 1 character
</pre></div>


<h2>Sources</h2>
<ol>
<li>"The Enigma Cipher". Tony Sale and Andrew Hodges. Publication date unknown. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm">https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm</a>&gt;</li>
</ol></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/ciphers.html">ciphers</a>
                    &nbsp;&nbsp;
                    <a href="/tag/enigma.html">enigma</a>
                    &nbsp;&nbsp;
                    <a href="/tag/encryption.html">encryption</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Enigma Cipher Implementation: Part 1: How It Works
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-03-21T20:00:00-07:00" pubdate>Tuesday 03/21/2017</time>
                in 
                <a href="/category/enigma.html">Enigma</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/enigma-cipher-implementation-part-1-how-it-works.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>This is the first of several posts that will walk through an implementation of the Enigma cipher in code.</p>
<p>Thanks to <a href="http://www.codesandciphers.org.uk/enigma/index.htm">the website of the late Tony Sale</a> for providing a wealth of 
detailed, accurate information entirely free of graduate level mathematics, 
and includes some very clear <a href="http://www.codesandciphers.org.uk/enigma/example1.htm">examples</a> for luddites like me who need everything spelled out really clearly.</p>
<p>There is also a Wikipedia article offering detailed information about the mathematical cryptanalysis of the Enigma,
and covering some of the strengths and weaknesses of the machine: <a href="https://en.wikipedia.org/wiki/Cryptanalysis_of_the_Enigma">Cryptanalysis of the Enigma</a>.</p>
<h2>Background</h2>
<p>The Enigma machine was a device used by the German military to encrypt communications during World War II.
The machine was essentially a large electronic circuit implementing a black-box encrypt/decrypt function.
By design, the circuitry of the machine could be used for both encryption and decryption. </p>
<p>The Enigma played an important role in the development of the first electronic computer. 
Alan Turing led a team at Bletchley Park, in England, that constructed machines that could crack the Enigma code.
This led to the development of the conceptual Turing machine and the creation of the first electronic computers.
By narrowing the space of possible keys using Enigma's weaknesses, 
these electronic computers could be used to explore the remaining key space.</p>
<p>There were several variations of the Enigma. Each operated on the same basic principle:
the operator entered a letter, which was transformed into a signal. 
That signal was passed through several components of the Enigma machine,
and underwent a series of linear transformations until its ciphertext was output.
The encrypted output character would light up on a second keyboard, and the operator could transcribe the message.</p>
<h2>Black Box Representation</h2>
<p>The following diagram lays out the Enigma circuitry using black boxes. 
The signal starts at the keyboard, where the operator types a letter.
That letter is transformed into an electrical signal, which is sent through a series of components.
First is the switchboard in the front, which swaps a few letter pairs.
Next, the signal passes through three rotor wheels, each of which scrambles the alphabet.
The signal is then passed into a reflector, which swaps every character with some other character.
The reflector made the Enigma a symmetric machine. The signal was sent out of the reflector and passed through each rotor in reverse order.
Finally, the signal passed through the switchboard at the front, and the resulting letter lit up, allowing the operator to transcribe the message.</p>
<p><img alt="Image: Enigma Black Box Representation" src="/images/enigma_blackbox.jpg"></p>
<h2>Components</h2>
<p>There were three principal components of the machine: a <strong>switchboard</strong>, a set of <strong>rotor wheels</strong>, and a <strong>reflector</strong>.</p>
<h3>Switchboard</h3>
<p>When the operator entered a key on the input keyboard, the key pressed was transformed into a signal.
On the front of the Enigma machine was a set of plugs, one for each letter. Operators would connect
pairs of letters using plugs, which would swap letters. If an operator connected the A and K ports, 
and typed "A" on the keyboard, the signal representing "A" would travel to the switchboard, 
where it would be transformed into the signal representing "K". </p>
<p>Typically the Enigma operators would only connect 7-10 pairs of letters, with the remaining 6-12 letters untransformed by the switchboard. 
The switchboard led to a huge number of possible encryption schemes, and was the single component that made the Enigma diffficult to crack.
Commercial versions of the Enigma, without the plugboard, were sold to banks and other entities in Germany, but without the plugboard,
the key space was reduced dramatically, making these codes "easy" to crack.</p>
<p><img alt="Enigma switchboard illustration" src="/images/enigma_switchboard.jpg"></p>
<p>The image above illustrates how a switchboard would work for a simple 8-symbol alphabet "ABCDEFGH". 
Only 3 of 4 pairings are made in this example. </p>
<h3>Rotor Wheels</h3>
<p>The rotor wheels were a set of interchangeable wheels that would perform a substitution cipher. 
Each wheel corresponded to a particular alphabet in scrambled order (these rotors were not performing simple shift Caesar ciphers).
Based on the order of the wheels, the signal, representing the letter the operator typed on the keyboard, 
that came out of the switchboard would undergo three alphabet scrambles (also called affine ciphers).</p>
<p>Because the wheels rotated with each keypress, the actual Affine cipher used by each wheel changed at each step.</p>
<p>To complicate the way the rotors turned, the designer of the Enigma added clasps and notches to each rotor at different letters.
When the notch of one rotor and the clasp of the rotor to the left matched, they would turn together. 
The right-most wheel rotated once each key press, the center wheel rotated once every 26 key presses, and the left wheel rotated once every 676 key presses.
Although these rates remained the same due to the number of notches, the exact locations of the notches dictated the timing of the rotations.
The ordering of the wheels and their initial settings were therefore important to how the message was encrypted or decrypted.</p>
<p>The German military distributed code books that contained daily settings for the Enigma machines, so that all Enigma operators had the same settings.
These code books specified which wheels to load into the Enigma (three out of five possible rotors I II III IV and V), as well as the initial rotation to apply to each.</p>
<p><img alt="Enigma rotor wheels illustration" src="/images/enigma_rotor.jpg"></p>
<p>The image above shows how the rotor would work for the 8-character alphabet "ABCDEFGH".
The wheel has a set arrangement of scrambled letters, but the scramble shifts each time the rotor is advanced.
This allows 1 wheel to provide as many different scrambles as there are symbols in the alphabet.</p>
<h3>Reflector</h3>
<p>Having passed through the three rotor wheels, each scrambling the original character signal input by the operator into the keyboard, the signal then entered the reflector. 
It did precisely what the name suggests - it reflected a signal back through the machine. 
Its design was very similar to the switchboard in the front of the machine, except it created 13 pairs of letters, so that every letter was paired with some other letter.
The reflector, like the rotor wheels, was removable and could be selected from a set. </p>
<p>The reflector is a curious part of the Enigma design, because it represents an attempt at convenience, which led to a gaping security flaw that Bletchley Park was able to exploit. 
The nature of the reflector is that it is symmetric: it pairs each letter with some other letter, and the pairings are mutual. 
If the reflector turns every "P" into "H", it also turns every "H" into "P". 
This symmetry gives the Enigma the property that you no longer need an "encrypt" or "decrypt" mode: if you take a plaintext message and run it through the Enigma machine once, you'll get the cipher text back. 
If you run it through the Enigma machine twice, you'll get the same plaintext back. 
This obviated the need for a switch on the Enigma, to go between "encrypt" and "decrypt" modes.</p>
<p>However, this property also means that no letter can ever be encoded as itself - a property called derangement. 
While the switch board at the front and the rotor wheel scrambles would sometimes encode a letter as itself 
(for example, Rotor I encodes "S" as "S", Rotor II encodes "A" as "A" and "Q" as "Q", and Rotor III encodes "N" as "N"),
the reflector would never do so. 
Thus, despite an astronomical number of possible settings, and complicated machinery and circuitry, 
no matter what the Enigma's settings, no letter would ever be encoded as itself.
This property can be exploited to rule out the location of certain words or phrases at certain locations in the message,
which is precisely how Bletchley Park attacked the Enigma cipher.</p>
<p><img alt="Enigma reflector illustration" src="/images/enigma_reflector.jpg"></p>
<p>The image above illustrates a reflector for the 8-symbol alphabet "ABCDEFGH".
Each of the 4 possible pairings are made, so no letter will be encoded to itself by the reflector.</p>
<p>Had the middle rotor wheels remained stationary, multiple wheels would have been redundant - 
any arbitrary sequence of alphabet scrambles can be collapsed into a single scramble.
However, the wheels were designed to rotate at various rates. Each time the wheels rotated,
it changed the scramble provided by the wheel that had rotated. </p>
<p>This means the Enigma worked by using a totally different scramble for each character in a message,
with the scrambles constantly changing, each character, over and over. 
Because the number of possible scrambles with a 26 character alphabet is <span class="math">\(26! = 403,291,461,126,605,635,584,000,000\)</span>,
which is a trillion trillions.</p>
<h2>The Enigma and Random Number Generators</h2>
<p>By using a mechanical device with the same construction and the same common initial settings, 
operators were able to generate random keys from an astronomical range of permutations, 
but in a mechanically reproducible way. </p>
<p>This makes Enigmas much like a random number generator, with the initial settings being the seed.
If there are 32 or 64 bits used to store a number, that's 32 or 64 bits of randomness. 
Large numbers of combinations indeed.</p>
<h2>Sources</h2>
<ol>
<li>
<p>"The Enigma Cipher". Tony Sale and Andrew Hodges. Publication date unknown. Accessed 18 March 2017.
&lt;<a href="https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm">https://web.archive.org/web/20170320081639/http://www.codesandciphers.org.uk/enigma/index.htm</a>&gt;</p>
</li>
<li>
<p>Copeland, B.J. "Alan Turing". Encyclopedia Britannica, Inc. Published 23 February 2016. Accessed 18 March 2017.</p>
</li>
<li>
<p>"Cryptanalysis of the Enigma". Wikipedia: The Free Encyclopedia. Wikimedia Foundation, Inc. Edited 11 January 2017. Accessed 18 March 2017.
&lt;<a href="https://en.wikipedia.org/wiki/Cryptanalysis_of_the_Enigma">https://en.wikipedia.org/wiki/Cryptanalysis_of_the_Enigma</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/ciphers.html">ciphers</a>
                    &nbsp;&nbsp;
                    <a href="/tag/enigma.html">enigma</a>
                    &nbsp;&nbsp;
                    <a href="/tag/encryption.html">encryption</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Math Sample
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2015-03-12T07:00:00-07:00" pubdate>Thursday 03/12/2015</time>
                in 
                <a href="/category/misc.html">misc</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/math-sample.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum sed tortor tortor. Vestibulum mattis gravida massa, vel placerat elit mollis vel. Donec facilisis erat ac congue dapibus. Nulla eu arcu ac purus interdum placerat. Pellentesque varius mauris vitae massa sollicitudin, nec varius augue feugiat. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Pellentesque id nunc a dolor volutpat molestie eget at ante. Sed molestie augue magna, id aliquam augue pharetra sed. Pellentesque venenatis dapibus mi ut elementum. Fusce quam sem, laoreet et auctor vel, lobortis vitae lacus. Quisque quis ligula a ex pellentesque dapibus at sit amet diam. Aenean in lectus eget neque volutpat interdum. Integer non tempor lorem, ac semper sem. Vivamus laoreet justo sed neque congue, eu fringilla mauris laoreet.</p>
<div class="math">$$
(a + b)^n = \sum_{k=0}^{n} \binom{n}{k} a^{n-k} b^{k}
$$</div>
<p>Cras in convallis sapien, vel pellentesque ante. In hac habitasse platea dictumst. Cras auctor maximus magna eget suscipit. Pellentesque congue ullamcorper justo vel scelerisque. Nulla a quam vitae justo viverra pharetra vitae in velit. Nullam sodales lacinia efficitur. In molestie dui purus, ac accumsan lacus posuere ut. Cras massa mauris, faucibus quis nisi sit amet, imperdiet scelerisque arcu. Nullam vel tortor id massa scelerisque vehicula dignissim feugiat velit. Sed ipsum mauris, pulvinar vitae felis nec, tristique accumsan nisi. Curabitur pretium nec felis eu blandit. Vivamus a sodales velit. Quisque iaculis mi quis dolor scelerisque, non tempor nibh mollis. Morbi sed eros euismod, elementum elit vitae, tempus neque.</p>
<div class="math">$$
\binom{n}{k} = \dfrac{n!}{(n-k)! k!}
$$</div>
<p>Morbi metus mi, semper id tincidunt ut, venenatis id velit. Sed at lobortis magna. Donec vulputate, odio ut blandit tincidunt, velit arcu volutpat erat, id suscipit tellus quam quis libero. Donec in molestie leo. Praesent imperdiet vulputate nibh, sed venenatis tellus volutpat vel. Aliquam arcu velit, fringilla at volutpat ut, vestibulum a lacus. Curabitur commodo purus eget eros interdum, vitae tempus lorem accumsan. Morbi et est a leo auctor ullamcorper. Ut scelerisque elementum magna, ut egestas elit convallis vel. Morbi est dolor, egestas quis purus in, tincidunt condimentum est. Vestibulum scelerisque mi lacinia molestie sagittis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed interdum arcu ligula, aliquam congue orci viverra vitae.</p>
<div class="math">$$
\dfrac{\partial \phi}{\partial t} + \nabla \cdot \mathbf{u} \phi = - \nabla \cdot J_{\phi} + S_{\phi}
$$</div>
<p>Suspendisse massa neque, gravida id urna at, maximus fringilla risus. Nulla nec faucibus dui, id luctus ipsum. Quisque eleifend tristique augue, tempor vestibulum leo accumsan id. Nulla facilisi. Cras tortor est, tempor a metus ut, lobortis sodales nunc. Phasellus a est porta, interdum purus vel, imperdiet lorem. Nulla dignissim, orci et suscipit volutpat, eros magna iaculis justo, vel rutrum lectus nisi at ipsum. Cras facilisis sapien sed massa pellentesque lacinia. Sed interdum commodo nulla non varius. Phasellus aliquet erat mauris, in gravida quam accumsan in.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2015</h2>

            <p class="archive">
            <a href="/math-sample.html">Math Sample</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>








<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>
<!--
<script type="text/javascript" src="/theme/js/leaflet-0.7.3.js"></script>
<script type="text/javascript" src="/theme/js/leaflet.ajax.min.js"></script>
--><footer id="contentinfo" class="body">
<hr />
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="http://d3js.org">D3.js</a>, <a href="http://angularjs.org">Angular.js</a>, and <a href="http://getpelican.com">Pelican</a>.
</p>

<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/jquery_load_template-1.4.5.min.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

</footer><!-- /#contentinfo -->
</body>
</html>