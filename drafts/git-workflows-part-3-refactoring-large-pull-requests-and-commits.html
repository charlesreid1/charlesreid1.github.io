<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Git Workflows, Part 3: Refactoring Large Pull Requests and Commits
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-11-21T20:00:00-08:00" pubdate>Thursday 11/21/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/git.html">Git</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/drafts/git-workflows-part-3-refactoring-large-pull-requests-and-commits.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li>Summary</li>
<li>Managing Complexity</li>
<li>Refactoring Large Branches</li>
<li>Refactoring Large Pull Requests</li>
<li>Refactoring Large Commits</li>
</ul>
<h1>Summary</h1>
<ul>
<li>
<p>If a feature branch or pull request gets too complicated and should be refactored
  into simpler pieces:</p>
<ul>
<li>Squash a set of commits together into a patch</li>
<li>Create a new feature branch from the original destination branch</li>
<li>Apply the patch to the new branch</li>
<li>Use <code>git add --patch</code> or <code>git add --edit</code> to selectively split out changes</li>
</ul>
</li>
<li>
<p>If a commit gets too large, you can rebase your branch, and mark that particular commit
  to be edited (<code>git rebase HASH_OF_COMMIT~1</code>). </p>
<ul>
<li>The rebase will replay that commit, and stage the changes, but will not 
  commit them, allowing you to edit the commit.</li>
<li>Use <code>git add --patch</code> or <code>git add --edit</code> to selectively split out changes</li>
<li>Remember you can also perform the same procedure on the resulting commits,
  further splitting each commit into sub-commits.</li>
</ul>
</li>
</ul>
<h1>Managing Complexity</h1>
<p>When collaborating on software, especially large software with people who are not the
primary developers, it is important to limit the complexity of features and proposed
changes. Why is it bad practice to propose large, complex changes?</p>
<ul>
<li>It is harder to review the proposed changes</li>
<li>Bugs increase in likelihood, and increase in likelihood far faster than the amount of code.</li>
<li>More complex changes usually combine </li>
</ul>
<h1>Refactoring Large Branches</h1>
<p>Consider the case of a large feature branch that is suffering from feature creep (trying to
cram too many changes into one branch.) For example, in the process of implementing a feature,
you may also implement significant fixups, refactoring of functions, and code cleanup that is
in the same file but not entirely related. While writing tests for the new feature, you may also
refactor tests to be cleaner, or to use context manager foobar, or etc.</p>
<p>To illustrate: suppose you are on a branch called <code>feature</code> (created off of <code>master</code>) that consists of
three sets of changes, DEF:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D1 - E1 - D2 - F1 - E2 - F2 - D3 - F3 - E3 (feature)
</pre></div>


<ul>
<li>D corresponds to implementing the new feature and writing tests for it</li>
<li>E corresponds to fixups to the same file that was changed to implement the feature</li>
<li>F corresponds to fixups to tests unrelated to the new feature</li>
</ul>
<p>Now, in reality, if things were really so clean, if you had a time machine or the patience to
to rebase commits one at a time and split them into atomic changes only to the features in their
scope (which would be super easy because of course your git logs are filled with helpful, concise
commit messages) you could use <code>git cherry-pick</code> to replay commits D1, D2, D3 onto a new D
branch, and so on. </p>
<p>But in reality, commit F1 contains a little bit of E1, and D2, and vice versa, and so on.
It's much easier to navigate a diff and select pieces from it.  That's were <code>git add -e</code>
(or <code>--edit</code>) will help.</p>
<p>We also have to turn a set of commits into a single set of unstaged changes (meaning, replay
the changes each commit made but not replay the commits themselves). There are a few ways
to do this, we'll cover two ways: squashing and rolling back a set of commits, and converting
a set of commits into a set of patch files.</p>
<p>Once the commits have been rolled back and unstaged, particular changes can be staged for each
split commit using <code>git add -e</code> and using the editor to select which changes to include or exclude
from the commit. As each commit is created, branches can be created that are linked to the group
of changes in each new commit.</p>
<h2>Converting Set of Commits to Unstaged Changes</h2>
<p>We are trying to untangle a set of unrelated changes into separate commits that group related
changes together. For the example, we want to convert this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D1 - E1 - D2 - F1 - E2 - F2 - D3 - F3 - E3 (feature)
</pre></div>


<p>to this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D - E - F
</pre></div>


<p>so that the changes in commits D, E, and F are simpler, more limited in scope, and easier to review.</p>
<h3>git format-patch</h3>
<div class="highlight"><pre><span></span>git format-patch
</pre></div>


<h3>squash and unstage</h3></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/git.html">git</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/rebase.html">rebase</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/cherry-pick.html">cherry-pick</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/branching.html">branching</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/version-control.html">version control</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>

</div>


<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>