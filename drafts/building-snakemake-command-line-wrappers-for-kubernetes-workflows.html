<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Building Snakemake Command Line Wrappers for Kubernetes Workflows
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-01-23T22:00:00-08:00" pubdate>Wednesday 01/23/2019</time>
                in 
                <a href="/category/snakemake.html">Snakemake</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/drafts/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p><strong>NOTE:</strong> These ideas are implemented in the repository
<a href="https://github.com/charlesreid/2019-snakemake-byok8s">charlesreid1/2019-snakemake-byok8s</a>.</p>
<p><br />
<br /></p>
<h2>Table of Contents:</h2>
<ul>
<li><a href="#exe">Recap: Workflows as Executables</a><ul>
<li><a href="#2018">2018-snakemake-cli</a></li>
<li><a href="#2019">2019-snakemake-cli</a></li>
<li><a href="#byok8s">2019-snakemake-byok8s</a></li>
</ul>
</li>
<li><a href="#byok8s2">Overview of 2019-snakemake-byok8s</a><ul>
<li><a href="#k8s">Cloud + Scale = Kubernetes</a></li>
<li><a href="#smkk8s">Snakemake k8s support</a></li>
</ul>
</li>
<li><a href="#cli">Modifying the CLI</a><ul>
<li><a href="#ns">Namespaces</a></li>
<li><a href="#flags">Adding flags</a></li>
</ul>
</li>
<li><a href="#minikube">Local Kubernetes Clusters with Minikube</a><ul>
<li><a href="#aws">AWS</a></li>
<li><a href="#dns-aws">Fixing DNS issues with AWS</a></li>
<li><a href="#travis">Travis</a></li>
<li><a href="#dns-travis">Fixing DNS issues with Travis</a></li>
</ul>
</li>
<li><a href="#byok8s3">End Product: byok8s</a></li>
<li><a href="#docs">Documentation</a></li>
<li><a href="#next">Next Steps</a></li>
</ul>
<p><br />
<br /></p>
<p><a name="exe"></a></p>
<h1>Recap: Workflows as Executables</h1>
<p>In our previous blog post, <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers.html">Building Snakemake Command Line Wrappers</a>,
we covered some approaches to making Snakemake
workflows into executables that can be run as
command line utilities.</p>
<p>In this post, we extend those ideas to Snakemake workflows
that run on Kubernetes clusters.</p>
<p><a name="2018"></a></p>
<h2>2018-snakemake-cli</h2>
<p>To recap, back in March 2018 Titus Brown wrote a blog post titled
<a href="http://ivory.idyll.org/blog/2018-workflows-applications.html">Pydoit, snakemake, and workflows-as-applications</a>
in which he implemented a proof-of-concept command
line utility wrapping the Snakemake API to create
an executable Snakemake workflow.</p>
<p>The end result was a command line utility that could
be run like so:</p>
<div class="highlight"><pre><span></span>./run &lt;workflow-config&gt; &lt;workflow-params&gt;
</pre></div>


<p>Relevant code is in <a href="https://github.com/ctb/2018-snakemake-cli">ctb/2018-snakemake-cli</a>.</p>
<p><a name="2019"></a></p>
<h2>2019-snakemake-cli</h2>
<p>In our previous blog post, <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers.html">Building Snakemake Command Line Wrappers</a>,
we extended this idea to create a bundled executable
command line utility that could be installed with
<code>setup.py</code> and run from a working directory. We also
demonstrated a method of writing tests for the 
Snakemake workflow and running those tests with
Travis CI.</p>
<p>We packaged the Snakefile with the command line utility,
but the approach is flexible and can be modified to
use a user-provided Snakemake workflow or Snakefile.</p>
<p>The end result was a command line utility called
<code>bananas</code> that could be installed and run like
the <code>run</code> wrapper above:</p>
<div class="highlight"><pre><span></span>bananas &lt;workflow-config&gt; &lt;workflow-params&gt;
</pre></div>


<p>Relevant code is in <a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<p><a name="byok8s"></a></p>
<h2>2019-snakemake-byok8s</h2>
<p>The next logical step in bundling workflows was to take
advantage of Snakemake's ability to run workflows across
distributed systems.</p>
<p>Specifically, we wanted to modify the command line utility
above to run the workflow on a user-provided Kubernetes
cluster, instead of running the workflow locally.</p>
<p>The result is <a href="https://github.com/charlesreid1/2019-snakemake-byok8s">2019-snakemake-byok8s</a>,
a command line utility that can be installed with
a <code>setup.py</code> and that launches a Snakemake workflow 
on a user-provided Kubernetes cluster. Furthermore,
we demonstrate how to use minikube to run a local
Kubernetes cluster to test Snakemake workflows on
Kubernetes clusters.</p>
<p>Here's what it looks like in practice:</p>
<div class="highlight"><pre><span></span># Install byok8s
python setup.py build install

# Create virtual k8s cluster
minikube start

# Run the workflow on the k8s cluster
cd /path/to/workflow/
byok8s my-workflowfile my-paramsfile --s3-bucket=my-bucket

# Clean up the virtual k8s cluster
minikube stop
</pre></div>


<p>We cover the details below.</p>
<p><a name="byok8s2"></a></p>
<h1>Overview of 2019-snakemake-byok8s</h1>
<p><a name="k8s"></a></p>
<h2>Cloud + Scale = Kubernetes (k8s)</h2>
<p>First, why kubernetes (k8s)?</p>
<p>To scale Snakemake workflows to multiple compute nodes,
it is not enough to just give Snakemake a pile of
compute nodes and a way to remotely connect to each.
Snakemake requires the compute nodes to have a 
controller and a job submission system.</p>
<p>When using cloud computing platforms like GCP or AWS,
k8s is a simple and popular way to orchestrate
multiple compute nodes (support for Docker images
is also baked into k8s).</p>
<p><a name="smkk8s"></a></p>
<h2>Snakemake k8s Support</h2>
<p>Snakemake has built-in support for k8s, making
the combination a logical choice for running 
Snakemake workflows at scale in the cloud. </p>
<p>The <code>minikube</code> tool, which we will cover later
in this blog post, makes it easy to run a local
virtual k8s cluster for testing purposes, and
even makes it possible to run k8s tests using
Travis CI.</p>
<p>Snakemake only requires the <code>--kubernetes</code> flag,
and an optional namespace, to connect to
the k8s cluster. (Under the hood, Snakemake
uses the Kubernetes Python API to connect
to the cluster and launch jobs.)</p>
<p>If you can run <code>kubectl</code> from a computer
to control the Kubernetes cluster, you can
run a Snakemake workflow on that cluster.</p>
<p>Let's get into the changes required in the Python code.</p>
<p><a name="cli"></a></p>
<h1>Modifying the CLI</h1>
<p>In our <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers.html">prior post</a>
covering <a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>,
we showed how to create a command line utility
using the <code>cli/</code> directory for the command line
interface package, and specifying it is a cli
entrypoint in <code>setup.py</code>:</p>
<div class="highlight"><pre><span></span>cli/
├── Snakefile
├── __init__.py
└── command.py
</pre></div>


<p>and the relevant bit from <code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[console_scripts]</span>
<span class="s2">{program} = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
</pre></div>


<p>We want our new command line utility, <code>byok8s</code>, to work
the same way, so we can do a <code>s/byok8s/bananas/g</code>
across the package.</p>
<p>The only change required happens in the file
<code>command.py</code>, where the Snakemake API call 
happens.</p>
<p><a name="ns"></a></p>
<h2>Nmespaces</h2>
<p>Checking the <a href="https://snakemake.readthedocs.io/en/stable/api_reference/snakemake.html">Snakemake API documentation</a>,
we can see that the API has a <code>kubernetes</code> option:</p>
<blockquote>
<p><strong>kubernetes</strong> <em>(str)</em> – submit jobs to kubernetes,
using the given namespace.</p>
</blockquote>
<p>so <code>command.py</code> should modify the Snakmake API call
accordingly, adding a kubernetes namespace.
This is a parameter the user usually won't need
to provide (<code>default</code> is the typical namespace
we want to use) but we added a <code>-k</code> argument
to the ArgParser to allow the user to specify
the Kubernetes namespace name. By default
the Kubernetes namespace used is <code>default</code>.</p>
<p><a name="flags"></a></p>
<h2>Adding flags</h2>
<p>We add and modify some flags to make the workflow
more flexible:</p>
<ul>
<li>
<p>The user now provides the Snakefile, which is
  called <code>Snakefile</code> in the current working directory
  by default but can be specified with the <code>--snakefile</code>
  or <code>-s</code> flag</p>
</li>
<li>
<p>The user provides the k8s namespace using the
  <code>--k8s-namespace</code> or <code>-k</code> flag</p>
</li>
<li>
<p>The user provides the name of an S3 bucket for
  Snakemake worker nodes to use for I/O using the
  <code>--s3-bucket</code> flag</p>
</li>
</ul>
<p>Finally, the user is also required to provide their
AWS credentials to access the S3 bucket, via two
environment variables that Snakemake passes through
to the Kubernetes worker nodes:</p>
<div class="highlight"><pre><span></span>AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
</pre></div>


<p>For Travis CI testing, these environment variables
can be set in the repository settings on the Travis
website once Travis CI has been enabled.</p>
<p>See <a href="https://charlesreid1.github.io/2019-snakemake-byok8s/travis_tests/">https://charlesreid1.github.io/2019-snakemake-byok8s/travis_tests/</a>
for details.</p>
<p><a name="minikube"><a></p>
<h1>Local Kubernetes Clusters with Minikube</h1>
<p><a name="aws"></a></p>
<h2>AWS</h2>
<p><a name="dns-aws"></a></p>
<h2>Fixing DNS issues with AWS</h2>
<p><a name="travis"></a></p>
<h2>Travis</h2>
<p><a name="dns-travis"></a></p>
<h2>Fixing DNS issues with Travis</h2>
<p><a name="byok8s3"></a></p>
<h1>End Product: byok8s</h1>
<p><a name="docs"></a></p>
<h1>Documentation</h1>
<p><a name="next"></a></p>
<h1>Next Steps</h1>
<hr>
<p>Relevant portion of <code>cli/command.py</code> for
2019-snakemake cli and <code>bananas</code>:</p>
<div class="highlight"><pre><span></span>    <span class="o">...</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;details!&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">snakefile: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">snakefile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">config: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workflowfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">params: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramsfile</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">target: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;--------&#39;</span><span class="p">)</span>

    <span class="c1"># run bananas!!</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">snakemake</span><span class="p">(</span><span class="n">snakefile</span><span class="p">,</span> 
                                 <span class="n">configfile</span><span class="o">=</span><span class="n">paramsfile</span><span class="p">,</span>
                                 <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> 
                                 <span class="n">printshellcmds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                 <span class="n">dryrun</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">,</span> 
                                 <span class="n">forceall</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span> <span class="c1"># translate &quot;success&quot; into shell exit code of 0</span>
       <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>The last component here is to make the function
in <code>cli/command.py</code> the entrypoint of a command line
utility called <code>bananas</code>, which can be done via
<code>setup.py</code>. This will put the executable <code>bananas</code>
in the Python binaries folder when the package is
installed.</p>
<p><code>setup.py</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;requirements.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)]</span>

<span class="c1"># Note: the _program variable is set in __init__.py.</span>
<span class="c1"># it determines the name of the package/final command line tool.</span>
<span class="kn">from</span> <span class="nn">cli</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">_program</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">],</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s1">&#39;pytest.collector&#39;</span><span class="p">,</span>
      <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">],</span>
      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;bananas command line interface&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://charlesreid1.github.io/2019-snakemake-cli&#39;</span><span class="p">,</span>
      <span class="n">author</span><span class="o">=</span><span class="s1">&#39;@charlesreid1&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;cmreid@ucdavis.edu&#39;</span><span class="p">,</span>
      <span class="n">license</span><span class="o">=</span><span class="s1">&#39;MIT&#39;</span><span class="p">,</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      [console_scripts]</span>
<span class="s2">      {program} = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>First, we grab the variables from <code>__init__.py</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cli</span> <span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">_program</span>
</pre></div>


<p>Next we specify where our package lives, the <code>cli</code> directory:</p>
<div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cli&#39;</span><span class="p">],</span>
</pre></div>


<p>and finally, we specify that we want to build a command line 
interface, with the entrypoint being the <code>main()</code> method of the
<code>cli/command.py</code> file using <code>entry_points</code>:</p>
<div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bananas&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[console_scripts]</span>
<span class="s2">{program} = cli.command:main</span>
<span class="s2">      &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program</span> <span class="o">=</span> <span class="n">_program</span><span class="p">),</span>
</pre></div>


<p><a name="using"></a></p>
<h1>End Result: Using bananas</h1>
<p>The end result is a command line utility that bundles a
Snakemake workflow. The repository contains some tests,
so let's run through the quick start installation and
run the tests.</p>
<h2>Quick Start: Installing</h2>
<p>Start by setting up a virtual environment:</p>
<div class="highlight"><pre><span></span>virtualenv vp
<span class="nb">source</span> vp/bin/activate
</pre></div>


<p>Install required components, then install the package:</p>
<div class="highlight"><pre><span></span>pip install -r requirements.txt
python setup.py build install
</pre></div>


<p>Now you should see <code>bananas</code> on your path:</p>
<div class="highlight"><pre><span></span>which bananas
</pre></div>


<h2>Quick Start: Running Tests</h2>
<div class="highlight"><pre><span></span>pytest
</pre></div>


<h2>Quick Start: Running Examples</h2>
<p>Change to the <code>test/</code> directory and run tests with
the example config and param files.</p>
<div class="highlight"><pre><span></span>cd test
</pre></div>


<p>Run the hello workflow with Amy params:</p>
<div class="highlight"><pre><span></span>rm -f hello.txt
bananas workflow-hello params-amy
</pre></div>


<p>Run the hello workflow with Beth params:</p>
<div class="highlight"><pre><span></span>rm -f hello.txt
bananas workflow-hello params-beth
</pre></div>


<p>Run the goodbye workflow with Beth params:</p>
<div class="highlight"><pre><span></span>rm -f goodbye.txt
bananas workflow-goodbye params-beth
</pre></div>


<p><a name="travis"></a></p>
<h1>Adding Travis CI Tests</h1>
<p>To test or workflow, we break down the necessary tasks:</p>
<ul>
<li>Use a Python environment</li>
<li>Install our requirements (snakemake)</li>
<li>Install bananas with setup.py</li>
<li>Run pytest</li>
</ul>
<p>This is an easy Travis file to write, following the
<a href="https://docs.travis-ci.com/user/languages/python/">Travis docs</a>.</p>
<p><code>.travis.yml</code>:</p>
<div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="nt">python</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.5&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;3.6&quot;</span>
  <span class="c1">#- &quot;3.7-dev&quot; # fails due to datrie build failure (snakemake dependency)</span>

<span class="c1"># command to install dependencies</span>
<span class="nt">install</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python setup.py build install</span>

<span class="c1"># command to run tests</span>
<span class="nt">script</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pytest</span>
</pre></div>


<p><a name="repo"></a></p>
<h1>Final Repository</h1>
<p>All of the code for this repository is in
<a href="https://github.com/charlesreid1/2019-snakemake-cli">charlesreid1/2019-snakemake-cli</a>.</p>
<p>See the <a href="https://github.com/charlesreid1/2019-snakemake-cli/releases/tag/v2.0">v2.0 tag</a>
in case there are changes to the code that are not reflected in
this blog post.</p>
<p><a name="next"></a></p>
<h1>Next Steps</h1>
<p>This demo provides a starting point for creating executable Snakemake
workflows that are installable.</p>
<p>A few open question and directions:</p>
<ul>
<li>
<p>Bundling the Snakefile vs. user-provided Snakefles</p>
<ul>
<li>There is obviously more utility and flexibility in letting the user provide Snakefiles.</li>
<li>User-provided Snakefiles provide more ways for workflows to go wrong.</li>
<li>Testing is either more difficult, or shifted to the workflow author.</li>
<li>Bundled Snakefiles take the burden of writing the workflow off of the user,
  so they can focus on param/config files.</li>
</ul>
</li>
<li>
<p>Kubernetes</p>
<ul>
<li>Can we make the command line wrapper work with a Kubernetes cluster?</li>
<li>See <a href="https://github.com/charlesreid1/2019-snakemake-byok8s">charlesreid1/2019-snakemake-byok8s</a>
  for proof of concept.</li>
</ul>
</li>
<li>
<p>Applications</p>
<ul>
<li>How can we apply this concept?</li>
<li><a href="https://github.com/spacegraphcats/spacegraphcats">spacegraphcats</a></li>
<li><a href="https://github.com/dib-lab/eelpond">eelpond</a></li>
<li><a href="https://github.com/dahak-metagenomics/dahak">dahak</a> and 
  <a href="https://github.com/dahak-metagenomics/dahak-taco">dahak-taco</a> </li>
</ul>
</li>
</ul></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="/tag/bioinformatics.html">bioinformatics</a>
                    &nbsp;&nbsp;
                    <a href="/tag/workflows.html">workflows</a>
                    &nbsp;&nbsp;
                    <a href="/tag/pipelines.html">pipelines</a>
                    &nbsp;&nbsp;
                    <a href="/tag/snakemake.html">snakemake</a>
                    &nbsp;&nbsp;
                    <a href="/tag/travis.html">travis</a>
                    &nbsp;&nbsp;
                    <a href="/tag/kubernetes.html">kubernetes</a>
                    &nbsp;&nbsp;
                    <a href="/tag/minikube.html">minikube</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>

</div>


<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>