<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <!--
        <link href="/theme/css/cyborg.css"          rel="stylesheet" type="text/css">
        <link href="/theme/css/cosmo.css"           rel="stylesheet" type="text/css">
        <link href="/theme/css/sandstone.css"       rel="stylesheet" type="text/css">
        -->
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>


        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com:3000/explore">Git.charlesreid1.com</a>
                    </li>
                    <li>
                        <a href="https://github.com/charlesreid1/charlesreid1-awesome/">charlesreid1 Awesome List</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/notes">Notes</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/contact">Contact Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Mad Combinatoric Castles
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-07-25T18:00:00-07:00" pubdate>Tuesday 07/25/2017</time>
                in 
                <a href="/category/mathematics.html">Mathematics</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/drafts/mad-combinatoric-castles.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li><a href="#castles-problem">Overview: The Problem</a></li>
<li><a href="#polyominoes">Polyominoes</a></li>
<li>Generating Functions</li>
<li>Problem 502 Analytical Model(s)</li>
<li>Problem 502 Solution Approaches</li>
</ul>
<p><a name="castles-problem"></a></p>
<h1>Overview: The Problem</h1>
<p>In an earlier post, I mentioned <a href="https://charlesreid1.com/wiki/Project_Euler">my efforts on Project Euler</a>
and the wide variety of problems there that can offer some profound mathematical insights.</p>
<p>Given that the first post covered problem #1, I thought it would be nice
if the next problem cranked up the difficulty factor by an order of magnitude.
Problem 502 is a very hairy combinatorics problem that required me to learn about 
a wide variety of combinatorial enumeration techniques.</p>
<p>Let's start with the problem statement.</p>
<h2>Building Castles</h2>
<p>Problem 502 is about building castles. The problem gives an <span class="math">\(M \times N\)</span> rectangular grid,
and asks us to count how many "caastles" can be built on the rectangular grid, given its maximum
height. Here is how the game works:</p>
<p>First, start by defining a block as a rectangle of height 1, and an integer-valued length.
A castle is a configuation of stacked blocks.</p>
<p>For a game grid of size <span class="math">\(M \times N\)</span>, we can construct castles according to
the following rules:
<em> Blocks can be placed on top of other blocks, but no sticking out past edge
</em> All blocks aligned to grid
<em> Two neighboring blocks must have 1 unit of space between them
</em> Maximum achieved height of castle is EXACTLY M
* Castle is made from even number of blocks</p>
<p>Here is an example W = 8, H = 5 castle given in more compact notation:</p>
<div class="highlight"><pre><span></span>  #   # 
  #   ##
 ## # ##
##### ##
########
</pre></div>


<p>We can also build more complicated castles, like this 10 by 100 castle:</p>
<div class="highlight"><pre><span></span>X       X      XX    X     XX   XX X X                          X XX          XX   XX  X     X   XXX
X       X      XX    X     XX X XX X X     X     X             XX XX          XX   XX  X     X   XXX
X      XX      XX    X     XX X XXXX X     X     X             XX XX          XX   XX  X     X   XXX
X      XX      XX    X     XX X XXXX X     X     X XXX         XX XX          XX X XX  X     X   XXX
X      XX     XXX    X     XX X XXXX X  X  X     X XXX X X     XX XX          XX X XX  X  X  X   XXX
X      XX  X  XXX  X X     XXXX XXXX X  XX X    XX XXX X X   X XX XX          XX XXXX  X XX XX  XXXX
X  XX  XX  X  XXX  X X     XXXX XXXX XX XX XX XXXX XXX X XXX X XX XX    X     XX XXXXX X XX XX XXXXX
X  XX  XXX X  XXX  X X   X XXXX XXXX XX XX XX XXXX XXXXX XXX XXXX XX  X X     XX XXXXX X XX XXXXXXXX
X XXXXXXXX X XXXXXXX X XXXXXXXX XXXXXXX XX XX XXXXXXXXXXXXXX XXXX XX XX X  XX XX XXXXXXXXXX XXXXXXXX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></div>


<p>Our objective in this problem is to enumerate all possible castles. Let <span class="math">\(F(x,y)\)</span> denote the number of 
unique castles with a width of x and a height of exactly y. The problem gives use the trivial number
<span class="math">\(F(4,2) = 10\)</span>. The problem also gives <span class="math">\(F(13,10)\)</span> and <span class="math">\(F(10,13)\)</span>, both of which are absolutely enormous numbers.</p>
<p>This should be your first giant red flag that manual enumeration through a traversal of combinatoric space 
is absolutely, positively out of the question. We'll explain why in more detail below, but suffice to say,
there is a combinatoric explosion that occurs for castles larger than 10, so castles with a width of 
1 trillion are going to get STUPID big.</p>
<p>Then we're given <span class="math">\(F(100,100)\)</span>, which is so enormous it has to be reported mod 1,000,000,007.</p>
<p>Finally, the problem asks us the following whopper of a question:</p>
<p>What is <span class="math">\(F(10^{12},100) + F(10^4, 10^4) + F(100,10^{12}) mod 1,000,000,007\)</span>? </p>
<p>Whew.</p>
<h2>The Scale of the Problem</h2>
<p>For solving this problem it is important to take a step back and think through
the size of the combinatoric space being searched, and what methods we have for 
carving out that space.</p>
<p>As already mentioned, the size of this problem - the actual number of 
castles - is surely larger than the <a href="https://charlesreid1.com/wiki/Eddington_Number">Eddington number</a>, 
the number of protons in the known universe. The numbers of combinations are 
STUPID big. There's no way for the mind to fully wrap itself around the concept.</p>
<p>The huge numbers involved means, we must have a closed-form expression for <span class="math">\(F(x,y)\)</span> that we can
evaluate once to get each of the <span class="math">\(F(10^{12},100), F(10^4,10^4), F(100,10^{12})\)</span> required by the answer.
Doing so much as counting to 1 trillion takes minutes on modern computers, so if you're doing anything else
1 trillion times, you'll end up waiting a loooong time.</p>
<h2>Generating Functions</h2>
<p>As it turns out, there is indeed a combinatorial enumeration method that does not require 
explicitly finding or generating each permutation in order to count all permutations.
I have covered <a href="https://charlesreid1.com/wiki/Generating_Functions">generating functions on the wiki</a>.
The principal idea behind generating functions is the observation that we can rearrange the 
infinite series:</p>
<div class="math">$$
G(z) = 1 + z + z^2 + z^3 + \dots
$$</div>
<p>into the equation </p>
<div class="math">$$
G(z) = \dfrac{1}{1-z}
$$</div>
<p>This single identity leads to a whole family of solution techniques for generating functions.
The basic idea is to start by writing the rules of your system (see above), 
then write a generating function that varies with characteristic variables of the problem 
(width and height in this case, possibly others),
and last, combine the generating functions of different rules or objects into a single generating function.</p>
<h1>Overview of Polyominoes</h1>
<p>Let us begin by considering a plane <span class="math">\(\pi\)</span> of positive integers, <span class="math">\(pi = \mathbb{N} \times \mathbb{N}\)</span>.</p>
<p>Let a polyomino denote a two-dimensional shape formed by connecting contiguous unit square tiles
together, all of which align to the 2D grid of integers <span class="math">\(\pi\)</span>. 
(Keep the definition general here, because there are lots of kinds of polyomonioes.)
If you have already played Tetris, or John Conway's Game of Life, you will recognize
polyominoes from those contexts.</p>
<p>Now, we set up our generating function in terms of characteristics of the problem.
It is very important to note that, while most of the rules are fairly straightforward to translate into
a polyomonio type of framework, Rule 6 is not. In fact, it is probably Rule 6 that makes Problem 502
so challenging. Were it not for Rule 6, this would be a nearly-trivial problem.</p>
<p>Let's revisit our rules and translate them into polyomino equivalents.</p>
<h2>Castle Rules for Polyominoes</h2>
<h3>Generating Function Variables</h3>
<p>We want to construct a multivariate ordinary generating function for our castles, since we have 
several variables we want to change, and get back a total count of castles.</p>
<p>The two most obvious variable choices for our generating function independent variables 
are width <span class="math">\(x\)</span> and height <span class="math">\(y\)</span>. Surely, these must be in the final generating function.</p>
<p>However, this still doesn't give us enough information about the construction process 
from step to step. Imagine that we place the first block on row 1.</p>
<p>Then we may place as many blocks as we would like along row 2, wherever we would like 
(level 2 is the least restricted layer of the castle).</p>
<p>Now, when we get to row 3, we are only allowed to keep building where there is already 
an existing tower from the prior row. This means, we have to pass along information 
from the prior row - where the bricks are located and how many - so that we know where
the next level may build towers.</p>
<p>This will remain an open question until we cover a few other representations of 
Problem 502 and ways of modeling it. Then we will cover what additional
variables our generating function might need.</p>
<h3>Rule 1: No Overhangs</h3>
<p>Rule 1 stipulates that blocks can be placed on top of other blocks as long as nothing sticks out past the end or hags out.</p>
<p>This ensures that the resulting polyomino is column convex. Column convexity is the property that 
we can draw a vertical line through any column of the polyomino, and we only intersect the polyomino
in two places. (No internal breaks.)</p>
<p>This rule stipulates what kind of polyomino constructions are allowed.</p>
<h3>Rule 2: Snap to Grid</h3>
<p>This rule is just saying that the unit squares in the castle problem
match the unit squares of polyominoes, ensuring the problems are 
interchangeable.</p>
<h3>Rule 3: Neighbor Blocks Need Space</h3>
<p>Rule 3 is crucial for being able to count blocks. If two side-by-side
contiguous unit squares could be either one or two blocks, this would make
the final count of solutions much, much, much, much, much bigger than it should be.</p>
<h3>Rule 4: Bottom Row is One Block</h3>
<p>This is more of an accounting-based rule, but we define our castle construction process
such that it begins with a completed row. This means that the number of blocks that we add
on top of that single block must be odd overall.</p>
<h3>Rule 5: Maximum Height is Exactly H</h3>
<p>As it turns out, the last two rules are the toughest - in a sense, because they are 
<strong>global</strong> conditions on the combinatoric solution that is being counted.
In other words, we will use generating functions to "construct" our combinatoric objects 
in a methodical way, and the challenge is on setting global conditions on the 
generating function's counted solutions.</p>
<h3>Rule 6: Even Number of Blocks</h3>
<p>Rule 6 is definitely what makes this problem difficult. </p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="/tag/mathematics.html">mathematics</a>
                    &nbsp;&nbsp;
                    <a href="/tag/factors.html">factors</a>
                    &nbsp;&nbsp;
                    <a href="/tag/sequences.html">sequences</a>
                    &nbsp;&nbsp;
                    <a href="/tag/project-euler.html">project euler</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>

</div>


<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>
<!--
<script type="text/javascript" src="/theme/js/leaflet-0.7.3.js"></script>
<script type="text/javascript" src="/theme/js/leaflet.ajax.min.js"></script>
--><script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>