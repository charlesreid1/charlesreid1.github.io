<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Traveling Schoolteacher Problem
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-30T13:00:00-07:00" pubdate>Sunday 04/30/2017</time>
                in 
                <a href="https://charlesreid1.github.io/category/java.html">Java</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><ul>
<li><a href="#tstp-intro">The Traveling Schoolteacher Problem</a></li>
<li><a href="#tstp-math">The Mathematical Model</a></li>
<li><a href="#tstp-pseudocode">The Pseudocode</a> </li>
<li><a href="#tstp-java">The Java Code</a> <ul>
<li><a href="#tstp-classes">TSTP Class Fields and Methods</a> </li>
<li><a href="#tstp-base">Explore: Base Case</a> </li>
<li><a href="#tstp-recursive">Explore: Recursive Case</a> </li>
</ul>
</li>
<li><a href="#tstp-graphs">Example Graphs</a> </li>
<li><a href="#tstp-results">Results</a><ul>
<li><a href="#tstp-walltime-nodes">Walltime vs Number of Nodes</a></li>
</ul>
</li>
<li><a href="#tstp-conclusion">Conclusion</a></li>
<li><a href="#tstp-references">References</a></li>
</ul>
<p><a name="tstp-intro"></a></p>
<h2 id="the-traveling-schoolteacher-problem">The Traveling Schoolteacher Problem</h2>
<p>The Traveling Schoolteacher Problem (TSTP) is a variation on the Traveling Salesperson Problem (TSP).</p>
<p>The Traveling Schoolteacher Problem supposes a schoolteacher that is traveling from school to school
in order to give lessons at different schools. Being a poor schoolteacher, they are only able to afford an older car that gets bad mileage and has a small gas tank.</p>
<p>After visiting each school, the schoolteacher receives payment from the school, in the currency of <span class="math">\(P\)</span> gallons of gasoline. 
Different schools pay the teacher different amounts of gasoline, further complicating matters. The schoolteacher's car has a 
small gas tank that can only hold a maximum of <span class="math">\(M\)</span> gallons of gas, and the schoolteacher cannot travel with cans of gasoline. 
Any gasoline the schoolteacher receives above <span class="math">\(M\)</span> gallons of gas must be left behind. </p>
<p>Traveling from a source node to a target node incurs a cost of <span class="math">\(C\)</span> gallons of gas, deducted from the gas tank's total at the source node.</p>
<p>In an attempt to minimize losses and avoid running out of gas, the traveling schoolteacher must plan out a route 
that both avoids running out of gas and minimizes the total distance traveled.</p>
<p><a name="tstp-math"></a></p>
<h2 id="the-mathematical-model">The Mathematical Model</h2>
<p>To represent this problem in the computer, we can use a graph - just like the Traveling Salesperson Problem solution - but modified a bit. Like the TSP, we can also solve the Traveling Schoolteacher Problem with recursive backtracking.</p>
<p>Each edge will represent a cost in gas, and each school arrived at will result in a payment in gas. Thus, the "real cost" of an edge will change depending on the state of the gas tank and the path taken to arrive there. </p>
<p>We can add a number to each node to represent the amount of gas that that school pays the schoolteacher.
We can use a number in each edge to represent the amount of gas that it costs to travel from one school to another.
The backtracking solution will explore various paths through teh graph, keeping track of the gas tank's running total and rejecting any paths that lead to an empty gas tank.</p>
<p><a name="tstp-pseudocode"></a></p>
<h2 id="the-pseudocode">The Pseudocode</h2>
<p>Revisiting the original Traveling Salesperson Problem, the recursive backtracking method we implemented was described with the following pseudocode:</p>
<div class="highlight"><pre><span></span><code>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        if current distance is greater than current minimum:
            skip
        else:
            for neighbor in unvisited neighbors:
                visit neighbor
                explore(new_neighbors)
                unvisit neighbor
</code></pre></div>

<p>To modify this to solve the Traveling Schoolteacher Problem, we want to make a few additions:</p>
<ul>
<li>Check if the gas tank is empty, and if so, don't explore this path</li>
<li>Check if the current distance is greater than our current minimum-distance path through the graph</li>
<li>Add gas from each school to the gas tank (up to the tank's maximum), subtract gas from each path from the gas tank</li>
</ul>
<p>This results in the following pseudocode:</p>
<div class="highlight"><pre><span></span><code>explore(neighbors):

    if(no more unvisited neighbors):
        # This is the base case.
        if total distance is less than current minimum:
            save path and new minimum

    else:
        # This is the recursive case.
        if gas tank is below empty:
            skip
        if current distance is greater than current minimum:
            skip
        else:
            add gas from this school to gas tank
            for neighbor in unvisited neighbors:
                visit neighbor
                deduct gas to get to neighbor from gas tank

                explore(new_neighbors)

                unvisit neighbor
                add gas back into gas tank
</code></pre></div>

<p>Once you have a backtracking algorithm for the original Traveling Salesperson Problem TSP, it's quite easy to make the few modifications required to solve the Traveling Schoolteacher Problem TSTP.</p>
<p><a name="tstp-java"></a></p>
<h2 id="the-java-code">The Java Code</h2>
<p>The Java code to solve the TSTP is organized into several classes:</p>
<ul>
<li>TSTP class - implements the recursive backtracking solution method, and owns temporary variables used by backtracking.</li>
<li>Node class - the Node is a lightweight class that stores an integer, representing the amount of gas this school pays the teacher. (Note, Node stores no links. Graph links handled by Guava.)</li>
<li>Edge class - the Edge class is a lightweight class that stores an integer for each edge, representing the amount of gas this path costs to travel.</li>
<li>RandomNodeGraph - a static class that builds random graphs with nodes and edges pre-populated with values. Parameters like connectivity and maximum gas tank capacity can be passed to introduce variation and ensure the graph is solvable (or not).</li>
</ul>
<p><a name="tstp-classes"></a></p>
<h3 id="tstp-class-fields-and-methods">TSTP Class Fields and Methods</h3>
<p>The TSTP class implements several fields to store the graph, and to store temporary information about the current solution during recursive backtracking (such that it is accessible by each instance of the recursive method). </p>
<p>The class stores the current route in an integer array, along with the current path distance, the current minimum distance, and the current state of the gas tank.</p>
<p>The TSTP class has a public <code>solve()</code> method, which calls a private recursive backtracking <code>explore()</code> method to solve the problem. </p>
<p>The recursive method will have a base case and a recursive case.</p>
<ul>
<li>
<p>The <strong>base case</strong> is that we have visited all cities on the graph. Check if this is a new solution, and if so, save it.</p>
</li>
<li>
<p>In the <strong>recursive case</strong>, we explore all solutions possible starting at the current node (passed in as a parameter), having already made N choices (passed in as a parameter). We do this by making a choice (and marking the node as visited), then exploring the consequences (through a recursive call), then unmaking the choice (rmarking the node as unvisited).</p>
</li>
</ul>
<p>Here is the explore method header:</p>
<div class="highlight"><pre><span></span><code><span class="err">    /** Recursive backtracking method: </span>
<span class="err">        explore possible solutions starting </span>
<span class="err">        at this node, having made nchoices */</span>
<span class="err">    public void explore(Node node, int nchoices) {</span>
</code></pre></div>

<p><a name="tstp-base"></a></p>
<h3 id="explore-base-case">Explore: Base Case</h3>
<p>The base case begins by checking if the minimum distance has been set, and if so, whether the current distance is larger than the minimum distance. If so, this route is abandoned; otherwise, we have a new solution.</p>
<div class="highlight"><pre><span></span><code>        <span class="k">if</span><span class="p">(</span><span class="n">nchoices</span> <span class="o">==</span> <span class="n">graphSize</span><span class="p">)</span> <span class="err">{</span>
            <span class="o">//</span> 
            <span class="o">//</span> <span class="n">BASE</span> <span class="k">CASE</span>
            <span class="o">//</span>
            <span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">this_distance</span> <span class="o">&lt;</span> <span class="n">this</span><span class="p">.</span><span class="n">min_distance</span> <span class="o">||</span> <span class="n">this</span><span class="p">.</span><span class="n">min_distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="err">{</span>
                <span class="n">this</span><span class="p">.</span><span class="n">min_distance</span> <span class="o">=</span> <span class="n">this</span><span class="p">.</span><span class="n">this_distance</span><span class="p">;</span>
                <span class="n">printSolution</span><span class="p">();</span>
            <span class="err">}</span> <span class="k">else</span> <span class="err">{</span>
                <span class="n">printFailure</span><span class="p">();</span>
            <span class="err">}</span>

        <span class="err">}</span> <span class="k">else</span> <span class="err">{</span>
</code></pre></div>

<p><a name="tstp-recursive"></a></p>
<h3 id="explore-recursive-case">Explore: Recursive Case</h3>
<p>Next, the recursive case will explore each of the possible choices open to it by iterating over each choice available at a node, and for each node, choosing it, exploring the results, and unchoosing it. </p>
<div class="highlight"><pre><span></span><code><span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="o">//</span><span class="w"></span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="k">CASE</span><span class="w"></span>
<span class="w">            </span><span class="o">//</span><span class="w">  </span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">gas_tank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Bummer</span><span class="p">,</span><span class="w"> </span><span class="n">man</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="err">}</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">min_distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">this_distance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">min_distance</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Give</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">there</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">hope</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="err">}</span><span class="w"></span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">teacher</span><span class="w"> </span><span class="n">teaches</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">teacher</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">gas</span><span class="p">.</span><span class="w"> </span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tank</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">full</span><span class="p">...</span><span class="w">  </span><span class="n">bummer</span><span class="p">,</span><span class="w"> </span><span class="n">man</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="n">this</span><span class="p">.</span><span class="n">gas_tank</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">tankSize</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">gas_tank</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">pay</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="nl">neighbor</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">Set</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graph</span><span class="p">.</span><span class="n">adjacentNodes</span><span class="p">(</span><span class="n">node</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="n">neighbor</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">neighbors</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">neighbor</span><span class="p">.</span><span class="n">visited</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="w">                    </span><span class="nc">int</span><span class="w"> </span><span class="n">distance_btwn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10000</span><span class="p">;</span><span class="w"></span>

<span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">edge</span><span class="p">.</span><span class="w"></span>
<span class="w">                    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">graph</span><span class="p">.</span><span class="n">edgesConnecting</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">neighbor</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">distance_btwn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edge</span><span class="p">.</span><span class="n">cost</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="err">}</span><span class="w"></span>

<span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">choice</span><span class="w"></span>
<span class="w">                    </span><span class="n">this</span><span class="p">.</span><span class="n">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="n">neighbor</span><span class="p">.</span><span class="n">visit</span><span class="p">();</span><span class="w"></span>
<span class="w">                    </span><span class="n">this</span><span class="p">.</span><span class="n">this_distance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">distance_btwn</span><span class="p">;</span><span class="w"></span>

<span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="n">Explore</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">consequences</span><span class="w"></span>
<span class="w">                    </span><span class="n">explore</span><span class="p">(</span><span class="n">neighbor</span><span class="p">,</span><span class="n">nchoices</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="n">Unmake</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">choice</span><span class="w"></span>
<span class="w">                    </span><span class="n">this</span><span class="p">.</span><span class="n">route</span><span class="o">[</span><span class="n">nchoices</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">                    </span><span class="n">neighbor</span><span class="p">.</span><span class="n">unvisit</span><span class="p">();</span><span class="w"></span>
<span class="w">                    </span><span class="n">this</span><span class="p">.</span><span class="n">this_distance</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">distance_btwn</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="err">}</span><span class="w"></span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Move</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="p">(</span><span class="k">continue</span><span class="w"> </span><span class="n">loop</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="err">}</span><span class="w">               </span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">End</span><span class="w"> </span><span class="n">base</span><span class="o">/</span><span class="k">recursive</span><span class="w"> </span><span class="k">case</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
</code></pre></div>

<p><a name="tstp-graphs"></a></p>
<h2 id="example-graphs">Example Graphs</h2>
<p>Just so you can see what they look like, here are a couple of graphs 
generated for the traveling schoolteacher problem:</p>
<p><img src="/images/graphviz_tstp_6.png" width="400px" /></p>
<p><img src="/images/graphviz_tstp_8.png" width="400px" /></p>
<p><img src="/images/graphviz_tstp_12.png" width="400px" /></p>
<p><a name="tstp-results"></a></p>
<h2 id="results">Results</h2>
<p><a name="tstp-walltime-nodes"></a></p>
<h3 id="walltime-vs-number-of-nodes">Walltime vs. Number of Nodes</h3>
<p>The following is a plot of walltime versus number of nodes:</p>
<p><img src="/images/tstp-java-scaling.png" width="500px" /></p>
<p>This plot shows that the traveling schoolteacher problem 
is solved faster than the traveling salesperson problem.
This makes sense - for a given city, many of the possible routes can be
eliminated from the list of routes to explore, due to the additional constraint
of the gas tank needing to remain full. If there are only 2 gallons of gas 
in the tank, this constrains the choices of nodes to explore to those 
requiring 2 gallons of gas or less.</p>
<p>This is particularly true for the scenario used when generating the above graph - 
the constraint of the gas tank size is used to construct an "interesting" graph
tand ensure that we don't end up with a graph where the traveling schoolteacher 
gets "stuck" somewhere without enough gas to continue. Here is the relevant section
of the <code>RandomNodeGraph.java</code> class. </p>
<p>The <code>getNextCost()</code> method generates a random edge
between two cities, with a <span class="math">\(\frac{T}{T+1}\)</span> percent chance of it being impossible for the 
teacher to travel that route due to a gas tank that's too small:</p>
<div class="highlight"><pre><span></span><code><span class="err">    private static int getNextCost(int T) {</span>
<span class="err">        Random r = new Random();</span>
<span class="err">        return 1+r.nextInt(T);</span>
<span class="err">    }</span>
</code></pre></div>

<p>Likewise, here is the <code>getNextPay()</code> method, which generates a random 
amount of pay (in gas) that the </p>
<div class="highlight"><pre><span></span><code><span class="err">    private static int getNextPay(int T) {</span>
<span class="err">        Random r = new Random();</span>
<span class="err">        return (int)(0.5*T + 0.5*(r.nextInt(T)+1));</span>
<span class="err">    }</span>
</code></pre></div>

<p>Here is a link to the full <code>RandomNodeGraph.java</code> file on the charlesreid1.com git server, 
contained in the <code>tsp</code> repository (which has several codes related to the traveling salesperson problem):
<a href="https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava/RandomNodeGraph.java">https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava/RandomNodeGraph.java</a></p>
<p>And here is a link to the <code>tsp</code> repository on the same charlesreid1.com git server:
<a href="https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava">https://git.charlesreid1.com/charlesreid1/tsp/src/master/schoolteacher-guava</a></p>
<p>In a city with 10 routes connecting to other cities, having edges that the schoolteacher
cannot travel, or nodes that limit the amount of gas the schoolteacher receives, 
can constrain the number of possible routes and reduce the number of routes that need to be 
explored. The methods above ensure that this will not happen very often, but that it will happen
some of the time. These routes that can be eliminated can lead to a significant reduction
in computational time.</p>
<p><a name="tstp-conclusion"></a></p>
<h2 id="conclusion">Conclusion</h2>
<p>This project shows how easy it is to utilize the Guava library to solve computational problems
in Java and create computing benchmarks and graphs of scaling behavior. The original code to 
solve the traveling salesperson problem using recursive backtracking was fairly straightforward to 
implement on a graph, and extending this code to implement additional constraints and solve the 
traveling schoolteacher problem was surprisingly easy to do. </p>
<p>Fitting the scaling behavior to a line and computing the slope would make the scaling study
more quantitative, and needs to be done, but unfortunately the Google Sheets tool does not have 
this capability, so this information will be done with Python (scipy linear algebra package)
and comparisons between the TSP and TSTP slopes will be added later.</p>
<p><a name="tstp-references"></a></p>
<h2 id="references">References</h2>
<ol>
<li>
<p>"tsp (git repository)." Charles Reid. Modified 7 April 2017. Accesssed 30 April 2017.
&lt;<a href="https://git.charlesreid1.com/charlesreid1/tsp">https://git.charlesreid1.com/charlesreid1/tsp</a>&gt;</p>
</li>
<li>
<p>"Solving the Traveling Salesperson Problem with Java and Guava." Charles Reid. 23 March 2017. Accessed 30 April 2017.
&lt;<a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html</a>&gt;</p>
</li>
<li>
<p>"Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts." Charles Reid. 1 April 2017. Accessed 30 April 2017.
&lt;<a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/guava.html">guava</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/graph.html">graph</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/tsp.html">TSP</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                The Z-Machine: A Simple Turing Machine
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-24T20:00:00-07:00" pubdate>Monday 04/24/2017</time>
                in 
                <a href="https://charlesreid1.github.io/category/computer-science.html">Computer Science</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#z-bkg">Background</a></li>
<li><a href="#z-setup">The Z-Machine: Setup</a></li>
<li><a href="#z-instructions">The Z-Machine: Instructions</a></li>
<li><a href="#z-loop">Simple Example: Loop</a></li>
<li><a href="#z-addition">Implementing an Addition Operator on the Z-Machine</a><ul>
<li><a href="#z-solution-approach">The Solution Approach (The Maths)</a></li>
<li><a href="#z-addition1">Solution 1: Positive Integers Only</a></li>
<li><a href="#z-addition2">Solution 2: Dealing with Zeros</a></li>
</ul>
</li>
<li><a href="#z-subtraction">Implementing a Decrement Operator on the Z-Machine</a></li>
<li><a href="#z-lessthan">Implementing a Less Than Operator on the Z-Machine</a></li>
<li><a href="#z-whocares">Who Cares? (Or, How To Build A Computer)</a></li>
<li><a href="#z-sources">Sources</a></li>
</ul>
<p><a name="z-bkg"></a></p>
<h2 id="background">Background</h2>
<p>Recently I discovered the wonderful blog of <a href="http://blog.jgc.org/2013/05/the-two-problems-i-had-to-solve-in-my.html">John Graham-Cumming</a>.
One of hist posts, from 2013, details a question that he had to answer for the Oxford University Department of Computer Science's "interviews" 
(which, I believe, are a kind of final examination "interview" to graduate, not an interview for admittance to the program).
Graham-Cumming describes one of the quetions he was presented with during his interview.</p>
<p><a name="z-setup"></a></p>
<h2 id="the-z-machine-setup">The Z-Machine: Setup</h2>
<p>Here is the problem setup:</p>
<p>Suppose you have a computer with a very simple memory layout. 
The memory consists of a series of numbered locations, each of which can store numbers. 
These numbers are positive or negative integers. Here is an illustration of an example of this memory layout:</p>
<p><img alt="Z Machine Memory Layout" src="https://charlesreid1.com/w/images/2/22/Z-Machine1.png"></p>
<p><a name="z-instructions"></a></p>
<h2 id="the-z-machine-instructions">The Z-Machine: Instructions</h2>
<p>Z-Machine Instructions</p>
<p>The machine can only perform three instructions: Zero (Z), Increment (I), and Jump (J).</p>
<p>The <strong>Z operator</strong> zeros out a location in memory. The operation specifies which index should be zeroed out. For example, Z4 will zero out index 4 (which is the 5th item in memory, since indexing starts at 0).</p>
<p>The <strong>I operator</strong> increments the value at a location in memory by 1. The operation specifies which index should be incremented. For example, I6 will increment index 6 (the 7th item in memory) by 1.</p>
<p>The <strong>J operator</strong> compares two locations in memory. If the values are different, the jump operator will branch (that is, jump to a different location in the code). The two locations are specified when calling the operator, and an arrow (or operation number) indicates where the operator should branch TO if the values are not the same. If the values are the same, the code continues.</p>
<p>The program stops when it reaches the end of the instruction list.</p>
<p><a name="z-loop"></a></p>
<h2 id="simple-example-loop">Simple Example: Loop</h2>
<p>Here is an example of a loop program. This program sets memory index 4 to zero, 
then increments it until it is equal to the value in memory index 20:</p>
<div class="highlight"><pre><span></span><code><span class="err">001   Z4</span>
<span class="err">002   I4</span>
<span class="err">003   J4,20 --&gt; 002</span>
</code></pre></div>

<p>The instruction <code>J4,20 --&gt; 002</code> indicates that the values in cell 4 and cell 20 
should be compared, and if they are not equal, the machine should jump to instruction <code>002</code>.</p>
<p><a name="z-addition"></a></p>
<h2 id="implementing-an-addition-operation-on-the-z-machine">Implementing an Addition Operation on the Z-Machine</h2>
<p>Graham-Cumming includes the following programming challenge in his <a href="http://blog.jgc.org/2013/05/the-two-problems-i-had-to-solve-in-my.html">blog post</a>:</p>
<p>Suppose a machine has two numbers in the first two locations in memory. Utilize these three operations to add the two numbers together and put the result into the third location in memory.</p>
<p>Under what circumstances does the program fail?</p>
<p><a name="z-solution-approach"></a></p>
<h3 id="the-solution-approach-the-maths">The Solution Approach (The Maths)</h3>
<p>To approach the solution, start with the maths. What we're doing is trying to define a "complex" arithmetical operation (addition) from simpler "unit" operations (increment by one), so it will be helpful to wipe our mental slate clean and start at the very beginning of the problem.</p>
<p>When I teach a math class, whether it be a developmental math class, an algebra class, or a calculus class, I always spend the first "full" lecture by guiding the students through this very procedure. Here's how I set the tone: "Imagine that you are stranded on a desert island, with no calculators, no math books, nothing but your fingers and toes. Now suppose you are tasked with reinventing all of mathematics, entirely from scratch. How would you do it?"</p>
<p>This is a challenging task - and part of the challenge is just knowing where to begin (just how clean should you wipe the mental slate?). The Z-Machine problem formulation resolves that problem by explicitly enumerating valid operations. But let's continue with the desert island analogy for a bit.</p>
<p>If we begin at what is truly the beginning, we can start with a single unit, the number 1. (If we want to fast forward through thousands of years of human history, we can instead start with the number 0 in addition to the number 1.) Having only a single number is boring, because we can't count anything. We need a way to generate more numbers. So, we begin by defining an increment operation. We begin with the unit, 1. We declare that we can combine 1 with any other number. When we combine 1 with another 1, we get a new, larger number - which we arbitrarily call two, and represent using this funny squiggle: 2.</p>
<p>Now that we have defined the increment operation, adding a unit, we can begin to generate new numbers. We start with 1+1, which gives 2. The next number can be found by adding 1 to 2, which gives us a new number that we arbitrarily call three, and represent with a funny squiggle: 3.</p>
<p>We continue in this manner, until we reach 9, and run out of squiggles to write. The next number we will get is a special number, because it is equal to the total number of fingers. When we get to 9, and add one more, we get "two hands", which we arbitrarily call ten. If we want to keep counting beyond ten, we're stuck, because we've run out of fingers. But we can take a shortcut - we can let one toe represent "two hands". So, we hold up one toe, to represent ten. To write ten, we can let the first digit represent how many toes we are holding up, and the second digit represent how many fingers we are holding up. That means we can write our "two hands" quantity as 10 - one toe, no fingers.</p>
<p>We can keep on incrementing by 1, and using this system we can count all the way up to 99, at which point we will need another pair of hands or feet to keep generating new numbers, or we can suppose that after counting to 99, we are able to hold numbers in our head.</p>
<p>But once again, we're generating numbers slowly. We want a way to generate more numbers, faster, so we can count higher. So, we define a new addition operation. Rather than adding 1, we define the general operation of addition recursively. To add two numbers like a and b, we can define this addition in terms of a unit increment:</p>
<div class="math">$$
a + b = a + 1 + 1 + 1 + \dots + 1
$$</div>
<p>We increment the quantity a by 1, b times. This gives us a way to add arbitrary numbers together, so now we can reach much larger numbers by taking the largest number that we can count to, and adding that number to itself.</p>
<p>Extending this approach can lead us from an increment operation (performed b times) to an addition operation (<code>+b</code>).</p>
<p>It can also lead from an addition operation (performed b times) to a multiplication operation (<code>*b</code>).</p>
<p>Extending the idea further, we can apply the multiplication operation (performed b times) and obtain an exponentiation operation (<code>^b</code>).</p>
<p>This recursive definition of new operations can continue as long as we'd like: applying the exponentiation operation b times yields tetration (<code>^b^b^b^b^b...^b</code>).</p>
<p>But let's get back to addition.</p>
<p><a name="z-addition1"></a></p>
<h3 id="solution-1-positive-integers-only">Solution 1: Positive Integers Only</h3>
<p>Adding two positive integers is the simplest case. 
Essentially, we just perform two loops: 
the first loop increments the result and increments a temporary variable 1, 
and does that until the temporary variable 1 is equal to the first number. 
The second loop increments the result and increments the result by 1 
for a number of times equal to the number at index 1.</p>
<div class="highlight"><pre><span></span><code><span class="err">001   Z2                    // clear space for the result</span>
<span class="err">002   Z3                    // clear space for temp variable 1</span>
<span class="err">003   I2                    // increment result</span>
<span class="err">004   I3                    // increment temp variable 1</span>
<span class="err">005   J3,0 --&gt; 003</span>
<span class="err">006   Z4                    // clear space for temp variable 2</span>
<span class="err">007   I2                    // increment result</span>
<span class="err">008   I3                    // increment temp variable 2</span>
<span class="err">009   J4,1 --&gt; 007</span>
<span class="err">010   Z3                    // clean up</span>
</code></pre></div>

<p>(Because we only have an increment operation at our disposal, 
there is no way for us to deal with negative numbers. 
Dittos for non-integer real numbers.) </p>
<p>This method will fail when either of the two numbers we are adding are zero.</p>
<p><a name="z-addition2"></a></p>
<h3 id="solution-2-dealing-with-zeros">Solution 2: Dealing With Zeros</h3>
<p>A second solution that is a bit more challenging is dealing with the case of possible zeros 
in the first or second position. The algorithm above will increment the result and the 
temporary variable <em>at least once</em> (similar to a do-while loop structure), 
which will always cause the comparison operation <code>J2,0</code> or <code>J3,1</code> to fail
if either cell 0 or cell 1 holds a zero.</p>
<p>Here is code that can deal more gracefully with a zero in either 
the first or second positions. This utilizes some extra space in memory
to keep track of whether index 0 is a zero and whether index 1 is a zero.</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span> <span class="k">initialize</span>
<span class="mi">001</span>     <span class="n">Z3</span>
<span class="mi">002</span>     <span class="n">Z4</span> <span class="o">//</span> <span class="n">temp</span> <span class="mi">0</span>
<span class="mi">003</span>     <span class="n">Z5</span> <span class="o">//</span> <span class="n">temp</span> <span class="mi">1</span>
<span class="mi">004</span>     <span class="n">Z6</span> <span class="o">//</span> <span class="k">is</span> <span class="k">index</span> <span class="mi">0</span> <span class="n">a</span> <span class="n">zero</span><span class="o">?</span>
<span class="mi">005</span>     <span class="n">Z7</span> <span class="o">//</span> <span class="k">is</span> <span class="k">index</span> <span class="mi">1</span> <span class="n">a</span> <span class="n">zero</span><span class="o">?</span>
<span class="mi">006</span>     <span class="n">Z8</span> <span class="o">//</span> <span class="n">zero</span>
<span class="mi">007</span>     <span class="n">Z9</span> <span class="o">//</span> <span class="n">one</span>
<span class="mi">008</span>     <span class="n">I9</span>

<span class="o">//</span> <span class="k">increment</span> <span class="k">by</span> <span class="n">amount</span> <span class="k">in</span> <span class="k">index</span> <span class="mi">0</span>
<span class="mi">009</span>     <span class="n">J0</span><span class="p">,</span><span class="mi">8</span> <span class="c1">--&gt; 014</span>
<span class="mi">010</span>     <span class="n">I6</span>
<span class="mi">011</span>     <span class="n">J4</span><span class="p">,</span><span class="mi">6</span> <span class="c1">--&gt; 014</span>
<span class="mi">012</span>     <span class="n">I4</span>
<span class="mi">013</span>     <span class="n">I3</span>
<span class="mi">014</span>     <span class="n">J0</span><span class="p">,</span><span class="mi">4</span> <span class="c1">--&gt; 009</span>

<span class="o">//</span> <span class="k">increment</span> <span class="k">by</span> <span class="n">amount</span> <span class="k">in</span> <span class="k">index</span> <span class="mi">1</span>
<span class="mi">015</span>     <span class="n">J1</span><span class="p">,</span><span class="mi">8</span> <span class="c1">--&gt; 020</span>
<span class="mi">016</span>     <span class="n">I7</span>
<span class="mi">017</span>     <span class="n">J7</span><span class="p">,</span><span class="mi">8</span> <span class="c1">--&gt; 020</span>
<span class="mi">018</span>     <span class="n">I5</span>
<span class="mi">019</span>     <span class="n">I3</span>
<span class="mi">020</span>     <span class="n">J1</span><span class="p">,</span><span class="mi">5</span> <span class="c1">--&gt; 017</span>

<span class="o">//</span> <span class="n">clean</span> <span class="n">up</span>
<span class="mi">021</span>     <span class="n">Z4</span>
<span class="mi">022</span>     <span class="n">Z5</span>
<span class="mi">023</span>     <span class="n">Z6</span>
<span class="mi">024</span>     <span class="n">Z7</span>
</code></pre></div>

<p>The central idea behind this algorithm is, we keep incrementing the target cell while a 
condition is false, and the condition we are checking is based on a separate, independent counter.
That allows us to correctly increment (and stop incrementing) based on the two numbers 
in index 0 and index 1. 
(We don't want the final result cell to be involved in our final condition check.) </p>
<p>This pattern can also be expanded to work for adding an arbitrary number of numbers; 
one simply needs to add an additional temp variable and an additional "is zero" variable 
for each new number being added to the total, then another block of 6 statements
to increment by the amount in the given index.
The block of 6 statements checks if the number we are adding is zero, 
and if it is not, the result is incremented by that many times. </p>
<p><a name="z-decrement"></a></p>
<h2 id="implementing-a-decrement-operator-on-the-z-machine">Implementing a Decrement Operator on the Z-Machine</h2>
<p>Suppose an operator places a number into cell 0 of the Z-Machine's memory. 
We require that the Z-Machine subtract 1 from that number, and place it in cell 1. </p>
<p>The pseudocode approach here is to increment two cells in a particular order:
cell 2, which contains a sentinel value, is incremented. The program them checks if 
cell 2 is equal to cell 0. If it is not, the program increments cell 1, and repeats.
If cell 2 is equal to cell 0, the program stops before cell 1 is incremented, leaving it 
one less than the original value in cell 0.</p>
<div class="highlight"><pre><span></span><code><span class="err">001   Z1            // decrement result</span>
<span class="err">002   Z2            // zero</span>
<span class="err">003   Z3            // one</span>
<span class="err">004   I3</span>
<span class="err">005   J2,3 --&gt; 007  // always false</span>
<span class="err">006   I1</span>
<span class="err">007   I2</span>
<span class="err">008   J2,0 --&gt; 006</span>
</code></pre></div>

<p>This pseudocode uses hard-coded constants (zero and one) to create a jump condition
that is always false and therefore always followed. This allows the machine to 
skip a line of code like instruction 006, and perform the increment operation 
in a staggered manner, as described above.</p>
<p><a name="z-lessthan"></a></p>
<h2 id="implementing-a-less-than-operator-on-the-z-machine">Implementing a Less Than Operator on the Z-Machine</h2>
<p>Another challenging operation to implement with the Z-Machine is a comparison operator. 
Suppose that an operator places two numbers into the first two memory positions of 
the Z-Machine. That is, index 0 contains a number A, and index 1 contains a number B. 
Supposing these numbers are both natural numbers (either 0 or positive integers), 
a comparison operator will compare the two numbers, select the smaller of the two numbers, 
and place it into the third position in memory (index 2).</p>
<p>The pseudocode approach to implement the comparison operator is to create 
a counter that start at zero, and check if it is equal to A or B 
(the numbers at index 0 and index 1). 
If we continue to increment our counter, and check if it is equal to A or B, 
and stop when it reaches either A or B, we can guarantee that we will stop 
when the counter reaches the smaller of the two numbers.</p>
<p>In order to increment the memory cell at index 2 to hold the smaller of the two numbers 
at index 0 and index 1, we can use the following Z-Machine code, 
which continually checks if the number at index 2 is equal to 
either the number at index 0 or the number at index 1, increments if false, 
and stops when true (when it reaches the smaller of the two). </p>
<div class="highlight"><pre><span></span><code><span class="mi">001</span>     <span class="n">Z2</span> <span class="o">//</span> <span class="n">smaller</span> <span class="k">of</span> <span class="n">the</span> <span class="n">two</span> <span class="n">numbers</span>
<span class="mi">002</span>     <span class="n">Z3</span> <span class="o">//</span> <span class="n">zero</span>
<span class="mi">003</span>     <span class="n">Z4</span> <span class="o">//</span> <span class="n">one</span>
<span class="mi">004</span>     <span class="n">I4</span>

<span class="mi">005</span>     <span class="n">J0</span><span class="p">,</span><span class="mi">2</span> <span class="c1">--&gt; 007</span>
<span class="mi">006</span>     <span class="n">J3</span><span class="p">,</span><span class="mi">4</span> <span class="c1">--&gt; 011</span>
<span class="mi">007</span>     <span class="n">J1</span><span class="p">,</span><span class="mi">2</span> <span class="c1">--&gt; 009</span>
<span class="mi">008</span>     <span class="n">J3</span><span class="p">,</span><span class="mi">4</span> <span class="c1">--&gt; 011</span>
<span class="mi">009</span>     <span class="n">I2</span>
<span class="mi">010</span>     <span class="n">J3</span><span class="p">,</span><span class="mi">4</span> <span class="c1">--&gt; 005</span>
<span class="mi">011</span>     <span class="n">Z4</span>
</code></pre></div>

<p>Note that this code successfully handles the case where either number (or both) 
is 0 or any positive integer.</p>
<p><a name="z-whocares"></a></p>
<h2 id="who-cares-or-how-to-build-a-computer">Who Cares? (Or, How To Build A Computer)</h2>
<p>This whole exercise may appear, at first glance, to be an exercise in trivial pursuit. 
Why bother reinventing the wheel? Isn't this nothing more than an entertaining puzzle?</p>
<p>To the contrary - the process of assembling a sequence of simple operations into a cascade of
more complex operations is precisely how computational devices are assembled from 
circuit components. For example, a <a href="https://en.wikipedia.org/wiki/Flip-flop_%28electronics%29">flip flop circuit</a>
utilizes a pair of NOR (negation of OR) gates to store bits. The <a href="https://en.wikipedia.org/wiki/Apollo_Guidance_Computer">Apollo Guidance Computer</a>
was composed entirely of NOR gates. </p>
<p>In fact, the Apollo Guidance Computer is a fantastic example of a computational device 
constructed from a set of such simple instructions as the ones available in the Z-Machine.
A few example operations from the Wikipedia article on the Apollo Guidance Computer:</p>
<div class="highlight"><pre><span></span><code><span class="n">AD</span> <span class="p">(</span><span class="k">add</span><span class="p">)</span>
    <span class="k">Add</span> <span class="n">the</span> <span class="n">contents</span> <span class="k">of</span> <span class="n">memory</span> <span class="k">to</span> <span class="n">register</span> <span class="n">A</span> <span class="k">and</span> <span class="n">store</span> <span class="n">the</span> <span class="k">result</span> <span class="k">in</span> <span class="n">A</span><span class="p">.</span>

<span class="k">INDEX</span>
    <span class="k">Add</span> <span class="n">the</span> <span class="k">data</span> <span class="n">retrieved</span> <span class="k">at</span> <span class="n">the</span> <span class="n">address</span> <span class="n">specified</span> <span class="k">by</span> <span class="n">the</span> <span class="n">instruction</span> 
    <span class="k">to</span> <span class="n">the</span> <span class="k">next</span> <span class="n">instruction</span><span class="p">.</span> <span class="k">INDEX</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">to</span> <span class="k">add</span> <span class="k">or</span> <span class="n">subtract</span> 
    <span class="n">an</span> <span class="k">index</span> <span class="n">value</span> <span class="k">to</span> <span class="n">the</span> <span class="n">base</span> <span class="n">address</span> <span class="n">specified</span> <span class="k">by</span> <span class="n">the</span> <span class="n">operand</span> 
    <span class="k">of</span> <span class="n">the</span> <span class="n">instruction</span> <span class="n">that</span> <span class="n">follows</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">This</span> <span class="k">method</span> <span class="k">is</span> <span class="n">used</span> 
    <span class="k">to</span> <span class="n">implement</span> <span class="n">arrays</span> <span class="k">and</span> <span class="k">table</span> <span class="n">look</span><span class="o">-</span><span class="n">ups</span><span class="p">.</span>
</code></pre></div>

<p>It is not unusual for a hardware platform to have a small set of basic commands or instructions
that can be carried out, and for that set of instructions to be different from hardware platform
to hardware platform. Designing a new computational device requires the system designer
to adapt to the hardware's capabilities - not the other way around. 
For that reason, it is important to keep those engineering and puzzle-solving skills sharp.
You never know when you'll be designing a new computer device.</p>
<p><a name="z-sources"></a></p>
<h2 id="sources">Sources</h2>
<ol>
<li>
<p>"The Two Problems I Had To Solve In My Oxford Interview." John Graham-Cumming. Published 2 May 2013. Accessed 24 April 2017.
&lt;<a href="http://blog.jgc.org/2013/05/the-two-problems-i-had-to-solve-in-my.html">http://blog.jgc.org/2013/05/the-two-problems-i-had-to-solve-in-my.html</a>&gt;</p>
</li>
<li>
<p>"Flip Flop (electronics)." Wikipedia. The Wikimedia Foundation. Edited 13 April 2017. Accessed 24 April 2017.
&lt;<a href="https://en.wikipedia.org/wiki/Flip-flop_%28electronics%29">https://en.wikipedia.org/wiki/Flip-flop_%28electronics%29</a>&gt;</p>
</li>
<li>
<p>"Apollo Guidance Computer." Wikipedia. The Wikimedia Foundation. Edited 5 April 2017. Accessed 24 April 2017.
&lt;<a href="https://en.wikipedia.org/wiki/Apollo_Guidance_Computer">https://en.wikipedia.org/wiki/Apollo_Guidance_Computer</a>&gt;</p>
</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/turing-machine.html">turing machine</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computer-engineering.html">computer engineering</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/apollo.html">apollo</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/assembly.html">assembly</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2017-04-12T10:00:00-07:00" pubdate>Wednesday 04/12/2017</time>
                in 
                <a href="https://charlesreid1.github.io/category/charlesreid1.html">Charlesreid1</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><p>These notes are also available on git.charlesreid1.com 
<a href="https://git.charlesreid1.com/charlesreid1/aws/src/branch/master/awsome-day-sea-2018/Part2.md">here</a>
or in
<a href="https://git.charlesreid1.com/charlesreid1/aws">https://git.charlesreid1.com/charlesreid1/aws</a>.</p>
<h1 id="awsome-day-notes-part-2-networking-security-and-miscellany">AWSome Day Notes: Part 2: Networking, Security, and Miscellany</h1>
<p>Following are some notes from Amazon's AWSome Day (Tuesday, February 27, 2018).</p>
<h2 id="nomenclature">Nomenclature</h2>
<p><strong>Elastic:</strong> You'll see the word "elastic" on a lot of Amazon's services. The "elastic" concept refers to a service that is able to handle huge increases in traffic (Pokemon Go - number of users grew orders of magnitude faster/larger than what they designed for).</p>
<p><strong>Virtual Private Cloud (VPC):</strong> The AWS equivalent of a virtual private network (VPN). A VPC is a virtual network that allows a given set of nodes in the same region and zone to create a virtual network to communicate privately.</p>
<h2 id="services">Services</h2>
<p>This document will give a brief summary of some of the popular cloud services. The model for most of these technologies is, the Apache Software Foundation will release an open-source big data project (can be installed/run by anyone). But since most people are using cloud providers anyway, the cloud providers offer their own ready-to-go implementation of these services. These run stable versions of the Apache software, wrapped by the cloud provider's API. This is a win-win because you don't have to fiddle with wrangling servers, and they can use their resources more wisely.</p>
<p>As an example, Apache Kafka is software for handling message streams. (Like a giant digital mail room - some services broadcast/publish messages, some services receive/subscribe to messages.) You can install Kafka locally or on a cluster, or rent cloud nodes and install it yourself. Or, you can use Kinesis on AWS, or PubSub on Google Cloud Platform (GCP), both of which are elastic (completely transparent to you) and charge for data throughput instead of compute time. Code written for Kafka can be uploaded and used without modification.</p>
<p>A few other important services, listing the Apache, AWS, and GCP equivalents:</p>
<table>
<thead>
<tr>
<th>Apache</th>
<th align="left">AWS</th>
<th>GCP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hadoop</td>
<td align="left">Kinesis Analytics</td>
<td>Dataproc</td>
<td>Running data-intensive parallel jobs</td>
</tr>
<tr>
<td>Spark</td>
<td align="left">Kinesis Analytics</td>
<td>Dataproc</td>
<td>Running data-intensive parallel jobs</td>
</tr>
<tr>
<td>HDFS</td>
<td align="left">S3</td>
<td>GC Storage</td>
<td>Object-based file storage</td>
</tr>
<tr>
<td>Beam</td>
<td align="left">Kinesis Streams</td>
<td>Dataflow</td>
<td>Sream/batch data processing pipelines</td>
</tr>
<tr>
<td>Impala</td>
<td align="left">Redshift/Athena</td>
<td>BigQuery</td>
<td>Handles SQL queries on massive (&gt;1 PB) data sets</td>
</tr>
<tr>
<td>Kafka</td>
<td align="left">Kinesis</td>
<td>PubSub</td>
<td>Message streaming</td>
</tr>
</tbody>
</table>
<p>There are many other cloud services, some without a corresponding Apache project (e.g., Google's Machine Learning APIs or Amazon's text-to-speech API) but these five are common in big data ecosystems.</p>
<h2 id="networking">Networking</h2>
<p>Cloud networking is like the condiment bar of cloud providers - customers don't pay for it, but they can help themselves. </p>
<p>Why set up a VPC? </p>
<ul>
<li>Scaling - having the ability to connect nodes via network means you can scale up client-server services (e.g., databases/web servers)</li>
<li>Security - VPC traffic is encrypted and not visible to outsiders, even when it occurs over public channels. Services can be set up to listen only for traffic from the VPC. You can also connect from an outside box (e.g., your laptop) to the VPC using a VPN client.</li>
<li>Learning - you have to deal with some nitty gritty details, but learning how to set up virtual networks gives you a real education in network security and in how the internet works. </li>
</ul>
<p>You can still accomplish a lot even with simple networking patterns.</p>
<h3 id="making-a-vpc-plan">Making a VPC: Plan</h3>
<p>To create a VPC, you first define the entire VPC network, then define a subnet on the network. The subnet must have an internet gateway, a routing table, and DHCP/DNS added to it so that nodes on the subnet can access the outside internet and find each other.</p>
<p>Here is a visual depiction of the architecture:</p>
<div class="highlight"><pre><span></span><code><span class="err">         +--------------------------------------------------------------------------+</span>
<span class="err">         | Whole Internet                                                           |</span>
<span class="err">         |                                                                          |</span>
<span class="err">         |                                                                          |</span>
<span class="err">         |  +--------------------------------------------------------------------+  |</span>
<span class="err">         |  |  Amazon                                                            |  |</span>
<span class="err">         |  |                                                                    |  |</span>
<span class="err">         |  |                                                                    |  |</span>
<span class="err">         |  |                                                                    |  |</span>
<span class="err">         |  |   +---------------------------------------------------+            |  |</span>
<span class="err">         |  |   |   Virtual Private Cloud: WAN                      |            |  |</span>
<span class="err">         |  |   |                                             +-----+-----+      |  |</span>
<span class="err">         |  |   |   Network IP Block: 10.117.0.0/16           | Internet  |      |  |</span>
<span class="err">         |  |   |                     10.117.*.*              | Gateway   |      |  |</span>
<span class="err">         |  |   |                                             +-----+-----+      |  |</span>
<span class="err">         |  |   |    +----------------------------------+           |            |  |</span>
<span class="err">         |  |   |    |  VPC Subnet: LAN                 |           |            |  |</span>
<span class="err">         |  |   |    |                                  |     +-----+-----+      |  |</span>
<span class="err">         |  |   |    |  Subnet IP Block: 10.117.0.0/24  |     |  Routing  |      |  |</span>
<span class="err">         |  |   |    |                   10.117.0.*     |     |  Table    |      |  |</span>
<span class="err">         |  |   |    |                                  |     +-----+-----+      |  |</span>
<span class="err">         |  |   |    |                                  |           |            |  |</span>
<span class="err">         |  |   |    +----------------------------------+           |            |  |</span>
<span class="err">         |  |   |                                             +-----+-----+      |  |</span>
<span class="err">         |  |   |                                             |   DHCP    |      |  |</span>
<span class="err">         |  |   |                                             +-----+-----+      |  |</span>
<span class="err">         |  |   |                                                   |            |  |</span>
<span class="err">         |  |   +---------------------------------------------------+            |  |</span>
<span class="err">         |  |                                                                    |  |</span>
<span class="err">         |  +--------------------------------------------------------------------+  |</span>
<span class="err">         |                                                                          |</span>
<span class="err">         +--------------------------------------------------------------------------+</span>
</code></pre></div>

<h3 id="making-a-vpc-network-and-subnet">Making a VPC: Network and Subnet</h3>
<p>To sepcify the network and subnet IP ranges, you use CIDR notation, which is an IP address
with zeroes in several blocks, and a suffix indicating which blocks are available for this 
network to assign. (For reference, <code>A.B.C.D/8</code> means "the last 3 blocks" or <code>B.C.D</code>;  <code>A.B.C.D/16</code> means "the last 2 blocks" or <code>C.D</code>; and <code>A.B.C.D/24</code> means "the last block" or <code>.D</code>).</p>
<p>The network IP address can be specified as:</p>
<div class="highlight"><pre><span></span><code><span class="err">10.X.0.0/16</span>
</code></pre></div>

<p>where X is any number between 0 and 254 (when you include the reserved 255 value, that totals 256, since IP addresses are just 32 bit strings, 4 blocks of 8 bits each - <code>2^8 = 256</code>). The subnet can be specified with the CIDR IP range:</p>
<div class="highlight"><pre><span></span><code><span class="err">10.X.Y.0/24</span>
</code></pre></div>

<p>where X and Y are integers between 0 and 254. This means any node joining this subnet will have an IP address of the form <code>10.X.Y.*</code>. Two IP addresses with the same <code>X</code> value are on the same VPC network; two IP addresses with the same <code>Y</code> value are on the same subnet.</p>
<p>In the example above, X = 117, and we have the VPC defined by:</p>
<div class="highlight"><pre><span></span><code><span class="err">10.117.0.0/16</span>
</code></pre></div>

<p>and the subnet defined by:</p>
<div class="highlight"><pre><span></span><code><span class="err">10.117.0.0/24</span>
</code></pre></div>

<h3 id="making-a-vpc-the-essentials">Making a VPC: The Essentials</h3>
<p>Once you've added the VPC and the subnet, you'll also need to add three essential services to the VPC network:</p>
<ul>
<li>Internet gateway - this is something you create from the VPC section of the AWS console. It's like your home wifi router that's connected to the internet. actually, it <em>is</em> the VPC network router, and it <em>is</em> connected to the internet.</li>
<li>Routing table - this tells computers on the network how to find each other and how to find the gateway.</li>
<li>DHCP - domain host control protocol, this is the service that is used to hand out IP addresses</li>
<li>(Bundled with DHCP) DNS - domain name service, this is used to turn web URLs into IP addresses</li>
</ul>
<p>Now you should be good to go. (Scratch that - make a security group first.) </p>
<h3 id="making-a-vpc-security-group">Making a VPC: Security Group</h3>
<p>One last step, after you've constructed the network, is to create a security group to control outside access to the VPC. This is an AWS-level firewall that will only allow traffic on ports you specify. Here we specify a single security group for every node on the network, and the security policy opens the following ports from and to computers in the same VPC:</p>
<ul>
<li>19999 - netdata</li>
<li>9090 - prometheus</li>
<li>3000 - grafana</li>
<li>27017 - mongodb</li>
<li>8080 - mongoexpress</li>
</ul>
<h3 id="adding-nodes-to-the-vpc">Adding Nodes to the VPC</h3>
<p>Test out your network by creating a t2.micro node and specifying the subnet you created as the network the node should connect to. Check to ensure you can access the internet.</p>
<p>A good schema to use is:</p>
<div class="highlight"><pre><span></span><code><span class="err">10.X.0.1      gateway</span>
<span class="err">10.X.0.100    node0</span>
<span class="err">10.X.0.101    node1</span>
<span class="err">10.X.0.102    node2</span>
<span class="err">...</span>
</code></pre></div>

<h2 id="scaling-your-process">Scaling Your Process</h2>
<blockquote>
<p>If you're SSHing into a machine, your automation is broken.
- Alex the AWS trainer</p>
</blockquote>
<p>There are some tricks to getting your process to scale, but the essential part is figuring out how to remove SSH from the process. Cloud OS images (e.g. Ubuntu) have cloud-init, which runs an init script on boot. <a href="https://stackoverflow.com/a/10128171">More info in this Stack Overflow post</a>. This must be a bash script and size is limited to 16 KB. If it takes &gt; 10 minutes, AWS will treat it as hanging and kill the node, so keep it (relatively) simple.</p>
<p>Example of what you can do:</p>
<ul>
<li>Check out a git repo with initailization scripts</li>
<li>Install a hard-coded copy of your SSH <em>public</em> (not private) key, so you can get passwordless access to the node later</li>
<li>Spawn a server or process in the background</li>
<li>Start a server or process in a screen so that later you can SSH into the machine and attach to the screen to monitor the progress of the job or the service</li>
</ul>
<p>And so on.</p>
<h2 id="ssh-and-identity-management">SSH and Identity Management</h2>
<p>Identity access management (IAM) and access controls are the most confusing part of any cloud platform - don't feel frustrated if you don't pick it up easily. </p>
<p>IAM is a way for you to provide limited, specified access to resources that you own/have created, without sharing your credentials.</p>
<p>IAM is useful for you to use yourself (e.g., if you are using Amazon Kinesis and you want it to access an Amazon Redshift database, you can create an IAM for your Amazon Kinesis script that gives it permission to access data in a particular Amazon Reshift database, and run your Kinesis script under that identity). </p>
<p>IAM is also useful for sharing resources with other AWS users. You can create a VPC and create an IAM group that allows people to manage the network, and add any network administrators to the group. This gives them full control over the network. You can also create an IAM group that gives members the ability to see, but not modify, the network (e.g., billing manager).</p>
<p><a href="https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_IAM.html">More info on IAM</a></p>
<h2 id="tricks-with-disks">Tricks with Disks</h2>
<p>AMI (Amazon Machine Images) provide operating system images that you can use to initialize a new node. But you can also create your own AMIs. Use the EC2 console to create an AMI (image) from any of your running nodes; wait for the snapshot to complete (may take a few minutes); and now you can spawn a new node from the exact state of the existing node.</p>
<p>This is useful for a couple of tasks:</p>
<ul>
<li>If you're doing a parameter study of an analysis technique and need to run a process in parallel on the same data set, you can download the data set and set up your code on a single node, create an image once you're finished, then spawn new nodes using that snapshot</li>
<li>If you already have a node with a huge data set that took hours to download and process, and you realize your node needs another 32 GB of RAM, or a few extra CPUs, you won't be able to resize it on the fly. But you can create an AMI from the running node, shut it down, and create a new node from the image.</li>
<li>If you created a node in region <code>us-west-1a</code> and another node in region <code>us-east-1c</code> and you want to connect them together on a VPC, you won't be able to create a VPC that spans regions. But you can create an AMI from one of the running nodes, shut it down, and spawn a new node in the correct region.</li>
<li>If you have a particularly large data set, a complicated workflow setup, or a custom operating system, you can create a public AMI and share it with others. </li>
<li>You can also <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html">privately share AMIs</a></li>
</ul>
<h2 id="aws-cli-and-boto3">AWS CLI and Boto3</h2>
<h3 id="aws-from-the-command-line">AWS from the Command Line</h3>
<p>If you've clicked the AWS web interface to death and are looking for a better way of interacting with AWS, you can use <code>aws-cli</code>, a command line interface to AWS. This is extremely convenient for scripting common tasks. </p>
<p><a href="https://aws.amazon.com/cli/">aws-cli</a></p>
<p>This is a really powerful way of interacting with S3 buckets, and makes copying files to/from S3 buckets as easy as copying files in local directories.</p>
<h3 id="boto3">Boto3</h3>
<p>The CLI is much more powerful than the web interface, but is still missing some of the options available through the web. For the complicated stuff, use boto3, the Python API for AWS services.</p>
<p><a href="https://github.com/boto/boto3">boto3 on github</a></p>
<p><a href="https://aws.amazon.com/sdk-for-python/">boto3 documentation</a></p>
<p>The basic formula for boto scripts is, you create Python objects representing different consoles or resources (e.g., a VPC object or an EC2 object), and you call functions to perform actions on those resources or in those consoles. These functions can take complicated nested dictionaries as parameters and allow you to specify every option available in AWS.</p>
<h3 id="to-infinity-and-beyond">To Infinity... And Beyond!</h3>
<p>Other libraries like <a href="https://www.terraform.io/intro/">terraform</a> build on boto3 and simplify the routine tasks of juggling information and configuration details, providing a kubernetes-like dashboard to run and manage an AWS cluster.</p>
<h2 id="instance-metadata">Instance Metadata</h2>
<p>One last topic - how to get access to information about your EC2 node, from your EC2 node.</p>
<p>There are some special IP addresses - any IP address starting with 10 is reserved for private networks, as are networks starting with 192.168, and 127.0.0.1 is the IP address that points to yourself.</p>
<p>The IP address 169.254 is another reserved IP block, and is normally used for crossover connections (direct ethernet-to-ethernet connections). Given its uselessness in the cloud, AWS repurposed that IP address to store instance metadata.</p>
<p>This IP address exposes a restful API that you can call with curl. Information is organized hierarchically. For example:</p>
<div class="highlight"><pre><span></span><code>$ curl http://169.254.169.254/latest/meta-data/

ami-id
ami-launch-index
ami-manifest-path
block-device-mapping/
hostname
iam/
instance-action
instance-id
instance-type
local-hostname
local-ipv4
mac
metrics/
network/
placement/
profile
public-hostname
public-ipv4
public-keys/
reservation-id
security-groups
services/
</code></pre></div>

<p>User data is also available:</p>
<div class="highlight"><pre><span></span><code><span class="c">http://169.254.169.254/latest/user-data</span>
</code></pre></div>

<p>as are the IP addresses of network interfaces. The network interface can be specified if there are more than one. To get the private VPC IP, request the <code>local-ipv4</code> address:</p>
<div class="highlight"><pre><span></span><code><span class="c">http://169.254.169.254/local-ipv4</span>
</code></pre></div>

<p>and to get the public IP address, use <code>public-ipv4</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c">http://169.254.169.254/public-ipv4</span>
</code></pre></div>

<p>by assigning these values to environment variables, you can write and run a single script across multiple machines, and control the execution behavior across those machines.</p>
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-user-data-retrieval">Link to more info on instance data</a></p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/aws.html">aws</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/cloud.html">cloud</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/vpc.html">vpc</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/containers.html">containers</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/data-engineering.html">data engineering</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">

            <a class="next" href="https://charlesreid1.github.io/index21.html">&larr; Newer</a>

            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;

            <a class="prev" href="https://charlesreid1.github.io/index23.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>January 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mediawiki-as-a-zettelkasten-or-external-brain.html">Using MediaWiki as a Zettelkasten or External Brain</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/a-singleton-configuration-class-in-python.html">A Singleton Configuration Class in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mock-api-servers.html">Using Mock API Servers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/creating-mock-api-servers.html">Creating Mock API Servers</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-from-args-to-kwargs.html">Python: From Args to Kwargs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/confuse-a-constructor-when-class-as-constructor-returns-objects-of-type-b.html">Confuse-A-Constructor: When Class A's Constructor Returns Objects of Type B</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-patterns-the-registry.html">Python Patterns: The Registry</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/incorporating-terraform-commands-into-makefiles.html">Incorporating Terraform Commands into Makefiles</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/automatically-generating-up-to-date-requirementstxt-for-python-projects.html">Automatically Generating Up-To-Date requirements.txt for Python Projects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-3-refactoring-large-branches-and-pull-requests.html">Git Workflows, Part 3: Refactoring Large Branches and Pull Requests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>November 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-2-crafting-commits.html">Git Workflows, Part 2: Crafting Commits</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">Git Workflows, Part 1: Supercharging your Git Config</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Mocking AWS in Unit Tests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">Deconvoluting Convolutional Neural Networks</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-2-finding-eulerian-paths.html">Graphs for Bioinformatics, Part 2: Finding Eulerian Paths</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-1-de-bruijn-graphs-hamiltonian-paths-and-eulerian-paths.html">Graphs for Bioinformatics, Part 1: de Bruijn Graphs, Hamiltonian Paths, and Eulerian Paths</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-git-commit-ectomy.html">The Git-Commit-Ectomy</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-3-solving-the-double-step-case.html">The Josephus Problem: Part 3: Solving the Double Step Case</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-2-two-examples.html">The Josephus Problem: Part 2: Two Examples</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-1-the-problem.html">The Josephus Problem: Part 1: The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/approximating-pi-happy-pi-day.html">Approximating Pi (Happy Pi Day)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-5-the-try-trie-tree.html">Five Letter Words: Part 5: The Try Trie Tree</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-4-revisiting-diff-by-one.html">Five Letter Words: Part 4: Revisiting Diff by One</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion: a document search engine</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/any-color-you-like-as-long-as-its-00add8.html">Any Color You Like, As Long As It's 00ADD8</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/a-few-of-my-favorite-peps.html">A Few of My Favorite PEPs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/context-managers-in-python.html">Context Managers in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">Building Snakemake Command Line Wrappers for Kubernetes Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers for Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>