<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                The Josephus Problem: Part 3: Solving the Double Step Case
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-03-20T14:00:00-07:00" pubdate>Wednesday 03/20/2019</time>
                in 
                <a href="/category/computer-science.html">Computer Science</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="/the-josephus-problem-part-3-solving-the-double-step-case.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>Table of Contents</h2>
<ul>
<li>
<p><a href="#solving-the-double-step-case">Solving the Double Step Case</a></p>
<ul>
<li><a href="#an-exmample">An Example</a></li>
</ul>
</li>
<li>
<p><a href="#algorithm-d-using-doubling-permutation">Algorithm D: Using Doubling Permutation</a></p>
<ul>
<li><a href="#write-the-doubling-permutation">Write the Doubling Permutation</a></li>
<li><a href="#reverse-the-doubling-permutation">Reverse the Doubling Permutation</a></li>
<li><a href="#trim-the-reversed-doubling-permutation">Trim the Reversed Doubling Permutation</a></li>
</ul>
</li>
<li>
<p><a href="#why-does-algorithm-d-work">Why Does Algorithm D Work?</a></p>
</li>
<li>
<p><a href="#algorithm-s-label-skipped-nodes">Algorithm S: Label Skipped Nodes</a></p>
</li>
</ul>
<p><br />
<br /></p>
<h2>Solving the Double Step Case</h2>
<p>The Josephus Problem for a step size of <span class="math">\(m = 2\)</span>
can be solved two ways:</p>
<ul>
<li>Algorithm D: Doubling Permutation Algorithm</li>
<li>Algorithm S: Label Skipped Nodes Algorithm</li>
</ul>
<p>We start by covering Algorithm D, which makes
use of a doubling permutation, and explain how
Algorithm D works and why.</p>
<p>Covering Algorithm D will also reveal patterns
that will show up again in Algorithm S, which is
essentially a shortcut method for Algorithm D.</p>
<p>We will start with a concrete example of <span class="math">\(n = 11, m = 2\)</span>
to illustrate Algorithm D, then walk through how it works.
We will solve the same concrete example with Algorithm S for 
comparison. We then give solutions for several other problem 
sizes using Algorithms D and S.</p>
<h2>Algorithm D: Using Doubling Permutation</h2>
<p>In Exercise 29, Knuth asks a question that reveals
a solution procedure for the special case of <span class="math">\(m = 2\)</span>,
and asks the reader to prove it:</p>
<blockquote>
<p>Prove: the cycle form of the Josephus permutation
when <span class="math">\(m = 2\)</span> can be obtained by expressing 
the "doubling permutation" of <span class="math">\(\{1, 2, \dots, 2n\}\)</span>,
which takes <span class="math">\(j\)</span> into <span class="math">\((2j) \mod (2n+1)\)</span> into
cycle form, then <strong>reversing</strong> L and R, 
and erasing all numbers larger than <span class="math">\(n\)</span>.</p>
</blockquote>
<p>Fortunately, we don't have to work out the solution
procedure for ourselves; unfortunately, it is not 
at all obvious why the solution procedure works, so
once we have seen how to apply it, we have to do a
bit more work before we can understand it.</p>
<p>Given an input size <span class="math">\(n\)</span>, the algorithm steps are:</p>
<ol>
<li>
<p>Write the doubling permutation (in table form)</p>
</li>
<li>
<p>Factor the doubling permutation into cycles</p>
</li>
<li>
<p>Reverse each cycle and remove values larger than n</p>
</li>
</ol>
<p>The result will be the Josephus permutation cycles.</p>
<h3>Write the Doubling Permutation</h3>
<p>We start by writing the doubling permutation for
the integers <span class="math">\(1 \dots 2n\)</span>. </p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \, 16 \, 32 \, \dots \right)
$$</div>
<p>When a number is greater than <span class="math">\(2n+1\)</span>, it is
reduced <span class="math">\(\mod (2n+1)\)</span>, so the next few terms of the
doubling permutation written out and reduced modulo
<span class="math">\(2n+1\)</span> are:</p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \, 16 \, 32 \, 64 \, 128 \, 256 \, 512 \, 1024 \right)
$$</div>
<p>which reduces modulo <span class="math">\(2n+1\)</span> to:</p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \, 16 \, 9  \, 18 \,  13 \,   3 \, 6\, 12 \right)
$$</div>
<p>After 12, we reach 1 again, the starting value, so further 
doublings will result in repetition of the elements we have
so far. </p>
<p>Next, continue the process with the remaining elements.
Start with the smallest element not included in the 
cycle found above, which is 5, and continue the operation
of doubling and reducing modulo <span class="math">\(2n+1\)</span>. Doing this results in
the terms:</p>
<div class="math">$$
\left( 5 \, 10 \, 20 \, 40 \, 80 \, \dots \right)
$$</div>
<p>which reduces modulo <span class="math">\(2n+1\)</span> to:</p>
<div class="math">$$
\left( 5 \, 10 \, 20 \, 17 \, 11 \, \dots \right)
$$</div>
<p>Repeating this until the first element repeats
yields all of the remaining elements:</p>
<div class="math">$$
\left( 5 \, 10 \, 20 \, 17 \, 11 \, 22 \, 21 \, 19 \, 15 \, 7 \, 14 \right)
$$</div>
<p>Now the final doubling permutation can be written as the 
product of the two cycles:</p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \, 16 \, 9  \, 18 \,  13 \,   3 \, 6\, 12 \right)
\left( 5 \, 10 \, 20 \, 17 \, 11 \, 22 \, 21 \, 19 \, 15 \, 7 \, 14 \right)
$$</div>
<h3>Reverse the Doubling Permutation</h3>
<p>The next step is to reverse the permutation from left to right,
which means we step through all cycles from left to right,
and step through each cycle from left to right.</p>
<p>Starting with the doubling permutation:</p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \, 16 \, 9  \, 18 \,  13 \,   3 \, 6\, 12 \right)
\left( 5 \, 10 \, 20 \, 17 \, 11 \, 22 \, 21 \, 19 \, 15 \, 7 \, 14 \right)
$$</div>
<p>We obtain the reverse:</p>
<div class="math">$$
\left( 14 \, 7 \, 15 \, 19 \, 21 \, 22 \, 11 \, 17 \, 20 \, 10 \, 5 \right)
\left( 12 \, 6 \, 3 \, 13 \, 18 \, 9 \, 16 \, 8 \, 4 \, 2 \, 1 \right)
$$</div>
<h3>Trim the Reversed Doubling Permutation</h3>
<p>Now we eliminate any numbers from the reversed doubling permutation
that are larger than <span class="math">\(n = 11\)</span>, to get the trimmed permutation:</p>
<div class="math">$$
\left( 7 \, 11 \, 10 \, 5 \right)
\left( 6 \, 3 \, 9 \, 8 \, 4 \, 2 \, 1 \right)
$$</div>
<p>This is the final Josephus permutation. The one remaining step is to
rewrite the cycles in standard "sorted" order:</p>
<div class="math">$$
\left( 1 \, 6 \, 3 \, 9 \, 8 \, 4 \, 2 \right)
\left( 5 \, 7 \, 11 \, 10 \right)
$$</div>
<p>Congratulations! You just solved the problem.</p>
<h2>Why Does Algorithm D Work?</h2>
<p>If at this point you are scratching your head in wonder
at the seeming black magic involved in this algorithm,
then welcome to <u>The Art of Computer Programming</u>!
(Seriously, the exercises are chock full of questions
like this one.)</p>
<p>To understand why Algorithm D works, it is instructive
to consider a case where <span class="math">\(n\)</span> is a power of two, and make
some observations and generalizations to uncover the pattern
at work in Algorithm D. </p>
<h3>An Important Observation</h3>
<p>Start with an important observation: each time we complete one 
circuit of the circle, we have reduced the number of items 
in the circle by </p>
<div class="math">$$
\left\lfloor{ \frac{n}{2} }\right\rfloor
$$</div>
<p>If our circle size is even, that means we cut our circle
size in half each time through the circle.</p>
<p>The halving operation means the Josephus problem is
intimately linked with powers of 2 (or, base 2 logs),
so that's where the powers of 2 will come from.</p>
<h3>Three Facts</h3>
<p>Now we use this observation about halving to
state 3 facts about the case:</p>
<p><br /></p>
<p><strong>Fact 1: If we are considering an item at an odd-numbered
location in the circle, we have already been
through the circle at least once.</strong></p>
<p>(Explanation: The first time through the circle, 
all of the items in the circle at even-numbered 
locations will be removed, so only items at 
odd-numbered locations around the circle are left
after the first pass.)</p>
<p><br /></p>
<p><strong>Fact 2: When the circle size is a power of 2,
the first item in the circle is the last item removed.</strong></p>
<p>(Explanation: If we have a circle the size of a power of 2,
we will always remove the last item in the circle when we
complete a circuit (because we will always reach it using 
two-steps), which means we always skip item 1 if the circle
size is a power of 2.)</p>
<p>(Addendum: If a circle size starts as a power of 2,
going through the circle once and removing elements will
exactly halve the circle size, and preserve the property
that the circle size is a power of 2.)</p>
<p><br /></p>
<p><strong>Fact 3: When the circle size is not a power of 2, the
size will eventually be reduced to a power of 2. Then
the item at the starting position in that round will be
the last item removed.</strong></p>
<p>(Explanation: Combining Fact 1 and Fact 2, we can see
that eventually we will always reach a "special case"
where the circle size is a power of 2. The worst case
is when the circle size takes <span class="math">\(n-2\)</span> steps to reduce to
a size of <span class="math">\(2\)</span>.)</p>
<p><br /></p>
<p>Now we will use these 3 facts to understand Algorithm D.</p>
<h3></h3>
<p>Let us first consider <span class="math">\(n = 8, m = 2\)</span>.</p>
<p>Step 1 is to create a table of <span class="math">\(j\)</span>, <span class="math">\(2j\)</span>,
and <span class="math">\((2j) \mod (2n+1)\)</span>:</p>
<div class="highlight"><pre><span></span> j   |  2j  |  2j mod 2n+1
-----|------|---------------
  1  |   2  |        2
  2  |   4  |        4
  3  |   6  |        6
  4  |   8  |        8
  5  |  10  |       10
  6  |  12  |       12
  7  |  14  |       14
  8  |  16  |       16
- - - - - - - - - - - - - - -
  9  |  18  |        1
 10  |  20  |        3
 11  |  22  |        5
 12  |  24  |        7
 13  |  26  |        9
 14  |  28  |       11
 15  |  30  |       13
 16  |  32  |       15
</pre></div>


<p>Step 2 is to thread our way through 
the table entries, creating cycles
as we go, which results in the following
cycles:</p>
<div class="math">$$
\left( 1 \, 2 \, 4 \, 8 \ 16 \, 15 \, 13 \, 9 \right)
\left( 3 \, 6 \, 12 \, 17 \, 14 \, 11 \, 5 \, 10 \right)
$$</div>
<p>Step 3 is to reverse and trim the values
larger than 8:</p>
<div class="math">$$
\left( 5 \, 7 \, 6 \, 3 \right)
\left( 8 \, 4 \, 2 \, 1 \right)
$$</div>
<h2>Algorithm S: Label Skipped Nodes</h2>
<p>Step through circle</p>
<p>Each person that is skipped, label <span class="math">\(n+1\)</span></p>
<p>Repeat until all even</p>
<p>Removal index is k/2</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="/tag/graphs.html">graphs</a>
                    &nbsp;&nbsp;
                    <a href="/tag/puzzles.html">puzzles</a>
                    &nbsp;&nbsp;
                    <a href="/tag/algorithms.html">algorithms</a>
                    &nbsp;&nbsp;
                    <a href="/tag/josephus.html">josephus</a>
                    &nbsp;&nbsp;
                    <a href="/tag/latex.html">latex</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>

</div>


<script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>