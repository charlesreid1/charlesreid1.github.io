<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                A Singleton Configuration Class in Python
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2020-04-28T16:00:00-07:00" pubdate>Tuesday 04/28/2020</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/a-singleton-configuration-class-in-python.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#the-singleton-pattern">The Singleton Pattern</a></li>
<li><a href="#get-variable-functions">Get Variable Functions</a></li>
<li><a href="#config-functions">Config Functions</a></li>
<li><a href="#reset-method">Reset method</a></li>
<li><a href="#creating-a-configuration-context-manager">Creating a configuration context manager</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ul>
</div>
<h1 id="overview">Overview</h1>
<p>In this post we cover a strategy for managing configurations for programs using
a Singleton pattern to create a static <code>Config</code> class.</p>
<p>This allows the user to create an instance of the <code>Config</code> class, pointing it
to a specific config file, which it loads into memory.</p>
<p>The <code>Config</code> class provides several static methods for accessing configuration
options from the config file. Here's an example of its usage:</p>
<div class="highlight"><pre><span></span><code>Config(&#39;/path/to/config.json&#39;)

if Config.get_foo() == &quot;bar&quot;:
    do_stuff()
</code></pre></div>

<p>The principle is to <strong>define one configuration file location, and be done with it.</strong>
The configuration file is JSON formatted, but the pattern can be adapted to use
any format.</p>
<p>The <code>Config</code> class can also be used to wrap and process both variables in the configuration
file <em>and</em> environment variables.</p>
<p>The <code>Config</code> class implements a <strong>separation of concerns</strong> by only processing top-level
configuration variable options, and leaving more detailed configuration file parsing
to the classes that need it. This allows for more flexible config files.</p>
<h1 id="the-singleton-pattern">The Singleton Pattern</h1>
<p>The Singleton pattern involves the use of instance variables, which the variables
<code>_CONFIG_FILE</code> and <code>_CONFIG</code> are. These are shared across all instances of class
<code>Config</code> and can be accessed via <code>Config._CONFIG_FILE</code>, etc.</p>
<p>The location of the config file can be set in the constructor,
or can be provided via the <code>CONFIG_FILE</code> environment variable.
The config class also provides a method for accessing environment
variables that are required by the Config class, and raising a
custom exception if it is not present.</p>
<p>The constructor starts by checking that the configuration file exists, then loads
the configuration file into memory (at <code>Config._CONFIG</code> as a dictionary):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c1">#########################</span>
    <span class="c1"># Begin Singleton Section</span>
    <span class="c1">#########################</span>

    <span class="n">_CONFIG_FILE</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_CONFIG</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config_file</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_required_env_var</span><span class="p">(</span><span class="s2">&quot;CONFIG_FILE&quot;</span><span class="p">)</span>

        <span class="c1"># Check that specified config file exists</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

        <span class="c1"># Use singleton pattern to store config file location/load config once</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG_FILE</span> <span class="o">=</span> <span class="n">config_file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_config_file</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG_FILE</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_required_env_var</span><span class="p">(</span><span class="n">envvar</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">envvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please set the </span><span class="si">{</span><span class="n">envvar</span><span class="si">}</span><span class="s2"> environment variable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">envvar</span><span class="p">]</span>
</code></pre></div>

<p>Aside from the constructor, every method in the <code>Config</code> class is a
<code>@staticmethod</code> or a <code>@classmethod</code>.</p>
<h1 id="get-variable-functions">Get Variable Functions</h1>
<p>We add two additional methods to get configuration variables: one to get variables
from the config file, one to get environment variables. Here they are:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_required_env_var</span><span class="p">(</span><span class="n">envvar</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">envvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please set the </span><span class="si">{envvar}</span><span class="s2"> environment variable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">envvar</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_required_config_var</span><span class="p">(</span><span class="n">configvar</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG</span>
        <span class="k">if</span> <span class="n">configvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please set the </span><span class="si">{</span><span class="n">configvar</span><span class="si">}</span><span class="s2"> variable in the config file </span><span class="si">{</span><span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG_FILE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Config</span><span class="o">.</span><span class="n">_CONFIG</span><span class="p">[</span><span class="n">configvar</span><span class="p">]</span>
</code></pre></div>

<p>We saw the get_required_env_var()<code>function in action in the constructor.
The</code>get_required_config_var()` can be useful for config variables that
are dependent on other config variables.</p>
<h1 id="config-functions">Config Functions</h1>
<p>Continuing with the <code>Config</code> class defined above,
we now define methods that implement logic for specific 
configuration variables.</p>
<p>Here are two example config variables.</p>
<p>The variable <code>foo</code> is set using the configuration file.
The configuration file is a dictionary, meaning it consists
of key-value pairs, so the variable <code>foo</code> is set by the value
corresponding to the <code>foo</code> key in the config file.</p>
<p>For example, using the following simple configuration file:</p>
<div class="highlight"><pre><span></span><code>{
    &quot;foo&quot;: &quot;hello world&quot;
}
</code></pre></div>

<p>if the <code>Config</code> class is initialized with that configuration file,
<code>Config.get_foo_var()</code>  will return the string <code>hello world</code>.</p>
<p>Similarly, the <code>bar</code>variable is set using the environment variable <code>BAR</code>.
If the <code>BAR</code> variable is not set, the program will raise an exception
when <code>Config.get_bar_var()</code> is called.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="o">...</span><span class="n">see</span> <span class="n">singleton</span> <span class="n">section</span> <span class="n">above</span><span class="o">...</span>

    <span class="c1">#############################</span>
    <span class="c1"># Begin Configuration Section</span>
    <span class="c1">#############################</span>

    <span class="n">_FOO</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_BAR</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_foo_var</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Example variable that is set in the config file (preferred)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_FOO</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_FOO</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_required_config_var</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_FOO</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_bar_var</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Example variable that is set via env var (not preferred)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_BAR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_BAR</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_required_env_var</span><span class="p">(</span><span class="s1">&#39;BAR&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_BAR</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_wuz</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;wuz&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_CONFIG</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_required_env_var</span><span class="p">(</span><span class="s1">&#39;WUZ&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_CONFIG</span><span class="p">[</span><span class="s1">&#39;wuz&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Path </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span><span class="si">}</span><span class="s2"> is not a directory&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_WUZ</span>
</code></pre></div>

<p>The <code>wuz</code> variable, in this example, is a variable that can be set with a config
file variable, or (if it is not present in the config file) with an environment
variable. The <code>wuz</code> variable msut also be a path, so there is logic for checking
whether the path exists.</p>
<h1 id="reset-method">Reset method</h1>
<p>It can be useful to clear out an existing config file in order to
load a new config file - specifically, when testing. Here we define a <code>reset()</code>
method that clears out variable values. We will show an example of how to
use the <code>reset()</code> method below.</p>
<div class="highlight"><pre><span></span><code>    @classmethod
    def reset(cls) -&gt; None:
        cls._CONFIG_FILE = None
        cls._CONFIG = None
        cls._FOO = None
        cls._BAR = None
        cls._WUZ = None
</code></pre></div>

<p>This could be done more gracefully by iterating over each attribute of the Config class
and only nullifying those attributes whose variable name matches the given pattern (start
with an underscore, only contain capital letters and underscores) using a regular expression.</p>
<h1 id="creating-a-configuration-context-manager">Creating a configuration context manager</h1>
<p>To make tests more convenient, we define a context manager that takes
a dictionary as an input. The context manager creates a temporary file
with the contents of that dictionary, and resets the Config class using
the temporary file as the new config file. This allows tests to be written
using different configurations on the fly, very useful when testing
different configuration options:</p>
<div class="highlight"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;peanut_butter&quot;</span><span class="p">:</span> <span class="s2">&quot;jelly&quot;</span><span class="p">}</span>
<span class="k">with</span> <span class="n">TempConfig</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temporary configuration file is at </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get_required_config_var</span><span class="p">(</span><span class="s2">&quot;peanut_butter&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">val</span><span class="o">==</span><span class="s2">&quot;jelly&quot;</span>
</code></pre></div>

<p>Here is the context manager class to temporarily replace the configuration
wrapped by the <code>Config</code> class:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TempConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporarily patch the Config class to use the config</span>
<span class="sd">    dictionary specified in the constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is the step that&#39;s run when object constructed&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># This is the temp configuration the user specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span> <span class="o">=</span> <span class="n">config_dict</span>
        <span class="c1"># Make a temp dir for our temp config file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="c1"># Make a temp config file</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_json</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="c1"># Set the wuz variable to the temporary directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;wuz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is what&#39;s returned to the &quot;as X&quot; portion of the context manager&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_json</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_dict</span><span class="p">))</span>
        <span class="c1"># Re-init Config with new config file</span>
        <span class="n">Config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_json</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_json</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the context and clean up; the *args are needed in case there is</span>
<span class="sd">        an exception (we don&#39;t deal with those here)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Delete temp file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_json</span><span class="p">)</span>
        <span class="c1"># Delete temp dir</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="c1"># Reset all config variables</span>
        <span class="n">Config</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method: write string contents to config file&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</code></pre></div>

<h1 id="next-steps">Next steps</h1>
<p>That's it for now. This singleton configuration class is being written into a
new version of <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion</a>,
which will be <a href="https://github.com/chmreid/centillion/pull/3">centillion version 2.0</a>.
This is still a pull request in a centillion fork, though, so it's a work in progress.
Stay tuned!</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/programming.html">programming</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/patterns.html">patterns</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/design-patterns.html">design patterns</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/registry.html">registry</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/computer-science.html">computer science</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Using Mock API Servers
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2020-03-09T19:00:00-07:00" pubdate>Monday 03/09/2020</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/using-mock-api-servers.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#the-mockapiserver-class">The MockAPIServer Class</a></li>
<li><a href="#a-basic-unit-test-with-mockapiserver">A Basic Unit Test with MockAPIServer</a></li>
</ul>
</div>
<h1 id="summary">Summary</h1>
<p>In a prior post, we covered how to write a mock API server that stored a thread
as a class attribute and used it to run the server in the background by starting
a thread.</p>
<p>However, we neglected to cover how to actually <em>use</em> the mock API server. So here
we include some examples of how you can use the mock API server to write better
tests for components that require interacting with APIs.</p>
<h1 id="the-mockapiserver-class">The MockAPIServer Class</h1>
<p>Let's start with a recap of the mock API server class. Major features included:</p>
<ul>
<li>
<p>Inheriting from the base HTTP server class in Python, to take advantage of
  the methods available through it</p>
</li>
<li>
<p>Using a singleton design pattern to start and stop the fake API server</p>
</li>
</ul>
<p>Basically we create the server, call <code>start_serving()</code>, and that starts the
server on a thread in the background.</p>
<p>Here is the source code:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MockAPIServer</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_addr_port</span><span class="p">():</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="s2">&quot;9876&quot;</span>
        <span class="k">return</span> <span class="n">addr</span><span class="p">,</span> <span class="n">port</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Get the bind address and port</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_addr_port</span><span class="p">()</span>

        <span class="c1"># Create an HTTP server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span><span class="p">),</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Create a thread to run the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>

        <span class="c1"># Start the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Shut down the server</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

        <span class="c1"># Let the thread rejoin the worker pool</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">))</span>
        <span class="c1"># Enforce rule: JSON only</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">!=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># Convert received JSON to dict</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>

        <span class="c1"># Process the json</span>

        <span class="c1"># Send a response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</code></pre></div>

<h1 id="a-basic-unit-test-with-mockapiserver">A Basic Unit Test with MockAPIServer</h1>
<p>Let's make a basic test that uses the <code>MockAPIServer</code> class. We'll use
<code>unittest</code> for simplicity, other testing frameworks offer similar
functionality.</p>
<p>Before testing our code, we'll need to make sure the API URL is configurable,
sicne we will need to get the mock API server's bind address and port and use
those to instruct our code where to find the API server.</p>
<p>Here is a short example function that we'll test:</p>
<p><strong><code>foobar.py</code></strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib.parse</span>

<span class="k">def</span> <span class="nf">make_api_call</span><span class="p">(</span><span class="n">api_url</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple function that gets an API endpoint</span>
<span class="sd">    and returns if no problems raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Assemble our API call</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;/hello/world&#39;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>

    <span class="c1"># The basic mock server will just echo our request back</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span>
</code></pre></div>

<p>Now we write a short test for our foobar script:</p>
<p><strong><code>test_foobar.py</code></strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">foobar</span> <span class="kn">import</span> <span class="n">make_api_call</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestAPICalls</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">MockAPIServer</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">start_serving</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_api_call</span><span class="p">():</span>
        <span class="n">addr</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span>
            <span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">port</span>
        <span class="p">)</span>
        <span class="n">make_api_cal</span><span class="p">(</span><span class="n">api_url</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">stop_serving</span><span class="p">()</span>
</code></pre></div>

<p>We can run the test like so:</p>
<div class="highlight"><pre><span></span><code>python test_foobar.py
</code></pre></div>

<p>Here's what happens when we run the test:</p>
<ul>
<li>The <code>setUpClass()</code> method is called, which creates a mock API server that starts on
  localhost on port 9876 and runs the server on a thread.</li>
<li>The <code>test_api_call()</code> method is run, which makes the API call to the mock API server.
  (Nothing interesting is happening on either end, right now, but stay tuned for more
  examples.)</li>
<li>The <code>tearDownClass()</code> method is called, which stops the mock API server and returns
  the thread worker to the pool of workers.</li>
</ul>
<p>Stay tuned for more complicated examples in the future - we are currently working on
extending this mock API server to mock calls to the Github API.</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/http.html">http</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/server.html">server</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mock.html">mock</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mocking.html">mocking</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/api.html">api</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/flask.html">flask</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/web-server.html">web server</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Creating Mock API Servers
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2020-02-26T22:00:00-08:00" pubdate>Wednesday 02/26/2020</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/creating-mock-api-servers.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#mock-api-server-class">Mock API Server Class</a><ul>
<li><a href="#startstop-serving">Start/Stop Serving</a><ul>
<li><a href="#getting-bind-addressport">Getting Bind Address/Port</a></li>
<li><a href="#start-serving">Start Serving</a></li>
<li><a href="#stop-serving">Stop Serving</a></li>
</ul>
</li>
<li><a href="#handling-requests">Handling Requests</a><ul>
<li><a href="#defining-post-response-method">Defining POST Response Method</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#putting-it-all-together">Putting it all together</a></li>
</ul>
</div>
<h1 id="overview">Overview</h1>
<p>In this post we discuss a way of mocking an API server during tests.
This technique will let you create a fake API server that can respond
to API calls however you want.</p>
<p>The technique is twofold:</p>
<ul>
<li>
<p>First, we create a mock API handler that extends <code>BaseHTTPRequestHandler</code>, which is the built-in HTTP server
  class in Python. We can extend the server class to control how it responds to requests - to implement a
  method to respond to POST requests, we implement a <code>do_POST()</code> method, to respond to GET requests
  we implement a <code>do_GET()</code> method, and so on. (In the example below, we restrict the types of requests
  to JSON content only.)</p>
</li>
<li>
<p>Second, we use the Singleton design pattern, by implementing 
  two class methods, <code>start_serving()</code> and <code>stop_serving()</code>, that
  we can call before and after our tests to set up and tear down
  the fake API server. This method will take care of starting the
  HTTP server on a separate thread, so that it does not block 
  execution.</p>
</li>
</ul>
<h1 id="mock-api-server-class">Mock API Server Class</h1>
<p>Let's start with the mock server class. This is going to extend the
<code>BaseHTTPRequestHandler</code> class from the <code>http.server</code> module, and
extend it.</p>
<p>We implement a stub method for the POST response behavior; this is the
only type of request that our mock API server will respond to.</p>
<p>We also have two stub class methods to start and stop the server.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MockAPIServer</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>

<h2 id="startstop-serving">Start/Stop Serving</h2>
<p>We start with the two class methods to start and stop the server.</p>
<h3 id="getting-bind-addressport">Getting Bind Address/Port</h3>
<p>Define another static method to get the address to bind to, and the
port to use; in this case we'll hard code values, but this function
could also find unused networking ports, etc.</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_addr_port</span><span class="p">():</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="s2">&quot;9876&quot;</span>
        <span class="k">return</span> <span class="n">addr</span><span class="p">,</span> <span class="n">port</span>
</code></pre></div>

<h3 id="start-serving">Start Serving</h3>
<p>Next, the <code>start_serving()</code> method should start a thread
(using the <code>cls._thread</code> attribute to store it for later)
and create an underlying HTTP server (and using the <code>self._server</code>
attribute to store it for later):</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Get the bind address and port</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_addr_port</span><span class="p">()</span>

        <span class="c1"># Create an HTTP server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span><span class="p">),</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Create a thread to run the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>

        <span class="c1"># Start the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>

<h3 id="stop-serving">Stop Serving</h3>
<p>The <code>stop_serving()</code> method stops the thread</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Shut down the server</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

        <span class="c1"># Let the thread rejoin the worker pool</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
</code></pre></div>

<h2 id="handling-requests">Handling Requests</h2>
<p>The mock API server should only process POST requests, and should
only accept JSON-formatted requests. We can implement those checks
and have the server return a 500 error if clients do not send a
properly formatted JSON request.</p>
<h3 id="defining-post-response-method">Defining POST Response Method</h3>
<p>To define a response to POST requests made to the API we are mocking,
we start by validating the JSON request that is received.</p>
<p>Note: this utilizes several built-in methods of the HTTP server class.</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">))</span>
        <span class="c1"># Enforce rule: JSON only</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">!=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># Convert received JSON to dict</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>

        <span class="c1"># Process the json</span>
        <span class="o">...</span>
</code></pre></div>

<p>Now, the JSON can be processed using a validate function,
for example, or generic success/failure responses returned
based on the contents of a request.</p>
<p>Let's do something very simple: have the API server return
whatever was sent in the request.</p>
<p>We can turn the dictionary <code>message</code> (a dictionary containing
the original request) back into a string, and the string into
a stream of bytes. Then we can write headers and the stream of
bytes into the response.</p>
<div class="highlight"><pre><span></span><code>        <span class="c1"># Send a response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div>

<p>The <code>_set_headers()</code> method is a short method that just sends
(writes) the correct headers:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">_set_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</code></pre></div>

<p>Note: the <code>send_headers()</code> and <code>end_headers()</code> methods are built-in
to the HTTP server base class we are using.</p>
<h1 id="putting-it-all-together">Putting it all together</h1>
<p>Putting it all together, we get one final mock API server class:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MockAPIServer</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_addr_port</span><span class="p">():</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="s2">&quot;9876&quot;</span>
        <span class="k">return</span> <span class="n">addr</span><span class="p">,</span> <span class="n">port</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Get the bind address and port</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_addr_port</span><span class="p">()</span>

        <span class="c1"># Create an HTTP server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="bp">cls</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_port</span><span class="p">),</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Create a thread to run the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>

        <span class="c1"># Start the server</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_serving</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Shut down the server</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

        <span class="c1"># Let the thread rejoin the worker pool</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctype</span><span class="p">,</span> <span class="n">pdict</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">))</span>
        <span class="c1"># Enforce rule: JSON only</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">!=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># Convert received JSON to dict</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>

        <span class="c1"># Process the json</span>

        <span class="c1"># Send a response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</code></pre></div></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/http.html">http</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/server.html">server</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mock.html">mock</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mocking.html">mocking</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/api.html">api</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/flask.html">flask</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/web-server.html">web server</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">

            <a class="next" href="https://charlesreid1.github.io/index4.html">&larr; Newer</a>

            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;

            <a class="prev" href="https://charlesreid1.github.io/index6.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>March 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/how-to-read-ulysses.html">How to Read Ulysses</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-todo-lists.html">MediaWiki Patterns for a Zettelkasten: Todo Lists</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-organizing-pages.html">MediaWiki Patterns for a Zettelkasten: Organizing Pages</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2022</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-monthly-template-pattern.html">MediaWiki Patterns for a Zettelkasten: Monthly Template Pattern</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/mediawiki-patterns-for-a-zettelkasten-daily-page-pattern.html">MediaWiki Patterns for a Zettelkasten: Daily Page Pattern</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mediawiki-as-a-zettelkasten-or-external-brain.html">Using MediaWiki as a Zettelkasten or External Brain</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2021</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/september-2021-tils.html">September 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/august-2021-tils.html">August 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/july-2021-tils.html">July 2021 TILs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/june-2021-tils.html">June 2021 TILs</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/copying-letsencrypt-certs-between-machines.html">Copying LetsEncrypt Certs Between Machines</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/applied-gitflow.html">Applied Gitflow</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/a-singleton-configuration-class-in-python.html">A Singleton Configuration Class in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/using-mock-api-servers.html">Using Mock API Servers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/creating-mock-api-servers.html">Creating Mock API Servers</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-from-args-to-kwargs.html">Python: From Args to Kwargs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/confuse-a-constructor-when-class-as-constructor-returns-objects-of-type-b.html">Confuse-A-Constructor: When Class A's Constructor Returns Objects of Type B</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-patterns-the-registry.html">Python Patterns: The Registry</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/incorporating-terraform-commands-into-makefiles.html">Incorporating Terraform Commands into Makefiles</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/automatically-generating-up-to-date-requirementstxt-for-python-projects.html">Automatically Generating Up-To-Date requirements.txt for Python Projects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-3-refactoring-large-branches-and-pull-requests.html">Git Workflows, Part 3: Refactoring Large Branches and Pull Requests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>November 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-2-crafting-commits.html">Git Workflows, Part 2: Crafting Commits</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">Git Workflows, Part 1: Supercharging your Git Config</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Mocking AWS in Unit Tests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">Deconvoluting Convolutional Neural Networks</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-2-finding-eulerian-paths.html">Graphs for Bioinformatics, Part 2: Finding Eulerian Paths</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-1-de-bruijn-graphs-hamiltonian-paths-and-eulerian-paths.html">Graphs for Bioinformatics, Part 1: de Bruijn Graphs, Hamiltonian Paths, and Eulerian Paths</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-git-commit-ectomy.html">The Git-Commit-Ectomy</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-3-solving-the-double-step-case.html">The Josephus Problem: Part 3: Solving the Double Step Case</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-2-two-examples.html">The Josephus Problem: Part 2: Two Examples</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-1-the-problem.html">The Josephus Problem: Part 1: The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/approximating-pi-happy-pi-day.html">Approximating Pi (Happy Pi Day)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-5-the-try-trie-tree.html">Five Letter Words: Part 5: The Try Trie Tree</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-4-revisiting-diff-by-one.html">Five Letter Words: Part 4: Revisiting Diff by One</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion: a document search engine</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/any-color-you-like-as-long-as-its-00add8.html">Any Color You Like, As Long As It's 00ADD8</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/a-few-of-my-favorite-peps.html">A Few of My Favorite PEPs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/context-managers-in-python.html">Context Managers in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">Building Snakemake Command Line Wrappers for Kubernetes Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers for Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>