<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="v50"></div>

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">Tag: mocking</h1>
            </div>
        </div>
    </div>

    <div class="v50"></div>

    <div>



<hr/ >

<header>
<div class="row">
    <div class="col-md-12">

        <!-- only the header is centered. -->
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Creating Mock API Servers
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-12-26T20:00:00-08:00" pubdate>Thursday 12/26/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/creating-mock-api-servers.html">permalink</a>
            </span>
            </p>
        </div>

    </div>
</div>
</header>

<div class="v20"></div>

<div class="row">
    <div class="col-md-8 col-centered" style="text-align: left;">

        <div class="entry-content"><h1>Introduction</h1>
<h2>Mock API Server Class</h2>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MockFusilladeHandler</span><span class="p">(</span><span class="nx">BaseHTTPRequestHandler</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">_server</span> <span class="o">=</span> <span class="nx">None</span>
    <span class="nx">_thread</span> <span class="o">=</span> <span class="nx">None</span>

    <span class="kd">@staticmethod</span>
    <span class="nx">def</span> <span class="nx">get_addr_port</span><span class="p">()</span><span class="o">:</span>
        <span class="nx">addr</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="nx">port</span> <span class="o">=</span> <span class="nx">networking</span><span class="p">.</span><span class="nx">unused_tcp_port</span><span class="p">()</span>
        <span class="k">return</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">port</span>

    <span class="kd">@classmethod</span>
    <span class="nx">def</span> <span class="nx">start_serving</span><span class="p">(</span><span class="nx">cls</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">Config</span><span class="p">.</span><span class="nx">set_config</span><span class="p">(</span><span class="nx">BucketConfig</span><span class="p">.</span><span class="nx">TEST</span><span class="p">)</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">_addr</span><span class="p">,</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">_port</span> <span class="o">=</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">get_addr_port</span><span class="p">()</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">stash_oidc_group_claim</span><span class="p">()</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">stash_openid_provider</span><span class="p">()</span>
        <span class="nx">Config</span><span class="p">.</span><span class="nx">_set_authz_url</span><span class="p">(</span><span class="nx">f</span><span class="s2">&quot;http://{cls._addr}:{cls._port}&quot;</span><span class="p">)</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">f</span><span class="s2">&quot;Mock Fusillade server listening at {cls._addr}:{cls._port}&quot;</span><span class="p">)</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">_server</span> <span class="o">=</span> <span class="nx">HTTPServer</span><span class="p">((</span><span class="nx">cls</span><span class="p">.</span><span class="nx">_addr</span><span class="p">,</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">_port</span><span class="p">),</span> <span class="nx">cls</span><span class="p">)</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">_thread</span> <span class="o">=</span> <span class="nx">threading</span><span class="p">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">cls</span><span class="p">.</span><span class="nx">_server</span><span class="p">.</span><span class="nx">serve_forever</span><span class="p">)</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">_thread</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>

    <span class="kd">@classmethod</span>
    <span class="nx">def</span> <span class="nx">stop_serving</span><span class="p">(</span><span class="nx">cls</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">restore_oidc_group_claim</span><span class="p">()</span>
        <span class="nx">cls</span><span class="p">.</span><span class="nx">restore_openid_provider</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">_server</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">None</span>:
            <span class="kt">cls._server.shutdown â€¦</span></pre></div></div>
        <br />
        <br />
        <footer>
            <a rel="full-article" href="https://charlesreid1.github.io/creating-mock-api-servers.html">Read On &crarr;</a>
        </footer>

    </div>
</div>



<div class="v20"></div>



<div class="row">
    <div class="col-md-8 col-centered" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/http.html">http</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/server.html">server</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mock.html">mock</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mocking.html">mocking</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>



<div class="v200"></div>


<hr/ >

<header>
<div class="row">
    <div class="col-md-12">

        <!-- only the header is centered. -->
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Mocking AWS in Unit Tests
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-09-23T09:00:00-07:00" pubdate>Monday 09/23/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">permalink</a>
            </span>
            </p>
        </div>

    </div>
</div>
</header>

<div class="v20"></div>

<div class="row">
    <div class="col-md-8 col-centered" style="text-align: left;">

        <div class="entry-content"><h2>Table of Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#a-simple-example-mocking-api-responses">A Simple Example: Mocking API Responses</a><ul>
<li><a href="#the-genuine-aws-call">The Genuine AWS Call</a></li>
<li><a href="#the-mocked-aws-call">The Mocked AWS Call</a></li>
</ul>
</li>
</ul>
<p><br />
<br /></p>
<h2>Overview</h2>
<p>This post covers a technique for mocking AWS in unit tests so that you can test functionality that normally
requires API calls and handling responses, by mocking those responses instead of making actual API calls.</p>
<h2>A Simple Example: Mocking API Responses</h2>
<h3>The Genuine AWS Call</h3>
<p>Let's start with an example of an AWS API call. Here's how our program will be structured:
start with a driver <code>lister.py</code> that creates an AWS secrets manager client and defines a 
function to list â€¦</p></div>
        <br />
        <br />
        <footer>
            <a rel="full-article" href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Read On &crarr;</a>
        </footer>

    </div>
</div>



<div class="v20"></div>



<div class="row">
    <div class="col-md-8 col-centered" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/pytest.html">pytest</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/tests.html">tests</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/aws.html">aws</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mock.html">mock</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/mocking.html">mocking</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>



<div class="v200"></div>



    </div>

</div>


<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>