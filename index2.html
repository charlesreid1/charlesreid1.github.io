<!DOCTYPE html>
<html lang="en">
<head>
        <title>charlesreid1</title>
        <meta charset="utf-8" />

        <!--
        CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/bootstrap.css"       rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/slate.css"              rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/font-awesome.css"       rel="stylesheet" type="text/css"/>
        <link href="https://charlesreid1.github.io/theme/css/pygment-solarized.css"  rel="stylesheet" type="text/css"/>

        <!--
        my CSS styles
        -->
        <link href="https://charlesreid1.github.io/theme/css/main.css"            rel="stylesheet" type="text/css">
        <link href="https://charlesreid1.github.io/theme/css/dox.css"             rel="stylesheet" type="text/css">


        <!--
        include Angular first
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/angular-1.3.15.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/skrollr-0.6.29.js"></script>
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script>

        <!--
        this seems like a bad idea.
        but if I don't put jquery first, I get errors about unrecognized $s.
        -->
        <script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>

</head>
<body id="index">
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span> 
            </button>
            <a href="https://charlesreid1.github.io" class="navbar-brand">charlesreid1.github.io</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                    <li>
                        <a href="https://charlesreid1.com/wiki">Wiki</a>
                    </li>
                    <li>
                        <a href="https://git.charlesreid1.com/explore">Git</a>
                    </li>
                    <li>
                        <a href="http://spotify.charlesreid1.com">Music</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/life">Life</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.github.io">Blog</a>
                    </li>
                    <li>
                        <a href="https://charlesreid1.com/about">About Me</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>



<div class="container">

    <div class="row">
        <div class="col-md-12 col-centered" style="text-align: center;">
            <div class="v50"></div>
            <div class="cosmojumbo">
                <h1 class="jumbojumbo">charlesreid1.com blog<h1>
            </div>
        </div>
    </div>


    <div class="v50"></div>


    <div class="row">

        <div class="col-md-8" style="text-align: center;">

  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Incorporating Terraform Commands into Makefiles
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2020-02-15T12:00:00-08:00" pubdate>Saturday 02/15/2020</time>
                in 
                <a href="https://charlesreid1.github.io/category/terraform.html">Terraform</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/incorporating-terraform-commands-into-makefiles.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#step-0-directory-and-file-layout">Step 0: Directory and File Layout</a><ul>
<li><a href="#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li><a href="#step-1-top-level-makefile">Step 1: Top Level Makefile</a></li>
<li><a href="#step-2-infra-level-makefile">Step 2: Infra Level Makefile</a><ul>
<li><a href="#fake-targets">Fake Targets</a></li>
<li><a href="#commands-for-single-components">Commands for Single Components</a></li>
<li><a href="#commands-for-all-components">Commands for All Components</a></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#final-makefile">Final Makefile</a></li>
</ul>
</li>
<li><a href="#step-3-writing-terraform-components">Step 3: Writing Terraform Components</a></li>
<li><a href="#step-4-initializing-terraform-components">Step 4: Initializing Terraform Components</a></li>
<li><a href="#workflow">Workflow</a><ul>
<li><a href="#plan">Plan</a></li>
<li><a href="#deploy">Deploy</a></li>
<li><a href="#update">Update</a></li>
<li><a href="#destroy">Destroy</a></li>
</ul>
</li>
</ul>
<h1>Summary</h1>
<p>This blog post covers a useful pattern for incorporating terraform commands
into a Makefile.</p>
<p>This is useful for cases where terraform is being used to manage infrastructure.
In the end you will be able to run a command like</p>
<div class="highlight"><pre><span></span>make plan-infra
make deploy-infra
</pre></div>


<p>and and have this call the corresponding terraform commands to plan and deploy your
terraformed cloud infrastructure.</p>
<p>The post is divided into a few steps:</p>
<ul>
<li>Directory and file layout - how we lay out the files for this tutorial</li>
<li>Top level Makefile - make commands to add to the top level Makefile</li>
<li>Infra level Makefile - make commands to add to the infra level Makefile</li>
<li>Writing Terraform component - how to write a configurable component that is ready to terraform</li>
<li>Initializing Terraform component - script to initialize terraform components</li>
<li>Workflow - plan, deploy, update, destroy</li>
</ul>
<h1>Step 0: Directory and File Layout</h1>
<p>This tutorial presumes you have a top level directory corresponding to a git repository.
We will use the following directory structure for this example:</p>
<div class="highlight"><pre><span></span>my-project/
    Readme.md
    environment
    Makefile
    infra/
        Makefile
        component-1/
            variables.tf
            main.tf
</pre></div>


<h2>Environment Variables</h2>
<p>In order to keep track of environment variables used in the terraform
process, we use the file <code>envronment</code> in the top level project directory
to keep all environment variable values under version control.</p>
<div class="highlight"><pre><span></span><span class="nv">SOURCE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">while</span> <span class="o">[</span> -h <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">do</span> <span class="nv">SOURCE</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>readlink <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span>
<span class="nb">export</span> <span class="nv">PROJECT_HOME</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span> -P <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="nb">set</span> -a
<span class="nv">PROJECT_DEPLOYMENT_STAGE</span><span class="o">=</span><span class="s2">&quot;dev&quot;</span>

<span class="c1"># bucket name</span>
<span class="nv">PROJECT_S3_BUCKET</span><span class="o">=</span><span class="s2">&quot;my-organization-my-project-my-bucket&quot;</span>

<span class="c1"># aws tags</span>
<span class="nv">PROJECT_INFRA_TAG_PROJECT</span><span class="o">=</span><span class="s2">&quot;my-project&quot;</span>
<span class="nv">PROJECT_INFRA_TAG_SERVICE</span><span class="o">=</span><span class="s2">&quot;my-service&quot;</span>
<span class="nv">PROJECT_INFRA_TAG_OWNER</span><span class="o">=</span><span class="s2">&quot;whoami@email.com&quot;</span>

<span class="c1"># aws settings</span>
<span class="nv">AWS_DEFAULT_OUTPUT</span><span class="o">=</span>json
<span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-east-1
<span class="nb">set</span> +a
</pre></div>


<p>Optionally, a local environment file can contain environment variable values
that are sensitive or should not be kept under version control, so add this
to the bottom of the <code>environment</code> file too:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[[</span> -f <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_HOME</span><span class="si">}</span><span class="s2">/environment.local&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_HOME</span><span class="si">}</span><span class="s2">/environment.local&quot;</span>
<span class="k">fi</span>
</pre></div>


<h1>Step 1: Top Level Makefile</h1>
<p>Start by creating the <code>plan-infra</code> and <code>deploy-infra</code> commands in your top-level
Makefile. These commands will, in turn, call make commands defined in <code>infra/Makefile</code>:</p>
<div class="highlight"><pre><span></span><span class="nf">plan-infra</span><span class="o">:</span>
    <span class="k">$(</span>MAKE<span class="k">)</span> -C infra plan-all

<span class="nf">deploy-infra</span><span class="o">:</span>
    <span class="k">$(</span>MAKE<span class="k">)</span> -C infra apply-all
</pre></div>


<p>The <code>-C infra</code> flag indicates make should use a Makefile in a subdirectory.</p>
<h1>Step 2: Infra Level Makefile</h1>
<p>Next we define <code>infra/Makefile</code>. This Makefile will have two parts:</p>
<ul>
<li>terraform commands for a single component (example: init, plan, apply, destroy)</li>
<li>wrapper commands to run the above commands for every component (example: for each component,
  run the plan terraform command)</li>
</ul>
<p>We cover the Makefile from the bottom up.</p>
<h2>Fake Targets</h2>
<p>Start by defining "fake" targets or rules, that is, make rules whose names are not file names:</p>
<div class="highlight"><pre><span></span><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">init</span>-<span class="n">all</span> <span class="n">plan</span>-<span class="n">all</span> <span class="n">apply</span>-<span class="n">all</span> <span class="n">clean</span>-<span class="n">all</span> <span class="n">plan</span> <span class="n">apply</span> <span class="n">destroy</span> <span class="n">init</span> <span class="n">clean</span>
</pre></div>


<h2>Commands for Single Components</h2>
<p>Next, above that, we define terraform commands for a single component:</p>
<div class="highlight"><pre><span></span><span class="nf">init</span><span class="o">:</span>
    rm -rf <span class="k">$(</span>COMPONENT<span class="k">)</span>/.terraform/*.tfstate
    ./build_deploy_config.py <span class="k">$(</span>COMPONENT<span class="k">)</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform init<span class="p">;</span>

<span class="nf">plan</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform plan -detailed-exitcode

<span class="nf">apply</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform apply

<span class="nf">destroy</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform destroy

<span class="nf">clean</span><span class="o">:</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> rm -rf .terraform
</pre></div>


<p>Note that the <code>init</code> command is running a <code>build_deploy_config.py</code> script,
which we will cover in a moment. This script creates the terraform variables
file <code>variables.tf</code> and populates the variable values using environment
variables.</p>
<h2>Commands for All Components</h2>
<p>Above that, we have commands to perform each action on all components:</p>
<div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span> <span class="n">init</span>-<span class="n">all</span>

<span class="nf">init-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> init <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">plan-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> plan <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">apply-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> apply <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">destroy-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> destroy <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">clean-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> clean <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>
</pre></div>


<h2>Variables</h2>
<p>Last but not least, we define a few variables at the top of the Makefile:
most importantly, the list of infrastructure components. This is created by
extracting the names of subdirectories in <code>infra/</code> containing <code>*.tf</code> files:</p>
<div class="highlight"><pre><span></span><span class="nv">DIRS</span><span class="o">=</span><span class="si">${</span><span class="nv">shell</span><span class="p"> find . -name </span><span class="s2">&quot;*.tf&quot;</span><span class="p"> -exec dirname {</span><span class="si">}</span> <span class="se">\;</span> <span class="p">|</span> sort --unique<span class="o">}</span>
<span class="nv">COMPONENTS</span><span class="o">=</span><span class="si">${</span><span class="nv">shell</span><span class="p"> for d in </span><span class="k">$(</span>DIRS<span class="k">)</span><span class="p">; do basename </span><span class="nv">$$d</span><span class="p">; done</span><span class="si">}</span>
</pre></div>


<h2>Final Makefile</h2>
<p>Here is the final <code>infra/Makefile</code>:</p>
<p><strong><code>infra/Makefile</code>:</strong></p>
<div class="highlight"><pre><span></span><span class="nv">DIRS</span><span class="o">=</span><span class="si">${</span><span class="nv">shell</span><span class="p"> find . -name </span><span class="s2">&quot;*.tf&quot;</span><span class="p"> -exec dirname {</span><span class="si">}</span> <span class="se">\;</span> <span class="p">|</span> sort --unique<span class="o">}</span>
<span class="nv">COMPONENTS</span><span class="o">=</span><span class="si">${</span><span class="nv">shell</span><span class="p"> for d in </span><span class="k">$(</span>DIRS<span class="k">)</span><span class="p">; do basename </span><span class="nv">$$d</span><span class="p">; done</span><span class="si">}</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">init</span>-<span class="n">all</span>

<span class="nf">init-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> init <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">plan-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> plan <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">apply-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> apply <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">destroy-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> destroy <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">clean-all</span><span class="o">:</span>
    @for c in <span class="k">$(</span>COMPONENTS<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="se">\</span>
        <span class="k">$(</span>MAKE<span class="k">)</span> clean <span class="nv">COMPONENT</span><span class="o">=</span><span class="nv">$$</span>c <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>

<span class="nf">plan</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform plan -detailed-exitcode

<span class="nf">apply</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform apply

<span class="nf">destroy</span><span class="o">:</span> <span class="n">init</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform destroy

<span class="nf">init</span><span class="o">:</span>
    rm -rf <span class="k">$(</span>COMPONENT<span class="k">)</span>/.terraform/*.tfstate
    ./build_deploy_config.py <span class="k">$(</span>COMPONENT<span class="k">)</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> terraform init<span class="p">;</span>

<span class="nf">clean</span><span class="o">:</span>
    <span class="nb">cd</span> <span class="k">$(</span>COMPONENT<span class="k">)</span><span class="p">;</span> rm -rf .terraform

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">init</span>-<span class="n">all</span> <span class="n">plan</span>-<span class="n">all</span> <span class="n">apply</span>-<span class="n">all</span> <span class="n">clean</span>-<span class="n">all</span> <span class="n">plan</span> <span class="n">apply</span> <span class="n">destroy</span> <span class="n">init</span> <span class="n">clean</span>
</pre></div>


<h1>Step 3: Writing Terraform Components</h1>
<p>As an example, we will consider an example of terraform-managed buckets.</p>
<p>Start by creating a directory called <code>infra/buckets/</code> to store terraform
files for creating and managing the buckets.</p>
<p>We can create one file per cloud provider. As an example, here is <code>s3.tf</code>:</p>
<p><strong><code>s3.tf</code></strong>:</p>
<div class="highlight"><pre><span></span>data &quot;aws_caller_identity&quot; &quot;current&quot; {}

locals {
  common_tags = &quot;${map(
    &quot;project&quot;   , &quot;${var.PROJECT_INFRA_TAG_PROJECT}&quot;,
    &quot;env&quot;       , &quot;${var.PROJECT_DEPLOYMENT_STAGE}&quot;,
    &quot;service&quot;   , &quot;${var.PROJECT_INFRA_TAG_SERVICE}&quot;
  )}&quot;
  aws_tags = &quot;${map(
  &quot;Name&quot;      , &quot;${var.PROJECT_INFRA_TAG_SERVICE}-s3-storage&quot;,
  &quot;owner&quot;     , &quot;${var.PROJECT_INFRA_TAG_OWNER}&quot;,
  &quot;managedBy&quot; , &quot;terraform&quot;
  )}&quot;
}

resource aws_s3_bucket dss_s3_bucket {
  count = length(var.PROJECT_S3_BUCKET) &gt; 0 ? 1 : 0
  bucket = var.PROJECT_S3_BUCKET
  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm = &quot;AES256&quot;
      }
    }
  }
  tags = merge(local.common_tags, local.aws_tags)
}
</pre></div>


<p>Note that this requires several environment variables to be
defined in <code>environment</code> and requires the operator to run:</p>
<div class="highlight"><pre><span></span>source environment
</pre></div>


<h1>Step 4: Initializing Terraform Components</h1>
<p>The following script will automatically generate terraform files for
our component that are populated with the correct environment variable
values.</p>
<p>It is called <code>build_deploy_config.py</code>.</p>
<p>Start with a simple argument parser that just accepts a single argument,
the component to make terraform files for:</p>
<div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>


<p>Next, we define several terraform file templates using Python's
bracket template syntax. Start with a template for defining a
terraform variable:</p>
<div class="highlight"><pre><span></span>terraform_variable_template = &quot;&quot;&quot;
variable &quot;{name}&quot; {{
  default = &quot;{val}&quot;
}}
&quot;&quot;&quot;
</pre></div>


<p>Next, define a template for the terraform backend buket:</p>
<div class="highlight"><pre><span></span>terraform_backend_template = &quot;&quot;&quot;# Auto-generated during infra build process.
# Please edit infra/build_deploy_config.py directly.
terraform {{
  backend &quot;s3&quot; {{
    bucket = &quot;{bucket}&quot;
    key = &quot;{comp}-{stage}.tfstate&quot;
    region = &quot;{region}&quot;
    {profile_setting}
  }}
}}
&quot;&quot;&quot;
</pre></div>


<p>Next define terraform cloud providers:</p>
<div class="highlight"><pre><span></span>terraform_providers_template = &quot;&quot;&quot;# Auto-generated during infra build process.
# Please edit infra/build_deploy_config.py directly.
provider aws {{
  region = &quot;{aws_region}&quot;
}}
&quot;&quot;&quot;
</pre></div>


<p>Provide a list of environment variables that should also be defined as
terraform variables:</p>
<div class="highlight"><pre><span></span><span class="nv">env_vars_to_infra</span> <span class="o">=</span> <span class="o">[</span>
<span class="nv">PROJECT_DEPLOYMENT_STAGE</span><span class="o">=</span><span class="s2">&quot;dev&quot;</span>

<span class="c1"># bucket name</span>
<span class="nv">PROJECT_S3_BUCKET</span><span class="o">=</span><span class="s2">&quot;my-organization-my-project-my-bucket&quot;</span>

<span class="c1"># aws tags</span>
<span class="nv">PROJECT_INFRA_TAG_PROJECT</span><span class="o">=</span><span class="s2">&quot;my-project&quot;</span>
<span class="nv">PROJECT_INFRA_TAG_SERVICE</span><span class="o">=</span><span class="s2">&quot;my-service&quot;</span>
<span class="nv">PROJECT_INFRA_TAG_OWNER</span><span class="o">=</span><span class="s2">&quot;whoami@email.com&quot;</span>

<span class="c1"># aws settings</span>
<span class="nv">AWS_DEFAULT_OUTPUT</span><span class="o">=</span>json
<span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-east-1

    <span class="s2">&quot;AWS_DEFAULT_REGION&quot;</span>,
    <span class="s2">&quot;PROJECT_DEPLOYMENT_STAGE&quot;</span>,
    <span class="s2">&quot;PROJECT_S3_BUCKET&quot;</span>,
    <span class="s2">&quot;PROJECT_INFRA_TAG_PROJECT&quot;</span>,
    <span class="s2">&quot;PROJECT_INFRA_TAG_SERVICE&quot;</span>,
    <span class="s2">&quot;PROJECT_INFRA_TAG_OWNER&quot;</span>
<span class="o">]</span>
</pre></div>


<p>Finally, substitute environment variable values into the templates, and write
the templated content to the appropriate <code>*.tf</code> file. First, the backend:</p>
<div class="highlight"><pre><span></span><span class="c1"># Write backend.tf</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infra_root</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s2">&quot;backend.tf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">caller_info</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;sts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AWS_PROFILE&#39;</span><span class="p">):</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_PROFILE&#39;</span><span class="p">]</span>
        <span class="n">profile_setting</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;profile = &quot;</span><span class="si">{profile}</span><span class="s1">&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">profile_setting</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">terraform_backend_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">bucket</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DSS_TERRAFORM_BACKEND_BUCKET_TEMPLATE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_id</span><span class="o">=</span><span class="n">caller_info</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]),</span>
        <span class="n">comp</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
        <span class="n">stage</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DSS_DEPLOYMENT_STAGE&#39;</span><span class="p">],</span>
        <span class="n">region</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_DEFAULT_REGION&#39;</span><span class="p">],</span>
        <span class="n">profile_setting</span><span class="o">=</span><span class="n">profile_setting</span><span class="p">,</span>
    <span class="p">))</span>
</pre></div>


<p>Next, the <code>variables.tf</code> for the component:</p>
<div class="highlight"><pre><span></span><span class="c1"># Write variables.tf</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infra_root</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s2">&quot;variables.tf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Auto-generated during infra build process.&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Please edit infra/build_deploy_config.py directly.&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env_vars_to_infra</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">terraform_variable_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">))</span>
</pre></div>


<p>Finally, the cloud providers file <code>providers.tf</code>:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infra_root</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">component</span><span class="p">,</span> <span class="s2">&quot;providers.tf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">terraform_providers_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">aws_region</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AWS_DEFAULT_REGION&#39;</span><span class="p">],</span>
        <span class="n">gcp_project_id</span><span class="o">=</span><span class="n">GCP_PROJECT_ID</span><span class="p">,</span>
    <span class="p">))</span>
</pre></div>


<h1>Workflow</h1>
<p>We now have a top-level Makefile that wraps the plan and apply commands directly,
and we have an infra-level Makefile with additional commands for managing infrastructure
(plan, apply, destroy).</p>
<h2>Plan</h2>
<p>The terraform plan step assembles the various templated terraform files and substitutes
environment variables into them, creating a new version of them with up-to-date values.</p>
<p>The plan step (<code>make plan-infra</code>) calls the <code>build_deploy_config.py</code> script (detailed above)
to regenerate the terraform files when environment variables are changed.</p>
<div class="highlight"><pre><span></span>make plan-infra
</pre></div>


<p>This script will iterate over each cloud infrastructure component in <code>infra/</code>, use terraform
to plan the changes it would make to cloud resources, and print a summary of those changes
to the screen.</p>
<p><strong>The <code>make plan-infra</code> command does not change any cloud infra.</strong></p>
<h2>Deploy</h2>
<p>The terraform deploy step makes the changes summarized in the <code>make plan-infra</code> step. This
command automates the terraform commands, but still requires interactive "yes" responses
to commands.</p>
<h2>Update</h2>
<p>Using the <code>make plan-infra</code> command will remake the terraform files using environment variable
values, and will display any changes that will be made to cloud infra. This includes updates to
existing infrastructure.</p>
<p>When you finish deploying infrastructure, store the version of your <code>environment</code> file in version
control and tag it as the current deployed infra. This will make it easier to delete infra later.</p>
<p>If you need to rename infra, use the following workflow:</p>
<ol>
<li>
<p>Source the old <code>environment</code> file</p>
</li>
<li>
<p>Destroy the old infra with the old names using:</p>
<p><code>text
make -C infra COMPONENT=buckets destroy</code></p>
<p>Or destroy all infra with the <code>destroy-all</code> command:</p>
<p><code>text
make -C infra destroy-all</code></p>
</li>
<li>
<p>Update the environment file with the new names, and source the new <code>environment</code> file</p>
</li>
<li>
<p>Plan the new infra with</p>
<p><code>text
make plan-infra</code></p>
</li>
<li>
<p>Deploy the new infra with</p>
<p><code>text
make deploy-infra</code></p>
</li>
</ol>
<h2>Destroy</h2>
<p>As seen above, infrastructure components can be deleted with the <code>delete</code> command in the infra
Makefile, and all infrastructure components can be deleted with the <code>delete-all</code> command.</p>
<p>To delete a particular component:</p>
<div class="highlight"><pre><span></span>make -C infra COMPONENT=buckets destroy
</pre></div>


<p>To destroy all infra:</p>
<div class="highlight"><pre><span></span>make -C infra destroy-all
</pre></div></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/terraform.html">terraform</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/makefile.html">makefile</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/make.html">make</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Automatically Generating Up-To-Date requirements.txt for Python Projects
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-12-12T12:12:00-08:00" pubdate>Thursday 12/12/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/python.html">Python</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/automatically-generating-up-to-date-requirementstxt-for-python-projects.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h2>Table of Contents</h2>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#what-is-requirementstxt">What is requirements.txt?</a></li>
<li><a href="#converting-requirementstxtin-to-requirementstxt">Converting requirements.txt.in to requirements.txt</a></li>
<li><a href="#automating-the-step-with-a-make-rule">Automating the step with a make rule</a></li>
<li><a href="#refreshing-requirements">Refreshing requirements</a></li>
</ul>
<p><br />
<br /></p>
<h2>Summary</h2>
<p>In this post, we cover a pattern for automatically generating a <code>requirements.txt</code> file that has the latest
compatible versions of required software, and that specifies the full and exact version of each package to
make the Python environment reproducible.</p>
<p>This will turn a requirements input file (called <code>requirements.txt.in</code> for example) that looks like</p>
<div class="highlight"><pre><span></span>numpy
</pre></div>


<p>into a requirements file that specifies the exact version of <code>numpy</code> and all dependencies, like</p>
<div class="highlight"><pre><span></span>numpy==1.18.1
</pre></div>


<p>By the end of this post, you'll be able to do this to refresh and update the versions of all the software your
project depends on:</p>
<div class="highlight"><pre><span></span>make requirements.txt
</pre></div>


<p><strong>All of this code comes from the Human Cell Atlas <a href="https://github.com/HumanCellAtlas/data-store">data-store</a>
project!</strong></p>
<h2>What is requirements.txt?</h2>
<p>When developing a Python project, the <code>requirements.txt</code> file is a plain text file that contains a list of
Python software packages that need to be installed for the current Python software package to work. The software
can be installed using the command</p>
<div class="highlight"><pre><span></span>pip install -r requirements.txt
</pre></div>


<p>For example, if a package <code>foobar</code> has <code>import numpy</code> at the top of a Python file in the project, the <code>numpy</code> package
must be installed before importing <code>foobar</code>. In this case, the <code>requirements.txt</code> could just contain</p>
<div class="highlight"><pre><span></span>numpy
</pre></div>


<p>or it could specify a particular version of numpy, or a minimum version of numpy:</p>
<div class="highlight"><pre><span></span>numpy &gt;= 1.10
</pre></div>


<p>Start by creating a <code>requirements.txt.in</code>, which should look like a normal <code>requirements.txt</code> file,
listing software packages for pip to install (and optionally version information - but version information
does not <em>need</em> to be specified).</p>
<p>This file is a looser set of specifications of software versions.</p>
<p>Example <code>requirements.txt.in</code>:</p>
<div class="highlight"><pre><span></span>numpy
pandas &gt; 0.22
sphinx
</pre></div>


<h2>Converting requirements.txt.in to requirements.txt</h2>
<p>Next, we use the <code>requirements.txt.in</code> file to install the latest versions of each software package (and all
dependent software packages) into a virtual environment.</p>
<p>From that virtual environment, we can use <code>pip freeze</code> to output the names of each software package installed in
the virtual environment, along with its exact version. This can be used to make a <code>requirements.txt</code> file.</p>
<p>The manual steps are</p>
<div class="highlight"><pre><span></span>virtualenv -p $(which python3) venv
venv/bin/pip install -r requirements.txt
venv/bin/pip install -r requirements.txt.in
venv/bin/pip freeze &gt;&gt; requirements.txt
rm -fr venv
</pre></div>


<p>Using pip freeze means the resulting <code>results.txt</code> contains detailed version numbers:</p>
<div class="highlight"><pre><span></span>alabaster==0.7.12
Babel==2.7.0
certifi==2019.11.28
chardet==3.0.4
docutils==0.15.2
idna==2.8
imagesize==1.1.0
Jinja2==2.10.3
MarkupSafe==1.1.1
numpy==1.17.4
packaging==19.2
pandas==0.25.3
Pygments==2.5.2
pyparsing==2.4.5
python-dateutil==2.8.1
pytz==2019.3
requests==2.22.0
six==1.13.0
snowballstemmer==2.0.0
Sphinx==2.2.2
sphinxcontrib-applehelp==1.0.1
sphinxcontrib-devhelp==1.0.1
sphinxcontrib-htmlhelp==1.0.2
sphinxcontrib-jsmath==1.0.1
sphinxcontrib-qthelp==1.0.2
sphinxcontrib-serializinghtml==1.1.3
urllib3==1.25.7
</pre></div>


<p>This is automated with a make rule next.</p>
<h2>Automating the step with a make rule</h2>
<p>We have a nice Makefile rule that can be dropped into
any Makefile that allows users to run</p>
<div class="highlight"><pre><span></span>make requirements.txt
</pre></div>


<p>and it will use <code>requirements.txt.in</code>, perform the above steps, and output an updated <code>requirements.txt</code> with the
latest compatible versions of software.</p>
<p>Here is the Makefile rule:</p>
<div class="highlight"><pre><span></span><span class="nf">requirements.txt</span><span class="o">:</span> %.<span class="n">txt</span> : %.<span class="n">txt</span>.<span class="n">in</span>
    <span class="o">[</span> ! -e .requirements-env <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
    virtualenv -p <span class="k">$(</span>shell which python3<span class="k">)</span> .$&lt;-env
    .$&lt;-env/bin/pip install -r <span class="nv">$@</span>
    .$&lt;-env/bin/pip install -r $&lt;
    <span class="nb">echo</span> <span class="s2">&quot;# You should not edit this file directly.  Instead, you should edit </span>$<span class="s2">&lt;.&quot;</span> &gt;<span class="p">|</span> <span class="nv">$@</span>
    .$&lt;-env/bin/pip freeze &gt;&gt; <span class="nv">$@</span>
    rm -rf .$&lt;-env
</pre></div>


<p>Summary of the make rule:</p>
<ul>
<li>
<p>The first two lines create a virtual environment at <code>.requirements-env/</code></p>
</li>
<li>
<p>The next two lines run <code>pip install</code>, first on <code>requirements.txt</code> (the existing version), then
  <code>requirements.txt.in</code> (which installs/updates any software packages in <code>requirements.txt.in</code>)</p>
</li>
<li>
<p>A comment is added to the top of the <code>requirements.txt</code> file to help give users a hint about
  where to update software requirements.</p>
</li>
<li>
<p>The <code>pip freeze</code> command is used to create a <code>requirements.txt</code> file from the current virtual
  environment</p>
</li>
</ul>
<h2>Refreshing requirements</h2>
<p>To update the requirements, update the <code>requirements.txt</code> with these manual steps:</p>
<div class="highlight"><pre><span></span><span class="nf">refresh_all_requirements</span><span class="o">:</span>
    @cat /dev/null &gt; requirements.txt
    @if <span class="o">[</span> <span class="nv">$$</span><span class="o">(</span>uname -s<span class="o">)</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> sleep <span class="m">1</span><span class="p">;</span> <span class="k">fi</span>  <span class="c1"># this is require because Darwin HFS+ only has second-resolution for timestamps.</span>
    @touch requirements.txt.in
    @<span class="k">$(</span>MAKE<span class="k">)</span> requirements.txt
</pre></div>


<p>Now <code>requirements.txt</code> can be updated with</p>
<div class="highlight"><pre><span></span>make refresh_all_requirements
</pre></div>


<p>This can be done periodically, and the new <code>requirements.txt</code> updated in the version control system.</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/python.html">python</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/pip.html">pip</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/version-control.html">version control</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/make.html">make</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/makefile.html">makefile</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>
  	            	<article>
<header>
<div class="row">


    <div class="col-md-12">
        <div class="headtext" style="text-align: center;">
            <h1><b>
                Git Workflows, Part 3: Refactoring Large Branches and Pull Requests
            </b></h1>
        
            <p class="lead">
                Posted 
                <time datetime="2019-12-08T15:00:00-08:00" pubdate>Sunday 12/08/2019</time>
                in 
                <a href="https://charlesreid1.github.io/category/git.html">Git</a>
                </p>
            <p>
            <span style="font-size: 14px">
                <a href="https://charlesreid1.github.io/git-workflows-part-3-refactoring-large-branches-and-pull-requests.html">permalink</a>
            </span>
            </p>
        </div>

    </div>

</div>
</header>


<div class="v50"></div>


<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="entry-content"><h1>Table of Contents</h1>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#managing-complexity">Managing Complexity</a></li>
<li><a href="#refactoring-large-branches">Refactoring Large Branches</a><ul>
<li><a href="#converting-set-of-commits-to-unstaged-changes">Converting Set of Commits to Unstaged Changes</a><ul>
<li><a href="#git-format-patch">git format-patch</a></li>
<li><a href="#cherry-pick-and-unstage">cherry-pick and unstage</a></li>
<li><a href="#soft-reset-and-commit">soft reset and commit</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#refactoring-large-pull-requests">Refactoring Large Pull Requests</a><ul>
<li><a href="#chaining-pull-requests">Chaining Pull Requests</a></li>
<li><a href="#preparing-to-merge-a-large-pull-request">Preparing to Merge a Large Pull Request</a></li>
<li><a href="#rinse-and-repeat">Rinse and Repeat</a></li>
<li><a href="#final-merge-into-master">Final Merge into Master</a></li>
</ul>
</li>
</ul>
<h1>Summary</h1>
<ul>
<li>If a feature branch or pull request gets too complicated and should be refactored
  into simpler pieces:<ul>
<li>Create a new feature branch from the original destination branch</li>
<li>Turn commits into patches, or cherry-pick commits (leaving changes unstaged)</li>
<li>Apply patches or cherry-picks to the feature branch</li>
<li>Use <code>git add --patch</code> or <code>git add --edit</code> to selectively split out changes into separate commits</li>
</ul>
</li>
</ul>
<p>This post contains many common patterns applied to different workflows.</p>
<h1>Managing Complexity</h1>
<p>When collaborating on software, especially large software with people who are not the
primary developers, it is important to limit the complexity of features and proposed
changes. Why is it bad practice to propose large, complex changes?</p>
<ul>
<li>It is harder to review the proposed changes</li>
<li>Bugs increase in likelihood, and increase in likelihood far faster than the amount of code.</li>
<li>More complex changes usually combine </li>
</ul>
<h1>Refactoring Large Branches</h1>
<p>Consider the case of a large feature branch that is suffering from feature creep (trying to
cram too many changes into one branch.) For example, in the process of implementing a feature,
you may also implement significant fixups, refactoring of functions, and code cleanup that is
in the same file but not entirely related. While writing tests for the new feature, you may also
refactor tests to be cleaner, or to use context manager foobar, or etc.</p>
<p>To illustrate: suppose you are on a branch called <code>feature</code> (created off of <code>master</code>) that consists of
three sets of changes, DEF:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D1 - E1 - D2 - F1 - E2 - F2 - D3 - F3 - E3 (feature)
</pre></div>


<ul>
<li>D corresponds to implementing the new feature and writing tests for it</li>
<li>E corresponds to fixups to the same file that was changed to implement the feature</li>
<li>F corresponds to fixups to tests unrelated to the new feature</li>
</ul>
<p>Now, in reality, if things were really so clean, if you had a time machine or the patience to
to rebase commits one at a time and split them into atomic changes only to the features in their
scope (which would be super easy because of course your git logs are filled with helpful, concise
commit messages) you could use <code>git cherry-pick</code> to replay commits D1, D2, D3 onto a new D
branch, and so on. </p>
<p>But in reality, commit F1 contains a little bit of E1, and D2, and vice versa, and so on.
It's much easier to navigate a diff and select pieces from it.  That's were <code>git add -e</code>
(or <code>--edit</code>) will help.</p>
<p>We also have to turn a set of commits into a single set of unstaged changes (meaning, replay
the changes each commit made but not replay the commits themselves). There are a few ways
to do this, we'll cover two ways: squashing and rolling back a set of commits, and converting
a set of commits into a set of patch files.</p>
<p>Once the commits have been rolled back and unstaged, particular changes can be staged for each
split commit using <code>git add -e</code> and using the editor to select which changes to include or exclude
from the commit. As each commit is created, branches can be created that are linked to the group
of changes in each new commit.</p>
<h2>Converting a Set of Commits to Unstaged Changes</h2>
<p>We are trying to untangle a set of unrelated changes into separate commits that group related
changes together. For the example, we want to convert this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D1 - E1 - D2 - F1 - E2 - F2 - D3 - F3 - E3 (feature)
</pre></div>


<p>to this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D - E - F (feature)
</pre></div>


<p>so that the changes in commits D, E, and F are simpler, more limited in scope, and easier to review.</p>
<p>We cover three strategies for turning a sequence of commits like <code>D1-E1-...-E3</code> into a set of unstaged
changes. Then, particular changes can be selectively added to commits using <code>git add -e</code> (<code>--edit</code>) or
<code>git add -p</code> (<code>--patch</code>).</p>
<h3>git format-patch</h3>
<p>To create a set of patches, one per commit, to edit them or apply them in various orders,
you can use <code>git format-patch</code> with a commit range:</p>
<div class="highlight"><pre><span></span>git format-patch D1..E3
</pre></div>


<p>This will create a series of patches like </p>
<div class="highlight"><pre><span></span>patches/0001-the-D1-commit-message.patch
patches/0001-the-E1-commit-message.patch
patches/0001-the-D2-commit-message.patch
patches/0001-the-F1-commit-message.patch
patches/0001-the-E2-commit-message.patch
patches/0001-the-F2-commit-message.patch
patches/0001-the-D3-commit-message.patch
patches/0001-the-F3-commit-message.patch
patches/0001-the-E3-commit-message.patch
</pre></div>


<p>Patches can be further split or modified, and can be applied in the desired order (although
changes in line numbers happening out of order may confuse the program applying the patch).</p>
<p>Start by creating a branch from the desired commit (commit <code>B</code> in the diagram above):</p>
<div class="highlight"><pre><span></span>git checkout B
</pre></div>


<p>(where <code>B</code> should be either the commit hash for commit B, or a tag or branch that is associated
with commit B). Now create a branch that will start from that commit (we'll start with our branch
for feature D here):</p>
<div class="highlight"><pre><span></span>git checkout -b feature-d
</pre></div>


<p>Now apply patches to the new branch, which will start from commit <code>B</code>.</p>
<p>To apply a patch, use <code>patch -p1</code>:</p>
<div class="highlight"><pre><span></span>patch -p1 &lt; 0001-the-D1-commit-message.patch
</pre></div>


<p>The <code>-p1</code> strips the prefix by 1 directory level, which is necessary with patches created
by git. We use <code>patch</code> rather than <code>git am</code> to apply the patch, because we want to apply
the changes independent of git, and only stage the changes we want into our next commit.</p>
<p>If you have a series of commits that you want to squash, that's also easy to do by applying
each patch for those commits, then staging all the changes from those patches into a new
commit.</p>
<p>As patches are applied, particular changes can be staged and commits can be crafted. Use 
the <code>--edit</code> or <code>--patch</code> flags of <code>git add</code>:</p>
<div class="highlight"><pre><span></span>git add --edit &lt;filename&gt;
git add --patch &lt;filename&gt;
</pre></div>


<p>This allows selective filtering of particular edits into the next commit, so that one patch
(or any number of patches) can be applied, and selective changes can be staged into a commit.</p>
<p>Once you are ready, just run</p>
<div class="highlight"><pre><span></span>git commit
</pre></div>


<p>without specifying the filename. (If you specify the filename, it will stage all changes,
and ignore the crafting you've done.)</p>
<p>As you create a commit or a set of commits specific to changeset D, you can work on a D branch.
When you finish all commits related to D, you can start a new branch with</p>
<div class="highlight"><pre><span></span>git checkout feature-e
</pre></div>


<p>that will start a new branch from where the d-branch left off. Chaining your
changes together into several small branches that build on each other will 
help keep pull requests simpler too.</p>
<p>The advantages of this approach include:</p>
<ul>
<li>Commits can be split by applying the patch and staging particular edits</li>
<li>The ability to split single commits into more commits, or combine/squash commits together, means
  this approach has a lot of flexibility</li>
<li>Best for some situations where, e.g., a long series of commits with many small commits that should
  be squashed and some large commits that should be split </li>
</ul>
<p>The disadvantages of this approach include:</p>
<ul>
<li>Patches applied out of order can confuse the program applying the patches</li>
</ul>
<h3>cherry-pick and unstage</h3>
<p>An alternative to the above workflow is to use <code>git cherry-pick</code> to apply the changes from particular
commits, but to leave those changes unstaged using the <code>--no-commit</code> or <code>-n</code> flag:</p>
<div class="highlight"><pre><span></span>git cherry-pick --no-commit &lt;commit-hash&gt;
git cherry-pick -n &lt;commit-hash&gt;
</pre></div>


<p>Alternatively, a range of commits can be used instead:</p>
<div class="highlight"><pre><span></span>git cherry-pick -n &lt;commit-hash-start&gt;..&lt;commit-hash-end&gt;
</pre></div>


<p>This can help achieve a similar level of flexibility to the patch approach.</p>
<h3>soft reset and commit</h3>
<p>Suppose the commit history is simple enough that you can squash all of the commits together
into a single diff set, and pick the changes to split into commits D, E, and F.</p>
<p>In that case, the easiest way might be to roll back all of the commits made, but preserve
the changes that each commit made. This is precisely what a <em>soft reset</em> will do.</p>
<p>For the git commit history</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D1 - E1 - D2 - F1 - E2 - F2 - D3 - F3 - E3 (feature)
</pre></div>


<p>Run the command</p>
<div class="highlight"><pre><span></span>git reset --soft B
</pre></div>


<p>to move the HEAD pointer to commit B, while also <em>preserving</em> all changes made from the
start of the feature branch <code>D1</code> to the tip of the feature branch <code>E3</code>, all added as
staged changes (as though they had been <code>git add</code>-ed).</p>
<p>The changes will be staged, but changes to files can be unstaged using</p>
<div class="highlight"><pre><span></span>git restore --staged &lt;filename&gt;
</pre></div>


<p>Now add changes selectively using the <code>--edit</code> or <code>--patch</code> flags</p>
<div class="highlight"><pre><span></span>git add --edit &lt;filename&gt;
git add --patch &lt;filename&gt;
</pre></div>


<p>If desired, those changes can be unstaged, and then re-staged using <code>git add --edit</code> or
<code>git add --patch</code> to selectively add changes to particular commits.</p>
<p>When done, run </p>
<div class="highlight"><pre><span></span>git commit
</pre></div>


<p>with no arguments to commit the changes you made.</p>
<h1>Refactoring Large Pull Requests</h1>
<p>The approaches above can be useful for refactoring branches. The end result will look something like this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D (feature-d)
      \ 
       E (feature-e)
        \
         F (feature-f)
</pre></div>


<p>Now 3 pull requests can be made, one for each feature. Thanks to the refactoring above, each branch
should be a more isolated set of changes that are all related, and therefore easier to review.</p>
<h2>Chaining Pull Requests</h2>
<p>The three D E F branches should be merged in together, since they are all related. But their changes should
be kept separate to make reviewing each branch easier. To accomplish this, chain the pull requests together
like so:</p>
<p>Pull Request 1: merge <code>feature-d</code> into <code>master</code></p>
<p>Pull Request 2: merge <code>feature-e</code> into <code>feature-d</code></p>
<p>Pull Request 3: merge <code>feature-f</code> into <code>feature-e</code></p>
<p>In this way, each pull request only shows the changes specific to that branch.</p>
<p>(If each pull request were made against <code>master</code>, then later branches (F) would also incorporate changes
from prior branches (D), resulting in messy and hard-to-review pull requests.)</p>
<p>Pull requests are reviewed and discussed, and new commits will probably be added to fix things or incorporate
feedback:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D - DA - DB (feature-d)
      \ 
       E - EA - EB (feature-e)
        \
         F - FA - FB (feature-f)
</pre></div>


<h2>Preparing to Merge a Large Pull Request</h2>
<p>All of your pull requests are approved and ready to merge. Now what?</p>
<p>Pull requests will need to be merged in reverse order (last PR is merged first - f into e, e into d, d into
master).  To test that things go smoothly with the first pull request (<code>feature-f</code> into <code>feature-e</code>), we should
create a local E-F integration branch.</p>
<p>The local integration branch will have new commits if changes are needed to resolve merge conflicts or fix
broken tests. Any changes made can be added to the <code>feature-f</code> branch and pushed to the remote, so that
they are part of the pull request, making the merge into <code>feature-e</code> go smoothly.</p>
<p>To create a throwaway E-F integration branch, we start by creating a test integration branch from the tip of the
<code>feature-f</code> branch, and we will merge branch <code>feature-e</code> into branch <code>feature-f</code>.</p>
<div class="highlight"><pre><span></span>git checkout feature-f
</pre></div>


<p>Now we create a local E-F integration branch:</p>
<div class="highlight"><pre><span></span>git checkout -b integration-e-f
</pre></div>


<p>Now we merge <code>feature-e</code> into <code>integration-e-f</code>, which is the same as <code>feature-f</code>:</p>
<div class="highlight"><pre><span></span>git merge --no-ff feature-e
</pre></div>


<p>The <code>--no-ff</code> flag creates a separate merge commit, which is useful here to keep our commit history clean.</p>
<p>If merge conflicts are encountered, those can be resolved in the usual manner, and the (conflict-free) new
versions of each file, reflecting changes from <code>feature-f</code> and <code>feature-e</code>, will all be present after the
merge commit.</p>
<p>Further commits can also be made to make tests pass, with a resulting git diagram:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D - DA - DB (feature-d)
      \ 
       E - EA - EB ----
        \              \
         F - FA - FB - EF1 - EF2 (integration-e-f)
                              ^
                             HEAD
</pre></div>


<p>Once the <code>integration-e-f</code> branch is polished and passing tests, we can re-label it as <code>feature-f</code> and push
the new commits to the remote. To re-label <code>integration-e-f</code> as <code>feature-f</code>, assuming we're at the tip of
the <code>integration-e-f</code> branch (where we left off above):</p>
<div class="highlight"><pre><span></span>git branch -D feature-f
git checkout -b feature-f
</pre></div>


<p>and push the new commits to the remote's <code>feature-f</code> branch, before you merge in the pull request (<code>feature-f</code>
into <code>feature-e</code>):</p>
<div class="highlight"><pre><span></span>git push origin feature-f
</pre></div>


<p>Now you are ready to merge pull request 3 (F into E).</p>
<h2>Rinse and Repeat</h2>
<p>Rinse and repeat for pull requests 2 and 1.</p>
<p>For Pull Request 2, we start by creating a new <code>integration-d-e-f</code> branch from the tip of the
<code>integration-e-f</code> branch, like so:</p>
<div class="highlight"><pre><span></span>git checkout integration-d-e
git checkout -b integration-d-e-f
</pre></div>


<p>and use the same approach of merging in the <code>feature-d</code> branch with an explicit merge commit:</p>
<div class="highlight"><pre><span></span>git merge --no-ff feature-d
</pre></div>


<p>Work out any merge conflicts that result, and add any additional changes needed to get tests passing,
and you should now have a git commit history like this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
    \
     D - DA - DB ----------------
      \                          \
       E - EA - EB ----           \
        \              \           \
         F - FA - FB - EF1 - EF2 - DEF1 - DEF2 (integration-d-e-f)
                                            ^
                                           HEAD
</pre></div>


<p>Now re-label the <code>integration-d-e-f</code> branch as <code>feature-e</code>:</p>
<div class="highlight"><pre><span></span>git branch -D feature-e &amp;&amp; git checkout -b feature-e
</pre></div>


<p>Finally, push all new commits to the remote, including the new merge
commit, which will make sure the pull request can be merged without
any conflicts:</p>
<div class="highlight"><pre><span></span>git push origin feature-e
</pre></div>


<p>Now PR 2 (E into D) can be merged.</p>
<h2>Final Merge into Master</h2>
<p>The last and final PR, D into master, will merge all combined feature
branches into the master branch. We start with a <code>feature-d</code> branch
that has several commits related to feature D, then several commits
from merging the <code>feature-e</code> branch in (pull request 2, E into D),
and the <code>feature-e</code> branch also had <code>feature-f</code> merged into it.</p>
<div class="highlight"><pre><span></span>A - B - C (master)
     \
      D - D2 - DEF1 - DEF2 (feature-d)
</pre></div>


<p>Now we will create one more commit on the <code>feature-d</code> branch that is
merging <code>master</code> into <code>feature-d</code>, which will help the merge happen
smoothly for pull request 1 (D into master).</p>
<p>But first we switch to an integration branch, in case things don't go
smoothly and we want to throw away the merge commit:</p>
<div class="highlight"><pre><span></span>git branch integration-def-master
</pre></div>


<p>Create an explicit merge commit to merge <code>master</code> into <code>integration-def-master</code>:</p>
<div class="highlight"><pre><span></span>git merge --no-ff master
</pre></div>


<p>Work out any merge conflicts that result, and add any additional changes needed to get tests passing,
and you should now have a git commit history like this:</p>
<div class="highlight"><pre><span></span>A - B - C (master)
     \   \---------------------
      \                        \
       D - D2 - DEF1 - DEF2 - DEF3 (integration-def-master)
</pre></div>


<p>where commit <code>DEF3</code> is the merge commit created with the <code>--no-ff</code> command.</p>
<p>The merge commit will resolve any conflicts. When you're satisfied with the
merge commit, you can switch out the <code>integration-def-master</code> branch with the
<code>feature-d</code> branch like so:</p>
<div class="highlight"><pre><span></span>git branch -D feature-d
git checkout -b feature-d
</pre></div>


<p>Now you can push the merge commit to the remote:</p>
<div class="highlight"><pre><span></span>git push origin feature-d
</pre></div>


<p>and you're now ready to merge your (conflict-free) pull request!</p></div>

    </div>
</div>

<div class="v20"></div>

<div class="row">
    <div class="col-md-12" style="text-align: left;">

        <div class="tags">
            <p>Tags:&nbsp;&nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/git.html">git</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/rebase.html">rebase</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/cherry-pick.html">cherry-pick</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/branching.html">branching</a>
                    &nbsp;&nbsp;
                    <a href="https://charlesreid1.github.io/tag/version-control.html">version control</a>
                    &nbsp;&nbsp;
        </div>

    </div>
</div>


<div class="v200"></div>
  	            	</article>

<div class="row">
    <div class="col-md-4 col-centered" style="text-align: center;">

        <div class="pagination">

            <a class="next" href="https://charlesreid1.github.io/index.html">&larr; Newer</a>

            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;
            &nbsp;

            <a class="prev" href="https://charlesreid1.github.io/index3.html">Older &rarr;</a>
        
          <br />
        </div>

    </div>
</div>

<div class="v50"></div>


        </div>

        <div class="col-md-4" style="text-align: center;">
<a name="a_archive"></a>


        <div class="well">

            <h2>February 2020</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/python-from-args-to-kwargs.html">Python: From Args to Kwargs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/confuse-a-constructor-when-class-as-constructor-returns-objects-of-type-b.html">Confuse-A-Constructor: When Class A's Constructor Returns Objects of Type B</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-patterns-the-registry.html">Python Patterns: The Registry</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/incorporating-terraform-commands-into-makefiles.html">Incorporating Terraform Commands into Makefiles</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/automatically-generating-up-to-date-requirementstxt-for-python-projects.html">Automatically Generating Up-To-Date requirements.txt for Python Projects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-3-refactoring-large-branches-and-pull-requests.html">Git Workflows, Part 3: Refactoring Large Branches and Pull Requests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>November 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-2-crafting-commits.html">Git Workflows, Part 2: Crafting Commits</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/git-workflows-part-1-supercharging-your-git-config.html">Git Workflows, Part 1: Supercharging your Git Config</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mocking-aws-in-unit-tests.html">Mocking AWS in Unit Tests</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/deconvoluting-convolutional-neural-networks.html">Deconvoluting Convolutional Neural Networks</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-2-finding-eulerian-paths.html">Graphs for Bioinformatics, Part 2: Finding Eulerian Paths</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/graphs-for-bioinformatics-part-1-de-bruijn-graphs-hamiltonian-paths-and-eulerian-paths.html">Graphs for Bioinformatics, Part 1: de Bruijn Graphs, Hamiltonian Paths, and Eulerian Paths</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-git-commit-ectomy.html">The Git-Commit-Ectomy</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-3-solving-the-double-step-case.html">The Josephus Problem: Part 3: Solving the Double Step Case</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-2-two-examples.html">The Josephus Problem: Part 2: Two Examples</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-josephus-problem-part-1-the-problem.html">The Josephus Problem: Part 1: The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/approximating-pi-happy-pi-day.html">Approximating Pi (Happy Pi Day)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-5-the-try-trie-tree.html">Five Letter Words: Part 5: The Try Trie Tree</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-4-revisiting-diff-by-one.html">Five Letter Words: Part 4: Revisiting Diff by One</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/centillion-a-document-search-engine.html">centillion: a document search engine</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/any-color-you-like-as-long-as-its-00add8.html">Any Color You Like, As Long As It's 00ADD8</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/a-few-of-my-favorite-peps.html">A Few of My Favorite PEPs</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/context-managers-in-python.html">Context Managers in Python</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2019</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-kubernetes-workflows.html">Building Snakemake Command Line Wrappers for Kubernetes Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/building-snakemake-command-line-wrappers-for-workflows.html">Building Snakemake Command Line Wrappers for Workflows</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-3-go-implementation-of-backtracking.html">Recursive Backtracking in Go for Bioinformatics Applications: 3. Go Implementation of Backtracking</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>December 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-2-generating-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 2. Generating Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/recursive-backtracking-in-go-for-bioinformatics-applications-1-counting-variations.html">Recursive Backtracking in Go for Bioinformatics Applications: 1. Counting Variations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/basic-data-structures-in-go-maps.html">Basic Data Structures in Go: Maps</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/learning-bioinformatics-with-go-and-rosalind.html">Learning Bioinformatics with Go and Rosalind</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>October 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-2-flaskadillo.html">First Post of the Fall, Part 2: Flaskadillo</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/first-post-of-the-fall-part-1-data-commons.html">First Post of the Fall, Part 1: Data Commons</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/current-projects.html">Current Projects</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/charlesreid1com-stack.html">Charlesreid1.com Stack</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>February 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/d3-calendar-visualizations.html">D3 Calendar Visualizations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-172.html">Project Euler Problem 172</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>January 2018</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-4-sequence-order.html">4x4 Rubik's Cube: Part 4: Sequence Order</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-3-factoring-permutations.html">4x4 Rubik's Cube: Part 3: Factoring Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-2-permutations.html">4x4 Rubik's Cube: Part 2: Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/4x4-rubiks-cube-part-1-representations.html">4x4 Rubik's Cube: Part 1: Representations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/lets-generate-permutations.html">Let's Generate Permutations!</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>September 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-3-letter-coverage-and-dynamic-programming.html">Five Letter Words: Part 3: Letter Coverage and Dynamic Programming</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-2-more-five-word-algorithms.html">Five Letter Words: Part 2: More Five-Word Algorithms</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/five-letter-words-part-1-getting-familiar-with-the-list.html">Five Letter Words: Part 1: Getting Familiar With The List</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>August 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/eulers-theorem-the-totient-function-and-calculating-totients-by-hand.html">Euler's Theorem, the Totient Function, and Calculating Totients By Hand</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>July 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/mad-combinatoric-castles.html">Mad Combinatoric Castles</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/project-euler-problem-1.html">Project Euler Problem 1</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/shortest-lattice-paths-and-multiset-permutations.html">Shortest Lattice Paths and Multiset Permutations</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-2-using-continued-fractions.html">Computing Square Roots: Part 2: Using Continued Fractions</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/computing-square-roots-part-1-using-newtons-method.html">Computing Square Roots: Part 1: Using Newton's Method</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>June 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-3-the-code.html">CSE 143 Final Project: Hilbert Sort: 3. The Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-2-the-solution-algorithm.html">CSE 143 Final Project: Hilbert Sort: 2. The Solution Algorithm</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-hilbert-sort-1-the-problem.html">CSE 143 Final Project: Hilbert Sort: 1. The Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-classy.html">CSE 143 Final Project: Classy</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/cse-143-final-project-checkers.html">CSE 143 Final Project: Checkers</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>May 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/teaching-recursion-with-the-n-queens-problem.html">Teaching Recursion with the N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-2-the-technologies.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 2: The Technologies)</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/undergraduate-research-project-wireless-sensor-networks-for-internet-of-things-applications-part-1-the-project.html">Undergraduate Research Project: Wireless Sensor Networks for Internet of Things Applications (Part 1: The Project)</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>April 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/stunnel.html">Stunnel</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/traveling-schoolteacher-problem.html">Traveling Schoolteacher Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/the-z-machine-a-simple-turing-machine.html">The Z-Machine: A Simple Turing Machine</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-2-networking-security-and-miscellany.html">AWSome Day Seattle Notes: Part 2: Networking, Security, and Miscellany</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/awsome-day-seattle-notes-part-1-the-basics.html">AWSome Day Seattle Notes: Part 1: The Basics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/setting-up-a-self-hosted-github-clone-with-gitea.html">Setting Up a Self-Hosted Github Clone with Gitea</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/better-timing-of-guava-traveling-salesperson-problem-code-timing-scripts.html">Better Timing of Guava Traveling Salesperson Problem Code: Timing Scripts</a>
            </p>

        </div>

        <div class="v20"></div>


        <div class="well">

            <h2>March 2017</h2>

            <p class="archive">
            <a href="https://charlesreid1.github.io/fixing-bottlenecks-in-the-guava-traveling-salesperson-problem-code.html">Fixing Bottlenecks in the Guava Traveling Salesperson Problem Code</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/python-vs-perl-n-queens-problem.html">Python vs. Perl: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/solving-the-traveling-salesperson-problem-with-java-and-guava.html">Solving the Traveling Salesperson Problem with Java and Guava</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/perl-vs-java-n-queens-problem.html">Perl vs. Java: N Queens Problem</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-4-combinatorics.html">Enigma Cipher Implementation: Part 4: Combinatorics</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-3-enigma-in-java-without-objects.html">Enigma Cipher Implementation: Part 3: Enigma in Java Without Objects</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-2-pseudocode.html">Enigma Cipher Implementation: Part 2: Pseudocode</a>
            </p>
            <p class="archive">
            <a href="https://charlesreid1.github.io/enigma-cipher-implementation-part-1-how-it-works.html">Enigma Cipher Implementation: Part 1: How It Works</a>
            </p>

        </div>

        <div class="v20"></div>



<div class="v100"></div>
        </div>

    </div>



</div>



<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/d3-3.5.5.js"></script><script type="text/javascript" src="https://charlesreid1.github.io/theme/js/jquery-1.11.2.js"></script>
<script type="text/javascript" src="https://charlesreid1.github.io/theme/js/bootstrap-3.3.4.js"></script>

<footer id="contentinfo" class="body">
<p>&nbsp;</p>
<p>&nbsp;</p>
<center>
	<hr />
</center>
<p>&nbsp;</p>
<p style="text-align: center">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
    </span>
    Made from the command line with vim by 
    <a href="http://charlesreid1.com">charlesreid1</a><br />
    with help from <a href="https://getbootstrap.com/">Bootstrap</a> and <a href="http://getpelican.com">Pelican</a>.
</p>

<br />

<p style="text-align: center">
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <span class="fa-stack fa-lg">
        <i class="fa fa-square fa-stack-2x" style="color:#000;"></i>
        <i class="fa fa-creative-commons fa-stack-1x fa-inverse"></i>
    </span>
    </a>
    <br />
    Licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 License</a>.
</p>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11611748;
var sc_invisible=1;
var sc_security="9fcba820";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>

<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11611748/0/9fcba820/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</footer><!-- /#contentinfo -->
</body>
</html>